=+=+= NLAN Request to router:openwrt3,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --scpmod
=+=+= NLAN Request to router:openwrt2,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --scpmod
=+=+= NLAN Request to router:openwrt1,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --scpmod
=+=+= NLAN Request to router:rpi1,platform:debian =+=+=+=+=+=+=+=+=+=+=+=+=+=+
operation: --scpmod
=+=+= Files copied to router:openwrt1,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
target_dir: /opt/nlan
files: ['nlan.py', 'command.py', 'ovsdbrow.py', 'init.py', 'db.py', 'test.py', 'system.py', 'vxlan.py', 'subnets.py', 'gateway.py', 'bridges.py', 'services.py', 'ovsdb.py', 'nlan_agent.py', 'oputil.py', 'cmdutil.py', 'nlan_debian', 'nlan.schema_0.0.1.yaml', 'nlan_openwrt', 'ovsdb_nlan.schema', 'vswitch.schema_2.0.0', 'nlan_env.conf']

=+=+= Files copied to router:openwrt2,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
target_dir: /opt/nlan
files: ['nlan.py', 'command.py', 'ovsdbrow.py', 'init.py', 'db.py', 'test.py', 'system.py', 'vxlan.py', 'subnets.py', 'gateway.py', 'bridges.py', 'services.py', 'ovsdb.py', 'nlan_agent.py', 'oputil.py', 'cmdutil.py', 'nlan_debian', 'nlan.schema_0.0.1.yaml', 'nlan_openwrt', 'ovsdb_nlan.schema', 'vswitch.schema_2.0.0', 'nlan_env.conf']

=+=+= Files copied to router:openwrt3,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
target_dir: /opt/nlan
files: ['nlan.py', 'command.py', 'ovsdbrow.py', 'init.py', 'db.py', 'test.py', 'system.py', 'vxlan.py', 'subnets.py', 'gateway.py', 'bridges.py', 'services.py', 'ovsdb.py', 'nlan_agent.py', 'oputil.py', 'cmdutil.py', 'nlan_debian', 'nlan.schema_0.0.1.yaml', 'nlan_openwrt', 'ovsdb_nlan.schema', 'vswitch.schema_2.0.0', 'nlan_env.conf']

=+=+= Files copied to router:rpi1,platform:debian =+=+=+=+=+=+=+=+=+=+=+=+=+=+
target_dir: /opt/nlan
files: ['nlan.py', 'command.py', 'ovsdbrow.py', 'init.py', 'db.py', 'test.py', 'system.py', 'vxlan.py', 'subnets.py', 'gateway.py', 'bridges.py', 'services.py', 'ovsdb.py', 'nlan_agent.py', 'oputil.py', 'cmdutil.py', 'nlan_debian', 'nlan.schema_0.0.1.yaml', 'nlan_openwrt', 'ovsdb_nlan.schema', 'vswitch.schema_2.0.0', 'nlan_env.conf']

=+=+= NLAN Request to router:openwrt3,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: rm -rf /opt/nlan
=+=+= NLAN Request to router:openwrt2,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: rm -rf /opt/nlan
=+=+= NLAN Request to router:openwrt1,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: rm -rf /opt/nlan
=+=+= NLAN Request to router:rpi1,platform:debian =+=+=+=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: rm -rf /opt/nlan
=+=+= NLAN Request to router:openwrt3,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --scpmod
=+=+= NLAN Request to router:openwrt2,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --scpmod
=+=+= NLAN Request to router:openwrt1,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --scpmod
=+=+= NLAN Request to router:rpi1,platform:debian =+=+=+=+=+=+=+=+=+=+=+=+=+=+
operation: --scpmod
=+=+= Files copied to router:openwrt3,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
target_dir: /opt/nlan
files: ['nlan.py', 'command.py', 'ovsdbrow.py', 'init.py', 'db.py', 'test.py', 'system.py', 'vxlan.py', 'subnets.py', 'gateway.py', 'bridges.py', 'services.py', 'ovsdb.py', 'nlan_agent.py', 'oputil.py', 'cmdutil.py', 'nlan_debian', 'nlan.schema_0.0.1.yaml', 'nlan_openwrt', 'ovsdb_nlan.schema', 'vswitch.schema_2.0.0', 'nlan_env.conf']

=+=+= Files copied to router:openwrt2,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
target_dir: /opt/nlan
files: ['nlan.py', 'command.py', 'ovsdbrow.py', 'init.py', 'db.py', 'test.py', 'system.py', 'vxlan.py', 'subnets.py', 'gateway.py', 'bridges.py', 'services.py', 'ovsdb.py', 'nlan_agent.py', 'oputil.py', 'cmdutil.py', 'nlan_debian', 'nlan.schema_0.0.1.yaml', 'nlan_openwrt', 'ovsdb_nlan.schema', 'vswitch.schema_2.0.0', 'nlan_env.conf']

=+=+= Files copied to router:openwrt1,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
target_dir: /opt/nlan
files: ['nlan.py', 'command.py', 'ovsdbrow.py', 'init.py', 'db.py', 'test.py', 'system.py', 'vxlan.py', 'subnets.py', 'gateway.py', 'bridges.py', 'services.py', 'ovsdb.py', 'nlan_agent.py', 'oputil.py', 'cmdutil.py', 'nlan_debian', 'nlan.schema_0.0.1.yaml', 'nlan_openwrt', 'ovsdb_nlan.schema', 'vswitch.schema_2.0.0', 'nlan_env.conf']

=+=+= Files copied to router:rpi1,platform:debian =+=+=+=+=+=+=+=+=+=+=+=+=+=+
target_dir: /opt/nlan
files: ['nlan.py', 'command.py', 'ovsdbrow.py', 'init.py', 'db.py', 'test.py', 'system.py', 'vxlan.py', 'subnets.py', 'gateway.py', 'bridges.py', 'services.py', 'ovsdb.py', 'nlan_agent.py', 'oputil.py', 'cmdutil.py', 'nlan_debian', 'nlan.schema_0.0.1.yaml', 'nlan_openwrt', 'ovsdb_nlan.schema', 'vswitch.schema_2.0.0', 'nlan_env.conf']

=+=+= NLAN Request to router:openwrt3,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
command: init.run
=+=+= NLAN Request to router:openwrt2,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
command: init.run
=+=+= NLAN Request to router:openwrt1,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
command: init.run
=+=+= NLAN Request to router:rpi1,platform:debian =+=+=+=+=+=+=+=+=+=+=+=+=+=+
command: init.run
=+=+= NLAN Reply from router:openwrt1,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
[INFO] module:nlan_agent,function:<module>,router: openwrt1
NLAN Agent initialization completed
{'mod_dir': ['command', 'config'], 'etc_dir': '/opt/nlan/etc', 'state_order': ['bridges', 'services', 'gateway', 'vxlan', 'subnets'], 'types': {'services': {'name': {'max': 1, 'key': {'type': 'string'}, 'min': 1}, 'chain': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}}, 'bridges': {'controller': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'ovs_bridges': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}, 'gateway': {'network': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'rip': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}, 'vxlan': {'remote_ips': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}, 'local_ip': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}, 'subnets': {'ip_dvr': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'peers': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}, 'vni': {'max': 1, 'key': {'minInteger': 0, 'maxInteger': 16777215, 'type': 'integer'}, 'min': 1}, 'vid': {'max': 1, 'key': {'minInteger': 0, 'maxInteger': 4095, 'type': 'integer'}, 'min': 0}, 'ip_vhost': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'ports': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}, 'default_gw': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'mode': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}}, 'tables': {'services': {'max': 'unlimited', 'key': {'type': 'uuid', 'refTable': 'NLAN_Service'}, 'min': 0}, 'bridges': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_Bridges'}, 'min': 0}, 'gateway': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_Gateway'}, 'min': 0}, 'vxlan': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_VXLAN'}, 'min': 0}, 'subnets': {'max': 'unlimited', 'key': {'type': 'uuid', 'refTable': 'NLAN_Subnet'}, 'min': 0}}, 'agent_dir': '/opt/nlan', 'indexes': {'services': 'name', 'subnets': 'vni'}, 'platform': 'openwrt', 'init': False, 'router': 'openwrt1', 'logger': <logging.Logger object at 0xb761076c>, 'schema': 'ovsdb_nlan.schema'}
[INFO] module:nlan_agent,function:_route,router: openwrt1
function:init.run, args:()
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: lxc-ls
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ovs-vsctl --if-exists del-br br-tun
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ovs-vsctl --if-exists del-br br-int
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: brctl show
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ip link set dev veth-ns3 down
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: brctl delif br3 down
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ip link set dev br3 down
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: brctl delbr br3
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ip link set dev veth-ns2 down
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: brctl delif br2 down
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ip link set dev br2 down
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: brctl delbr br2
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ip link set dev veth-ns1 down
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: brctl delif br1 down
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ip link set dev br1 down
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: brctl delbr br1
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ip netns list
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ip netns del ns-global
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ip netns del ns1
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ip netns del ns3
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ip netns del ns2
[DEBUG] module:ovsdb,function:_send,router: openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN","where":[],"op":"delete"}],"method":"transact","id":968837}
... JSON-RPC response ...
{"id":968837,"result":[{"count":1}],"error":null}


...
brctl: iface down: No such device
brctl: iface down: No such device
brctl: iface down: No such device


=+=+= NLAN Reply from router:openwrt2,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
[INFO] module:nlan_agent,function:<module>,router: openwrt2
NLAN Agent initialization completed
{'mod_dir': ['command', 'config'], 'etc_dir': '/opt/nlan/etc', 'state_order': ['bridges', 'services', 'gateway', 'vxlan', 'subnets'], 'types': {'services': {'name': {'max': 1, 'key': {'type': 'string'}, 'min': 1}, 'chain': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}}, 'bridges': {'controller': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'ovs_bridges': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}, 'gateway': {'network': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'rip': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}, 'vxlan': {'remote_ips': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}, 'local_ip': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}, 'subnets': {'ip_dvr': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'peers': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}, 'vni': {'max': 1, 'key': {'minInteger': 0, 'maxInteger': 16777215, 'type': 'integer'}, 'min': 1}, 'vid': {'max': 1, 'key': {'minInteger': 0, 'maxInteger': 4095, 'type': 'integer'}, 'min': 0}, 'ip_vhost': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'ports': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}, 'default_gw': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'mode': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}}, 'tables': {'services': {'max': 'unlimited', 'key': {'type': 'uuid', 'refTable': 'NLAN_Service'}, 'min': 0}, 'bridges': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_Bridges'}, 'min': 0}, 'gateway': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_Gateway'}, 'min': 0}, 'vxlan': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_VXLAN'}, 'min': 0}, 'subnets': {'max': 'unlimited', 'key': {'type': 'uuid', 'refTable': 'NLAN_Subnet'}, 'min': 0}}, 'agent_dir': '/opt/nlan', 'indexes': {'services': 'name', 'subnets': 'vni'}, 'platform': 'openwrt', 'init': False, 'router': 'openwrt2', 'logger': <logging.Logger object at 0xb76107cc>, 'schema': 'ovsdb_nlan.schema'}
[INFO] module:nlan_agent,function:_route,router: openwrt2
function:init.run, args:()
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: lxc-ls
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ovs-vsctl --if-exists del-br br-tun
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ovs-vsctl --if-exists del-br br-int
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: brctl show
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ip link set dev veth-ns3 down
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: brctl delif br3 down
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ip link set dev br3 down
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: brctl delbr br3
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ip link set dev veth-ns2 down
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: brctl delif br2 down
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ip link set dev br2 down
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: brctl delbr br2
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ip link set dev veth-ns1 down
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: brctl delif br1 down
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ip link set dev br1 down
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: brctl delbr br1
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ip netns list
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ip netns del ns1
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ip netns del ns3
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ip netns del ns2
[DEBUG] module:ovsdb,function:_send,router: openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN","where":[],"op":"delete"}],"method":"transact","id":75977}
... JSON-RPC response ...
{"id":75977,"result":[{"count":1}],"error":null}


...
brctl: iface down: No such device
brctl: iface down: No such device
brctl: iface down: No such device


=+=+= NLAN Reply from router:openwrt3,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
[INFO] module:nlan_agent,function:<module>,router: openwrt3
NLAN Agent initialization completed
{'mod_dir': ['command', 'config'], 'etc_dir': '/opt/nlan/etc', 'state_order': ['bridges', 'services', 'gateway', 'vxlan', 'subnets'], 'types': {'services': {'name': {'max': 1, 'key': {'type': 'string'}, 'min': 1}, 'chain': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}}, 'bridges': {'controller': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'ovs_bridges': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}, 'gateway': {'network': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'rip': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}, 'vxlan': {'remote_ips': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}, 'local_ip': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}, 'subnets': {'ip_dvr': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'peers': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}, 'vni': {'max': 1, 'key': {'minInteger': 0, 'maxInteger': 16777215, 'type': 'integer'}, 'min': 1}, 'vid': {'max': 1, 'key': {'minInteger': 0, 'maxInteger': 4095, 'type': 'integer'}, 'min': 0}, 'ip_vhost': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'ports': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}, 'default_gw': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'mode': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}}, 'tables': {'services': {'max': 'unlimited', 'key': {'type': 'uuid', 'refTable': 'NLAN_Service'}, 'min': 0}, 'bridges': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_Bridges'}, 'min': 0}, 'gateway': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_Gateway'}, 'min': 0}, 'vxlan': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_VXLAN'}, 'min': 0}, 'subnets': {'max': 'unlimited', 'key': {'type': 'uuid', 'refTable': 'NLAN_Subnet'}, 'min': 0}}, 'agent_dir': '/opt/nlan', 'indexes': {'services': 'name', 'subnets': 'vni'}, 'platform': 'openwrt', 'init': False, 'router': 'openwrt3', 'logger': <logging.Logger object at 0xb7595cac>, 'schema': 'ovsdb_nlan.schema'}
[INFO] module:nlan_agent,function:_route,router: openwrt3
function:init.run, args:()
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: lxc-ls
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ovs-vsctl --if-exists del-br br-tun
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ovs-vsctl --if-exists del-br br-int
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: brctl show
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ip link set dev veth-ns3 down
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: brctl delif br3 down
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ip link set dev br3 down
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: brctl delbr br3
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ip link set dev veth-ns2 down
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: brctl delif br2 down
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ip link set dev br2 down
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: brctl delbr br2
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ip link set dev veth-ns1 down
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: brctl delif br1 down
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ip link set dev br1 down
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: brctl delbr br1
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ip netns list
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ip netns del ns1
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ip netns del ns3
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ip netns del ns2
[DEBUG] module:ovsdb,function:_send,router: openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN","where":[],"op":"delete"}],"method":"transact","id":279465}
... JSON-RPC response ...
{"id":279465,"result":[{"count":1}],"error":null}


...
brctl: iface down: No such device
brctl: iface down: No such device
brctl: iface down: No such device


=+=+= NLAN Reply from router:rpi1,platform:debian =+=+=+=+=+=+=+=+=+=+=+=+=+=+
[INFO] module:nlan_agent,function:<module>,router: rpi1
NLAN Agent initialization completed
{'mod_dir': ['command', 'config'], 'etc_dir': '/opt/nlan/etc', 'state_order': ['bridges', 'services', 'gateway', 'vxlan', 'subnets'], 'types': {'services': {'name': {'max': 1, 'key': {'type': 'string'}, 'min': 1}, 'chain': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}}, 'bridges': {'controller': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'ovs_bridges': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}, 'gateway': {'network': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'rip': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}, 'vxlan': {'remote_ips': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}, 'local_ip': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}, 'subnets': {'ip_dvr': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'peers': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}, 'vni': {'max': 1, 'key': {'minInteger': 0, 'maxInteger': 16777215, 'type': 'integer'}, 'min': 1}, 'vid': {'max': 1, 'key': {'minInteger': 0, 'maxInteger': 4095, 'type': 'integer'}, 'min': 0}, 'ip_vhost': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'ports': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}, 'default_gw': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'mode': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}}, 'tables': {'services': {'max': 'unlimited', 'key': {'type': 'uuid', 'refTable': 'NLAN_Service'}, 'min': 0}, 'bridges': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_Bridges'}, 'min': 0}, 'gateway': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_Gateway'}, 'min': 0}, 'vxlan': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_VXLAN'}, 'min': 0}, 'subnets': {'max': 'unlimited', 'key': {'type': 'uuid', 'refTable': 'NLAN_Subnet'}, 'min': 0}}, 'agent_dir': '/opt/nlan', 'indexes': {'services': 'name', 'subnets': 'vni'}, 'platform': 'debian', 'init': False, 'router': 'rpi1', 'logger': <logging.Logger object at 0xb727254c>, 'schema': 'ovsdb_nlan.schema'}
[INFO] module:nlan_agent,function:_route,router: rpi1
function:init.run, args:()
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: lxc-ls
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: lxc-stop -n snort1
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: lxc-stop -n snort2
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: ovs-vsctl --if-exists del-br br-tun
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: ovs-vsctl --if-exists del-br br-int
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: brctl show
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: ip link set dev dmz.1001 down
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: brctl delif br111 down
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: ip link set dev veth-ns111 down
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: brctl delif br111 down
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: ip link set dev br111 down
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: brctl delbr br111
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: ip link set dev mz.101 down
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: brctl delif br1 down
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: ip link set dev veth-ns1 down
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: brctl delif br1 down
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: ip link set dev br1 down
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: brctl delbr br1
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: ip netns list
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: ip netns del ns1
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: ip netns del ns111
[DEBUG] module:ovsdb,function:_send,router: rpi1
... JSON-RPC request ...
{"params": ["Open_vSwitch", {"table": "NLAN", "where": [], "op": "delete"}], "method": "transact", "id": 359991}
... JSON-RPC response ...
{"id":359991,"result":[{"count":1}],"error":null}


...
interface down does not exist!
interface down does not exist!
interface down does not exist!
interface down does not exist!


cmd: git show HEAD:dvsdvr.yaml
=+=+= NLAN Request to router:rpi1,platform:debian =+=+=+=+=+=+=+=+=+=+=+=+=+=+
operation: --add
dict_args: "OrderedDict([('bridges', {'ovs_bridges': 'enabled'}), ('services', {('name', 'snort1'): {'name': 'snort1', 'chain': ['mz.101', 'dmz.1001']}}), ('vxlan', {'remote_ips': ['192.168.1.103', '192.168.1.102', '192.168.1.101'], 'local_ip': '192.168.1.104'}), ('subnets', {('vni', 1001): {'peers': ['192.168.1.101'], 'vid': 111, 'vni': 1001, 'ports': ['dmz.1001']}, ('vni', 101): {'peers': ['192.168.1.102', '192.168.1.103'], 'vid': 1, 'vni': 101, 'ports': ['mz.101']}})])"
=+=+= NLAN Request to router:openwrt3,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --add
dict_args: "OrderedDict([('bridges', {'ovs_bridges': 'enabled'}), ('vxlan', {'remote_ips': ['192.168.1.102', '192.168.1.101', '192.168.1.104'], 'local_ip': '192.168.1.103'}), ('subnets', {('vni', 1): {'peers': ['192.168.1.101', '192.168.1.102'], 'vid': 2, 'ip_vhost': '192.168.100.103/24', 'default_gw': '192.168.100.1', 'ip_dvr': '192.168.100.3/24', 'vni': 1}, ('vni', 103): {'peers': ['192.168.1.101', '192.168.1.102'], 'vid': 3, 'ip_vhost': '10.0.3.103/24', 'vni': 103, 'ip_dvr': '10.0.3.1/24', 'ports': ['eth0.3']}, ('vni', 101): {'peers': ['192.168.1.102', '192.168.1.104'], 'vid': 1, 'ip_vhost': '10.0.1.103/24', 'vni': 101, 'ip_dvr': '10.0.1.1/24', 'mode': 'spoke_dvr', 'ports': ['eth0.1']}})])"
=+=+= NLAN Request to router:openwrt2,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --add
dict_args: "OrderedDict([('bridges', {'ovs_bridges': 'enabled'}), ('vxlan', {'remote_ips': ['192.168.1.103', '192.168.1.101', '192.168.1.104'], 'local_ip': '192.168.1.102'}), ('subnets', {('vni', 1): {'peers': ['192.168.1.101', '192.168.1.103'], 'vid': 2, 'ip_vhost': '192.168.100.102/24', 'default_gw': '192.168.100.1', 'ip_dvr': '192.168.100.2/24', 'vni': 1}, ('vni', 103): {'peers': ['192.168.1.101', '192.168.1.103'], 'vid': 3, 'ip_vhost': '10.0.3.102/24', 'vni': 103, 'ip_dvr': '10.0.3.1/24', 'ports': ['eth0.3']}, ('vni', 101): {'peers': ['192.168.1.103', '192.168.1.104'], 'vid': 1, 'ip_vhost': '10.0.1.102/24', 'vni': 101, 'ip_dvr': '10.0.1.1/24', 'mode': 'spoke_dvr', 'ports': ['eth0.1']}})])"
=+=+= NLAN Request to router:openwrt1,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --add
dict_args: "OrderedDict([('bridges', {'ovs_bridges': 'enabled'}), ('gateway', {'network': 'eth0.2', 'rip': 'enabled'}), ('vxlan', {'remote_ips': ['192.168.1.103', '192.168.1.102', '192.168.1.104'], 'local_ip': '192.168.1.101'}), ('subnets', {('vni', 1): {'ip_vhost': '192.168.100.101/24', 'ip_dvr': '192.168.100.1/24', 'peers': ['192.168.1.102', '192.168.1.103'], 'vid': 2, 'vni': 1}, ('vni', 103): {'peers': ['192.168.1.102', '192.168.1.103'], 'vid': 3, 'ip_vhost': '10.0.3.101/24', 'vni': 103, 'ip_dvr': '10.0.3.1/24', 'ports': ['eth0.3']}, ('vni', 1001): {'peers': ['192.168.1.104'], 'vid': 1, 'ip_vhost': '10.0.1.101/24', 'vni': 1001, 'ip_dvr': '10.0.1.1/24', 'mode': 'hub', 'ports': ['eth0.1']}})])"
=+=+= NLAN Reply from router:openwrt2,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
[INFO] module:nlan_agent,function:<module>,router: openwrt2
NLAN Agent initialization completed
{'mod_dir': ['command', 'config'], 'etc_dir': '/opt/nlan/etc', 'state_order': ['bridges', 'services', 'gateway', 'vxlan', 'subnets'], 'types': {'services': {'name': {'max': 1, 'key': {'type': 'string'}, 'min': 1}, 'chain': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}}, 'bridges': {'controller': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'ovs_bridges': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}, 'gateway': {'network': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'rip': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}, 'vxlan': {'remote_ips': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}, 'local_ip': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}, 'subnets': {'ip_dvr': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'peers': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}, 'vni': {'max': 1, 'key': {'minInteger': 0, 'maxInteger': 16777215, 'type': 'integer'}, 'min': 1}, 'vid': {'max': 1, 'key': {'minInteger': 0, 'maxInteger': 4095, 'type': 'integer'}, 'min': 0}, 'ip_vhost': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'ports': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}, 'default_gw': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'mode': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}}, 'tables': {'services': {'max': 'unlimited', 'key': {'type': 'uuid', 'refTable': 'NLAN_Service'}, 'min': 0}, 'bridges': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_Bridges'}, 'min': 0}, 'gateway': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_Gateway'}, 'min': 0}, 'vxlan': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_VXLAN'}, 'min': 0}, 'subnets': {'max': 'unlimited', 'key': {'type': 'uuid', 'refTable': 'NLAN_Subnet'}, 'min': 0}}, 'agent_dir': '/opt/nlan', 'indexes': {'services': 'name', 'subnets': 'vni'}, 'platform': 'openwrt', 'init': False, 'router': 'openwrt2', 'logger': <logging.Logger object at 0xb75b17cc>, 'schema': 'ovsdb_nlan.schema'}
[INFO] module:nlan_agent,function:_route,router: openwrt2
function:bridges.add, model:{'ovs_bridges': 'enabled'}
[INFO] module:bridges,function:add,router: openwrt2
Adding bridges: br-int and br-tun
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ovs-vsctl add-br br-int
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ovs-vsctl add-br br-tun
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ovs-ofctl del-flows br-tun
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ovs-vsctl add-port br-int patch-int -- set interface patch-int type=patch options:peer=patch-tun
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ovs-vsctl add-port br-tun patch-tun -- set interface patch-tun type=patch options:peer=patch-int
[DEBUG] module:ovsdb,function:_send,router: openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"Interface","where":[["name","==","patch-tun"]],"op":"select"}],"method":"transact","id":971626}
... JSON-RPC response ...
{"id":971626,"result":[{"rows":[{"options":["map",[["peer","patch-int"]]],"mtu":["set",[]],"link_speed":["set",[]],"statistics":["map",[["collisions",0],["rx_bytes",0],["rx_crc_err",0],["rx_dropped",0],["rx_errors",0],["rx_frame_err",0],["rx_over_err",0],["rx_packets",0],["tx_bytes",0],["tx_dropped",0],["tx_errors",0],["tx_packets",0]]],"mac_in_use":"66:68:db:92:0c:06","ingress_policing_rate":0,"ofport":1,"mac":["set",[]],"cfm_fault_status":["set",[]],"duplex":["set",[]],"lacp_current":["set",[]],"cfm_fault":["set",[]],"link_state":["set",[]],"external_ids":["map",[]],"bfd_status":["map",[]],"link_resets":["set",[]],"name":"patch-tun","type":"patch","cfm_remote_opstate":["set",[]],"_uuid":["uuid","eaffca22-60e6-4b8f-8634-8f462b573382"],"status":["map",[]],"ifindex":0,"_version":["uuid","cb7647cc-b8bf-42d9-bab0-6dddf9fda762"],"other_config":["map",[]],"admin_state":["set",[]],"cfm_remote_mpids":["set",[]],"cfm_mpid":["set",[]],"bfd":["map",[]],"ofport_request":["set",[]],"ingress_policing_burst":0,"cfm_flap_count":["set",[]],"cfm_health":["set",[]]}]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ovs-ofctl del-flows br-tun
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ovs-ofctl add-flow br-tun table=0,priority=1,in_port=1,actions=resubmit(,1)
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ovs-ofctl add-flow br-tun table=0,priority=0,actions=drop
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ovs-ofctl add-flow br-tun table=1,priority=0,dl_dst=01:00:00:00:00:00/01:00:00:00:00:00,actions=resubmit(,19)
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ovs-ofctl add-flow br-tun table=1,priority=0,dl_dst=00:00:00:00:00:00/01:00:00:00:00:00,actions=resubmit(,20)
[DEBUG] module:ovsdb,function:_send,router: openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"Interface","where":[["name","==","patch-tun"]],"op":"select"}],"method":"transact","id":986101}
... JSON-RPC response ...
{"id":986101,"result":[{"rows":[{"options":["map",[["peer","patch-int"]]],"mtu":["set",[]],"link_speed":["set",[]],"statistics":["map",[["collisions",0],["rx_bytes",0],["rx_crc_err",0],["rx_dropped",0],["rx_errors",0],["rx_frame_err",0],["rx_over_err",0],["rx_packets",0],["tx_bytes",0],["tx_dropped",0],["tx_errors",0],["tx_packets",0]]],"mac_in_use":"66:68:db:92:0c:06","ingress_policing_rate":0,"ofport":1,"mac":["set",[]],"cfm_fault_status":["set",[]],"duplex":["set",[]],"lacp_current":["set",[]],"cfm_fault":["set",[]],"link_state":"up","external_ids":["map",[]],"bfd_status":["map",[]],"link_resets":0,"name":"patch-tun","type":"patch","cfm_remote_opstate":["set",[]],"_uuid":["uuid","eaffca22-60e6-4b8f-8634-8f462b573382"],"status":["map",[]],"ifindex":0,"_version":["uuid","473fb173-5cb0-46af-ab0e-5dd8c7be0866"],"other_config":["map",[]],"admin_state":"up","cfm_remote_mpids":["set",[]],"cfm_mpid":["set",[]],"bfd":["map",[]],"ofport_request":["set",[]],"ingress_policing_burst":0,"cfm_flap_count":["set",[]],"cfm_health":["set",[]]}]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ovs-ofctl add-flow br-tun table=2,priority=0,actions=drop
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ovs-ofctl add-flow br-tun table=3,priority=0,actions=drop
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ovs-ofctl add-flow br-tun table=10,priority=1,actions=learn(table=20,hard_timeout=300,priority=1,NXM_OF_VLAN_TCI[0..11],NXM_OF_ETH_DST[]=NXM_OF_ETH_SRC[],load:0->NXM_OF_VLAN_TCI[],load:NXM_NX_TUN_ID[]->NXM_NX_TUN_ID[],output:NXM_OF_IN_PORT[]),output:1
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ovs-ofctl add-flow br-tun table=19,priority=0,actions=resubmit(,21)
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ovs-ofctl add-flow br-tun table=20,priority=0,actions=resubmit(,21)
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ovs-ofctl add-flow br-tun table=21,priority=0,actions=drop
[DEBUG] module:ovsdb,function:_send,router: openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN","row":{},"op":"insert"}],"method":"transact","id":91043}
... JSON-RPC response ...
{"id":91043,"result":[{"uuid":["uuid","bfa24ce6-5d69-4cd3-adfb-fdaffa0ba561"]}],"error":null}
[DEBUG] module:ovsdb,function:_send,router: openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Bridges","where":[],"op":"select"}],"method":"transact","id":148343}
... JSON-RPC response ...
{"id":148343,"result":[{"rows":[]}],"error":null}
[DEBUG] module:ovsdb,function:_send,router: openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Bridges","uuid-name":"temp_535910","row":{"ovs_bridges":"enabled"},"op":"insert"},{"table":"NLAN","where":[],"mutations":[["bridges","insert",["set",[["named-uuid","temp_535910"]]]]],"op":"mutate"}],"method":"transact","id":500997}
... JSON-RPC response ...
{"id":500997,"result":[{"uuid":["uuid","b7c5bdfa-de84-4e59-a673-3a718b3705a6"]},{"count":1}],"error":null}
[DEBUG] module:ovsdb,function:_send,router: openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Bridges","where":[],"op":"select"}],"method":"transact","id":512383}
... JSON-RPC response ...
{"id":512383,"result":[{"rows":[{"_uuid":["uuid","b7c5bdfa-de84-4e59-a673-3a718b3705a6"],"_version":["uuid","e06412e2-e48d-4626-91cc-759dab4d5502"],"ovs_bridges":"enabled","controller":["set",[]]}]}],"error":null}
[INFO] module:nlan_agent,function:_route,router: openwrt2
function:vxlan.add, model:{'remote_ips': ['192.168.1.103', '192.168.1.101', '192.168.1.104'], 'local_ip': '192.168.1.102'}
[INFO] module:vxlan,function:add,router: openwrt2
Adding a VXLAN tunnel: vxlan_103
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ovs-vsctl add-port br-tun vxlan_103 -- set interface vxlan_103 type=vxlan options:in_key=flow options:local_ip=192.168.1.102 options:out_key=flow options:remote_ip=192.168.1.103
[INFO] module:vxlan,function:add,router: openwrt2
Adding a VXLAN tunnel: vxlan_101
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ovs-vsctl add-port br-tun vxlan_101 -- set interface vxlan_101 type=vxlan options:in_key=flow options:local_ip=192.168.1.102 options:out_key=flow options:remote_ip=192.168.1.101
[INFO] module:vxlan,function:add,router: openwrt2
Adding a VXLAN tunnel: vxlan_104
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ovs-vsctl add-port br-tun vxlan_104 -- set interface vxlan_104 type=vxlan options:in_key=flow options:local_ip=192.168.1.102 options:out_key=flow options:remote_ip=192.168.1.104
[DEBUG] module:ovsdb,function:_send,router: openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"Interface","where":[["type","==","vxlan"]],"columns":["ofport","options"],"op":"select"}],"method":"transact","id":933150}
... JSON-RPC response ...
{"id":933150,"result":[{"rows":[{"options":["map",[["in_key","flow"],["local_ip","192.168.1.102"],["out_key","flow"],["remote_ip","192.168.1.101"]]],"ofport":3},{"options":["map",[["in_key","flow"],["local_ip","192.168.1.102"],["out_key","flow"],["remote_ip","192.168.1.103"]]],"ofport":2},{"options":["map",[["in_key","flow"],["local_ip","192.168.1.102"],["out_key","flow"],["remote_ip","192.168.1.104"]]],"ofport":4}]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ovs-ofctl add-flow br-tun table=0,priority=1,in_port=3,actions=resubmit(,2)
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ovs-ofctl add-flow br-tun table=0,priority=1,in_port=2,actions=resubmit(,2)
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ovs-ofctl add-flow br-tun table=0,priority=1,in_port=4,actions=resubmit(,2)
[DEBUG] module:ovsdb,function:_send,router: openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN","row":{},"op":"insert"}],"method":"transact","id":97374}
... JSON-RPC response ...
{"id":97374,"result":[{"uuid":["uuid","88426871-3fc1-4525-aad6-d6eacc901490"]},{"error":"constraint violation","details":"transaction causes \"NLAN\" table to contain 2 rows, greater than the schema-defined limit of 1 row(s)"}],"error":null}
[DEBUG] module:ovsdb,function:_send,router: openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_VXLAN","where":[],"op":"select"}],"method":"transact","id":790628}
... JSON-RPC response ...
{"id":790628,"result":[{"rows":[]}],"error":null}
[DEBUG] module:ovsdb,function:_send,router: openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_VXLAN","uuid-name":"temp_34893","row":{"remote_ips":["set",["192.168.1.103","192.168.1.101","192.168.1.104"]],"local_ip":"192.168.1.102"},"op":"insert"},{"table":"NLAN","where":[],"mutations":[["vxlan","insert",["set",[["named-uuid","temp_34893"]]]]],"op":"mutate"}],"method":"transact","id":302073}
... JSON-RPC response ...
{"id":302073,"result":[{"uuid":["uuid","c4dc4f8a-d0ad-4913-bc1a-bf05db8d4823"]},{"count":1}],"error":null}
[DEBUG] module:ovsdb,function:_send,router: openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_VXLAN","where":[],"op":"select"}],"method":"transact","id":276386}
... JSON-RPC response ...
{"id":276386,"result":[{"rows":[{"_version":["uuid","77b681c0-e92b-475f-98de-6906623e814d"],"_uuid":["uuid","c4dc4f8a-d0ad-4913-bc1a-bf05db8d4823"],"local_ip":"192.168.1.102","remote_ips":["set",["192.168.1.101","192.168.1.103","192.168.1.104"]]}]}],"error":null}
[INFO] module:nlan_agent,function:_route,router: openwrt2
function:subnets.add, model:{('vni', 1): {'peers': ['192.168.1.101', '192.168.1.103'], 'vid': 2, 'ip_vhost': '192.168.100.102/24', 'default_gw': '192.168.100.1', 'ip_dvr': '192.168.100.2/24', 'vni': 1}, ('vni', 103): {'peers': ['192.168.1.101', '192.168.1.103'], 'vid': 3, 'ip_vhost': '10.0.3.102/24', 'vni': 103, 'ip_dvr': '10.0.3.1/24', 'ports': ['eth0.3']}, ('vni', 101): {'peers': ['192.168.1.103', '192.168.1.104'], 'vid': 1, 'ip_vhost': '10.0.1.102/24', 'vni': 101, 'ip_dvr': '10.0.1.1/24', 'mode': 'spoke_dvr', 'ports': ['eth0.1']}}
[INFO] module:subnets,function:_crud,router: openwrt2
Adding a subnet(vlan): 2
[DEBUG] module:ovsdb,function:_send,router: openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN","row":{},"op":"insert"}],"method":"transact","id":266641}
... JSON-RPC response ...
{"id":266641,"result":[{"uuid":["uuid","f42eb87c-c2d4-4e0c-9fe9-5a8ab7ddddfd"]},{"error":"constraint violation","details":"transaction causes \"NLAN\" table to contain 2 rows, greater than the schema-defined limit of 1 row(s)"}],"error":null}
[DEBUG] module:ovsdb,function:_send,router: openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","where":[["vni","==",1]],"op":"select"}],"method":"transact","id":729526}
... JSON-RPC response ...
{"id":729526,"result":[{"rows":[]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ip netns add ns2
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: brctl addbr br2
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ip link add veth-ns2 type veth peer name temp-ns2
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ip link set dev temp-ns2 netns ns2
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ip netns exec ns2 ip link set dev temp-ns2 name eth0
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ovs-vsctl add-port br-int int-br2 tag=2 -- set interface int-br2 type=internal
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ovs-vsctl add-port br-int int-dvr2 tag=2 -- set interface int-dvr2 type=internal
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: brctl addif br2 veth-ns2
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: brctl addif br2 int-br2
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ip link set dev veth-ns2 promisc on
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ip link set dev veth-ns2 up
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ip netns exec ns2 ip link set dev eth0 up
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ip link set dev int-br2 promisc on
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ip link set dev int-br2 up
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ip link set dev int-dvr2 up
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ip link set dev br2 up
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ip netns exec ns2 ip addr add dev eth0 192.168.100.102/24
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ip addr add dev int-dvr2 192.168.100.2/24
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ip netns exec ns2 ip route add default via 192.168.100.2 dev eth0
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: route
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ip route add default via 192.168.100.1
[DEBUG] module:ovsdb,function:_send,router: openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"Controller","where":[],"columns":["target"],"op":"select"}],"method":"transact","id":325260}
... JSON-RPC response ...
{"id":325260,"result":[{"rows":[]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ovs-ofctl add-flow br-tun table=2,priority=1,tun_id=1,actions=mod_vlan_vid:2,resubmit(,10)
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ovs-ofctl add-flow br-tun table=19,priority=1,dl_type=0x0806,dl_vlan=2,nw_dst=192.168.100.2,actions=drop
[DEBUG] module:ovsdb,function:_send,router: openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"Interface","where":[["type","==","vxlan"]],"columns":["ofport","options"],"op":"select"}],"method":"transact","id":353737}
... JSON-RPC response ...
{"id":353737,"result":[{"rows":[{"options":["map",[["in_key","flow"],["local_ip","192.168.1.102"],["out_key","flow"],["remote_ip","192.168.1.101"]]],"ofport":3},{"options":["map",[["in_key","flow"],["local_ip","192.168.1.102"],["out_key","flow"],["remote_ip","192.168.1.103"]]],"ofport":2},{"options":["map",[["in_key","flow"],["local_ip","192.168.1.102"],["out_key","flow"],["remote_ip","192.168.1.104"]]],"ofport":4}]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ovs-ofctl add-flow br-tun table=21,priority=1,dl_vlan=2,actions=strip_vlan,set_tunnel:1,output:3,output:2
[INFO] module:subnets,function:_crud,router: openwrt2
Adding a subnet(vlan): 3
[DEBUG] module:ovsdb,function:_send,router: openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN","row":{},"op":"insert"}],"method":"transact","id":77801}
... JSON-RPC response ...
{"id":77801,"result":[{"uuid":["uuid","db6c6a76-3786-4756-8697-7cc58579792f"]},{"error":"constraint violation","details":"transaction causes \"NLAN\" table to contain 2 rows, greater than the schema-defined limit of 1 row(s)"}],"error":null}
[DEBUG] module:ovsdb,function:_send,router: openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","where":[["vni","==",103]],"op":"select"}],"method":"transact","id":448720}
... JSON-RPC response ...
{"id":448720,"result":[{"rows":[]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ip netns add ns3
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: brctl addbr br3
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ip link add veth-ns3 type veth peer name temp-ns3
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ip link set dev temp-ns3 netns ns3
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ip netns exec ns3 ip link set dev temp-ns3 name eth0
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ovs-vsctl add-port br-int int-br3 tag=3 -- set interface int-br3 type=internal
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ovs-vsctl add-port br-int int-dvr3 tag=3 -- set interface int-dvr3 type=internal
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: brctl addif br3 veth-ns3
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: brctl addif br3 int-br3
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ip link set dev veth-ns3 promisc on
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ip link set dev veth-ns3 up
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ip netns exec ns3 ip link set dev eth0 up
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ip link set dev int-br3 promisc on
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ip link set dev int-br3 up
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ip link set dev int-dvr3 up
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ip link set dev br3 up
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ip netns exec ns3 ip addr add dev eth0 10.0.3.102/24
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ip addr add dev int-dvr3 10.0.3.1/24
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ip netns exec ns3 ip route add default via 10.0.3.1 dev eth0
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: brctl addif br3 eth0.3
[DEBUG] module:ovsdb,function:_send,router: openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"Controller","where":[],"columns":["target"],"op":"select"}],"method":"transact","id":990947}
... JSON-RPC response ...
{"id":990947,"result":[{"rows":[]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ovs-ofctl add-flow br-tun table=2,priority=1,tun_id=103,actions=mod_vlan_vid:3,resubmit(,10)
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ovs-ofctl add-flow br-tun table=19,priority=1,dl_type=0x0806,dl_vlan=3,nw_dst=10.0.3.1,actions=drop
[DEBUG] module:ovsdb,function:_send,router: openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"Interface","where":[["type","==","vxlan"]],"columns":["ofport","options"],"op":"select"}],"method":"transact","id":38505}
... JSON-RPC response ...
{"id":38505,"result":[{"rows":[{"options":["map",[["in_key","flow"],["local_ip","192.168.1.102"],["out_key","flow"],["remote_ip","192.168.1.101"]]],"ofport":3},{"options":["map",[["in_key","flow"],["local_ip","192.168.1.102"],["out_key","flow"],["remote_ip","192.168.1.103"]]],"ofport":2},{"options":["map",[["in_key","flow"],["local_ip","192.168.1.102"],["out_key","flow"],["remote_ip","192.168.1.104"]]],"ofport":4}]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ovs-ofctl add-flow br-tun table=21,priority=1,dl_vlan=3,actions=strip_vlan,set_tunnel:103,output:3,output:2
[INFO] module:subnets,function:_crud,router: openwrt2
Adding a subnet(vlan): 1
[DEBUG] module:ovsdb,function:_send,router: openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN","row":{},"op":"insert"}],"method":"transact","id":544341}
... JSON-RPC response ...
{"id":544341,"result":[{"uuid":["uuid","57eb9797-412c-4639-9ef9-91f7338437fa"]},{"error":"constraint violation","details":"transaction causes \"NLAN\" table to contain 2 rows, greater than the schema-defined limit of 1 row(s)"}],"error":null}
[DEBUG] module:ovsdb,function:_send,router: openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","where":[["vni","==",101]],"op":"select"}],"method":"transact","id":84961}
... JSON-RPC response ...
{"id":84961,"result":[{"rows":[]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ip netns add ns1
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: brctl addbr br1
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ip link add veth-ns1 type veth peer name temp-ns1
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ip link set dev temp-ns1 netns ns1
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ip netns exec ns1 ip link set dev temp-ns1 name eth0
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ovs-vsctl add-port br-int int-br1 tag=1 -- set interface int-br1 type=internal
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ovs-vsctl add-port br-int int-dvr1 tag=1 -- set interface int-dvr1 type=internal
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: brctl addif br1 veth-ns1
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: brctl addif br1 int-br1
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ip link set dev veth-ns1 promisc on
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ip link set dev veth-ns1 up
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ip netns exec ns1 ip link set dev eth0 up
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ip link set dev int-br1 promisc on
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ip link set dev int-br1 up
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ip link set dev int-dvr1 up
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ip link set dev br1 up
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ip netns exec ns1 ip addr add dev eth0 10.0.1.102/24
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ip addr add dev int-dvr1 10.0.1.1/24
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ip netns exec ns1 ip route add default via 10.0.1.1 dev eth0
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: brctl addif br1 eth0.1
[DEBUG] module:ovsdb,function:_send,router: openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"Controller","where":[],"columns":["target"],"op":"select"}],"method":"transact","id":93866}
... JSON-RPC response ...
{"id":93866,"result":[{"rows":[]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ovs-ofctl add-flow br-tun table=2,priority=1,tun_id=101,actions=mod_vlan_vid:1,resubmit(,10)
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ip link show dev int-dvr1
[DEBUG] module:ovsdb,function:_send,router: openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"Interface","where":[["name","==","int-dvr1"]],"op":"select"}],"method":"transact","id":836622}
... JSON-RPC response ...
{"id":836622,"result":[{"rows":[{"options":["map",[]],"mtu":1500,"link_speed":["set",[]],"statistics":["map",[["collisions",0],["rx_bytes",0],["rx_crc_err",0],["rx_dropped",0],["rx_errors",0],["rx_frame_err",0],["rx_over_err",0],["rx_packets",0],["tx_bytes",0],["tx_dropped",0],["tx_errors",0],["tx_packets",0]]],"mac_in_use":"66:4a:72:bb:3b:5e","ingress_policing_rate":0,"ofport":7,"mac":["set",[]],"cfm_fault_status":["set",[]],"duplex":["set",[]],"lacp_current":["set",[]],"cfm_fault":["set",[]],"link_state":"up","external_ids":["map",[]],"bfd_status":["map",[]],"link_resets":2,"name":"int-dvr1","type":"internal","cfm_remote_opstate":["set",[]],"_uuid":["uuid","0c6ac338-98c6-4d0c-a516-40b9da358a4f"],"status":["map",[["driver_name","openvswitch"]]],"ifindex":46,"_version":["uuid","35663e67-5d6a-426c-bd85-76f2acba637d"],"other_config":["map",[]],"admin_state":"up","cfm_remote_mpids":["set",[]],"cfm_mpid":["set",[]],"bfd":["map",[]],"ofport_request":["set",[]],"ingress_policing_burst":0,"cfm_flap_count":["set",[]],"cfm_health":["set",[]]}]}],"error":null}
[DEBUG] module:ovsdb,function:_send,router: openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"Interface","where":[["name","==","int-br1"]],"op":"select"}],"method":"transact","id":512982}
... JSON-RPC response ...
{"id":512982,"result":[{"rows":[{"options":["map",[]],"mtu":1500,"link_speed":["set",[]],"statistics":["map",[["collisions",0],["rx_bytes",0],["rx_crc_err",0],["rx_dropped",0],["rx_errors",0],["rx_frame_err",0],["rx_over_err",0],["rx_packets",0],["tx_bytes",0],["tx_dropped",0],["tx_errors",0],["tx_packets",0]]],"mac_in_use":"76:6b:77:e9:71:34","ingress_policing_rate":0,"ofport":6,"mac":["set",[]],"cfm_fault_status":["set",[]],"duplex":["set",[]],"lacp_current":["set",[]],"cfm_fault":["set",[]],"link_state":"up","external_ids":["map",[]],"bfd_status":["map",[]],"link_resets":2,"name":"int-br1","type":"internal","cfm_remote_opstate":["set",[]],"_uuid":["uuid","e520527a-3024-452a-8c1a-8952126b443f"],"status":["map",[["driver_name","openvswitch"]]],"ifindex":45,"_version":["uuid","2e804a20-b5ee-4de0-8b82-c1baf5fba83e"],"other_config":["map",[]],"admin_state":"up","cfm_remote_mpids":["set",[]],"cfm_mpid":["set",[]],"bfd":["map",[]],"ofport_request":["set",[]],"ingress_policing_burst":0,"cfm_flap_count":["set",[]],"cfm_health":["set",[]]}]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ovs-ofctl add-flow br-int table=0,priority=2,in_port=6,dl_type=0x0800,nw_dst=10.0.1.0/24,actions=normal
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ovs-ofctl add-flow br-int table=0,priority=1,in_port=6,dl_type=0x0800,nw_dst=10.0.0.0/8,actions=resubmit(,1)
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ovs-ofctl add-flow br-int table=0,priority=1,in_port=6,dl_type=0x0800,nw_dst=172.16.0.0/12,actions=resubmit(,1)
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ovs-ofctl add-flow br-int table=0,priority=1,in_port=6,dl_type=0x0800,nw_dst=192.168.0.0/16,actions=resubmit(,1)
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ovs-ofctl add-flow br-int table=0,priority=1,in_port=7,dl_type=0x0806,nw_src=10.0.1.1,nw_proto=2,actions=drop
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ovs-ofctl add-flow br-int table=1,priority=0,actions=set_field:66:4a:72:bb:3b:5e->dl_dst,output:7
[DEBUG] module:ovsdb,function:_send,router: openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"Interface","where":[["type","==","vxlan"]],"columns":["ofport","options"],"op":"select"}],"method":"transact","id":249123}
... JSON-RPC response ...
{"id":249123,"result":[{"rows":[{"options":["map",[["in_key","flow"],["local_ip","192.168.1.102"],["out_key","flow"],["remote_ip","192.168.1.101"]]],"ofport":3},{"options":["map",[["in_key","flow"],["local_ip","192.168.1.102"],["out_key","flow"],["remote_ip","192.168.1.103"]]],"ofport":2},{"options":["map",[["in_key","flow"],["local_ip","192.168.1.102"],["out_key","flow"],["remote_ip","192.168.1.104"]]],"ofport":4}]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt2
cmd: ovs-ofctl add-flow br-tun table=21,priority=1,dl_vlan=1,actions=strip_vlan,set_tunnel:101,output:2,output:4
[DEBUG] module:ovsdb,function:_send,router: openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN","row":{},"op":"insert"}],"method":"transact","id":541419}
... JSON-RPC response ...
{"id":541419,"result":[{"uuid":["uuid","636d4c4e-3466-440e-ac36-fbbd201ad093"]},{"error":"constraint violation","details":"transaction causes \"NLAN\" table to contain 2 rows, greater than the schema-defined limit of 1 row(s)"}],"error":null}
[DEBUG] module:ovsdb,function:_send,router: openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","where":[["vni","==",1]],"op":"select"}],"method":"transact","id":289068}
... JSON-RPC response ...
{"id":289068,"result":[{"rows":[]}],"error":null}
[DEBUG] module:ovsdb,function:crud,router: openwrt2
CRUD operation (add): {'peers': ['192.168.1.101', '192.168.1.103'], 'vid': 2, 'ip_vhost': '192.168.100.102/24', 'default_gw': '192.168.100.1', 'ip_dvr': '192.168.100.2/24', 'vni': 1}
[DEBUG] module:ovsdb,function:_send,router: openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","uuid-name":"temp_922932","row":{"peers":["set",["192.168.1.101","192.168.1.103"]],"vid":2,"ip_vhost":"192.168.100.102/24","default_gw":"192.168.100.1","ip_dvr":"192.168.100.2/24","vni":1},"op":"insert"},{"table":"NLAN","where":[],"mutations":[["subnets","insert",["set",[["named-uuid","temp_922932"]]]]],"op":"mutate"}],"method":"transact","id":249645}
... JSON-RPC response ...
{"id":249645,"result":[{"uuid":["uuid","34ef67ed-334b-4d9e-a3fa-bd8795042f92"]},{"count":1}],"error":null}
[DEBUG] module:ovsdb,function:_send,router: openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","where":[["vni","==",1]],"op":"select"}],"method":"transact","id":290106}
... JSON-RPC response ...
{"id":290106,"result":[{"rows":[{"peers":["set",["192.168.1.101","192.168.1.103"]],"_version":["uuid","61e38eb7-aa41-4342-9d98-cabbe8f12a96"],"vni":1,"ports":["set",[]],"mode":["set",[]],"vid":2,"_uuid":["uuid","34ef67ed-334b-4d9e-a3fa-bd8795042f92"],"default_gw":"192.168.100.1","ip_vhost":"192.168.100.102/24","ip_dvr":"192.168.100.2/24"}]}],"error":null}
[DEBUG] module:ovsdb,function:_send,router: openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN","row":{},"op":"insert"}],"method":"transact","id":317965}
... JSON-RPC response ...
{"id":317965,"result":[{"uuid":["uuid","bbb71c73-71a2-4f33-a529-90c027fe11b5"]},{"error":"constraint violation","details":"transaction causes \"NLAN\" table to contain 2 rows, greater than the schema-defined limit of 1 row(s)"}],"error":null}
[DEBUG] module:ovsdb,function:_send,router: openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","where":[["vni","==",103]],"op":"select"}],"method":"transact","id":144459}
... JSON-RPC response ...
{"id":144459,"result":[{"rows":[]}],"error":null}
[DEBUG] module:ovsdb,function:crud,router: openwrt2
CRUD operation (add): {'peers': ['192.168.1.101', '192.168.1.103'], 'vid': 3, 'ip_vhost': '10.0.3.102/24', 'vni': 103, 'ip_dvr': '10.0.3.1/24', 'ports': ['eth0.3']}
[DEBUG] module:ovsdb,function:_send,router: openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","uuid-name":"temp_208691","row":{"peers":["set",["192.168.1.101","192.168.1.103"]],"vid":3,"ip_vhost":"10.0.3.102/24","vni":103,"ip_dvr":"10.0.3.1/24","ports":["set",["eth0.3"]]},"op":"insert"},{"table":"NLAN","where":[],"mutations":[["subnets","insert",["set",[["named-uuid","temp_208691"]]]]],"op":"mutate"}],"method":"transact","id":206371}
... JSON-RPC response ...
{"id":206371,"result":[{"uuid":["uuid","26c7c4a6-fc44-4c41-bcc1-806e4281834b"]},{"count":1}],"error":null}
[DEBUG] module:ovsdb,function:_send,router: openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","where":[["vni","==",103]],"op":"select"}],"method":"transact","id":281415}
... JSON-RPC response ...
{"id":281415,"result":[{"rows":[{"peers":["set",["192.168.1.101","192.168.1.103"]],"_version":["uuid","c519a5d8-4b8f-4bdf-aa8d-bedbbb245860"],"vni":103,"ports":"eth0.3","mode":["set",[]],"vid":3,"_uuid":["uuid","26c7c4a6-fc44-4c41-bcc1-806e4281834b"],"default_gw":["set",[]],"ip_vhost":"10.0.3.102/24","ip_dvr":"10.0.3.1/24"}]}],"error":null}
[DEBUG] module:ovsdb,function:_send,router: openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN","row":{},"op":"insert"}],"method":"transact","id":940833}
... JSON-RPC response ...
{"id":940833,"result":[{"uuid":["uuid","8142ad76-f6d6-4f08-aaf1-3e14e8eedbe7"]},{"error":"constraint violation","details":"transaction causes \"NLAN\" table to contain 2 rows, greater than the schema-defined limit of 1 row(s)"}],"error":null}
[DEBUG] module:ovsdb,function:_send,router: openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","where":[["vni","==",101]],"op":"select"}],"method":"transact","id":603740}
... JSON-RPC response ...
{"id":603740,"result":[{"rows":[]}],"error":null}
[DEBUG] module:ovsdb,function:crud,router: openwrt2
CRUD operation (add): {'peers': ['192.168.1.103', '192.168.1.104'], 'vid': 1, 'ip_vhost': '10.0.1.102/24', 'vni': 101, 'ip_dvr': '10.0.1.1/24', 'mode': 'spoke_dvr', 'ports': ['eth0.1']}
[DEBUG] module:ovsdb,function:_send,router: openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","uuid-name":"temp_594859","row":{"peers":["set",["192.168.1.103","192.168.1.104"]],"vid":1,"ip_vhost":"10.0.1.102/24","vni":101,"ip_dvr":"10.0.1.1/24","mode":"spoke_dvr","ports":["set",["eth0.1"]]},"op":"insert"},{"table":"NLAN","where":[],"mutations":[["subnets","insert",["set",[["named-uuid","temp_594859"]]]]],"op":"mutate"}],"method":"transact","id":991128}
... JSON-RPC response ...
{"id":991128,"result":[{"uuid":["uuid","eae7e8fb-aeca-4400-bd66-30dc33ca6438"]},{"count":1}],"error":null}
[DEBUG] module:ovsdb,function:_send,router: openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","where":[["vni","==",101]],"op":"select"}],"method":"transact","id":138981}
... JSON-RPC response ...
{"id":138981,"result":[{"rows":[{"peers":["set",["192.168.1.103","192.168.1.104"]],"_version":["uuid","38ad870f-52aa-43b4-9e52-ad797d56c180"],"vni":101,"ports":"eth0.1","mode":"spoke_dvr","vid":1,"_uuid":["uuid","eae7e8fb-aeca-4400-bd66-30dc33ca6438"],"default_gw":["set",[]],"ip_vhost":"10.0.1.102/24","ip_dvr":"10.0.1.1/24"}]}],"error":null}


...
brctl: iface eth0.3: No such device
brctl: iface eth0.1: No such device


=+=+= NLAN Reply from router:openwrt3,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
[INFO] module:nlan_agent,function:<module>,router: openwrt3
NLAN Agent initialization completed
{'mod_dir': ['command', 'config'], 'etc_dir': '/opt/nlan/etc', 'state_order': ['bridges', 'services', 'gateway', 'vxlan', 'subnets'], 'types': {'services': {'name': {'max': 1, 'key': {'type': 'string'}, 'min': 1}, 'chain': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}}, 'bridges': {'controller': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'ovs_bridges': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}, 'gateway': {'network': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'rip': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}, 'vxlan': {'remote_ips': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}, 'local_ip': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}, 'subnets': {'ip_dvr': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'peers': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}, 'vni': {'max': 1, 'key': {'minInteger': 0, 'maxInteger': 16777215, 'type': 'integer'}, 'min': 1}, 'vid': {'max': 1, 'key': {'minInteger': 0, 'maxInteger': 4095, 'type': 'integer'}, 'min': 0}, 'ip_vhost': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'ports': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}, 'default_gw': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'mode': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}}, 'tables': {'services': {'max': 'unlimited', 'key': {'type': 'uuid', 'refTable': 'NLAN_Service'}, 'min': 0}, 'bridges': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_Bridges'}, 'min': 0}, 'gateway': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_Gateway'}, 'min': 0}, 'vxlan': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_VXLAN'}, 'min': 0}, 'subnets': {'max': 'unlimited', 'key': {'type': 'uuid', 'refTable': 'NLAN_Subnet'}, 'min': 0}}, 'agent_dir': '/opt/nlan', 'indexes': {'services': 'name', 'subnets': 'vni'}, 'platform': 'openwrt', 'init': False, 'router': 'openwrt3', 'logger': <logging.Logger object at 0xb75a1cac>, 'schema': 'ovsdb_nlan.schema'}
[INFO] module:nlan_agent,function:_route,router: openwrt3
function:bridges.add, model:{'ovs_bridges': 'enabled'}
[INFO] module:bridges,function:add,router: openwrt3
Adding bridges: br-int and br-tun
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ovs-vsctl add-br br-int
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ovs-vsctl add-br br-tun
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ovs-ofctl del-flows br-tun
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ovs-vsctl add-port br-int patch-int -- set interface patch-int type=patch options:peer=patch-tun
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ovs-vsctl add-port br-tun patch-tun -- set interface patch-tun type=patch options:peer=patch-int
[DEBUG] module:ovsdb,function:_send,router: openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"Interface","where":[["name","==","patch-tun"]],"op":"select"}],"method":"transact","id":395639}
... JSON-RPC response ...
{"id":395639,"result":[{"rows":[{"options":["map",[["peer","patch-int"]]],"mtu":["set",[]],"link_speed":["set",[]],"statistics":["map",[["collisions",0],["rx_bytes",0],["rx_crc_err",0],["rx_dropped",0],["rx_errors",0],["rx_frame_err",0],["rx_over_err",0],["rx_packets",0],["tx_bytes",0],["tx_dropped",0],["tx_errors",0],["tx_packets",0]]],"mac_in_use":"ca:a8:42:77:26:e5","ingress_policing_rate":0,"ofport":1,"mac":["set",[]],"cfm_fault_status":["set",[]],"duplex":["set",[]],"lacp_current":["set",[]],"cfm_fault":["set",[]],"link_state":["set",[]],"external_ids":["map",[]],"bfd_status":["map",[]],"link_resets":["set",[]],"name":"patch-tun","type":"patch","cfm_remote_opstate":["set",[]],"_uuid":["uuid","2e7a5307-ce16-4489-b39e-c3bc8544adc1"],"status":["map",[]],"ifindex":0,"_version":["uuid","cf9bb147-19be-434f-854d-79889d54c6d6"],"other_config":["map",[]],"admin_state":["set",[]],"cfm_remote_mpids":["set",[]],"cfm_mpid":["set",[]],"bfd":["map",[]],"ofport_request":["set",[]],"ingress_policing_burst":0,"cfm_flap_count":["set",[]],"cfm_health":["set",[]]}]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ovs-ofctl del-flows br-tun
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ovs-ofctl add-flow br-tun table=0,priority=1,in_port=1,actions=resubmit(,1)
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ovs-ofctl add-flow br-tun table=0,priority=0,actions=drop
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ovs-ofctl add-flow br-tun table=1,priority=0,dl_dst=01:00:00:00:00:00/01:00:00:00:00:00,actions=resubmit(,19)
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ovs-ofctl add-flow br-tun table=1,priority=0,dl_dst=00:00:00:00:00:00/01:00:00:00:00:00,actions=resubmit(,20)
[DEBUG] module:ovsdb,function:_send,router: openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"Interface","where":[["name","==","patch-tun"]],"op":"select"}],"method":"transact","id":474956}
... JSON-RPC response ...
{"id":474956,"result":[{"rows":[{"options":["map",[["peer","patch-int"]]],"mtu":["set",[]],"link_speed":["set",[]],"statistics":["map",[["collisions",0],["rx_bytes",0],["rx_crc_err",0],["rx_dropped",0],["rx_errors",0],["rx_frame_err",0],["rx_over_err",0],["rx_packets",0],["tx_bytes",0],["tx_dropped",0],["tx_errors",0],["tx_packets",0]]],"mac_in_use":"ca:a8:42:77:26:e5","ingress_policing_rate":0,"ofport":1,"mac":["set",[]],"cfm_fault_status":["set",[]],"duplex":["set",[]],"lacp_current":["set",[]],"cfm_fault":["set",[]],"link_state":"up","external_ids":["map",[]],"bfd_status":["map",[]],"link_resets":0,"name":"patch-tun","type":"patch","cfm_remote_opstate":["set",[]],"_uuid":["uuid","2e7a5307-ce16-4489-b39e-c3bc8544adc1"],"status":["map",[]],"ifindex":0,"_version":["uuid","59b9fba5-6731-4363-9b84-891944c2d280"],"other_config":["map",[]],"admin_state":"up","cfm_remote_mpids":["set",[]],"cfm_mpid":["set",[]],"bfd":["map",[]],"ofport_request":["set",[]],"ingress_policing_burst":0,"cfm_flap_count":["set",[]],"cfm_health":["set",[]]}]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ovs-ofctl add-flow br-tun table=2,priority=0,actions=drop
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ovs-ofctl add-flow br-tun table=3,priority=0,actions=drop
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ovs-ofctl add-flow br-tun table=10,priority=1,actions=learn(table=20,hard_timeout=300,priority=1,NXM_OF_VLAN_TCI[0..11],NXM_OF_ETH_DST[]=NXM_OF_ETH_SRC[],load:0->NXM_OF_VLAN_TCI[],load:NXM_NX_TUN_ID[]->NXM_NX_TUN_ID[],output:NXM_OF_IN_PORT[]),output:1
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ovs-ofctl add-flow br-tun table=19,priority=0,actions=resubmit(,21)
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ovs-ofctl add-flow br-tun table=20,priority=0,actions=resubmit(,21)
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ovs-ofctl add-flow br-tun table=21,priority=0,actions=drop
[DEBUG] module:ovsdb,function:_send,router: openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN","row":{},"op":"insert"}],"method":"transact","id":728230}
... JSON-RPC response ...
{"id":728230,"result":[{"uuid":["uuid","a7ceb454-cad9-46a9-b707-fd92f3ff8ebc"]}],"error":null}
[DEBUG] module:ovsdb,function:_send,router: openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Bridges","where":[],"op":"select"}],"method":"transact","id":948814}
... JSON-RPC response ...
{"id":948814,"result":[{"rows":[]}],"error":null}
[DEBUG] module:ovsdb,function:_send,router: openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Bridges","uuid-name":"temp_703832","row":{"ovs_bridges":"enabled"},"op":"insert"},{"table":"NLAN","where":[],"mutations":[["bridges","insert",["set",[["named-uuid","temp_703832"]]]]],"op":"mutate"}],"method":"transact","id":135188}
... JSON-RPC response ...
{"id":135188,"result":[{"uuid":["uuid","d6f51972-6735-40ca-8098-85a8a76fb27e"]},{"count":1}],"error":null}
[DEBUG] module:ovsdb,function:_send,router: openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Bridges","where":[],"op":"select"}],"method":"transact","id":333453}
... JSON-RPC response ...
{"id":333453,"result":[{"rows":[{"_uuid":["uuid","d6f51972-6735-40ca-8098-85a8a76fb27e"],"_version":["uuid","e51180eb-37e7-4c7a-a2e1-68784431dd93"],"ovs_bridges":"enabled","controller":["set",[]]}]}],"error":null}
[INFO] module:nlan_agent,function:_route,router: openwrt3
function:vxlan.add, model:{'remote_ips': ['192.168.1.102', '192.168.1.101', '192.168.1.104'], 'local_ip': '192.168.1.103'}
[INFO] module:vxlan,function:add,router: openwrt3
Adding a VXLAN tunnel: vxlan_102
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ovs-vsctl add-port br-tun vxlan_102 -- set interface vxlan_102 type=vxlan options:in_key=flow options:local_ip=192.168.1.103 options:out_key=flow options:remote_ip=192.168.1.102
[INFO] module:vxlan,function:add,router: openwrt3
Adding a VXLAN tunnel: vxlan_101
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ovs-vsctl add-port br-tun vxlan_101 -- set interface vxlan_101 type=vxlan options:in_key=flow options:local_ip=192.168.1.103 options:out_key=flow options:remote_ip=192.168.1.101
[INFO] module:vxlan,function:add,router: openwrt3
Adding a VXLAN tunnel: vxlan_104
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ovs-vsctl add-port br-tun vxlan_104 -- set interface vxlan_104 type=vxlan options:in_key=flow options:local_ip=192.168.1.103 options:out_key=flow options:remote_ip=192.168.1.104
[DEBUG] module:ovsdb,function:_send,router: openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"Interface","where":[["type","==","vxlan"]],"columns":["ofport","options"],"op":"select"}],"method":"transact","id":771705}
... JSON-RPC response ...
{"id":771705,"result":[{"rows":[{"options":["map",[["in_key","flow"],["local_ip","192.168.1.103"],["out_key","flow"],["remote_ip","192.168.1.101"]]],"ofport":3},{"options":["map",[["in_key","flow"],["local_ip","192.168.1.103"],["out_key","flow"],["remote_ip","192.168.1.102"]]],"ofport":2},{"options":["map",[["in_key","flow"],["local_ip","192.168.1.103"],["out_key","flow"],["remote_ip","192.168.1.104"]]],"ofport":4}]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ovs-ofctl add-flow br-tun table=0,priority=1,in_port=3,actions=resubmit(,2)
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ovs-ofctl add-flow br-tun table=0,priority=1,in_port=2,actions=resubmit(,2)
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ovs-ofctl add-flow br-tun table=0,priority=1,in_port=4,actions=resubmit(,2)
[DEBUG] module:ovsdb,function:_send,router: openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN","row":{},"op":"insert"}],"method":"transact","id":701424}
... JSON-RPC response ...
{"id":701424,"result":[{"uuid":["uuid","0049ccb5-6665-4e52-86a0-8ff65d7b252f"]},{"error":"constraint violation","details":"transaction causes \"NLAN\" table to contain 2 rows, greater than the schema-defined limit of 1 row(s)"}],"error":null}
[DEBUG] module:ovsdb,function:_send,router: openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_VXLAN","where":[],"op":"select"}],"method":"transact","id":54069}
... JSON-RPC response ...
{"id":54069,"result":[{"rows":[]}],"error":null}
[DEBUG] module:ovsdb,function:_send,router: openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_VXLAN","uuid-name":"temp_364671","row":{"remote_ips":["set",["192.168.1.102","192.168.1.101","192.168.1.104"]],"local_ip":"192.168.1.103"},"op":"insert"},{"table":"NLAN","where":[],"mutations":[["vxlan","insert",["set",[["named-uuid","temp_364671"]]]]],"op":"mutate"}],"method":"transact","id":96035}
... JSON-RPC response ...
{"id":96035,"result":[{"uuid":["uuid","fe450ae6-081f-4bc1-a4c7-cca995837283"]},{"count":1}],"error":null}
[DEBUG] module:ovsdb,function:_send,router: openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_VXLAN","where":[],"op":"select"}],"method":"transact","id":485333}
... JSON-RPC response ...
{"id":485333,"result":[{"rows":[{"_version":["uuid","2e562d2b-47f7-4346-85a3-364aeaa63343"],"_uuid":["uuid","fe450ae6-081f-4bc1-a4c7-cca995837283"],"local_ip":"192.168.1.103","remote_ips":["set",["192.168.1.101","192.168.1.102","192.168.1.104"]]}]}],"error":null}
[INFO] module:nlan_agent,function:_route,router: openwrt3
function:subnets.add, model:{('vni', 1): {'peers': ['192.168.1.101', '192.168.1.102'], 'vid': 2, 'ip_vhost': '192.168.100.103/24', 'default_gw': '192.168.100.1', 'ip_dvr': '192.168.100.3/24', 'vni': 1}, ('vni', 103): {'peers': ['192.168.1.101', '192.168.1.102'], 'vid': 3, 'ip_vhost': '10.0.3.103/24', 'vni': 103, 'ip_dvr': '10.0.3.1/24', 'ports': ['eth0.3']}, ('vni', 101): {'peers': ['192.168.1.102', '192.168.1.104'], 'vid': 1, 'ip_vhost': '10.0.1.103/24', 'vni': 101, 'ip_dvr': '10.0.1.1/24', 'mode': 'spoke_dvr', 'ports': ['eth0.1']}}
[INFO] module:subnets,function:_crud,router: openwrt3
Adding a subnet(vlan): 2
[DEBUG] module:ovsdb,function:_send,router: openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN","row":{},"op":"insert"}],"method":"transact","id":864734}
... JSON-RPC response ...
{"id":864734,"result":[{"uuid":["uuid","222d9df1-1188-49fa-84b3-46219904f20a"]},{"error":"constraint violation","details":"transaction causes \"NLAN\" table to contain 2 rows, greater than the schema-defined limit of 1 row(s)"}],"error":null}
[DEBUG] module:ovsdb,function:_send,router: openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","where":[["vni","==",1]],"op":"select"}],"method":"transact","id":2309}
... JSON-RPC response ...
{"id":2309,"result":[{"rows":[]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ip netns add ns2
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: brctl addbr br2
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ip link add veth-ns2 type veth peer name temp-ns2
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ip link set dev temp-ns2 netns ns2
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ip netns exec ns2 ip link set dev temp-ns2 name eth0
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ovs-vsctl add-port br-int int-br2 tag=2 -- set interface int-br2 type=internal
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ovs-vsctl add-port br-int int-dvr2 tag=2 -- set interface int-dvr2 type=internal
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: brctl addif br2 veth-ns2
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: brctl addif br2 int-br2
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ip link set dev veth-ns2 promisc on
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ip link set dev veth-ns2 up
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ip netns exec ns2 ip link set dev eth0 up
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ip link set dev int-br2 promisc on
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ip link set dev int-br2 up
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ip link set dev int-dvr2 up
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ip link set dev br2 up
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ip netns exec ns2 ip addr add dev eth0 192.168.100.103/24
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ip addr add dev int-dvr2 192.168.100.3/24
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ip netns exec ns2 ip route add default via 192.168.100.3 dev eth0
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: route
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ip route add default via 192.168.100.1
[DEBUG] module:ovsdb,function:_send,router: openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"Controller","where":[],"columns":["target"],"op":"select"}],"method":"transact","id":719325}
... JSON-RPC response ...
{"id":719325,"result":[{"rows":[]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ovs-ofctl add-flow br-tun table=2,priority=1,tun_id=1,actions=mod_vlan_vid:2,resubmit(,10)
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ovs-ofctl add-flow br-tun table=19,priority=1,dl_type=0x0806,dl_vlan=2,nw_dst=192.168.100.3,actions=drop
[DEBUG] module:ovsdb,function:_send,router: openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"Interface","where":[["type","==","vxlan"]],"columns":["ofport","options"],"op":"select"}],"method":"transact","id":580547}
... JSON-RPC response ...
{"id":580547,"result":[{"rows":[{"options":["map",[["in_key","flow"],["local_ip","192.168.1.103"],["out_key","flow"],["remote_ip","192.168.1.101"]]],"ofport":3},{"options":["map",[["in_key","flow"],["local_ip","192.168.1.103"],["out_key","flow"],["remote_ip","192.168.1.102"]]],"ofport":2},{"options":["map",[["in_key","flow"],["local_ip","192.168.1.103"],["out_key","flow"],["remote_ip","192.168.1.104"]]],"ofport":4}]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ovs-ofctl add-flow br-tun table=21,priority=1,dl_vlan=2,actions=strip_vlan,set_tunnel:1,output:3,output:2
[INFO] module:subnets,function:_crud,router: openwrt3
Adding a subnet(vlan): 3
[DEBUG] module:ovsdb,function:_send,router: openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN","row":{},"op":"insert"}],"method":"transact","id":586063}
... JSON-RPC response ...
{"id":586063,"result":[{"uuid":["uuid","5c000145-741f-4aa7-ad9c-baf63029799d"]},{"error":"constraint violation","details":"transaction causes \"NLAN\" table to contain 2 rows, greater than the schema-defined limit of 1 row(s)"}],"error":null}
[DEBUG] module:ovsdb,function:_send,router: openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","where":[["vni","==",103]],"op":"select"}],"method":"transact","id":225084}
... JSON-RPC response ...
{"id":225084,"result":[{"rows":[]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ip netns add ns3
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: brctl addbr br3
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ip link add veth-ns3 type veth peer name temp-ns3
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ip link set dev temp-ns3 netns ns3
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ip netns exec ns3 ip link set dev temp-ns3 name eth0
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ovs-vsctl add-port br-int int-br3 tag=3 -- set interface int-br3 type=internal
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ovs-vsctl add-port br-int int-dvr3 tag=3 -- set interface int-dvr3 type=internal
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: brctl addif br3 veth-ns3
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: brctl addif br3 int-br3
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ip link set dev veth-ns3 promisc on
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ip link set dev veth-ns3 up
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ip netns exec ns3 ip link set dev eth0 up
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ip link set dev int-br3 promisc on
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ip link set dev int-br3 up
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ip link set dev int-dvr3 up
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ip link set dev br3 up
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ip netns exec ns3 ip addr add dev eth0 10.0.3.103/24
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ip addr add dev int-dvr3 10.0.3.1/24
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ip netns exec ns3 ip route add default via 10.0.3.1 dev eth0
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: brctl addif br3 eth0.3
[DEBUG] module:ovsdb,function:_send,router: openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"Controller","where":[],"columns":["target"],"op":"select"}],"method":"transact","id":27880}
... JSON-RPC response ...
{"id":27880,"result":[{"rows":[]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ovs-ofctl add-flow br-tun table=2,priority=1,tun_id=103,actions=mod_vlan_vid:3,resubmit(,10)
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ovs-ofctl add-flow br-tun table=19,priority=1,dl_type=0x0806,dl_vlan=3,nw_dst=10.0.3.1,actions=drop
[DEBUG] module:ovsdb,function:_send,router: openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"Interface","where":[["type","==","vxlan"]],"columns":["ofport","options"],"op":"select"}],"method":"transact","id":567205}
... JSON-RPC response ...
{"id":567205,"result":[{"rows":[{"options":["map",[["in_key","flow"],["local_ip","192.168.1.103"],["out_key","flow"],["remote_ip","192.168.1.101"]]],"ofport":3},{"options":["map",[["in_key","flow"],["local_ip","192.168.1.103"],["out_key","flow"],["remote_ip","192.168.1.102"]]],"ofport":2},{"options":["map",[["in_key","flow"],["local_ip","192.168.1.103"],["out_key","flow"],["remote_ip","192.168.1.104"]]],"ofport":4}]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ovs-ofctl add-flow br-tun table=21,priority=1,dl_vlan=3,actions=strip_vlan,set_tunnel:103,output:3,output:2
[INFO] module:subnets,function:_crud,router: openwrt3
Adding a subnet(vlan): 1
[DEBUG] module:ovsdb,function:_send,router: openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN","row":{},"op":"insert"}],"method":"transact","id":958034}
... JSON-RPC response ...
{"id":958034,"result":[{"uuid":["uuid","783080c2-1bdc-4923-be75-6ddf21828137"]},{"error":"constraint violation","details":"transaction causes \"NLAN\" table to contain 2 rows, greater than the schema-defined limit of 1 row(s)"}],"error":null}
[DEBUG] module:ovsdb,function:_send,router: openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","where":[["vni","==",101]],"op":"select"}],"method":"transact","id":603924}
... JSON-RPC response ...
{"id":603924,"result":[{"rows":[]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ip netns add ns1
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: brctl addbr br1
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ip link add veth-ns1 type veth peer name temp-ns1
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ip link set dev temp-ns1 netns ns1
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ip netns exec ns1 ip link set dev temp-ns1 name eth0
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ovs-vsctl add-port br-int int-br1 tag=1 -- set interface int-br1 type=internal
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ovs-vsctl add-port br-int int-dvr1 tag=1 -- set interface int-dvr1 type=internal
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: brctl addif br1 veth-ns1
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: brctl addif br1 int-br1
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ip link set dev veth-ns1 promisc on
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ip link set dev veth-ns1 up
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ip netns exec ns1 ip link set dev eth0 up
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ip link set dev int-br1 promisc on
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ip link set dev int-br1 up
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ip link set dev int-dvr1 up
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ip link set dev br1 up
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ip netns exec ns1 ip addr add dev eth0 10.0.1.103/24
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ip addr add dev int-dvr1 10.0.1.1/24
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ip netns exec ns1 ip route add default via 10.0.1.1 dev eth0
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: brctl addif br1 eth0.1
[DEBUG] module:ovsdb,function:_send,router: openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"Controller","where":[],"columns":["target"],"op":"select"}],"method":"transact","id":565843}
... JSON-RPC response ...
{"id":565843,"result":[{"rows":[]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ovs-ofctl add-flow br-tun table=2,priority=1,tun_id=101,actions=mod_vlan_vid:1,resubmit(,10)
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ip link show dev int-dvr1
[DEBUG] module:ovsdb,function:_send,router: openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"Interface","where":[["name","==","int-dvr1"]],"op":"select"}],"method":"transact","id":514468}
... JSON-RPC response ...
{"id":514468,"result":[{"rows":[{"options":["map",[]],"mtu":1500,"link_speed":["set",[]],"statistics":["map",[["collisions",0],["rx_bytes",0],["rx_crc_err",0],["rx_dropped",0],["rx_errors",0],["rx_frame_err",0],["rx_over_err",0],["rx_packets",0],["tx_bytes",0],["tx_dropped",0],["tx_errors",0],["tx_packets",0]]],"mac_in_use":"1a:e9:b9:9a:89:a8","ingress_policing_rate":0,"ofport":7,"mac":["set",[]],"cfm_fault_status":["set",[]],"duplex":["set",[]],"lacp_current":["set",[]],"cfm_fault":["set",[]],"link_state":"up","external_ids":["map",[]],"bfd_status":["map",[]],"link_resets":2,"name":"int-dvr1","type":"internal","cfm_remote_opstate":["set",[]],"_uuid":["uuid","618358f7-8ac2-4147-821a-c7801616e0c1"],"status":["map",[["driver_name","openvswitch"]]],"ifindex":46,"_version":["uuid","da04cfcf-3d28-4a74-9d16-9ac74a9edd09"],"other_config":["map",[]],"admin_state":"up","cfm_remote_mpids":["set",[]],"cfm_mpid":["set",[]],"bfd":["map",[]],"ofport_request":["set",[]],"ingress_policing_burst":0,"cfm_flap_count":["set",[]],"cfm_health":["set",[]]}]}],"error":null}
[DEBUG] module:ovsdb,function:_send,router: openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"Interface","where":[["name","==","int-br1"]],"op":"select"}],"method":"transact","id":819921}
... JSON-RPC response ...
{"id":819921,"result":[{"rows":[{"options":["map",[]],"mtu":1500,"link_speed":["set",[]],"statistics":["map",[["collisions",0],["rx_bytes",0],["rx_crc_err",0],["rx_dropped",0],["rx_errors",0],["rx_frame_err",0],["rx_over_err",0],["rx_packets",0],["tx_bytes",0],["tx_dropped",0],["tx_errors",0],["tx_packets",0]]],"mac_in_use":"2a:6d:3e:e9:3f:da","ingress_policing_rate":0,"ofport":6,"mac":["set",[]],"cfm_fault_status":["set",[]],"duplex":["set",[]],"lacp_current":["set",[]],"cfm_fault":["set",[]],"link_state":"up","external_ids":["map",[]],"bfd_status":["map",[]],"link_resets":2,"name":"int-br1","type":"internal","cfm_remote_opstate":["set",[]],"_uuid":["uuid","85a0bb37-10c1-4c0a-a29d-d2244f1f9744"],"status":["map",[["driver_name","openvswitch"]]],"ifindex":45,"_version":["uuid","0543d8ea-ab0b-4ded-b406-ff80efb8cef6"],"other_config":["map",[]],"admin_state":"up","cfm_remote_mpids":["set",[]],"cfm_mpid":["set",[]],"bfd":["map",[]],"ofport_request":["set",[]],"ingress_policing_burst":0,"cfm_flap_count":["set",[]],"cfm_health":["set",[]]}]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ovs-ofctl add-flow br-int table=0,priority=2,in_port=6,dl_type=0x0800,nw_dst=10.0.1.0/24,actions=normal
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ovs-ofctl add-flow br-int table=0,priority=1,in_port=6,dl_type=0x0800,nw_dst=10.0.0.0/8,actions=resubmit(,1)
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ovs-ofctl add-flow br-int table=0,priority=1,in_port=6,dl_type=0x0800,nw_dst=172.16.0.0/12,actions=resubmit(,1)
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ovs-ofctl add-flow br-int table=0,priority=1,in_port=6,dl_type=0x0800,nw_dst=192.168.0.0/16,actions=resubmit(,1)
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ovs-ofctl add-flow br-int table=0,priority=1,in_port=7,dl_type=0x0806,nw_src=10.0.1.1,nw_proto=2,actions=drop
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ovs-ofctl add-flow br-int table=1,priority=0,actions=set_field:1a:e9:b9:9a:89:a8->dl_dst,output:7
[DEBUG] module:ovsdb,function:_send,router: openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"Interface","where":[["type","==","vxlan"]],"columns":["ofport","options"],"op":"select"}],"method":"transact","id":716279}
... JSON-RPC response ...
{"id":716279,"result":[{"rows":[{"options":["map",[["in_key","flow"],["local_ip","192.168.1.103"],["out_key","flow"],["remote_ip","192.168.1.101"]]],"ofport":3},{"options":["map",[["in_key","flow"],["local_ip","192.168.1.103"],["out_key","flow"],["remote_ip","192.168.1.102"]]],"ofport":2},{"options":["map",[["in_key","flow"],["local_ip","192.168.1.103"],["out_key","flow"],["remote_ip","192.168.1.104"]]],"ofport":4}]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt3
cmd: ovs-ofctl add-flow br-tun table=21,priority=1,dl_vlan=1,actions=strip_vlan,set_tunnel:101,output:2,output:4
[DEBUG] module:ovsdb,function:_send,router: openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN","row":{},"op":"insert"}],"method":"transact","id":880608}
... JSON-RPC response ...
{"id":880608,"result":[{"uuid":["uuid","25dbfe8e-64dc-477f-af20-9c1f028e984a"]},{"error":"constraint violation","details":"transaction causes \"NLAN\" table to contain 2 rows, greater than the schema-defined limit of 1 row(s)"}],"error":null}
[DEBUG] module:ovsdb,function:_send,router: openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","where":[["vni","==",1]],"op":"select"}],"method":"transact","id":459264}
... JSON-RPC response ...
{"id":459264,"result":[{"rows":[]}],"error":null}
[DEBUG] module:ovsdb,function:crud,router: openwrt3
CRUD operation (add): {'peers': ['192.168.1.101', '192.168.1.102'], 'vid': 2, 'ip_vhost': '192.168.100.103/24', 'default_gw': '192.168.100.1', 'ip_dvr': '192.168.100.3/24', 'vni': 1}
[DEBUG] module:ovsdb,function:_send,router: openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","uuid-name":"temp_166918","row":{"peers":["set",["192.168.1.101","192.168.1.102"]],"vid":2,"ip_vhost":"192.168.100.103/24","default_gw":"192.168.100.1","ip_dvr":"192.168.100.3/24","vni":1},"op":"insert"},{"table":"NLAN","where":[],"mutations":[["subnets","insert",["set",[["named-uuid","temp_166918"]]]]],"op":"mutate"}],"method":"transact","id":294056}
... JSON-RPC response ...
{"id":294056,"result":[{"uuid":["uuid","4d24b255-d98a-4c4b-ac3e-c80e9de3e768"]},{"count":1}],"error":null}
[DEBUG] module:ovsdb,function:_send,router: openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","where":[["vni","==",1]],"op":"select"}],"method":"transact","id":453047}
... JSON-RPC response ...
{"id":453047,"result":[{"rows":[{"peers":["set",["192.168.1.101","192.168.1.102"]],"_version":["uuid","c74026eb-58ab-4698-9b46-9ae568d0659e"],"vni":1,"ports":["set",[]],"mode":["set",[]],"vid":2,"_uuid":["uuid","4d24b255-d98a-4c4b-ac3e-c80e9de3e768"],"default_gw":"192.168.100.1","ip_vhost":"192.168.100.103/24","ip_dvr":"192.168.100.3/24"}]}],"error":null}
[DEBUG] module:ovsdb,function:_send,router: openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN","row":{},"op":"insert"}],"method":"transact","id":234909}
... JSON-RPC response ...
{"id":234909,"result":[{"uuid":["uuid","2acbc9e4-2044-44f3-a7d9-8ff7d618421a"]},{"error":"constraint violation","details":"transaction causes \"NLAN\" table to contain 2 rows, greater than the schema-defined limit of 1 row(s)"}],"error":null}
[DEBUG] module:ovsdb,function:_send,router: openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","where":[["vni","==",103]],"op":"select"}],"method":"transact","id":924291}
... JSON-RPC response ...
{"id":924291,"result":[{"rows":[]}],"error":null}
[DEBUG] module:ovsdb,function:crud,router: openwrt3
CRUD operation (add): {'peers': ['192.168.1.101', '192.168.1.102'], 'vid': 3, 'ip_vhost': '10.0.3.103/24', 'vni': 103, 'ip_dvr': '10.0.3.1/24', 'ports': ['eth0.3']}
[DEBUG] module:ovsdb,function:_send,router: openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","uuid-name":"temp_328252","row":{"peers":["set",["192.168.1.101","192.168.1.102"]],"vid":3,"ip_vhost":"10.0.3.103/24","vni":103,"ip_dvr":"10.0.3.1/24","ports":["set",["eth0.3"]]},"op":"insert"},{"table":"NLAN","where":[],"mutations":[["subnets","insert",["set",[["named-uuid","temp_328252"]]]]],"op":"mutate"}],"method":"transact","id":261092}
... JSON-RPC response ...
{"id":261092,"result":[{"uuid":["uuid","6731cac0-05f3-4596-b43a-7832eba27c22"]},{"count":1}],"error":null}
[DEBUG] module:ovsdb,function:_send,router: openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","where":[["vni","==",103]],"op":"select"}],"method":"transact","id":190521}
... JSON-RPC response ...
{"id":190521,"result":[{"rows":[{"peers":["set",["192.168.1.101","192.168.1.102"]],"_version":["uuid","ae70113c-2237-4f6a-9918-0101a15f7820"],"vni":103,"ports":"eth0.3","mode":["set",[]],"vid":3,"_uuid":["uuid","6731cac0-05f3-4596-b43a-7832eba27c22"],"default_gw":["set",[]],"ip_vhost":"10.0.3.103/24","ip_dvr":"10.0.3.1/24"}]}],"error":null}
[DEBUG] module:ovsdb,function:_send,router: openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN","row":{},"op":"insert"}],"method":"transact","id":787449}
... JSON-RPC response ...
{"id":787449,"result":[{"uuid":["uuid","f31ded6b-1735-4555-94b7-418fb9163255"]},{"error":"constraint violation","details":"transaction causes \"NLAN\" table to contain 2 rows, greater than the schema-defined limit of 1 row(s)"}],"error":null}
[DEBUG] module:ovsdb,function:_send,router: openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","where":[["vni","==",101]],"op":"select"}],"method":"transact","id":620449}
... JSON-RPC response ...
{"id":620449,"result":[{"rows":[]}],"error":null}
[DEBUG] module:ovsdb,function:crud,router: openwrt3
CRUD operation (add): {'peers': ['192.168.1.102', '192.168.1.104'], 'vid': 1, 'ip_vhost': '10.0.1.103/24', 'vni': 101, 'ip_dvr': '10.0.1.1/24', 'mode': 'spoke_dvr', 'ports': ['eth0.1']}
[DEBUG] module:ovsdb,function:_send,router: openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","uuid-name":"temp_777147","row":{"peers":["set",["192.168.1.102","192.168.1.104"]],"vid":1,"ip_vhost":"10.0.1.103/24","vni":101,"ip_dvr":"10.0.1.1/24","mode":"spoke_dvr","ports":["set",["eth0.1"]]},"op":"insert"},{"table":"NLAN","where":[],"mutations":[["subnets","insert",["set",[["named-uuid","temp_777147"]]]]],"op":"mutate"}],"method":"transact","id":249833}
... JSON-RPC response ...
{"id":249833,"result":[{"uuid":["uuid","1c3d01de-20a9-4712-8b15-557281824dc4"]},{"count":1}],"error":null}
[DEBUG] module:ovsdb,function:_send,router: openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","where":[["vni","==",101]],"op":"select"}],"method":"transact","id":887110}
... JSON-RPC response ...
{"id":887110,"result":[{"rows":[{"peers":["set",["192.168.1.102","192.168.1.104"]],"_version":["uuid","49f55815-8bff-44f9-a9fd-456f08beaf23"],"vni":101,"ports":"eth0.1","mode":"spoke_dvr","vid":1,"_uuid":["uuid","1c3d01de-20a9-4712-8b15-557281824dc4"],"default_gw":["set",[]],"ip_vhost":"10.0.1.103/24","ip_dvr":"10.0.1.1/24"}]}],"error":null}


...
brctl: iface eth0.3: No such device
brctl: iface eth0.1: No such device


=+=+= NLAN Reply from router:rpi1,platform:debian =+=+=+=+=+=+=+=+=+=+=+=+=+=+
[INFO] module:nlan_agent,function:<module>,router: rpi1
NLAN Agent initialization completed
{'mod_dir': ['command', 'config'], 'etc_dir': '/opt/nlan/etc', 'state_order': ['bridges', 'services', 'gateway', 'vxlan', 'subnets'], 'types': {'services': {'name': {'max': 1, 'key': {'type': 'string'}, 'min': 1}, 'chain': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}}, 'bridges': {'controller': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'ovs_bridges': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}, 'gateway': {'network': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'rip': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}, 'vxlan': {'remote_ips': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}, 'local_ip': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}, 'subnets': {'ip_dvr': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'peers': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}, 'vni': {'max': 1, 'key': {'minInteger': 0, 'maxInteger': 16777215, 'type': 'integer'}, 'min': 1}, 'vid': {'max': 1, 'key': {'minInteger': 0, 'maxInteger': 4095, 'type': 'integer'}, 'min': 0}, 'ip_vhost': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'ports': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}, 'default_gw': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'mode': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}}, 'tables': {'services': {'max': 'unlimited', 'key': {'type': 'uuid', 'refTable': 'NLAN_Service'}, 'min': 0}, 'bridges': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_Bridges'}, 'min': 0}, 'gateway': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_Gateway'}, 'min': 0}, 'vxlan': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_VXLAN'}, 'min': 0}, 'subnets': {'max': 'unlimited', 'key': {'type': 'uuid', 'refTable': 'NLAN_Subnet'}, 'min': 0}}, 'agent_dir': '/opt/nlan', 'indexes': {'services': 'name', 'subnets': 'vni'}, 'platform': 'debian', 'init': False, 'router': 'rpi1', 'logger': <logging.Logger object at 0xb730c54c>, 'schema': 'ovsdb_nlan.schema'}
[INFO] module:nlan_agent,function:_route,router: rpi1
function:bridges.add, model:{'ovs_bridges': 'enabled'}
[INFO] module:bridges,function:add,router: rpi1
Adding bridges: br-int and br-tun
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: ovs-vsctl add-br br-int
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: ovs-vsctl add-br br-tun
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: ovs-ofctl del-flows br-tun
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: ovs-vsctl add-port br-int patch-int -- set interface patch-int type=patch options:peer=patch-tun
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: ovs-vsctl add-port br-tun patch-tun -- set interface patch-tun type=patch options:peer=patch-int
[DEBUG] module:ovsdb,function:_send,router: rpi1
... JSON-RPC request ...
{"params": ["Open_vSwitch", {"table": "Interface", "where": [["name", "==", "patch-tun"]], "op": "select"}], "method": "transact", "id": 635554}
... JSON-RPC response ...
{"id":635554,"result":[{"rows":[{"options":["map",[["peer","patch-int"]]],"mtu":["set",[]],"link_speed":["set",[]],"statistics":["map",[["collisions",0],["rx_bytes",0],["rx_crc_err",0],["rx_dropped",0],["rx_errors",0],["rx_frame_err",0],["rx_over_err",0],["rx_packets",0],["tx_bytes",0],["tx_dropped",0],["tx_errors",0],["tx_packets",0]]],"mac_in_use":"f6:db:0f:5a:af:02","ingress_policing_rate":0,"mac":["set",[]],"ofport":1,"cfm_fault_status":["set",[]],"duplex":["set",[]],"cfm_fault":["set",[]],"lacp_current":["set",[]],"external_ids":["map",[]],"link_state":["set",[]],"bfd_status":["map",[]],"link_resets":["set",[]],"name":"patch-tun","type":"patch","cfm_remote_opstate":["set",[]],"_uuid":["uuid","5a58e627-0db7-4a2e-90ca-8a656303d258"],"status":["map",[]],"ifindex":0,"_version":["uuid","bd1c3d2e-334f-454d-b257-564c8717c384"],"other_config":["map",[]],"admin_state":["set",[]],"cfm_remote_mpids":["set",[]],"cfm_mpid":["set",[]],"bfd":["map",[]],"ofport_request":["set",[]],"ingress_policing_burst":0,"cfm_flap_count":["set",[]],"cfm_health":["set",[]]}]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: ovs-ofctl del-flows br-tun
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: ovs-ofctl add-flow br-tun table=0,priority=1,in_port=1,actions=resubmit(,1)
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: ovs-ofctl add-flow br-tun table=0,priority=0,actions=drop
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: ovs-ofctl add-flow br-tun table=1,priority=0,dl_dst=01:00:00:00:00:00/01:00:00:00:00:00,actions=resubmit(,19)
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: ovs-ofctl add-flow br-tun table=1,priority=0,dl_dst=00:00:00:00:00:00/01:00:00:00:00:00,actions=resubmit(,20)
[DEBUG] module:ovsdb,function:_send,router: rpi1
... JSON-RPC request ...
{"params": ["Open_vSwitch", {"table": "Interface", "where": [["name", "==", "patch-tun"]], "op": "select"}], "method": "transact", "id": 621829}
... JSON-RPC response ...
{"id":621829,"result":[{"rows":[{"options":["map",[["peer","patch-int"]]],"mtu":["set",[]],"link_speed":["set",[]],"statistics":["map",[["collisions",0],["rx_bytes",0],["rx_crc_err",0],["rx_dropped",0],["rx_errors",0],["rx_frame_err",0],["rx_over_err",0],["rx_packets",0],["tx_bytes",0],["tx_dropped",0],["tx_errors",0],["tx_packets",0]]],"mac_in_use":"f6:db:0f:5a:af:02","ingress_policing_rate":0,"mac":["set",[]],"ofport":1,"cfm_fault_status":["set",[]],"duplex":["set",[]],"cfm_fault":["set",[]],"lacp_current":["set",[]],"external_ids":["map",[]],"link_state":"up","bfd_status":["map",[]],"link_resets":0,"name":"patch-tun","type":"patch","cfm_remote_opstate":["set",[]],"_uuid":["uuid","5a58e627-0db7-4a2e-90ca-8a656303d258"],"status":["map",[]],"ifindex":0,"_version":["uuid","8ca01166-7df5-4618-9183-9a63f6558880"],"other_config":["map",[]],"admin_state":"up","cfm_remote_mpids":["set",[]],"cfm_mpid":["set",[]],"bfd":["map",[]],"ofport_request":["set",[]],"ingress_policing_burst":0,"cfm_flap_count":["set",[]],"cfm_health":["set",[]]}]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: ovs-ofctl add-flow br-tun table=2,priority=0,actions=drop
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: ovs-ofctl add-flow br-tun table=3,priority=0,actions=drop
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: ovs-ofctl add-flow br-tun table=10,priority=1,actions=learn(table=20,hard_timeout=300,priority=1,NXM_OF_VLAN_TCI[0..11],NXM_OF_ETH_DST[]=NXM_OF_ETH_SRC[],load:0->NXM_OF_VLAN_TCI[],load:NXM_NX_TUN_ID[]->NXM_NX_TUN_ID[],output:NXM_OF_IN_PORT[]),output:1
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: ovs-ofctl add-flow br-tun table=19,priority=0,actions=resubmit(,21)
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: ovs-ofctl add-flow br-tun table=20,priority=0,actions=resubmit(,21)
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: ovs-ofctl add-flow br-tun table=21,priority=0,actions=drop
[DEBUG] module:ovsdb,function:_send,router: rpi1
... JSON-RPC request ...
{"params": ["Open_vSwitch", {"table": "NLAN", "row": {}, "op": "insert"}], "method": "transact", "id": 484972}
... JSON-RPC response ...
{"id":484972,"result":[{"uuid":["uuid","2928cfe4-1615-4e5a-ad56-5e10b881a9bb"]}],"error":null}
[DEBUG] module:ovsdb,function:_send,router: rpi1
... JSON-RPC request ...
{"params": ["Open_vSwitch", {"table": "NLAN_Bridges", "where": [], "op": "select"}], "method": "transact", "id": 501658}
... JSON-RPC response ...
{"id":501658,"result":[{"rows":[]}],"error":null}
[DEBUG] module:ovsdb,function:_send,router: rpi1
... JSON-RPC request ...
{"params": ["Open_vSwitch", {"table": "NLAN_Bridges", "uuid-name": "temp_70537", "row": {"ovs_bridges": "enabled"}, "op": "insert"}, {"table": "NLAN", "where": [], "mutations": [["bridges", "insert", ["set", [["named-uuid", "temp_70537"]]]]], "op": "mutate"}], "method": "transact", "id": 11934}
... JSON-RPC response ...
{"id":11934,"result":[{"uuid":["uuid","b96c47b6-1ace-4ea4-af7c-946d2623cacc"]},{"count":1}],"error":null}
[DEBUG] module:ovsdb,function:_send,router: rpi1
... JSON-RPC request ...
{"params": ["Open_vSwitch", {"table": "NLAN_Bridges", "where": [], "op": "select"}], "method": "transact", "id": 758585}
... JSON-RPC response ...
{"id":758585,"result":[{"rows":[{"_uuid":["uuid","b96c47b6-1ace-4ea4-af7c-946d2623cacc"],"_version":["uuid","0b3726c2-b50e-4f6a-b329-4da982483429"],"ovs_bridges":"enabled","controller":["set",[]]}]}],"error":null}
[INFO] module:nlan_agent,function:_route,router: rpi1
function:services.add, model:{('name', 'snort1'): {'name': 'snort1', 'chain': ['mz.101', 'dmz.1001']}}
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: lxc-start -d -f /var/lib/lxc/snort1/config_nlan -n snort1
[DEBUG] module:ovsdb,function:_send,router: rpi1
... JSON-RPC request ...
{"params": ["Open_vSwitch", {"table": "NLAN", "row": {}, "op": "insert"}], "method": "transact", "id": 582913}
... JSON-RPC response ...
{"id":582913,"result":[{"uuid":["uuid","b90bfc70-debf-4f94-9214-4db033ad36c7"]},{"error":"constraint violation","details":"transaction causes \"NLAN\" table to contain 2 rows, greater than the schema-defined limit of 1 row(s)"}],"error":null}
[DEBUG] module:ovsdb,function:_send,router: rpi1
... JSON-RPC request ...
{"params": ["Open_vSwitch", {"table": "NLAN_Service", "where": [["name", "==", "snort1"]], "op": "select"}], "method": "transact", "id": 306883}
... JSON-RPC response ...
{"id":306883,"result":[{"rows":[]}],"error":null}
[DEBUG] module:ovsdb,function:crud,router: rpi1
CRUD operation (add): {'name': 'snort1', 'chain': ['mz.101', 'dmz.1001']}
[DEBUG] module:ovsdb,function:_send,router: rpi1
... JSON-RPC request ...
{"params": ["Open_vSwitch", {"table": "NLAN_Service", "uuid-name": "temp_283525", "row": {"name": "snort1", "chain": ["set", ["mz.101", "dmz.1001"]]}, "op": "insert"}, {"table": "NLAN", "where": [], "mutations": [["services", "insert", ["set", [["named-uuid", "temp_283525"]]]]], "op": "mutate"}], "method": "transact", "id": 329414}
... JSON-RPC response ...
{"id":329414,"result":[{"uuid":["uuid","bf9038c4-5b02-45d0-adfd-51176b24ca49"]},{"count":1}],"error":null}
[DEBUG] module:ovsdb,function:_send,router: rpi1
... JSON-RPC request ...
{"params": ["Open_vSwitch", {"table": "NLAN_Service", "where": [["name", "==", "snort1"]], "op": "select"}], "method": "transact", "id": 702830}
... JSON-RPC response ...
{"id":702830,"result":[{"rows":[{"_version":["uuid","eddb1b2d-89e0-4d3d-99cb-895d01b7b220"],"_uuid":["uuid","bf9038c4-5b02-45d0-adfd-51176b24ca49"],"name":"snort1","chain":["set",["dmz.1001","mz.101"]]}]}],"error":null}
[INFO] module:nlan_agent,function:_route,router: rpi1
function:vxlan.add, model:{'remote_ips': ['192.168.1.103', '192.168.1.102', '192.168.1.101'], 'local_ip': '192.168.1.104'}
[INFO] module:vxlan,function:add,router: rpi1
Adding a VXLAN tunnel: vxlan_103
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: ovs-vsctl add-port br-tun vxlan_103 -- set interface vxlan_103 type=vxlan options:in_key=flow options:local_ip=192.168.1.104 options:out_key=flow options:remote_ip=192.168.1.103
[INFO] module:vxlan,function:add,router: rpi1
Adding a VXLAN tunnel: vxlan_102
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: ovs-vsctl add-port br-tun vxlan_102 -- set interface vxlan_102 type=vxlan options:in_key=flow options:local_ip=192.168.1.104 options:out_key=flow options:remote_ip=192.168.1.102
[INFO] module:vxlan,function:add,router: rpi1
Adding a VXLAN tunnel: vxlan_101
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: ovs-vsctl add-port br-tun vxlan_101 -- set interface vxlan_101 type=vxlan options:in_key=flow options:local_ip=192.168.1.104 options:out_key=flow options:remote_ip=192.168.1.101
[DEBUG] module:ovsdb,function:_send,router: rpi1
... JSON-RPC request ...
{"params": ["Open_vSwitch", {"table": "Interface", "where": [["type", "==", "vxlan"]], "columns": ["ofport", "options"], "op": "select"}], "method": "transact", "id": 110226}
... JSON-RPC response ...
{"id":110226,"result":[{"rows":[{"options":["map",[["in_key","flow"],["local_ip","192.168.1.104"],["out_key","flow"],["remote_ip","192.168.1.101"]]],"ofport":4},{"options":["map",[["in_key","flow"],["local_ip","192.168.1.104"],["out_key","flow"],["remote_ip","192.168.1.102"]]],"ofport":3},{"options":["map",[["in_key","flow"],["local_ip","192.168.1.104"],["out_key","flow"],["remote_ip","192.168.1.103"]]],"ofport":2}]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: ovs-ofctl add-flow br-tun table=0,priority=1,in_port=4,actions=resubmit(,2)
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: ovs-ofctl add-flow br-tun table=0,priority=1,in_port=3,actions=resubmit(,2)
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: ovs-ofctl add-flow br-tun table=0,priority=1,in_port=2,actions=resubmit(,2)
[DEBUG] module:ovsdb,function:_send,router: rpi1
... JSON-RPC request ...
{"params": ["Open_vSwitch", {"table": "NLAN", "row": {}, "op": "insert"}], "method": "transact", "id": 572821}
... JSON-RPC response ...
{"id":572821,"result":[{"uuid":["uuid","0820288e-0e84-4063-9813-527630a1434c"]},{"error":"constraint violation","details":"transaction causes \"NLAN\" table to contain 2 rows, greater than the schema-defined limit of 1 row(s)"}],"error":null}
[DEBUG] module:ovsdb,function:_send,router: rpi1
... JSON-RPC request ...
{"params": ["Open_vSwitch", {"table": "NLAN_VXLAN", "where": [], "op": "select"}], "method": "transact", "id": 687994}
... JSON-RPC response ...
{"id":687994,"result":[{"rows":[]}],"error":null}
[DEBUG] module:ovsdb,function:_send,router: rpi1
... JSON-RPC request ...
{"params": ["Open_vSwitch", {"table": "NLAN_VXLAN", "uuid-name": "temp_193414", "row": {"remote_ips": ["set", ["192.168.1.103", "192.168.1.102", "192.168.1.101"]], "local_ip": "192.168.1.104"}, "op": "insert"}, {"table": "NLAN", "where": [], "mutations": [["vxlan", "insert", ["set", [["named-uuid", "temp_193414"]]]]], "op": "mutate"}], "method": "transact", "id": 408969}
... JSON-RPC response ...
{"id":408969,"result":[{"uuid":["uuid","42da0c85-688a-4231-9082-5e43a63756bd"]},{"count":1}],"error":null}
[DEBUG] module:ovsdb,function:_send,router: rpi1
... JSON-RPC request ...
{"params": ["Open_vSwitch", {"table": "NLAN_VXLAN", "where": [], "op": "select"}], "method": "transact", "id": 411422}
... JSON-RPC response ...
{"id":411422,"result":[{"rows":[{"_version":["uuid","f434ecda-ea8b-4463-94c7-c8ac03087cda"],"_uuid":["uuid","42da0c85-688a-4231-9082-5e43a63756bd"],"remote_ips":["set",["192.168.1.101","192.168.1.102","192.168.1.103"]],"local_ip":"192.168.1.104"}]}],"error":null}
[INFO] module:nlan_agent,function:_route,router: rpi1
function:subnets.add, model:{('vni', 1001): {'peers': ['192.168.1.101'], 'vni': 1001, 'vid': 111, 'ports': ['dmz.1001']}, ('vni', 101): {'peers': ['192.168.1.102', '192.168.1.103'], 'vni': 101, 'vid': 1, 'ports': ['mz.101']}}
[INFO] module:subnets,function:_crud,router: rpi1
Adding a subnet(vlan): 111
[DEBUG] module:ovsdb,function:_send,router: rpi1
... JSON-RPC request ...
{"params": ["Open_vSwitch", {"table": "NLAN", "row": {}, "op": "insert"}], "method": "transact", "id": 713650}
... JSON-RPC response ...
{"id":713650,"result":[{"uuid":["uuid","d9a31507-fd3e-4b75-ab0d-ef9af486f560"]},{"error":"constraint violation","details":"transaction causes \"NLAN\" table to contain 2 rows, greater than the schema-defined limit of 1 row(s)"}],"error":null}
[DEBUG] module:ovsdb,function:_send,router: rpi1
... JSON-RPC request ...
{"params": ["Open_vSwitch", {"table": "NLAN_Subnet", "where": [["vni", "==", 1001]], "op": "select"}], "method": "transact", "id": 656297}
... JSON-RPC response ...
{"id":656297,"result":[{"rows":[]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: ip netns add ns111
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: brctl addbr br111
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: ip link add veth-ns111 type veth peer name temp-ns111
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: ip link set dev temp-ns111 netns ns111
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: ip netns exec ns111 ip link set dev temp-ns111 name eth0
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: ovs-vsctl add-port br-int int-br111 tag=111 -- set interface int-br111 type=internal
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: ovs-vsctl add-port br-int int-dvr111 tag=111 -- set interface int-dvr111 type=internal
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: brctl addif br111 veth-ns111
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: brctl addif br111 int-br111
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: ip link set dev veth-ns111 promisc on
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: ip link set dev veth-ns111 up
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: ip netns exec ns111 ip link set dev eth0 up
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: ip link set dev int-br111 promisc on
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: ip link set dev int-br111 up
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: ip link set dev int-dvr111 up
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: ip link set dev br111 up
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: brctl addif br111 dmz.1001
[DEBUG] module:ovsdb,function:_send,router: rpi1
... JSON-RPC request ...
{"params": ["Open_vSwitch", {"table": "Controller", "where": [], "columns": ["target"], "op": "select"}], "method": "transact", "id": 733608}
... JSON-RPC response ...
{"id":733608,"result":[{"rows":[]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: ovs-ofctl add-flow br-tun table=2,priority=1,tun_id=1001,actions=mod_vlan_vid:111,resubmit(,10)
[DEBUG] module:ovsdb,function:_send,router: rpi1
... JSON-RPC request ...
{"params": ["Open_vSwitch", {"table": "Interface", "where": [["type", "==", "vxlan"]], "columns": ["ofport", "options"], "op": "select"}], "method": "transact", "id": 748644}
... JSON-RPC response ...
{"id":748644,"result":[{"rows":[{"options":["map",[["in_key","flow"],["local_ip","192.168.1.104"],["out_key","flow"],["remote_ip","192.168.1.101"]]],"ofport":4},{"options":["map",[["in_key","flow"],["local_ip","192.168.1.104"],["out_key","flow"],["remote_ip","192.168.1.102"]]],"ofport":3},{"options":["map",[["in_key","flow"],["local_ip","192.168.1.104"],["out_key","flow"],["remote_ip","192.168.1.103"]]],"ofport":2}]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: ovs-ofctl add-flow br-tun table=21,priority=1,dl_vlan=111,actions=strip_vlan,set_tunnel:1001,output:4
[INFO] module:subnets,function:_crud,router: rpi1
Adding a subnet(vlan): 1
[DEBUG] module:ovsdb,function:_send,router: rpi1
... JSON-RPC request ...
{"params": ["Open_vSwitch", {"table": "NLAN", "row": {}, "op": "insert"}], "method": "transact", "id": 625965}
... JSON-RPC response ...
{"id":625965,"result":[{"uuid":["uuid","1b5d6070-4674-4e6e-b712-23720a27a8a9"]},{"error":"constraint violation","details":"transaction causes \"NLAN\" table to contain 2 rows, greater than the schema-defined limit of 1 row(s)"}],"error":null}
[DEBUG] module:ovsdb,function:_send,router: rpi1
... JSON-RPC request ...
{"params": ["Open_vSwitch", {"table": "NLAN_Subnet", "where": [["vni", "==", 101]], "op": "select"}], "method": "transact", "id": 328913}
... JSON-RPC response ...
{"id":328913,"result":[{"rows":[]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: ip netns add ns1
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: brctl addbr br1
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: ip link add veth-ns1 type veth peer name temp-ns1
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: ip link set dev temp-ns1 netns ns1
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: ip netns exec ns1 ip link set dev temp-ns1 name eth0
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: ovs-vsctl add-port br-int int-br1 tag=1 -- set interface int-br1 type=internal
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: ovs-vsctl add-port br-int int-dvr1 tag=1 -- set interface int-dvr1 type=internal
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: brctl addif br1 veth-ns1
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: brctl addif br1 int-br1
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: ip link set dev veth-ns1 promisc on
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: ip link set dev veth-ns1 up
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: ip netns exec ns1 ip link set dev eth0 up
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: ip link set dev int-br1 promisc on
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: ip link set dev int-br1 up
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: ip link set dev int-dvr1 up
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: ip link set dev br1 up
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: brctl addif br1 mz.101
[DEBUG] module:ovsdb,function:_send,router: rpi1
... JSON-RPC request ...
{"params": ["Open_vSwitch", {"table": "Controller", "where": [], "columns": ["target"], "op": "select"}], "method": "transact", "id": 654825}
... JSON-RPC response ...
{"id":654825,"result":[{"rows":[]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: ovs-ofctl add-flow br-tun table=2,priority=1,tun_id=101,actions=mod_vlan_vid:1,resubmit(,10)
[DEBUG] module:ovsdb,function:_send,router: rpi1
... JSON-RPC request ...
{"params": ["Open_vSwitch", {"table": "Interface", "where": [["type", "==", "vxlan"]], "columns": ["ofport", "options"], "op": "select"}], "method": "transact", "id": 999430}
... JSON-RPC response ...
{"id":999430,"result":[{"rows":[{"options":["map",[["in_key","flow"],["local_ip","192.168.1.104"],["out_key","flow"],["remote_ip","192.168.1.101"]]],"ofport":4},{"options":["map",[["in_key","flow"],["local_ip","192.168.1.104"],["out_key","flow"],["remote_ip","192.168.1.102"]]],"ofport":3},{"options":["map",[["in_key","flow"],["local_ip","192.168.1.104"],["out_key","flow"],["remote_ip","192.168.1.103"]]],"ofport":2}]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router: rpi1
cmd: ovs-ofctl add-flow br-tun table=21,priority=1,dl_vlan=1,actions=strip_vlan,set_tunnel:101,output:3,output:2
[DEBUG] module:ovsdb,function:_send,router: rpi1
... JSON-RPC request ...
{"params": ["Open_vSwitch", {"table": "NLAN", "row": {}, "op": "insert"}], "method": "transact", "id": 260718}
... JSON-RPC response ...
{"id":260718,"result":[{"uuid":["uuid","b279092f-d6e2-456b-bf96-759301732831"]},{"error":"constraint violation","details":"transaction causes \"NLAN\" table to contain 2 rows, greater than the schema-defined limit of 1 row(s)"}],"error":null}
[DEBUG] module:ovsdb,function:_send,router: rpi1
... JSON-RPC request ...
{"params": ["Open_vSwitch", {"table": "NLAN_Subnet", "where": [["vni", "==", 1001]], "op": "select"}], "method": "transact", "id": 65813}
... JSON-RPC response ...
{"id":65813,"result":[{"rows":[]}],"error":null}
[DEBUG] module:ovsdb,function:crud,router: rpi1
CRUD operation (add): {'peers': ['192.168.1.101'], 'vni': 1001, 'vid': 111, 'ports': ['dmz.1001']}
[DEBUG] module:ovsdb,function:_send,router: rpi1
... JSON-RPC request ...
{"params": ["Open_vSwitch", {"table": "NLAN_Subnet", "uuid-name": "temp_162874", "row": {"peers": ["set", ["192.168.1.101"]], "vid": 111, "vni": 1001, "ports": ["set", ["dmz.1001"]]}, "op": "insert"}, {"table": "NLAN", "where": [], "mutations": [["subnets", "insert", ["set", [["named-uuid", "temp_162874"]]]]], "op": "mutate"}], "method": "transact", "id": 362041}
... JSON-RPC response ...
{"id":362041,"result":[{"uuid":["uuid","376c0b57-9108-44c1-8fcd-d28634953977"]},{"count":1}],"error":null}
[DEBUG] module:ovsdb,function:_send,router: rpi1
... JSON-RPC request ...
{"params": ["Open_vSwitch", {"table": "NLAN_Subnet", "where": [["vni", "==", 1001]], "op": "select"}], "method": "transact", "id": 589661}
... JSON-RPC response ...
{"id":589661,"result":[{"rows":[{"peers":"192.168.1.101","_version":["uuid","601ca056-3119-4427-8707-f83c8047959c"],"vni":1001,"ports":"dmz.1001","mode":["set",[]],"vid":111,"_uuid":["uuid","376c0b57-9108-44c1-8fcd-d28634953977"],"default_gw":["set",[]],"ip_vhost":["set",[]],"ip_dvr":["set",[]]}]}],"error":null}
[DEBUG] module:ovsdb,function:_send,router: rpi1
... JSON-RPC request ...
{"params": ["Open_vSwitch", {"table": "NLAN", "row": {}, "op": "insert"}], "method": "transact", "id": 808413}
... JSON-RPC response ...
{"id":808413,"result":[{"uuid":["uuid","6de71349-04ad-48f0-be91-b5c53f8d9867"]},{"error":"constraint violation","details":"transaction causes \"NLAN\" table to contain 2 rows, greater than the schema-defined limit of 1 row(s)"}],"error":null}
[DEBUG] module:ovsdb,function:_send,router: rpi1
... JSON-RPC request ...
{"params": ["Open_vSwitch", {"table": "NLAN_Subnet", "where": [["vni", "==", 101]], "op": "select"}], "method": "transact", "id": 729429}
... JSON-RPC response ...
{"id":729429,"result":[{"rows":[]}],"error":null}
[DEBUG] module:ovsdb,function:crud,router: rpi1
CRUD operation (add): {'peers': ['192.168.1.102', '192.168.1.103'], 'vni': 101, 'vid': 1, 'ports': ['mz.101']}
[DEBUG] module:ovsdb,function:_send,router: rpi1
... JSON-RPC request ...
{"params": ["Open_vSwitch", {"table": "NLAN_Subnet", "uuid-name": "temp_599860", "row": {"peers": ["set", ["192.168.1.102", "192.168.1.103"]], "vid": 1, "vni": 101, "ports": ["set", ["mz.101"]]}, "op": "insert"}, {"table": "NLAN", "where": [], "mutations": [["subnets", "insert", ["set", [["named-uuid", "temp_599860"]]]]], "op": "mutate"}], "method": "transact", "id": 216873}
... JSON-RPC response ...
{"id":216873,"result":[{"uuid":["uuid","d11f17e3-1457-4a24-b7fd-34710af48ca2"]},{"count":1}],"error":null}
[DEBUG] module:ovsdb,function:_send,router: rpi1
... JSON-RPC request ...
{"params": ["Open_vSwitch", {"table": "NLAN_Subnet", "where": [["vni", "==", 101]], "op": "select"}], "method": "transact", "id": 369322}
... JSON-RPC response ...
{"id":369322,"result":[{"rows":[{"peers":["set",["192.168.1.102","192.168.1.103"]],"_version":["uuid","20ec45e1-9342-4e63-a6a1-00c6cc9325e2"],"vni":101,"ports":"mz.101","mode":["set",[]],"vid":1,"_uuid":["uuid","d11f17e3-1457-4a24-b7fd-34710af48ca2"],"default_gw":["set",[]],"ip_vhost":["set",[]],"ip_dvr":["set",[]]}]}],"error":null}


=+=+= NLAN Reply from router:openwrt1,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
[INFO] module:nlan_agent,function:<module>,router: openwrt1
NLAN Agent initialization completed
{'mod_dir': ['command', 'config'], 'etc_dir': '/opt/nlan/etc', 'state_order': ['bridges', 'services', 'gateway', 'vxlan', 'subnets'], 'types': {'services': {'name': {'max': 1, 'key': {'type': 'string'}, 'min': 1}, 'chain': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}}, 'bridges': {'controller': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'ovs_bridges': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}, 'gateway': {'network': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'rip': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}, 'vxlan': {'remote_ips': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}, 'local_ip': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}, 'subnets': {'ip_dvr': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'peers': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}, 'vni': {'max': 1, 'key': {'minInteger': 0, 'maxInteger': 16777215, 'type': 'integer'}, 'min': 1}, 'vid': {'max': 1, 'key': {'minInteger': 0, 'maxInteger': 4095, 'type': 'integer'}, 'min': 0}, 'ip_vhost': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'ports': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}, 'default_gw': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'mode': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}}, 'tables': {'services': {'max': 'unlimited', 'key': {'type': 'uuid', 'refTable': 'NLAN_Service'}, 'min': 0}, 'bridges': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_Bridges'}, 'min': 0}, 'gateway': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_Gateway'}, 'min': 0}, 'vxlan': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_VXLAN'}, 'min': 0}, 'subnets': {'max': 'unlimited', 'key': {'type': 'uuid', 'refTable': 'NLAN_Subnet'}, 'min': 0}}, 'agent_dir': '/opt/nlan', 'indexes': {'services': 'name', 'subnets': 'vni'}, 'platform': 'openwrt', 'init': False, 'router': 'openwrt1', 'logger': <logging.Logger object at 0xb759876c>, 'schema': 'ovsdb_nlan.schema'}
[INFO] module:nlan_agent,function:_route,router: openwrt1
function:bridges.add, model:{'ovs_bridges': 'enabled'}
[INFO] module:bridges,function:add,router: openwrt1
Adding bridges: br-int and br-tun
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ovs-vsctl add-br br-int
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ovs-vsctl add-br br-tun
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ovs-ofctl del-flows br-tun
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ovs-vsctl add-port br-int patch-int -- set interface patch-int type=patch options:peer=patch-tun
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ovs-vsctl add-port br-tun patch-tun -- set interface patch-tun type=patch options:peer=patch-int
[DEBUG] module:ovsdb,function:_send,router: openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"Interface","where":[["name","==","patch-tun"]],"op":"select"}],"method":"transact","id":932783}
... JSON-RPC response ...
{"id":932783,"result":[{"rows":[{"options":["map",[["peer","patch-int"]]],"mtu":["set",[]],"link_speed":["set",[]],"statistics":["map",[["collisions",0],["rx_bytes",0],["rx_crc_err",0],["rx_dropped",0],["rx_errors",0],["rx_frame_err",0],["rx_over_err",0],["rx_packets",0],["tx_bytes",0],["tx_dropped",0],["tx_errors",0],["tx_packets",0]]],"mac_in_use":"1a:57:12:0a:03:fb","ingress_policing_rate":0,"ofport":1,"mac":["set",[]],"cfm_fault_status":["set",[]],"duplex":["set",[]],"lacp_current":["set",[]],"cfm_fault":["set",[]],"link_state":"up","external_ids":["map",[]],"bfd_status":["map",[]],"link_resets":0,"name":"patch-tun","type":"patch","cfm_remote_opstate":["set",[]],"_uuid":["uuid","278bf1d3-0ac6-4fc5-a0ba-7e3c1dac1083"],"status":["map",[]],"ifindex":0,"_version":["uuid","a1ccd632-a288-4f6e-a09b-5dc3ee359e8a"],"other_config":["map",[]],"admin_state":"up","cfm_remote_mpids":["set",[]],"cfm_mpid":["set",[]],"bfd":["map",[]],"ofport_request":["set",[]],"ingress_policing_burst":0,"cfm_flap_count":["set",[]],"cfm_health":["set",[]]}]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ovs-ofctl del-flows br-tun
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ovs-ofctl add-flow br-tun table=0,priority=1,in_port=1,actions=resubmit(,1)
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ovs-ofctl add-flow br-tun table=0,priority=0,actions=drop
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ovs-ofctl add-flow br-tun table=1,priority=0,dl_dst=01:00:00:00:00:00/01:00:00:00:00:00,actions=resubmit(,19)
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ovs-ofctl add-flow br-tun table=1,priority=0,dl_dst=00:00:00:00:00:00/01:00:00:00:00:00,actions=resubmit(,20)
[DEBUG] module:ovsdb,function:_send,router: openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"Interface","where":[["name","==","patch-tun"]],"op":"select"}],"method":"transact","id":707575}
... JSON-RPC response ...
{"id":707575,"result":[{"rows":[{"options":["map",[["peer","patch-int"]]],"mtu":["set",[]],"link_speed":["set",[]],"statistics":["map",[["collisions",0],["rx_bytes",0],["rx_crc_err",0],["rx_dropped",0],["rx_errors",0],["rx_frame_err",0],["rx_over_err",0],["rx_packets",0],["tx_bytes",0],["tx_dropped",0],["tx_errors",0],["tx_packets",0]]],"mac_in_use":"1a:57:12:0a:03:fb","ingress_policing_rate":0,"ofport":1,"mac":["set",[]],"cfm_fault_status":["set",[]],"duplex":["set",[]],"lacp_current":["set",[]],"cfm_fault":["set",[]],"link_state":"up","external_ids":["map",[]],"bfd_status":["map",[]],"link_resets":0,"name":"patch-tun","type":"patch","cfm_remote_opstate":["set",[]],"_uuid":["uuid","278bf1d3-0ac6-4fc5-a0ba-7e3c1dac1083"],"status":["map",[]],"ifindex":0,"_version":["uuid","a1ccd632-a288-4f6e-a09b-5dc3ee359e8a"],"other_config":["map",[]],"admin_state":"up","cfm_remote_mpids":["set",[]],"cfm_mpid":["set",[]],"bfd":["map",[]],"ofport_request":["set",[]],"ingress_policing_burst":0,"cfm_flap_count":["set",[]],"cfm_health":["set",[]]}]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ovs-ofctl add-flow br-tun table=2,priority=0,actions=drop
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ovs-ofctl add-flow br-tun table=3,priority=0,actions=drop
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ovs-ofctl add-flow br-tun table=10,priority=1,actions=learn(table=20,hard_timeout=300,priority=1,NXM_OF_VLAN_TCI[0..11],NXM_OF_ETH_DST[]=NXM_OF_ETH_SRC[],load:0->NXM_OF_VLAN_TCI[],load:NXM_NX_TUN_ID[]->NXM_NX_TUN_ID[],output:NXM_OF_IN_PORT[]),output:1
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ovs-ofctl add-flow br-tun table=19,priority=0,actions=resubmit(,21)
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ovs-ofctl add-flow br-tun table=20,priority=0,actions=resubmit(,21)
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ovs-ofctl add-flow br-tun table=21,priority=0,actions=drop
[DEBUG] module:ovsdb,function:_send,router: openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN","row":{},"op":"insert"}],"method":"transact","id":962935}
... JSON-RPC response ...
{"id":962935,"result":[{"uuid":["uuid","c34d377e-b97f-48ab-bef9-8ff46ba8719b"]}],"error":null}
[DEBUG] module:ovsdb,function:_send,router: openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Bridges","where":[],"op":"select"}],"method":"transact","id":67545}
... JSON-RPC response ...
{"id":67545,"result":[{"rows":[]}],"error":null}
[DEBUG] module:ovsdb,function:_send,router: openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Bridges","uuid-name":"temp_357618","row":{"ovs_bridges":"enabled"},"op":"insert"},{"table":"NLAN","where":[],"mutations":[["bridges","insert",["set",[["named-uuid","temp_357618"]]]]],"op":"mutate"}],"method":"transact","id":445167}
... JSON-RPC response ...
{"id":445167,"result":[{"uuid":["uuid","a93fc4d8-2984-4971-b9ae-f3b701c96a62"]},{"count":1}],"error":null}
[DEBUG] module:ovsdb,function:_send,router: openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Bridges","where":[],"op":"select"}],"method":"transact","id":590835}
... JSON-RPC response ...
{"id":590835,"result":[{"rows":[{"_uuid":["uuid","a93fc4d8-2984-4971-b9ae-f3b701c96a62"],"_version":["uuid","6b116781-65e1-4b03-b690-6800d2f59eec"],"ovs_bridges":"enabled","controller":["set",[]]}]}],"error":null}
[INFO] module:nlan_agent,function:_route,router: openwrt1
function:gateway.add, model:{'network': 'eth0.2', 'rip': 'enabled'}
[INFO] module:gateway,function:add,router: openwrt1
Adding a gateway router: rip
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: vtysh -c configure terminal -c interface eth0.2 -c link-detect -c exit -c router rip -c version 2 -c redistribute connected -c network eth0.2 -c exit -c exit -c write -c exit
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: /etc/init.d/quagga start
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: vtysh -c configure terminal -c interface eth0.2 -c link-detect -c exit -c router rip -c version 2 -c redistribute connected -c network eth0.2 -c exit -c exit -c write -c exit
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: /etc/init.d/quagga restart
[DEBUG] module:ovsdb,function:_send,router: openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN","row":{},"op":"insert"}],"method":"transact","id":287795}
... JSON-RPC response ...
{"id":287795,"result":[{"uuid":["uuid","205dede3-1870-44ec-9250-9153172f7511"]},{"error":"constraint violation","details":"transaction causes \"NLAN\" table to contain 2 rows, greater than the schema-defined limit of 1 row(s)"}],"error":null}
[DEBUG] module:ovsdb,function:_send,router: openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Gateway","where":[],"op":"select"}],"method":"transact","id":863211}
... JSON-RPC response ...
{"id":863211,"result":[{"rows":[]}],"error":null}
[DEBUG] module:ovsdb,function:_send,router: openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Gateway","uuid-name":"temp_88074","row":{"network":"eth0.2","rip":"enabled"},"op":"insert"},{"table":"NLAN","where":[],"mutations":[["gateway","insert",["set",[["named-uuid","temp_88074"]]]]],"op":"mutate"}],"method":"transact","id":191884}
... JSON-RPC response ...
{"id":191884,"result":[{"uuid":["uuid","0b7c575e-e6cb-4d73-b492-2fc53b9f912c"]},{"count":1}],"error":null}
[DEBUG] module:ovsdb,function:_send,router: openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Gateway","where":[],"op":"select"}],"method":"transact","id":574323}
... JSON-RPC response ...
{"id":574323,"result":[{"rows":[{"_version":["uuid","270b823c-d9ad-4a51-8e7e-98fe68f31d20"],"network":"eth0.2","_uuid":["uuid","0b7c575e-e6cb-4d73-b492-2fc53b9f912c"],"rip":"enabled"}]}],"error":null}
[INFO] module:nlan_agent,function:_route,router: openwrt1
function:vxlan.add, model:{'remote_ips': ['192.168.1.103', '192.168.1.102', '192.168.1.104'], 'local_ip': '192.168.1.101'}
[INFO] module:vxlan,function:add,router: openwrt1
Adding a VXLAN tunnel: vxlan_103
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ovs-vsctl add-port br-tun vxlan_103 -- set interface vxlan_103 type=vxlan options:in_key=flow options:local_ip=192.168.1.101 options:out_key=flow options:remote_ip=192.168.1.103
[INFO] module:vxlan,function:add,router: openwrt1
Adding a VXLAN tunnel: vxlan_102
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ovs-vsctl add-port br-tun vxlan_102 -- set interface vxlan_102 type=vxlan options:in_key=flow options:local_ip=192.168.1.101 options:out_key=flow options:remote_ip=192.168.1.102
[INFO] module:vxlan,function:add,router: openwrt1
Adding a VXLAN tunnel: vxlan_104
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ovs-vsctl add-port br-tun vxlan_104 -- set interface vxlan_104 type=vxlan options:in_key=flow options:local_ip=192.168.1.101 options:out_key=flow options:remote_ip=192.168.1.104
[DEBUG] module:ovsdb,function:_send,router: openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"Interface","where":[["type","==","vxlan"]],"columns":["ofport","options"],"op":"select"}],"method":"transact","id":31212}
... JSON-RPC response ...
{"id":31212,"result":[{"rows":[{"options":["map",[["in_key","flow"],["local_ip","192.168.1.101"],["out_key","flow"],["remote_ip","192.168.1.102"]]],"ofport":3},{"options":["map",[["in_key","flow"],["local_ip","192.168.1.101"],["out_key","flow"],["remote_ip","192.168.1.103"]]],"ofport":2},{"options":["map",[["in_key","flow"],["local_ip","192.168.1.101"],["out_key","flow"],["remote_ip","192.168.1.104"]]],"ofport":4}]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ovs-ofctl add-flow br-tun table=0,priority=1,in_port=3,actions=resubmit(,2)
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ovs-ofctl add-flow br-tun table=0,priority=1,in_port=2,actions=resubmit(,2)
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ovs-ofctl add-flow br-tun table=0,priority=1,in_port=4,actions=resubmit(,2)
[DEBUG] module:ovsdb,function:_send,router: openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN","row":{},"op":"insert"}],"method":"transact","id":699406}
... JSON-RPC response ...
{"id":699406,"result":[{"uuid":["uuid","73139924-3971-4be4-82ca-4916cd50faa9"]},{"error":"constraint violation","details":"transaction causes \"NLAN\" table to contain 2 rows, greater than the schema-defined limit of 1 row(s)"}],"error":null}
[DEBUG] module:ovsdb,function:_send,router: openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_VXLAN","where":[],"op":"select"}],"method":"transact","id":848664}
... JSON-RPC response ...
{"id":848664,"result":[{"rows":[]}],"error":null}
[DEBUG] module:ovsdb,function:_send,router: openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_VXLAN","uuid-name":"temp_354702","row":{"remote_ips":["set",["192.168.1.103","192.168.1.102","192.168.1.104"]],"local_ip":"192.168.1.101"},"op":"insert"},{"table":"NLAN","where":[],"mutations":[["vxlan","insert",["set",[["named-uuid","temp_354702"]]]]],"op":"mutate"}],"method":"transact","id":935469}
... JSON-RPC response ...
{"id":935469,"result":[{"uuid":["uuid","895c1751-2805-4620-9baa-8a29de5b82b4"]},{"count":1}],"error":null}
[DEBUG] module:ovsdb,function:_send,router: openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_VXLAN","where":[],"op":"select"}],"method":"transact","id":67740}
... JSON-RPC response ...
{"id":67740,"result":[{"rows":[{"_version":["uuid","ac3c5ea9-52d5-427a-8b57-199df4388280"],"_uuid":["uuid","895c1751-2805-4620-9baa-8a29de5b82b4"],"local_ip":"192.168.1.101","remote_ips":["set",["192.168.1.102","192.168.1.103","192.168.1.104"]]}]}],"error":null}
[INFO] module:nlan_agent,function:_route,router: openwrt1
function:subnets.add, model:{('vni', 1): {'ip_dvr': '192.168.100.1/24', 'ip_vhost': '192.168.100.101/24', 'peers': ['192.168.1.102', '192.168.1.103'], 'vid': 2, 'vni': 1}, ('vni', 103): {'peers': ['192.168.1.102', '192.168.1.103'], 'vid': 3, 'ip_vhost': '10.0.3.101/24', 'vni': 103, 'ip_dvr': '10.0.3.1/24', 'ports': ['eth0.3']}, ('vni', 1001): {'peers': ['192.168.1.104'], 'vid': 1, 'ip_vhost': '10.0.1.101/24', 'vni': 1001, 'ip_dvr': '10.0.1.1/24', 'mode': 'hub', 'ports': ['eth0.1']}}
[INFO] module:subnets,function:_crud,router: openwrt1
Adding a subnet(vlan): 2
[DEBUG] module:ovsdb,function:_send,router: openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN","row":{},"op":"insert"}],"method":"transact","id":152308}
... JSON-RPC response ...
{"id":152308,"result":[{"uuid":["uuid","975ab1af-b582-4c68-bcf5-a369723e033b"]},{"error":"constraint violation","details":"transaction causes \"NLAN\" table to contain 2 rows, greater than the schema-defined limit of 1 row(s)"}],"error":null}
[DEBUG] module:ovsdb,function:_send,router: openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","where":[["vni","==",1]],"op":"select"}],"method":"transact","id":770653}
... JSON-RPC response ...
{"id":770653,"result":[{"rows":[]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ip netns add ns2
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: brctl addbr br2
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ip link add veth-ns2 type veth peer name temp-ns2
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ip link set dev temp-ns2 netns ns2
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ip netns exec ns2 ip link set dev temp-ns2 name eth0
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ovs-vsctl add-port br-int int-br2 tag=2 -- set interface int-br2 type=internal
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ovs-vsctl add-port br-int int-dvr2 tag=2 -- set interface int-dvr2 type=internal
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: brctl addif br2 veth-ns2
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: brctl addif br2 int-br2
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ip link set dev veth-ns2 promisc on
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ip link set dev veth-ns2 up
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ip netns exec ns2 ip link set dev eth0 up
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ip link set dev int-br2 promisc on
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ip link set dev int-br2 up
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ip link set dev int-dvr2 up
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ip link set dev br2 up
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ip netns exec ns2 ip addr add dev eth0 192.168.100.101/24
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ip addr add dev int-dvr2 192.168.100.1/24
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ip netns exec ns2 ip route add default via 192.168.100.1 dev eth0
[DEBUG] module:ovsdb,function:_send,router: openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"Controller","where":[],"columns":["target"],"op":"select"}],"method":"transact","id":667954}
... JSON-RPC response ...
{"id":667954,"result":[{"rows":[]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ovs-ofctl add-flow br-tun table=2,priority=1,tun_id=1,actions=mod_vlan_vid:2,resubmit(,10)
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ovs-ofctl add-flow br-tun table=19,priority=1,dl_type=0x0806,dl_vlan=2,nw_dst=192.168.100.1,actions=drop
[DEBUG] module:ovsdb,function:_send,router: openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"Interface","where":[["type","==","vxlan"]],"columns":["ofport","options"],"op":"select"}],"method":"transact","id":950422}
... JSON-RPC response ...
{"id":950422,"result":[{"rows":[{"options":["map",[["in_key","flow"],["local_ip","192.168.1.101"],["out_key","flow"],["remote_ip","192.168.1.102"]]],"ofport":3},{"options":["map",[["in_key","flow"],["local_ip","192.168.1.101"],["out_key","flow"],["remote_ip","192.168.1.103"]]],"ofport":2},{"options":["map",[["in_key","flow"],["local_ip","192.168.1.101"],["out_key","flow"],["remote_ip","192.168.1.104"]]],"ofport":4}]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ovs-ofctl add-flow br-tun table=21,priority=1,dl_vlan=2,actions=strip_vlan,set_tunnel:1,output:3,output:2
[INFO] module:subnets,function:_crud,router: openwrt1
Adding a subnet(vlan): 3
[DEBUG] module:ovsdb,function:_send,router: openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN","row":{},"op":"insert"}],"method":"transact","id":138313}
... JSON-RPC response ...
{"id":138313,"result":[{"uuid":["uuid","45c71dd5-d7f9-403a-b27c-9b8b900f22f4"]},{"error":"constraint violation","details":"transaction causes \"NLAN\" table to contain 2 rows, greater than the schema-defined limit of 1 row(s)"}],"error":null}
[DEBUG] module:ovsdb,function:_send,router: openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","where":[["vni","==",103]],"op":"select"}],"method":"transact","id":407909}
... JSON-RPC response ...
{"id":407909,"result":[{"rows":[]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ip netns add ns3
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: brctl addbr br3
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ip link add veth-ns3 type veth peer name temp-ns3
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ip link set dev temp-ns3 netns ns3
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ip netns exec ns3 ip link set dev temp-ns3 name eth0
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ovs-vsctl add-port br-int int-br3 tag=3 -- set interface int-br3 type=internal
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ovs-vsctl add-port br-int int-dvr3 tag=3 -- set interface int-dvr3 type=internal
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: brctl addif br3 veth-ns3
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: brctl addif br3 int-br3
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ip link set dev veth-ns3 promisc on
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ip link set dev veth-ns3 up
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ip netns exec ns3 ip link set dev eth0 up
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ip link set dev int-br3 promisc on
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ip link set dev int-br3 up
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ip link set dev int-dvr3 up
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ip link set dev br3 up
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ip netns exec ns3 ip addr add dev eth0 10.0.3.101/24
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ip addr add dev int-dvr3 10.0.3.1/24
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ip netns exec ns3 ip route add default via 10.0.3.1 dev eth0
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: brctl addif br3 eth0.3
[DEBUG] module:ovsdb,function:_send,router: openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"Controller","where":[],"columns":["target"],"op":"select"}],"method":"transact","id":259797}
... JSON-RPC response ...
{"id":259797,"result":[{"rows":[]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ovs-ofctl add-flow br-tun table=2,priority=1,tun_id=103,actions=mod_vlan_vid:3,resubmit(,10)
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ovs-ofctl add-flow br-tun table=19,priority=1,dl_type=0x0806,dl_vlan=3,nw_dst=10.0.3.1,actions=drop
[DEBUG] module:ovsdb,function:_send,router: openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"Interface","where":[["type","==","vxlan"]],"columns":["ofport","options"],"op":"select"}],"method":"transact","id":467654}
... JSON-RPC response ...
{"id":467654,"result":[{"rows":[{"options":["map",[["in_key","flow"],["local_ip","192.168.1.101"],["out_key","flow"],["remote_ip","192.168.1.102"]]],"ofport":3},{"options":["map",[["in_key","flow"],["local_ip","192.168.1.101"],["out_key","flow"],["remote_ip","192.168.1.103"]]],"ofport":2},{"options":["map",[["in_key","flow"],["local_ip","192.168.1.101"],["out_key","flow"],["remote_ip","192.168.1.104"]]],"ofport":4}]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ovs-ofctl add-flow br-tun table=21,priority=1,dl_vlan=3,actions=strip_vlan,set_tunnel:103,output:3,output:2
[INFO] module:subnets,function:_crud,router: openwrt1
Adding a subnet(vlan): 1
[DEBUG] module:ovsdb,function:_send,router: openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN","row":{},"op":"insert"}],"method":"transact","id":360547}
... JSON-RPC response ...
{"id":360547,"result":[{"uuid":["uuid","10a603f8-1a63-4ac0-901c-c9dcabbd5cea"]},{"error":"constraint violation","details":"transaction causes \"NLAN\" table to contain 2 rows, greater than the schema-defined limit of 1 row(s)"}],"error":null}
[DEBUG] module:ovsdb,function:_send,router: openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","where":[["vni","==",1001]],"op":"select"}],"method":"transact","id":101865}
... JSON-RPC response ...
{"id":101865,"result":[{"rows":[]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ip netns add ns1
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: brctl addbr br1
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ip link add veth-ns1 type veth peer name temp-ns1
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ip link set dev temp-ns1 netns ns1
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ip netns exec ns1 ip link set dev temp-ns1 name eth0
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ovs-vsctl add-port br-int int-br1 tag=1 -- set interface int-br1 type=internal
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ovs-vsctl add-port br-int int-dvr1 tag=1 -- set interface int-dvr1 type=internal
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: brctl addif br1 veth-ns1
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: brctl addif br1 int-br1
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ip link set dev veth-ns1 promisc on
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ip link set dev veth-ns1 up
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ip netns exec ns1 ip link set dev eth0 up
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ip link set dev int-br1 promisc on
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ip link set dev int-br1 up
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ip link set dev int-dvr1 up
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ip link set dev br1 up
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ip netns exec ns1 ip addr add dev eth0 10.0.1.101/24
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ip addr add dev int-dvr1 10.0.1.1/24
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ip netns exec ns1 ip route add default via 10.0.1.1 dev eth0
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: brctl addif br1 eth0.1
[DEBUG] module:ovsdb,function:_send,router: openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"Controller","where":[],"columns":["target"],"op":"select"}],"method":"transact","id":180483}
... JSON-RPC response ...
{"id":180483,"result":[{"rows":[]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ovs-ofctl add-flow br-tun table=2,priority=1,tun_id=1001,actions=mod_vlan_vid:1,resubmit(,10)
[DEBUG] module:ovsdb,function:_send,router: openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"Interface","where":[["type","==","vxlan"]],"columns":["ofport","options"],"op":"select"}],"method":"transact","id":82771}
... JSON-RPC response ...
{"id":82771,"result":[{"rows":[{"options":["map",[["in_key","flow"],["local_ip","192.168.1.101"],["out_key","flow"],["remote_ip","192.168.1.102"]]],"ofport":3},{"options":["map",[["in_key","flow"],["local_ip","192.168.1.101"],["out_key","flow"],["remote_ip","192.168.1.103"]]],"ofport":2},{"options":["map",[["in_key","flow"],["local_ip","192.168.1.101"],["out_key","flow"],["remote_ip","192.168.1.104"]]],"ofport":4}]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router: openwrt1
cmd: ovs-ofctl add-flow br-tun table=21,priority=1,dl_vlan=1,actions=strip_vlan,set_tunnel:1001,output:4
[DEBUG] module:ovsdb,function:_send,router: openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN","row":{},"op":"insert"}],"method":"transact","id":1524}
... JSON-RPC response ...
{"id":1524,"result":[{"uuid":["uuid","f6da9b3e-dc58-4458-8dcf-2796391d6a3c"]},{"error":"constraint violation","details":"transaction causes \"NLAN\" table to contain 2 rows, greater than the schema-defined limit of 1 row(s)"}],"error":null}
[DEBUG] module:ovsdb,function:_send,router: openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","where":[["vni","==",1]],"op":"select"}],"method":"transact","id":730887}
... JSON-RPC response ...
{"id":730887,"result":[{"rows":[]}],"error":null}
[DEBUG] module:ovsdb,function:crud,router: openwrt1
CRUD operation (add): {'ip_dvr': '192.168.100.1/24', 'ip_vhost': '192.168.100.101/24', 'peers': ['192.168.1.102', '192.168.1.103'], 'vid': 2, 'vni': 1}
[DEBUG] module:ovsdb,function:_send,router: openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","uuid-name":"temp_968855","row":{"ip_dvr":"192.168.100.1/24","ip_vhost":"192.168.100.101/24","peers":["set",["192.168.1.102","192.168.1.103"]],"vid":2,"vni":1},"op":"insert"},{"table":"NLAN","where":[],"mutations":[["subnets","insert",["set",[["named-uuid","temp_968855"]]]]],"op":"mutate"}],"method":"transact","id":947321}
... JSON-RPC response ...
{"id":947321,"result":[{"uuid":["uuid","75558f79-cd81-42e0-850d-e1d5419dd91c"]},{"count":1}],"error":null}
[DEBUG] module:ovsdb,function:_send,router: openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","where":[["vni","==",1]],"op":"select"}],"method":"transact","id":805984}
... JSON-RPC response ...
{"id":805984,"result":[{"rows":[{"peers":["set",["192.168.1.102","192.168.1.103"]],"_version":["uuid","1c1324de-80a8-4d38-abb6-92aae4f21ec3"],"vni":1,"ports":["set",[]],"mode":["set",[]],"vid":2,"_uuid":["uuid","75558f79-cd81-42e0-850d-e1d5419dd91c"],"default_gw":["set",[]],"ip_vhost":"192.168.100.101/24","ip_dvr":"192.168.100.1/24"}]}],"error":null}
[DEBUG] module:ovsdb,function:_send,router: openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN","row":{},"op":"insert"}],"method":"transact","id":486028}
... JSON-RPC response ...
{"id":486028,"result":[{"uuid":["uuid","9fbe38c4-557b-4a81-8cfa-70bb947e6108"]},{"error":"constraint violation","details":"transaction causes \"NLAN\" table to contain 2 rows, greater than the schema-defined limit of 1 row(s)"}],"error":null}
[DEBUG] module:ovsdb,function:_send,router: openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","where":[["vni","==",103]],"op":"select"}],"method":"transact","id":13303}
... JSON-RPC response ...
{"id":13303,"result":[{"rows":[]}],"error":null}
[DEBUG] module:ovsdb,function:crud,router: openwrt1
CRUD operation (add): {'peers': ['192.168.1.102', '192.168.1.103'], 'vid': 3, 'ip_vhost': '10.0.3.101/24', 'vni': 103, 'ip_dvr': '10.0.3.1/24', 'ports': ['eth0.3']}
[DEBUG] module:ovsdb,function:_send,router: openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","uuid-name":"temp_642307","row":{"peers":["set",["192.168.1.102","192.168.1.103"]],"vid":3,"ip_vhost":"10.0.3.101/24","vni":103,"ip_dvr":"10.0.3.1/24","ports":["set",["eth0.3"]]},"op":"insert"},{"table":"NLAN","where":[],"mutations":[["subnets","insert",["set",[["named-uuid","temp_642307"]]]]],"op":"mutate"}],"method":"transact","id":344572}
... JSON-RPC response ...
{"id":344572,"result":[{"uuid":["uuid","d0b0c61a-147e-4488-972a-e3668ac4230d"]},{"count":1}],"error":null}
[DEBUG] module:ovsdb,function:_send,router: openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","where":[["vni","==",103]],"op":"select"}],"method":"transact","id":834152}
... JSON-RPC response ...
{"id":834152,"result":[{"rows":[{"peers":["set",["192.168.1.102","192.168.1.103"]],"_version":["uuid","c5f981e5-e0de-4129-b532-552e3035d676"],"vni":103,"ports":"eth0.3","mode":["set",[]],"vid":3,"_uuid":["uuid","d0b0c61a-147e-4488-972a-e3668ac4230d"],"default_gw":["set",[]],"ip_vhost":"10.0.3.101/24","ip_dvr":"10.0.3.1/24"}]}],"error":null}
[DEBUG] module:ovsdb,function:_send,router: openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN","row":{},"op":"insert"}],"method":"transact","id":47402}
... JSON-RPC response ...
{"id":47402,"result":[{"uuid":["uuid","1a272fe0-a080-4925-92ac-201168b32bab"]},{"error":"constraint violation","details":"transaction causes \"NLAN\" table to contain 2 rows, greater than the schema-defined limit of 1 row(s)"}],"error":null}
[DEBUG] module:ovsdb,function:_send,router: openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","where":[["vni","==",1001]],"op":"select"}],"method":"transact","id":209707}
... JSON-RPC response ...
{"id":209707,"result":[{"rows":[]}],"error":null}
[DEBUG] module:ovsdb,function:crud,router: openwrt1
CRUD operation (add): {'peers': ['192.168.1.104'], 'vid': 1, 'ip_vhost': '10.0.1.101/24', 'vni': 1001, 'ip_dvr': '10.0.1.1/24', 'mode': 'hub', 'ports': ['eth0.1']}
[DEBUG] module:ovsdb,function:_send,router: openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","uuid-name":"temp_504002","row":{"peers":["set",["192.168.1.104"]],"vid":1,"ip_vhost":"10.0.1.101/24","vni":1001,"ip_dvr":"10.0.1.1/24","mode":"hub","ports":["set",["eth0.1"]]},"op":"insert"},{"table":"NLAN","where":[],"mutations":[["subnets","insert",["set",[["named-uuid","temp_504002"]]]]],"op":"mutate"}],"method":"transact","id":549840}
... JSON-RPC response ...
{"id":549840,"result":[{"uuid":["uuid","04520957-a9ed-41c9-b839-fd89caa052b0"]},{"count":1}],"error":null}
[DEBUG] module:ovsdb,function:_send,router: openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","where":[["vni","==",1001]],"op":"select"}],"method":"transact","id":566351}
... JSON-RPC response ...
{"id":566351,"result":[{"rows":[{"peers":"192.168.1.104","_version":["uuid","d42615e3-9db2-426b-be3a-e7a74f99613f"],"vni":1001,"ports":"eth0.1","mode":"hub","vid":1,"_uuid":["uuid","04520957-a9ed-41c9-b839-fd89caa052b0"],"default_gw":["set",[]],"ip_vhost":"10.0.1.101/24","ip_dvr":"10.0.1.1/24"}]}],"error":null}


...
brctl: iface eth0.3: No such device
brctl: iface eth0.1: No such device


=+=+= NLAN Request to router:openwrt1,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ip netns add ns-global
=+=+= NLAN Request to router:openwrt1,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ip link add veth-global type veth peer name temp
=+=+= NLAN Request to router:openwrt1,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ip link set dev temp netns ns-global
=+=+= NLAN Request to router:openwrt1,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ip netns exec ns-global ip link set dev temp name eth0
=+=+= NLAN Request to router:openwrt1,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ip netns exec ns-global ip addr add dev eth0 8.8.8.8/24
=+=+= NLAN Request to router:openwrt1,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ip link set dev veth-global up
=+=+= NLAN Request to router:openwrt1,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ip addr add dev veth-global 8.8.8.1/24
=+=+= NLAN Request to router:openwrt1,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ip netns exec ns-global ip link set dev eth0 up
=+=+= NLAN Request to router:openwrt1,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ip netns exec ns-global ip route add default via  8.8.8.1
=+=+= NLAN Request to router:openwrt1,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: echo a b c
=+=+= NLAN Reply from router:openwrt1,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
a b c


=+=+= NLAN Request to router:openwrt1,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ip netns exec ns1 ping -c 2 10.0.1.102
=+=+= NLAN Reply from router:openwrt1,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
PING 10.0.1.102 (10.0.1.102): 56 data bytes
64 bytes from 10.0.1.102: seq=0 ttl=64 time=12.278 ms
64 bytes from 10.0.1.102: seq=1 ttl=64 time=7.208 ms

--- 10.0.1.102 ping statistics ---
2 packets transmitted, 2 packets received, 0% packet loss
round-trip min/avg/max = 7.208/9.743/12.278 ms


=+=+= NLAN Request to router:openwrt1,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ip netns exec ns1 ping -c 2 10.0.1.102
=+=+= NLAN Reply from router:openwrt1,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
PING 10.0.1.102 (10.0.1.102): 56 data bytes
64 bytes from 10.0.1.102: seq=0 ttl=64 time=2.430 ms
64 bytes from 10.0.1.102: seq=1 ttl=64 time=2.560 ms

--- 10.0.1.102 ping statistics ---
2 packets transmitted, 2 packets received, 0% packet loss
round-trip min/avg/max = 2.430/2.495/2.560 ms


=+=+= NLAN Request to router:openwrt1,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ip netns exec ns3 ping -c 2 10.0.3.103
=+=+= NLAN Reply from router:openwrt1,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
PING 10.0.3.103 (10.0.3.103): 56 data bytes
64 bytes from 10.0.3.103: seq=0 ttl=64 time=5.753 ms
64 bytes from 10.0.3.103: seq=1 ttl=64 time=1.208 ms

--- 10.0.3.103 ping statistics ---
2 packets transmitted, 2 packets received, 0% packet loss
round-trip min/avg/max = 1.208/3.480/5.753 ms


=+=+= NLAN Request to router:openwrt3,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ip netns exec ns3 ping -c 2 10.0.1.101
=+=+= NLAN Reply from router:openwrt3,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
PING 10.0.1.101 (10.0.1.101): 56 data bytes
64 bytes from 10.0.1.101: seq=0 ttl=63 time=13.704 ms
64 bytes from 10.0.1.101: seq=1 ttl=63 time=3.699 ms

--- 10.0.1.101 ping statistics ---
2 packets transmitted, 2 packets received, 0% packet loss
round-trip min/avg/max = 3.699/8.701/13.704 ms


=+=+= NLAN Request to router:openwrt2,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ip netns exec ns1 ping -c 2 192.168.100.1
=+=+= NLAN Reply from router:openwrt2,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
PING 192.168.100.1 (192.168.100.1): 56 data bytes
64 bytes from 192.168.100.1: seq=0 ttl=64 time=13.957 ms
64 bytes from 192.168.100.1: seq=1 ttl=64 time=2.129 ms

--- 192.168.100.1 ping statistics ---
2 packets transmitted, 2 packets received, 0% packet loss
round-trip min/avg/max = 2.129/8.043/13.957 ms


=+=+= NLAN Request to router:openwrt3,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ip netns exec ns1 ping -c 2 192.168.100.1
=+=+= NLAN Reply from router:openwrt3,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
PING 192.168.100.1 (192.168.100.1): 56 data bytes
64 bytes from 192.168.100.1: seq=0 ttl=64 time=11.824 ms
64 bytes from 192.168.100.1: seq=1 ttl=64 time=1.322 ms

--- 192.168.100.1 ping statistics ---
2 packets transmitted, 2 packets received, 0% packet loss
round-trip min/avg/max = 1.322/6.573/11.824 ms


=+=+= NLAN Request to router:openwrt2,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ip netns exec ns3 ping -c 2 192.168.100.1
=+=+= NLAN Reply from router:openwrt2,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
PING 192.168.100.1 (192.168.100.1): 56 data bytes
64 bytes from 192.168.100.1: seq=0 ttl=64 time=5.628 ms
64 bytes from 192.168.100.1: seq=1 ttl=64 time=1.280 ms

--- 192.168.100.1 ping statistics ---
2 packets transmitted, 2 packets received, 0% packet loss
round-trip min/avg/max = 1.280/3.454/5.628 ms


=+=+= NLAN Request to router:openwrt2,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ping -c 2 192.168.100.1
=+=+= NLAN Reply from router:openwrt2,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
PING 192.168.100.1 (192.168.100.1): 56 data bytes
64 bytes from 192.168.100.1: seq=0 ttl=64 time=2.055 ms
64 bytes from 192.168.100.1: seq=1 ttl=64 time=1.027 ms

--- 192.168.100.1 ping statistics ---
2 packets transmitted, 2 packets received, 0% packet loss
round-trip min/avg/max = 1.027/1.541/2.055 ms


=+=+= NLAN Request to router:openwrt3,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ip netns exec ns3 ping -c 2 10.0.1.102
=+=+= NLAN Reply from router:openwrt3,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
PING 10.0.1.102 (10.0.1.102): 56 data bytes
64 bytes from 10.0.1.102: seq=0 ttl=63 time=8.055 ms
64 bytes from 10.0.1.102: seq=1 ttl=63 time=3.211 ms

--- 10.0.1.102 ping statistics ---
2 packets transmitted, 2 packets received, 0% packet loss
round-trip min/avg/max = 3.211/5.633/8.055 ms


=+=+= NLAN Request to router:openwrt3,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ip netns exec ns3 ping -c 2 10.0.1.1
=+=+= NLAN Reply from router:openwrt3,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
PING 10.0.1.1 (10.0.1.1): 56 data bytes
64 bytes from 10.0.1.1: seq=0 ttl=64 time=3.761 ms
64 bytes from 10.0.1.1: seq=1 ttl=64 time=1.029 ms

--- 10.0.1.1 ping statistics ---
2 packets transmitted, 2 packets received, 0% packet loss
round-trip min/avg/max = 1.029/2.395/3.761 ms


=+=+= NLAN Request to router:openwrt2,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ip netns exec ns3 ping -c 2 10.0.1.1
=+=+= NLAN Reply from router:openwrt2,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
PING 10.0.1.1 (10.0.1.1): 56 data bytes
64 bytes from 10.0.1.1: seq=0 ttl=64 time=1.193 ms
64 bytes from 10.0.1.1: seq=1 ttl=64 time=0.163 ms

--- 10.0.1.1 ping statistics ---
2 packets transmitted, 2 packets received, 0% packet loss
round-trip min/avg/max = 0.163/0.678/1.193 ms


=+=+= NLAN Request to router:openwrt2,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ip netns exec ns1 ping -c 2 8.8.8.8
=+=+= NLAN Reply from router:openwrt2,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
PING 8.8.8.8 (8.8.8.8): 56 data bytes
64 bytes from 8.8.8.8: seq=0 ttl=63 time=5.107 ms
64 bytes from 8.8.8.8: seq=1 ttl=63 time=1.981 ms

--- 8.8.8.8 ping statistics ---
2 packets transmitted, 2 packets received, 0% packet loss
round-trip min/avg/max = 1.981/3.544/5.107 ms


=+=+= NLAN Request to router:openwrt2,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ip netns exec ns3 ping -c 2 8.8.8.8
=+=+= NLAN Reply from router:openwrt2,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
PING 8.8.8.8 (8.8.8.8): 56 data bytes
64 bytes from 8.8.8.8: seq=0 ttl=63 time=3.524 ms
64 bytes from 8.8.8.8: seq=1 ttl=63 time=1.221 ms

--- 8.8.8.8 ping statistics ---
2 packets transmitted, 2 packets received, 0% packet loss
round-trip min/avg/max = 1.221/2.372/3.524 ms


=+=+= NLAN Request to router:openwrt3,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ip netns exec ns1 ping -c 2 8.8.8.8
=+=+= NLAN Reply from router:openwrt3,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
PING 8.8.8.8 (8.8.8.8): 56 data bytes
64 bytes from 8.8.8.8: seq=0 ttl=63 time=4.626 ms
64 bytes from 8.8.8.8: seq=1 ttl=63 time=2.253 ms

--- 8.8.8.8 ping statistics ---
2 packets transmitted, 2 packets received, 0% packet loss
round-trip min/avg/max = 2.253/3.439/4.626 ms


=+=+= NLAN Request to router:openwrt3,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ip netns exec ns3 ping -c 2 8.8.8.8
=+=+= NLAN Reply from router:openwrt3,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
PING 8.8.8.8 (8.8.8.8): 56 data bytes
64 bytes from 8.8.8.8: seq=0 ttl=63 time=8.336 ms
64 bytes from 8.8.8.8: seq=1 ttl=63 time=2.070 ms

--- 8.8.8.8 ping statistics ---
2 packets transmitted, 2 packets received, 0% packet loss
round-trip min/avg/max = 2.070/5.203/8.336 ms


=+=+= NLAN Request to router:openwrt3,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
command: system.reboot
=+=+= NLAN Request to router:openwrt2,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
command: system.reboot
=+=+= NLAN Request to router:openwrt1,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
command: system.reboot
=+=+= NLAN Request to router:rpi1,platform:debian =+=+=+=+=+=+=+=+=+=+=+=+=+=+
command: system.reboot
Make sure all the systems have rebooted!
Enter to proceed the test: 
=+=+= NLAN Request to router:openwrt1,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ip netns add ns-global
=+=+= NLAN Request to router:openwrt1,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ip link add veth-global type veth peer name temp
=+=+= NLAN Request to router:openwrt1,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ip link set dev temp netns ns-global
=+=+= NLAN Request to router:openwrt1,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ip netns exec ns-global ip link set dev temp name eth0
=+=+= NLAN Request to router:openwrt1,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ip netns exec ns-global ip addr add dev eth0 8.8.8.8/24
=+=+= NLAN Request to router:openwrt1,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ip link set dev veth-global up
=+=+= NLAN Request to router:openwrt1,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ip addr add dev veth-global 8.8.8.1/24
=+=+= NLAN Request to router:openwrt1,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ip netns exec ns-global ip link set dev eth0 up
=+=+= NLAN Request to router:openwrt1,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ip netns exec ns-global ip route add default via  8.8.8.1
=+=+= NLAN Request to router:openwrt1,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: echo a b c
=+=+= NLAN Reply from router:openwrt1,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
a b c


=+=+= NLAN Request to router:openwrt1,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ip netns exec ns1 ping -c 2 10.0.1.102
=+=+= NLAN Reply from router:openwrt1,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
PING 10.0.1.102 (10.0.1.102): 56 data bytes
64 bytes from 10.0.1.102: seq=0 ttl=64 time=14.008 ms
64 bytes from 10.0.1.102: seq=1 ttl=64 time=2.376 ms

--- 10.0.1.102 ping statistics ---
2 packets transmitted, 2 packets received, 0% packet loss
round-trip min/avg/max = 2.376/8.192/14.008 ms


=+=+= NLAN Request to router:openwrt1,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ip netns exec ns1 ping -c 2 10.0.1.102
=+=+= NLAN Reply from router:openwrt1,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
PING 10.0.1.102 (10.0.1.102): 56 data bytes
64 bytes from 10.0.1.102: seq=0 ttl=64 time=2.161 ms
64 bytes from 10.0.1.102: seq=1 ttl=64 time=2.290 ms

--- 10.0.1.102 ping statistics ---
2 packets transmitted, 2 packets received, 0% packet loss
round-trip min/avg/max = 2.161/2.225/2.290 ms


=+=+= NLAN Request to router:openwrt1,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ip netns exec ns3 ping -c 2 10.0.3.103
=+=+= NLAN Reply from router:openwrt1,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
PING 10.0.3.103 (10.0.3.103): 56 data bytes
64 bytes from 10.0.3.103: seq=0 ttl=64 time=7.065 ms
64 bytes from 10.0.3.103: seq=1 ttl=64 time=1.587 ms

--- 10.0.3.103 ping statistics ---
2 packets transmitted, 2 packets received, 0% packet loss
round-trip min/avg/max = 1.587/4.326/7.065 ms


=+=+= NLAN Request to router:openwrt3,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ip netns exec ns3 ping -c 2 10.0.1.101
=+=+= NLAN Reply from router:openwrt3,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
PING 10.0.1.101 (10.0.1.101): 56 data bytes
64 bytes from 10.0.1.101: seq=0 ttl=63 time=16.106 ms
64 bytes from 10.0.1.101: seq=1 ttl=63 time=2.180 ms

--- 10.0.1.101 ping statistics ---
2 packets transmitted, 2 packets received, 0% packet loss
round-trip min/avg/max = 2.180/9.143/16.106 ms


=+=+= NLAN Request to router:openwrt2,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ip netns exec ns1 ping -c 2 192.168.100.1
=+=+= NLAN Reply from router:openwrt2,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
PING 192.168.100.1 (192.168.100.1): 56 data bytes
64 bytes from 192.168.100.1: seq=0 ttl=64 time=13.116 ms
64 bytes from 192.168.100.1: seq=1 ttl=64 time=1.993 ms

--- 192.168.100.1 ping statistics ---
2 packets transmitted, 2 packets received, 0% packet loss
round-trip min/avg/max = 1.993/7.554/13.116 ms


=+=+= NLAN Request to router:openwrt3,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ip netns exec ns1 ping -c 2 192.168.100.1
=+=+= NLAN Reply from router:openwrt3,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
PING 192.168.100.1 (192.168.100.1): 56 data bytes
64 bytes from 192.168.100.1: seq=0 ttl=64 time=11.752 ms
64 bytes from 192.168.100.1: seq=1 ttl=64 time=3.266 ms

--- 192.168.100.1 ping statistics ---
2 packets transmitted, 2 packets received, 0% packet loss
round-trip min/avg/max = 3.266/7.509/11.752 ms


=+=+= NLAN Request to router:openwrt2,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ip netns exec ns3 ping -c 2 192.168.100.1
=+=+= NLAN Reply from router:openwrt2,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
PING 192.168.100.1 (192.168.100.1): 56 data bytes
64 bytes from 192.168.100.1: seq=0 ttl=64 time=6.272 ms
64 bytes from 192.168.100.1: seq=1 ttl=64 time=1.627 ms

--- 192.168.100.1 ping statistics ---
2 packets transmitted, 2 packets received, 0% packet loss
round-trip min/avg/max = 1.627/3.949/6.272 ms


=+=+= NLAN Request to router:openwrt2,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ping -c 2 192.168.100.1
=+=+= NLAN Reply from router:openwrt2,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
PING 192.168.100.1 (192.168.100.1): 56 data bytes
64 bytes from 192.168.100.1: seq=0 ttl=64 time=2.447 ms
64 bytes from 192.168.100.1: seq=1 ttl=64 time=1.165 ms

--- 192.168.100.1 ping statistics ---
2 packets transmitted, 2 packets received, 0% packet loss
round-trip min/avg/max = 1.165/1.806/2.447 ms


=+=+= NLAN Request to router:openwrt3,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ip netns exec ns3 ping -c 2 10.0.1.102
=+=+= NLAN Reply from router:openwrt3,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
PING 10.0.1.102 (10.0.1.102): 56 data bytes
64 bytes from 10.0.1.102: seq=0 ttl=63 time=6.646 ms
64 bytes from 10.0.1.102: seq=1 ttl=63 time=2.943 ms

--- 10.0.1.102 ping statistics ---
2 packets transmitted, 2 packets received, 0% packet loss
round-trip min/avg/max = 2.943/4.794/6.646 ms


=+=+= NLAN Request to router:openwrt3,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ip netns exec ns3 ping -c 2 10.0.1.1
=+=+= NLAN Reply from router:openwrt3,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
PING 10.0.1.1 (10.0.1.1): 56 data bytes
64 bytes from 10.0.1.1: seq=0 ttl=64 time=2.489 ms
64 bytes from 10.0.1.1: seq=1 ttl=64 time=1.137 ms

--- 10.0.1.1 ping statistics ---
2 packets transmitted, 2 packets received, 0% packet loss
round-trip min/avg/max = 1.137/1.813/2.489 ms


=+=+= NLAN Request to router:openwrt2,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ip netns exec ns3 ping -c 2 10.0.1.1
=+=+= NLAN Reply from router:openwrt2,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
PING 10.0.1.1 (10.0.1.1): 56 data bytes
64 bytes from 10.0.1.1: seq=0 ttl=64 time=2.011 ms
64 bytes from 10.0.1.1: seq=1 ttl=64 time=0.271 ms

--- 10.0.1.1 ping statistics ---
2 packets transmitted, 2 packets received, 0% packet loss
round-trip min/avg/max = 0.271/1.141/2.011 ms


=+=+= NLAN Request to router:openwrt2,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ip netns exec ns1 ping -c 2 8.8.8.8
=+=+= NLAN Reply from router:openwrt2,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
PING 8.8.8.8 (8.8.8.8): 56 data bytes
64 bytes from 8.8.8.8: seq=0 ttl=63 time=9.321 ms
64 bytes from 8.8.8.8: seq=1 ttl=63 time=1.686 ms

--- 8.8.8.8 ping statistics ---
2 packets transmitted, 2 packets received, 0% packet loss
round-trip min/avg/max = 1.686/5.503/9.321 ms


=+=+= NLAN Request to router:openwrt2,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ip netns exec ns3 ping -c 2 8.8.8.8
=+=+= NLAN Reply from router:openwrt2,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
PING 8.8.8.8 (8.8.8.8): 56 data bytes
64 bytes from 8.8.8.8: seq=0 ttl=63 time=2.940 ms
64 bytes from 8.8.8.8: seq=1 ttl=63 time=1.020 ms

--- 8.8.8.8 ping statistics ---
2 packets transmitted, 2 packets received, 0% packet loss
round-trip min/avg/max = 1.020/1.980/2.940 ms


=+=+= NLAN Request to router:openwrt3,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ip netns exec ns1 ping -c 2 8.8.8.8
=+=+= NLAN Reply from router:openwrt3,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
PING 8.8.8.8 (8.8.8.8): 56 data bytes
64 bytes from 8.8.8.8: seq=0 ttl=63 time=6.390 ms
64 bytes from 8.8.8.8: seq=1 ttl=63 time=2.446 ms

--- 8.8.8.8 ping statistics ---
2 packets transmitted, 2 packets received, 0% packet loss
round-trip min/avg/max = 2.446/4.418/6.390 ms


=+=+= NLAN Request to router:openwrt3,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ip netns exec ns3 ping -c 2 8.8.8.8
=+=+= NLAN Reply from router:openwrt3,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
PING 8.8.8.8 (8.8.8.8): 56 data bytes
64 bytes from 8.8.8.8: seq=0 ttl=63 time=10.618 ms
64 bytes from 8.8.8.8: seq=1 ttl=63 time=1.529 ms

--- 8.8.8.8 ping statistics ---
2 packets transmitted, 2 packets received, 0% packet loss
round-trip min/avg/max = 1.529/6.073/10.618 ms


