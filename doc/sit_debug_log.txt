=+=+= NLAN Request to router:openwrt3,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --scpmod
=+=+= NLAN Request to router:openwrt2,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --scpmod
=+=+= NLAN Request to router:openwrt1,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --scpmod
=+=+= NLAN Request to router:rpi1,platform:debian =+=+=+=+=+=+=+=+=+=+=+=+=+=+
operation: --scpmod
=+=+= Files copied to router:openwrt2,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
target_dir: /opt/nlan
files: ['ovsdbrow.py', 'command.py', 'db.py', 'system.py', 'nlan.py', 'test.py', 'init.py', 'vxlan.py', 'bridges.py', 'gateway.py', 'services.py', 'subnets.py', 'nlan_agent.py', 'ovsdb.py', 'oputil.py', 'cmdutil.py', 'nlan_debian', 'nlan.schema_0.0.1.yaml', 'vswitch.schema_2.0.0', 'nlan_openwrt', 'ovsdb_nlan.schema', 'nlan_env.conf']
=+=+= Files copied to router:openwrt1,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
target_dir: /opt/nlan
files: ['ovsdbrow.py', 'command.py', 'db.py', 'system.py', 'nlan.py', 'test.py', 'init.py', 'vxlan.py', 'bridges.py', 'gateway.py', 'services.py', 'subnets.py', 'nlan_agent.py', 'ovsdb.py', 'oputil.py', 'cmdutil.py', 'nlan_debian', 'nlan.schema_0.0.1.yaml', 'vswitch.schema_2.0.0', 'nlan_openwrt', 'ovsdb_nlan.schema', 'nlan_env.conf']
=+=+= Files copied to router:openwrt3,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
target_dir: /opt/nlan
files: ['ovsdbrow.py', 'command.py', 'db.py', 'system.py', 'nlan.py', 'test.py', 'init.py', 'vxlan.py', 'bridges.py', 'gateway.py', 'services.py', 'subnets.py', 'nlan_agent.py', 'ovsdb.py', 'oputil.py', 'cmdutil.py', 'nlan_debian', 'nlan.schema_0.0.1.yaml', 'vswitch.schema_2.0.0', 'nlan_openwrt', 'ovsdb_nlan.schema', 'nlan_env.conf']
=+=+= Files copied to router:rpi1,platform:debian =+=+=+=+=+=+=+=+=+=+=+=+=+=+
target_dir: /opt/nlan
files: ['ovsdbrow.py', 'command.py', 'db.py', 'system.py', 'nlan.py', 'test.py', 'init.py', 'vxlan.py', 'bridges.py', 'gateway.py', 'services.py', 'subnets.py', 'nlan_agent.py', 'ovsdb.py', 'oputil.py', 'cmdutil.py', 'nlan_debian', 'nlan.schema_0.0.1.yaml', 'vswitch.schema_2.0.0', 'nlan_openwrt', 'ovsdb_nlan.schema', 'nlan_env.conf']
=+=+= NLAN Request to router:openwrt3,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: rm -rf /opt/nlan
=+=+= NLAN Request to router:openwrt2,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: rm -rf /opt/nlan
=+=+= NLAN Request to router:openwrt1,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: rm -rf /opt/nlan
=+=+= NLAN Request to router:rpi1,platform:debian =+=+=+=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: rm -rf /opt/nlan
=+=+= NLAN Request to router:openwrt3,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --scpmod
=+=+= NLAN Request to router:openwrt2,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --scpmod
=+=+= NLAN Request to router:openwrt1,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --scpmod
=+=+= NLAN Request to router:rpi1,platform:debian =+=+=+=+=+=+=+=+=+=+=+=+=+=+
operation: --scpmod
=+=+= Files copied to router:openwrt3,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
target_dir: /opt/nlan
files: ['ovsdbrow.py', 'command.py', 'db.py', 'system.py', 'nlan.py', 'test.py', 'init.py', 'vxlan.py', 'bridges.py', 'gateway.py', 'services.py', 'subnets.py', 'nlan_agent.py', 'ovsdb.py', 'oputil.py', 'cmdutil.py', 'nlan_debian', 'nlan.schema_0.0.1.yaml', 'vswitch.schema_2.0.0', 'nlan_openwrt', 'ovsdb_nlan.schema', 'nlan_env.conf']
=+=+= Files copied to router:openwrt2,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
target_dir: /opt/nlan
files: ['ovsdbrow.py', 'command.py', 'db.py', 'system.py', 'nlan.py', 'test.py', 'init.py', 'vxlan.py', 'bridges.py', 'gateway.py', 'services.py', 'subnets.py', 'nlan_agent.py', 'ovsdb.py', 'oputil.py', 'cmdutil.py', 'nlan_debian', 'nlan.schema_0.0.1.yaml', 'vswitch.schema_2.0.0', 'nlan_openwrt', 'ovsdb_nlan.schema', 'nlan_env.conf']
=+=+= Files copied to router:openwrt1,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
target_dir: /opt/nlan
files: ['ovsdbrow.py', 'command.py', 'db.py', 'system.py', 'nlan.py', 'test.py', 'init.py', 'vxlan.py', 'bridges.py', 'gateway.py', 'services.py', 'subnets.py', 'nlan_agent.py', 'ovsdb.py', 'oputil.py', 'cmdutil.py', 'nlan_debian', 'nlan.schema_0.0.1.yaml', 'vswitch.schema_2.0.0', 'nlan_openwrt', 'ovsdb_nlan.schema', 'nlan_env.conf']
=+=+= Files copied to router:rpi1,platform:debian =+=+=+=+=+=+=+=+=+=+=+=+=+=+
target_dir: /opt/nlan
files: ['ovsdbrow.py', 'command.py', 'db.py', 'system.py', 'nlan.py', 'test.py', 'init.py', 'vxlan.py', 'bridges.py', 'gateway.py', 'services.py', 'subnets.py', 'nlan_agent.py', 'ovsdb.py', 'oputil.py', 'cmdutil.py', 'nlan_debian', 'nlan.schema_0.0.1.yaml', 'vswitch.schema_2.0.0', 'nlan_openwrt', 'ovsdb_nlan.schema', 'nlan_env.conf']
=+=+= NLAN Request to router:openwrt3,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
command: init.run
=+=+= NLAN Request to router:openwrt2,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
command: init.run
=+=+= NLAN Request to router:openwrt1,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
command: init.run
=+=+= NLAN Request to router:rpi1,platform:debian =+=+=+=+=+=+=+=+=+=+=+=+=+=+
command: init.run
=+=+= NLAN Response from router:openwrt3,platform:openwrt =+=+=+=+=+=+=+=+=+=+
[INFO] module:nlan_agent,function:<module>,router:openwrt3
NLAN Agent initialization completed
{'mod_dir': ['command', 'config'], 'etc_dir': '/opt/nlan/etc', 'state_order': ['bridges', 'services', 'gateway', 'vxlan', 'subnets'], 'types': {'services': {'name': {'max': 1, 'key': {'type': 'string'}, 'min': 1}, 'chain': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}}, 'bridges': {'controller': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'ovs_bridges': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}, 'gateway': {'network': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'rip': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}, 'vxlan': {'remote_ips': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}, 'local_ip': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}, 'subnets': {'ip_dvr': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'peers': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}, 'vni': {'max': 1, 'key': {'minInteger': 0, 'maxInteger': 16777215, 'type': 'integer'}, 'min': 1}, 'vid': {'max': 1, 'key': {'minInteger': 0, 'maxInteger': 4095, 'type': 'integer'}, 'min': 0}, 'ip_vhost': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'ports': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}, 'default_gw': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'mode': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}}, 'tables': {'services': {'max': 'unlimited', 'key': {'type': 'uuid', 'refTable': 'NLAN_Service'}, 'min': 0}, 'bridges': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_Bridges'}, 'min': 0}, 'gateway': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_Gateway'}, 'min': 0}, 'vxlan': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_VXLAN'}, 'min': 0}, 'subnets': {'max': 'unlimited', 'key': {'type': 'uuid', 'refTable': 'NLAN_Subnet'}, 'min': 0}}, 'agent_dir': '/opt/nlan', 'indexes': {'services': 'name', 'subnets': 'vni'}, 'platform': 'openwrt', 'init': False, 'router': 'openwrt3', 'logger': <logging.Logger object at 0xb75af4ec>, 'schema': 'ovsdb_nlan.schema'}
[INFO] module:nlan_agent,function:_route,router:openwrt3
function:init.run, args:()
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: lxc-ls
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-vsctl --if-exists del-br br-tun
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-vsctl --if-exists del-br br-int
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: brctl show
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip link set dev veth-ns3 down
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: brctl delif br3 veth-ns3
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip link set dev br3 down
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: brctl delbr br3
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip link set dev veth-ns2 down
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: brctl delif br2 veth-ns2
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip link set dev br2 down
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: brctl delbr br2
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip link set dev veth-ns1 down
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: brctl delif br1 veth-ns1
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip link set dev br1 down
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: brctl delbr br1
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip netns list
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip netns del ns1
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip netns del ns3
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip netns del ns2
[DEBUG] module:ovsdb,function:_send,router:openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN","where":[],"op":"delete"}],"method":"transact","id":487496}
... JSON-RPC response ...
{"id":487496,"result":[{"count":1}],"error":null}
__ NLAN response __
message:Execution completed
exit:0
=+=+= NLAN Response from router:openwrt1,platform:openwrt =+=+=+=+=+=+=+=+=+=+
[INFO] module:nlan_agent,function:<module>,router:openwrt1
NLAN Agent initialization completed
{'mod_dir': ['command', 'config'], 'etc_dir': '/opt/nlan/etc', 'state_order': ['bridges', 'services', 'gateway', 'vxlan', 'subnets'], 'types': {'services': {'name': {'max': 1, 'key': {'type': 'string'}, 'min': 1}, 'chain': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}}, 'bridges': {'controller': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'ovs_bridges': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}, 'gateway': {'network': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'rip': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}, 'vxlan': {'remote_ips': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}, 'local_ip': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}, 'subnets': {'ip_dvr': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'peers': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}, 'vni': {'max': 1, 'key': {'minInteger': 0, 'maxInteger': 16777215, 'type': 'integer'}, 'min': 1}, 'vid': {'max': 1, 'key': {'minInteger': 0, 'maxInteger': 4095, 'type': 'integer'}, 'min': 0}, 'ip_vhost': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'ports': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}, 'default_gw': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'mode': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}}, 'tables': {'services': {'max': 'unlimited', 'key': {'type': 'uuid', 'refTable': 'NLAN_Service'}, 'min': 0}, 'bridges': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_Bridges'}, 'min': 0}, 'gateway': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_Gateway'}, 'min': 0}, 'vxlan': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_VXLAN'}, 'min': 0}, 'subnets': {'max': 'unlimited', 'key': {'type': 'uuid', 'refTable': 'NLAN_Subnet'}, 'min': 0}}, 'agent_dir': '/opt/nlan', 'indexes': {'services': 'name', 'subnets': 'vni'}, 'platform': 'openwrt', 'init': False, 'router': 'openwrt1', 'logger': <logging.Logger object at 0xb75514ec>, 'schema': 'ovsdb_nlan.schema'}
[INFO] module:nlan_agent,function:_route,router:openwrt1
function:init.run, args:()
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: lxc-ls
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-vsctl --if-exists del-br br-tun
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-vsctl --if-exists del-br br-int
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: brctl show
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip link set dev veth-ns3 down
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: brctl delif br3 veth-ns3
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip link set dev br3 down
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: brctl delbr br3
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip link set dev veth-ns2 down
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: brctl delif br2 veth-ns2
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip link set dev br2 down
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: brctl delbr br2
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip link set dev veth-ns1 down
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: brctl delif br1 veth-ns1
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip link set dev br1 down
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: brctl delbr br1
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip netns list
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip netns del ns1
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip netns del ns3
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip netns del ns2
[DEBUG] module:ovsdb,function:_send,router:openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN","where":[],"op":"delete"}],"method":"transact","id":586757}
... JSON-RPC response ...
{"id":586757,"result":[{"count":1}],"error":null}
__ NLAN response __
message:Execution completed
exit:0
=+=+= NLAN Response from router:openwrt2,platform:openwrt =+=+=+=+=+=+=+=+=+=+
[INFO] module:nlan_agent,function:<module>,router:openwrt2
NLAN Agent initialization completed
{'mod_dir': ['command', 'config'], 'etc_dir': '/opt/nlan/etc', 'state_order': ['bridges', 'services', 'gateway', 'vxlan', 'subnets'], 'types': {'services': {'name': {'max': 1, 'key': {'type': 'string'}, 'min': 1}, 'chain': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}}, 'bridges': {'controller': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'ovs_bridges': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}, 'gateway': {'network': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'rip': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}, 'vxlan': {'remote_ips': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}, 'local_ip': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}, 'subnets': {'ip_dvr': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'peers': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}, 'vni': {'max': 1, 'key': {'minInteger': 0, 'maxInteger': 16777215, 'type': 'integer'}, 'min': 1}, 'vid': {'max': 1, 'key': {'minInteger': 0, 'maxInteger': 4095, 'type': 'integer'}, 'min': 0}, 'ip_vhost': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'ports': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}, 'default_gw': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'mode': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}}, 'tables': {'services': {'max': 'unlimited', 'key': {'type': 'uuid', 'refTable': 'NLAN_Service'}, 'min': 0}, 'bridges': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_Bridges'}, 'min': 0}, 'gateway': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_Gateway'}, 'min': 0}, 'vxlan': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_VXLAN'}, 'min': 0}, 'subnets': {'max': 'unlimited', 'key': {'type': 'uuid', 'refTable': 'NLAN_Subnet'}, 'min': 0}}, 'agent_dir': '/opt/nlan', 'indexes': {'services': 'name', 'subnets': 'vni'}, 'platform': 'openwrt', 'init': False, 'router': 'openwrt2', 'logger': <logging.Logger object at 0xb75b24ec>, 'schema': 'ovsdb_nlan.schema'}
[INFO] module:nlan_agent,function:_route,router:openwrt2
function:init.run, args:()
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: lxc-ls
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-vsctl --if-exists del-br br-tun
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-vsctl --if-exists del-br br-int
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: brctl show
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip link set dev veth-ns3 down
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: brctl delif br3 veth-ns3
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip link set dev br3 down
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: brctl delbr br3
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip link set dev veth-ns2 down
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: brctl delif br2 veth-ns2
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip link set dev br2 down
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: brctl delbr br2
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip link set dev veth-ns1 down
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: brctl delif br1 veth-ns1
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip link set dev br1 down
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: brctl delbr br1
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip netns list
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip netns del ns1
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip netns del ns3
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip netns del ns2
[DEBUG] module:ovsdb,function:_send,router:openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN","where":[],"op":"delete"}],"method":"transact","id":200489}
... JSON-RPC response ...
{"id":200489,"result":[{"count":1}],"error":null}
__ NLAN response __
message:Execution completed
exit:0
=+=+= NLAN Response from router:rpi1,platform:debian +=+=+=+=+=+=+=+=+=+=+=+=+
[INFO] module:nlan_agent,function:<module>,router:rpi1
NLAN Agent initialization completed
{'mod_dir': ['command', 'config'], 'etc_dir': '/opt/nlan/etc', 'state_order': ['bridges', 'services', 'gateway', 'vxlan', 'subnets'], 'types': {'services': {'name': {'max': 1, 'key': {'type': 'string'}, 'min': 1}, 'chain': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}}, 'bridges': {'controller': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'ovs_bridges': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}, 'gateway': {'network': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'rip': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}, 'vxlan': {'remote_ips': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}, 'local_ip': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}, 'subnets': {'ip_dvr': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'peers': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}, 'vni': {'max': 1, 'key': {'minInteger': 0, 'maxInteger': 16777215, 'type': 'integer'}, 'min': 1}, 'vid': {'max': 1, 'key': {'minInteger': 0, 'maxInteger': 4095, 'type': 'integer'}, 'min': 0}, 'ip_vhost': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'ports': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}, 'default_gw': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'mode': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}}, 'tables': {'services': {'max': 'unlimited', 'key': {'type': 'uuid', 'refTable': 'NLAN_Service'}, 'min': 0}, 'bridges': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_Bridges'}, 'min': 0}, 'gateway': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_Gateway'}, 'min': 0}, 'vxlan': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_VXLAN'}, 'min': 0}, 'subnets': {'max': 'unlimited', 'key': {'type': 'uuid', 'refTable': 'NLAN_Subnet'}, 'min': 0}}, 'agent_dir': '/opt/nlan', 'indexes': {'services': 'name', 'subnets': 'vni'}, 'platform': 'debian', 'init': False, 'router': 'rpi1', 'logger': <logging.Logger object at 0xb730c0ec>, 'schema': 'ovsdb_nlan.schema'}
[INFO] module:nlan_agent,function:_route,router:rpi1
function:init.run, args:()
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: lxc-ls
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: lxc-stop -n snort1
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: ovs-vsctl --if-exists del-br br-tun
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: ovs-vsctl --if-exists del-br br-int
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: brctl show
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: ip link set dev veth-ns111 down
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: brctl delif br111 veth-ns111
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: ip link set dev br111 down
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: brctl delbr br111
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: ip link set dev veth-ns1 down
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: brctl delif br1 veth-ns1
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: ip link set dev br1 down
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: brctl delbr br1
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: ip netns list
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: ip netns del ns1
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: ip netns del ns111
[DEBUG] module:ovsdb,function:_send,router:rpi1
... JSON-RPC request ...
{"params": ["Open_vSwitch", {"table": "NLAN", "where": [], "op": "delete"}], "method": "transact", "id": 279289}
... JSON-RPC response ...
{"id":279289,"result":[{"count":1}],"error":null}
__ NLAN response __
message:Execution completed
exit:0
=+=+= Transaction Summary =+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+

Start Time: 2014-04-23 00:52:34.006755

Router           Result    Elapsed Time
---------------------------------------
openwrt3          :-)         1.46(sec)
openwrt1          :-)         2.03(sec)
openwrt2          :-)         2.23(sec)
rpi1              :-)         3.01(sec)
cmd: git show HEAD:dvsdvr.yaml
=+=+= NLAN Request to router:rpi1,platform:debian =+=+=+=+=+=+=+=+=+=+=+=+=+=+
operation: --add
dict_args: "OrderedDict([('bridges', {'ovs_bridges': 'enabled'}), ('services', {('name', 'snort1'): {'name': 'snort1', 'chain': ['mz.101', 'dmz.1001']}}), ('vxlan', {'remote_ips': ['192.168.1.103', '192.168.1.102', '192.168.1.101'], 'local_ip': '192.168.1.104'}), ('subnets', {('vni', 1001): {'peers': ['192.168.1.101'], 'vid': 111, 'vni': 1001, 'ports': ['dmz.1001']}, ('vni', 101): {'peers': ['192.168.1.102', '192.168.1.103'], 'vid': 1, 'vni': 101, 'ports': ['mz.101']}})])"
=+=+= NLAN Request to router:openwrt3,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --add
dict_args: "OrderedDict([('bridges', {'ovs_bridges': 'enabled'}), ('vxlan', {'remote_ips': ['192.168.1.102', '192.168.1.101', '192.168.1.104'], 'local_ip': '192.168.1.103'}), ('subnets', {('vni', 1): {'peers': ['192.168.1.101', '192.168.1.102'], 'vid': 2, 'ip_vhost': '192.168.100.103/24', 'default_gw': '192.168.100.1', 'ip_dvr': '192.168.100.3/24', 'vni': 1}, ('vni', 103): {'ip_vhost': '10.0.3.103/24', 'ip_dvr': '10.0.3.1/24', 'peers': ['192.168.1.101', '192.168.1.102'], 'vid': 3, 'vni': 103}, ('vni', 101): {'peers': ['192.168.1.102', '192.168.1.104'], 'vid': 1, 'ip_vhost': '10.0.1.103/24', 'vni': 101, 'ip_dvr': '10.0.1.1/24', 'mode': 'spoke_dvr'}})])"
=+=+= NLAN Request to router:openwrt2,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --add
dict_args: "OrderedDict([('bridges', {'ovs_bridges': 'enabled'}), ('vxlan', {'remote_ips': ['192.168.1.103', '192.168.1.101', '192.168.1.104'], 'local_ip': '192.168.1.102'}), ('subnets', {('vni', 1): {'peers': ['192.168.1.101', '192.168.1.103'], 'vid': 2, 'ip_vhost': '192.168.100.102/24', 'default_gw': '192.168.100.1', 'ip_dvr': '192.168.100.2/24', 'vni': 1}, ('vni', 103): {'ip_vhost': '10.0.3.102/24', 'ip_dvr': '10.0.3.1/24', 'peers': ['192.168.1.101', '192.168.1.103'], 'vid': 3, 'vni': 103}, ('vni', 101): {'peers': ['192.168.1.103', '192.168.1.104'], 'vid': 1, 'ip_vhost': '10.0.1.102/24', 'vni': 101, 'ip_dvr': '10.0.1.1/24', 'mode': 'spoke_dvr'}})])"
=+=+= NLAN Request to router:openwrt1,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --add
dict_args: "OrderedDict([('bridges', {'ovs_bridges': 'enabled'}), ('gateway', {'network': 'eth2', 'rip': 'enabled'}), ('vxlan', {'remote_ips': ['192.168.1.103', '192.168.1.102', '192.168.1.104'], 'local_ip': '192.168.1.101'}), ('subnets', {('vni', 1): {'ip_vhost': '192.168.100.101/24', 'ip_dvr': '192.168.100.1/24', 'peers': ['192.168.1.102', '192.168.1.103'], 'vid': 2, 'vni': 1}, ('vni', 103): {'ip_vhost': '10.0.3.101/24', 'ip_dvr': '10.0.3.1/24', 'peers': ['192.168.1.102', '192.168.1.103'], 'vid': 3, 'vni': 103}, ('vni', 1001): {'peers': ['192.168.1.104'], 'vid': 1, 'ip_vhost': '10.0.1.101/24', 'vni': 1001, 'ip_dvr': '10.0.1.1/24', 'mode': 'hub'}})])"
=+=+= NLAN Response from router:openwrt3,platform:openwrt =+=+=+=+=+=+=+=+=+=+
[INFO] module:nlan_agent,function:<module>,router:openwrt3
NLAN Agent initialization completed
{'mod_dir': ['command', 'config'], 'etc_dir': '/opt/nlan/etc', 'state_order': ['bridges', 'services', 'gateway', 'vxlan', 'subnets'], 'types': {'services': {'name': {'max': 1, 'key': {'type': 'string'}, 'min': 1}, 'chain': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}}, 'bridges': {'controller': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'ovs_bridges': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}, 'gateway': {'network': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'rip': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}, 'vxlan': {'remote_ips': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}, 'local_ip': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}, 'subnets': {'ip_dvr': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'peers': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}, 'vni': {'max': 1, 'key': {'minInteger': 0, 'maxInteger': 16777215, 'type': 'integer'}, 'min': 1}, 'vid': {'max': 1, 'key': {'minInteger': 0, 'maxInteger': 4095, 'type': 'integer'}, 'min': 0}, 'ip_vhost': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'ports': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}, 'default_gw': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'mode': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}}, 'tables': {'services': {'max': 'unlimited', 'key': {'type': 'uuid', 'refTable': 'NLAN_Service'}, 'min': 0}, 'bridges': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_Bridges'}, 'min': 0}, 'gateway': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_Gateway'}, 'min': 0}, 'vxlan': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_VXLAN'}, 'min': 0}, 'subnets': {'max': 'unlimited', 'key': {'type': 'uuid', 'refTable': 'NLAN_Subnet'}, 'min': 0}}, 'agent_dir': '/opt/nlan', 'indexes': {'services': 'name', 'subnets': 'vni'}, 'platform': 'openwrt', 'init': False, 'router': 'openwrt3', 'logger': <logging.Logger object at 0xb757516c>, 'schema': 'ovsdb_nlan.schema'}
[INFO] module:nlan_agent,function:_route,router:openwrt3
function:bridges.add, model:{'ovs_bridges': 'enabled'}
[INFO] module:bridges,function:add,router:openwrt3
Adding bridges: br-int and br-tun
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-vsctl add-br br-int
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-vsctl add-br br-tun
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-ofctl del-flows br-tun
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-vsctl add-port br-int patch-int -- set interface patch-int type=patch options:peer=patch-tun
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-vsctl add-port br-tun patch-tun -- set interface patch-tun type=patch options:peer=patch-int
[DEBUG] module:ovsdb,function:_send,router:openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"Interface","where":[["name","==","patch-tun"]],"op":"select"}],"method":"transact","id":588069}
... JSON-RPC response ...
{"id":588069,"result":[{"rows":[{"options":["map",[["peer","patch-int"]]],"mtu":["set",[]],"link_speed":["set",[]],"statistics":["map",[["collisions",0],["rx_bytes",0],["rx_crc_err",0],["rx_dropped",0],["rx_errors",0],["rx_frame_err",0],["rx_over_err",0],["rx_packets",0],["tx_bytes",0],["tx_dropped",0],["tx_errors",0],["tx_packets",0]]],"mac_in_use":"8e:18:9b:fc:0a:5e","ingress_policing_rate":0,"ofport":1,"mac":["set",[]],"cfm_fault_status":["set",[]],"duplex":["set",[]],"lacp_current":["set",[]],"cfm_fault":["set",[]],"link_state":["set",[]],"external_ids":["map",[]],"bfd_status":["map",[]],"link_resets":["set",[]],"name":"patch-tun","type":"patch","cfm_remote_opstate":["set",[]],"_uuid":["uuid","4d3cc5e0-75d7-4f2b-a063-35775d895cae"],"status":["map",[]],"ifindex":0,"_version":["uuid","8bdc7297-40e7-438d-821b-802489ea1e63"],"other_config":["map",[]],"admin_state":["set",[]],"cfm_remote_mpids":["set",[]],"cfm_mpid":["set",[]],"bfd":["map",[]],"ofport_request":["set",[]],"ingress_policing_burst":0,"cfm_flap_count":["set",[]],"cfm_health":["set",[]]}]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-ofctl del-flows br-tun
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-ofctl add-flow br-tun table=0,priority=1,in_port=1,actions=resubmit(,1)
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-ofctl add-flow br-tun table=0,priority=0,actions=drop
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-ofctl add-flow br-tun table=1,priority=0,dl_dst=01:00:00:00:00:00/01:00:00:00:00:00,actions=resubmit(,19)
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-ofctl add-flow br-tun table=1,priority=0,dl_dst=00:00:00:00:00:00/01:00:00:00:00:00,actions=resubmit(,20)
[DEBUG] module:ovsdb,function:_send,router:openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"Interface","where":[["name","==","patch-tun"]],"op":"select"}],"method":"transact","id":811820}
... JSON-RPC response ...
{"id":811820,"result":[{"rows":[{"options":["map",[["peer","patch-int"]]],"mtu":["set",[]],"link_speed":["set",[]],"statistics":["map",[["collisions",0],["rx_bytes",0],["rx_crc_err",0],["rx_dropped",0],["rx_errors",0],["rx_frame_err",0],["rx_over_err",0],["rx_packets",0],["tx_bytes",0],["tx_dropped",0],["tx_errors",0],["tx_packets",0]]],"mac_in_use":"8e:18:9b:fc:0a:5e","ingress_policing_rate":0,"ofport":1,"mac":["set",[]],"cfm_fault_status":["set",[]],"duplex":["set",[]],"lacp_current":["set",[]],"cfm_fault":["set",[]],"link_state":"up","external_ids":["map",[]],"bfd_status":["map",[]],"link_resets":0,"name":"patch-tun","type":"patch","cfm_remote_opstate":["set",[]],"_uuid":["uuid","4d3cc5e0-75d7-4f2b-a063-35775d895cae"],"status":["map",[]],"ifindex":0,"_version":["uuid","47436bd6-258a-43ec-9633-b5a748bfdb24"],"other_config":["map",[]],"admin_state":"up","cfm_remote_mpids":["set",[]],"cfm_mpid":["set",[]],"bfd":["map",[]],"ofport_request":["set",[]],"ingress_policing_burst":0,"cfm_flap_count":["set",[]],"cfm_health":["set",[]]}]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-ofctl add-flow br-tun table=2,priority=0,actions=drop
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-ofctl add-flow br-tun table=3,priority=0,actions=drop
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-ofctl add-flow br-tun table=10,priority=1,actions=learn(table=20,hard_timeout=300,priority=1,NXM_OF_VLAN_TCI[0..11],NXM_OF_ETH_DST[]=NXM_OF_ETH_SRC[],load:0->NXM_OF_VLAN_TCI[],load:NXM_NX_TUN_ID[]->NXM_NX_TUN_ID[],output:NXM_OF_IN_PORT[]),output:1
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-ofctl add-flow br-tun table=19,priority=0,actions=resubmit(,21)
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-ofctl add-flow br-tun table=20,priority=0,actions=resubmit(,21)
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-ofctl add-flow br-tun table=21,priority=0,actions=drop
[DEBUG] module:ovsdb,function:_send,router:openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN","row":{},"op":"insert"}],"method":"transact","id":437100}
... JSON-RPC response ...
{"id":437100,"result":[{"uuid":["uuid","c03fdbcb-8132-43cc-9a20-3eed2b795c4d"]}],"error":null}
[DEBUG] module:ovsdb,function:_send,router:openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Bridges","where":[],"op":"select"}],"method":"transact","id":181828}
... JSON-RPC response ...
{"id":181828,"result":[{"rows":[]}],"error":null}
[DEBUG] module:ovsdb,function:_send,router:openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Bridges","uuid-name":"temp_712750","row":{"ovs_bridges":"enabled"},"op":"insert"},{"table":"NLAN","where":[],"mutations":[["bridges","insert",["set",[["named-uuid","temp_712750"]]]]],"op":"mutate"}],"method":"transact","id":405807}
... JSON-RPC response ...
{"id":405807,"result":[{"uuid":["uuid","6fd119b0-e21f-4e19-9133-f3b5ecac8450"]},{"count":1}],"error":null}
[DEBUG] module:ovsdb,function:_send,router:openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Bridges","where":[],"op":"select"}],"method":"transact","id":969612}
... JSON-RPC response ...
{"id":969612,"result":[{"rows":[{"_uuid":["uuid","6fd119b0-e21f-4e19-9133-f3b5ecac8450"],"_version":["uuid","1758b3ee-4132-4c64-beb7-42d024903fce"],"ovs_bridges":"enabled","controller":["set",[]]}]}],"error":null}
[INFO] module:nlan_agent,function:_route,router:openwrt3
function:vxlan.add, model:{'remote_ips': ['192.168.1.102', '192.168.1.101', '192.168.1.104'], 'local_ip': '192.168.1.103'}
[INFO] module:vxlan,function:add,router:openwrt3
Adding a VXLAN tunnel: vxlan_102
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-vsctl add-port br-tun vxlan_102 -- set interface vxlan_102 type=vxlan options:in_key=flow options:local_ip=192.168.1.103 options:out_key=flow options:remote_ip=192.168.1.102
[INFO] module:vxlan,function:add,router:openwrt3
Adding a VXLAN tunnel: vxlan_101
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-vsctl add-port br-tun vxlan_101 -- set interface vxlan_101 type=vxlan options:in_key=flow options:local_ip=192.168.1.103 options:out_key=flow options:remote_ip=192.168.1.101
[INFO] module:vxlan,function:add,router:openwrt3
Adding a VXLAN tunnel: vxlan_104
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-vsctl add-port br-tun vxlan_104 -- set interface vxlan_104 type=vxlan options:in_key=flow options:local_ip=192.168.1.103 options:out_key=flow options:remote_ip=192.168.1.104
[DEBUG] module:ovsdb,function:_send,router:openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"Interface","where":[["type","==","vxlan"]],"columns":["ofport","options"],"op":"select"}],"method":"transact","id":749025}
... JSON-RPC response ...
{"id":749025,"result":[{"rows":[{"options":["map",[["in_key","flow"],["local_ip","192.168.1.103"],["out_key","flow"],["remote_ip","192.168.1.101"]]],"ofport":3},{"options":["map",[["in_key","flow"],["local_ip","192.168.1.103"],["out_key","flow"],["remote_ip","192.168.1.102"]]],"ofport":2},{"options":["map",[["in_key","flow"],["local_ip","192.168.1.103"],["out_key","flow"],["remote_ip","192.168.1.104"]]],"ofport":4}]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-ofctl add-flow br-tun table=0,priority=1,in_port=3,actions=resubmit(,2)
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-ofctl add-flow br-tun table=0,priority=1,in_port=2,actions=resubmit(,2)
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-ofctl add-flow br-tun table=0,priority=1,in_port=4,actions=resubmit(,2)
[DEBUG] module:ovsdb,function:_send,router:openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN","row":{},"op":"insert"}],"method":"transact","id":839015}
... JSON-RPC response ...
{"id":839015,"result":[{"uuid":["uuid","1a8ebb04-edf4-4d72-a3cd-16cdaee16f41"]},{"error":"constraint violation","details":"transaction causes \"NLAN\" table to contain 2 rows, greater than the schema-defined limit of 1 row(s)"}],"error":null}
[DEBUG] module:ovsdb,function:_send,router:openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_VXLAN","where":[],"op":"select"}],"method":"transact","id":398612}
... JSON-RPC response ...
{"id":398612,"result":[{"rows":[]}],"error":null}
[DEBUG] module:ovsdb,function:_send,router:openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_VXLAN","uuid-name":"temp_936701","row":{"remote_ips":["set",["192.168.1.102","192.168.1.101","192.168.1.104"]],"local_ip":"192.168.1.103"},"op":"insert"},{"table":"NLAN","where":[],"mutations":[["vxlan","insert",["set",[["named-uuid","temp_936701"]]]]],"op":"mutate"}],"method":"transact","id":675119}
... JSON-RPC response ...
{"id":675119,"result":[{"uuid":["uuid","5183e419-4edd-4182-aca2-6ef995b06fc4"]},{"count":1}],"error":null}
[DEBUG] module:ovsdb,function:_send,router:openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_VXLAN","where":[],"op":"select"}],"method":"transact","id":530247}
... JSON-RPC response ...
{"id":530247,"result":[{"rows":[{"_version":["uuid","cf6c0419-b3c0-4c95-88ac-798d8836c6f3"],"_uuid":["uuid","5183e419-4edd-4182-aca2-6ef995b06fc4"],"local_ip":"192.168.1.103","remote_ips":["set",["192.168.1.101","192.168.1.102","192.168.1.104"]]}]}],"error":null}
[INFO] module:nlan_agent,function:_route,router:openwrt3
function:subnets.add, index:('vni', 1), model:{'peers': ['192.168.1.101', '192.168.1.102'], 'vid': 2, 'ip_vhost': '192.168.100.103/24', 'default_gw': '192.168.100.1', 'ip_dvr': '192.168.100.3/24', 'vni': 1}
[INFO] module:subnets,function:_crud,router:openwrt3
Adding a subnet(vlan): 2
[DEBUG] module:ovsdb,function:_send,router:openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN","row":{},"op":"insert"}],"method":"transact","id":725244}
... JSON-RPC response ...
{"id":725244,"result":[{"uuid":["uuid","7dd9654f-367f-4121-801c-a1805bd8884f"]},{"error":"constraint violation","details":"transaction causes \"NLAN\" table to contain 2 rows, greater than the schema-defined limit of 1 row(s)"}],"error":null}
[DEBUG] module:ovsdb,function:_send,router:openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","where":[["vni","==",1]],"op":"select"}],"method":"transact","id":935143}
... JSON-RPC response ...
{"id":935143,"result":[{"rows":[]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip netns add ns2
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: brctl addbr br2
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip link add veth-ns2 type veth peer name temp-ns2
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip link set dev temp-ns2 netns ns2
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip netns exec ns2 ip link set dev temp-ns2 name eth0
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-vsctl add-port br-int int-br2 tag=2 -- set interface int-br2 type=internal
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-vsctl add-port br-int int-dvr2 tag=2 -- set interface int-dvr2 type=internal
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: brctl addif br2 veth-ns2
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: brctl addif br2 int-br2
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip link set dev veth-ns2 promisc on
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip link set dev veth-ns2 up
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip netns exec ns2 ip link set dev eth0 up
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip link set dev int-br2 promisc on
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip link set dev int-br2 up
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip link set dev int-dvr2 up
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip link set dev br2 up
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip netns exec ns2 ip addr add dev eth0 192.168.100.103/24
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip addr add dev int-dvr2 192.168.100.3/24
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip netns exec ns2 ip route add default via 192.168.100.3 dev eth0
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: route
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip route add default via 192.168.100.1
[DEBUG] module:ovsdb,function:_send,router:openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"Controller","where":[],"columns":["target"],"op":"select"}],"method":"transact","id":395431}
... JSON-RPC response ...
{"id":395431,"result":[{"rows":[]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-ofctl add-flow br-tun table=2,priority=1,tun_id=1,actions=mod_vlan_vid:2,resubmit(,10)
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-ofctl add-flow br-tun table=19,priority=1,dl_type=0x0806,dl_vlan=2,nw_dst=192.168.100.3,actions=drop
[DEBUG] module:ovsdb,function:_send,router:openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"Interface","where":[["type","==","vxlan"]],"columns":["ofport","options"],"op":"select"}],"method":"transact","id":484990}
... JSON-RPC response ...
{"id":484990,"result":[{"rows":[{"options":["map",[["in_key","flow"],["local_ip","192.168.1.103"],["out_key","flow"],["remote_ip","192.168.1.101"]]],"ofport":3},{"options":["map",[["in_key","flow"],["local_ip","192.168.1.103"],["out_key","flow"],["remote_ip","192.168.1.102"]]],"ofport":2},{"options":["map",[["in_key","flow"],["local_ip","192.168.1.103"],["out_key","flow"],["remote_ip","192.168.1.104"]]],"ofport":4}]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-ofctl add-flow br-tun table=21,priority=1,dl_vlan=2,actions=strip_vlan,set_tunnel:1,output:3,output:2
[DEBUG] module:ovsdb,function:_send,router:openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN","row":{},"op":"insert"}],"method":"transact","id":996944}
... JSON-RPC response ...
{"id":996944,"result":[{"uuid":["uuid","15d7b098-4e6b-4906-a493-33632cdff19e"]},{"error":"constraint violation","details":"transaction causes \"NLAN\" table to contain 2 rows, greater than the schema-defined limit of 1 row(s)"}],"error":null}
[DEBUG] module:ovsdb,function:_send,router:openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","where":[["vni","==",1]],"op":"select"}],"method":"transact","id":588274}
... JSON-RPC response ...
{"id":588274,"result":[{"rows":[]}],"error":null}
[DEBUG] module:ovsdb,function:crud,router:openwrt3
CRUD operation (add): {'peers': ['192.168.1.101', '192.168.1.102'], 'vid': 2, 'ip_vhost': '192.168.100.103/24', 'default_gw': '192.168.100.1', 'ip_dvr': '192.168.100.3/24', 'vni': 1}
[DEBUG] module:ovsdb,function:_send,router:openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","uuid-name":"temp_237974","row":{"peers":["set",["192.168.1.101","192.168.1.102"]],"vid":2,"ip_vhost":"192.168.100.103/24","default_gw":"192.168.100.1","ip_dvr":"192.168.100.3/24","vni":1},"op":"insert"},{"table":"NLAN","where":[],"mutations":[["subnets","insert",["set",[["named-uuid","temp_237974"]]]]],"op":"mutate"}],"method":"transact","id":856749}
... JSON-RPC response ...
{"id":856749,"result":[{"uuid":["uuid","9a2bc607-41d3-47c5-8016-d7b6617e3e20"]},{"count":1}],"error":null}
[DEBUG] module:ovsdb,function:_send,router:openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","where":[["vni","==",1]],"op":"select"}],"method":"transact","id":594410}
... JSON-RPC response ...
{"id":594410,"result":[{"rows":[{"peers":["set",["192.168.1.101","192.168.1.102"]],"_version":["uuid","49f36351-8ef7-4f9f-bd77-03f4c019db83"],"vni":1,"ports":["set",[]],"mode":["set",[]],"vid":2,"_uuid":["uuid","9a2bc607-41d3-47c5-8016-d7b6617e3e20"],"default_gw":"192.168.100.1","ip_vhost":"192.168.100.103/24","ip_dvr":"192.168.100.3/24"}]}],"error":null}
[INFO] module:nlan_agent,function:_route,router:openwrt3
function:subnets.add, index:('vni', 103), model:{'ip_dvr': '10.0.3.1/24', 'ip_vhost': '10.0.3.103/24', 'peers': ['192.168.1.101', '192.168.1.102'], 'vid': 3, 'vni': 103}
[INFO] module:subnets,function:_crud,router:openwrt3
Adding a subnet(vlan): 3
[DEBUG] module:ovsdb,function:_send,router:openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN","row":{},"op":"insert"}],"method":"transact","id":682214}
... JSON-RPC response ...
{"id":682214,"result":[{"uuid":["uuid","6da33a3f-9046-4241-9c01-f2fb3ef802c1"]},{"error":"constraint violation","details":"transaction causes \"NLAN\" table to contain 2 rows, greater than the schema-defined limit of 1 row(s)"}],"error":null}
[DEBUG] module:ovsdb,function:_send,router:openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","where":[["vni","==",103]],"op":"select"}],"method":"transact","id":331926}
... JSON-RPC response ...
{"id":331926,"result":[{"rows":[]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip netns add ns3
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: brctl addbr br3
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip link add veth-ns3 type veth peer name temp-ns3
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip link set dev temp-ns3 netns ns3
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip netns exec ns3 ip link set dev temp-ns3 name eth0
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-vsctl add-port br-int int-br3 tag=3 -- set interface int-br3 type=internal
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-vsctl add-port br-int int-dvr3 tag=3 -- set interface int-dvr3 type=internal
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: brctl addif br3 veth-ns3
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: brctl addif br3 int-br3
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip link set dev veth-ns3 promisc on
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip link set dev veth-ns3 up
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip netns exec ns3 ip link set dev eth0 up
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip link set dev int-br3 promisc on
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip link set dev int-br3 up
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip link set dev int-dvr3 up
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip link set dev br3 up
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip netns exec ns3 ip addr add dev eth0 10.0.3.103/24
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip addr add dev int-dvr3 10.0.3.1/24
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip netns exec ns3 ip route add default via 10.0.3.1 dev eth0
[DEBUG] module:ovsdb,function:_send,router:openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"Controller","where":[],"columns":["target"],"op":"select"}],"method":"transact","id":590588}
... JSON-RPC response ...
{"id":590588,"result":[{"rows":[]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-ofctl add-flow br-tun table=2,priority=1,tun_id=103,actions=mod_vlan_vid:3,resubmit(,10)
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-ofctl add-flow br-tun table=19,priority=1,dl_type=0x0806,dl_vlan=3,nw_dst=10.0.3.1,actions=drop
[DEBUG] module:ovsdb,function:_send,router:openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"Interface","where":[["type","==","vxlan"]],"columns":["ofport","options"],"op":"select"}],"method":"transact","id":96656}
... JSON-RPC response ...
{"id":96656,"result":[{"rows":[{"options":["map",[["in_key","flow"],["local_ip","192.168.1.103"],["out_key","flow"],["remote_ip","192.168.1.101"]]],"ofport":3},{"options":["map",[["in_key","flow"],["local_ip","192.168.1.103"],["out_key","flow"],["remote_ip","192.168.1.102"]]],"ofport":2},{"options":["map",[["in_key","flow"],["local_ip","192.168.1.103"],["out_key","flow"],["remote_ip","192.168.1.104"]]],"ofport":4}]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-ofctl add-flow br-tun table=21,priority=1,dl_vlan=3,actions=strip_vlan,set_tunnel:103,output:3,output:2
[DEBUG] module:ovsdb,function:_send,router:openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN","row":{},"op":"insert"}],"method":"transact","id":165230}
... JSON-RPC response ...
{"id":165230,"result":[{"uuid":["uuid","9483bbc6-df08-4375-8c85-4f394640111a"]},{"error":"constraint violation","details":"transaction causes \"NLAN\" table to contain 2 rows, greater than the schema-defined limit of 1 row(s)"}],"error":null}
[DEBUG] module:ovsdb,function:_send,router:openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","where":[["vni","==",103]],"op":"select"}],"method":"transact","id":230723}
... JSON-RPC response ...
{"id":230723,"result":[{"rows":[]}],"error":null}
[DEBUG] module:ovsdb,function:crud,router:openwrt3
CRUD operation (add): {'ip_dvr': '10.0.3.1/24', 'ip_vhost': '10.0.3.103/24', 'peers': ['192.168.1.101', '192.168.1.102'], 'vid': 3, 'vni': 103}
[DEBUG] module:ovsdb,function:_send,router:openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","uuid-name":"temp_351032","row":{"ip_dvr":"10.0.3.1/24","ip_vhost":"10.0.3.103/24","peers":["set",["192.168.1.101","192.168.1.102"]],"vid":3,"vni":103},"op":"insert"},{"table":"NLAN","where":[],"mutations":[["subnets","insert",["set",[["named-uuid","temp_351032"]]]]],"op":"mutate"}],"method":"transact","id":261442}
... JSON-RPC response ...
{"id":261442,"result":[{"uuid":["uuid","b9e3151f-d839-4c33-b95e-74a480647f8c"]},{"count":1}],"error":null}
[DEBUG] module:ovsdb,function:_send,router:openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","where":[["vni","==",103]],"op":"select"}],"method":"transact","id":949732}
... JSON-RPC response ...
{"id":949732,"result":[{"rows":[{"peers":["set",["192.168.1.101","192.168.1.102"]],"_version":["uuid","70031267-9a92-4493-bdc6-d289f0b773dc"],"vni":103,"ports":["set",[]],"mode":["set",[]],"vid":3,"_uuid":["uuid","b9e3151f-d839-4c33-b95e-74a480647f8c"],"default_gw":["set",[]],"ip_vhost":"10.0.3.103/24","ip_dvr":"10.0.3.1/24"}]}],"error":null}
[INFO] module:nlan_agent,function:_route,router:openwrt3
function:subnets.add, index:('vni', 101), model:{'peers': ['192.168.1.102', '192.168.1.104'], 'vid': 1, 'ip_vhost': '10.0.1.103/24', 'vni': 101, 'ip_dvr': '10.0.1.1/24', 'mode': 'spoke_dvr'}
[INFO] module:subnets,function:_crud,router:openwrt3
Adding a subnet(vlan): 1
[DEBUG] module:ovsdb,function:_send,router:openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN","row":{},"op":"insert"}],"method":"transact","id":182533}
... JSON-RPC response ...
{"id":182533,"result":[{"uuid":["uuid","fa12bb31-6c52-4a29-bdd5-36aa5215eafa"]},{"error":"constraint violation","details":"transaction causes \"NLAN\" table to contain 2 rows, greater than the schema-defined limit of 1 row(s)"}],"error":null}
[DEBUG] module:ovsdb,function:_send,router:openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","where":[["vni","==",101]],"op":"select"}],"method":"transact","id":122912}
... JSON-RPC response ...
{"id":122912,"result":[{"rows":[]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip netns add ns1
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: brctl addbr br1
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip link add veth-ns1 type veth peer name temp-ns1
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip link set dev temp-ns1 netns ns1
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip netns exec ns1 ip link set dev temp-ns1 name eth0
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-vsctl add-port br-int int-br1 tag=1 -- set interface int-br1 type=internal
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-vsctl add-port br-int int-dvr1 tag=1 -- set interface int-dvr1 type=internal
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: brctl addif br1 veth-ns1
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: brctl addif br1 int-br1
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip link set dev veth-ns1 promisc on
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip link set dev veth-ns1 up
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip netns exec ns1 ip link set dev eth0 up
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip link set dev int-br1 promisc on
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip link set dev int-br1 up
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip link set dev int-dvr1 up
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip link set dev br1 up
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip netns exec ns1 ip addr add dev eth0 10.0.1.103/24
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip addr add dev int-dvr1 10.0.1.1/24
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip netns exec ns1 ip route add default via 10.0.1.1 dev eth0
[DEBUG] module:ovsdb,function:_send,router:openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"Controller","where":[],"columns":["target"],"op":"select"}],"method":"transact","id":922907}
... JSON-RPC response ...
{"id":922907,"result":[{"rows":[]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-ofctl add-flow br-tun table=2,priority=1,tun_id=101,actions=mod_vlan_vid:1,resubmit(,10)
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip link show dev int-dvr1
[DEBUG] module:ovsdb,function:_send,router:openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"Interface","where":[["name","==","int-dvr1"]],"op":"select"}],"method":"transact","id":354770}
... JSON-RPC response ...
{"id":354770,"result":[{"rows":[{"options":["map",[]],"mtu":1500,"link_speed":["set",[]],"statistics":["map",[["collisions",0],["rx_bytes",0],["rx_crc_err",0],["rx_dropped",0],["rx_errors",0],["rx_frame_err",0],["rx_over_err",0],["rx_packets",0],["tx_bytes",0],["tx_dropped",0],["tx_errors",0],["tx_packets",0]]],"mac_in_use":"a6:d5:eb:ba:b9:38","ingress_policing_rate":0,"ofport":7,"mac":["set",[]],"cfm_fault_status":["set",[]],"duplex":["set",[]],"lacp_current":["set",[]],"cfm_fault":["set",[]],"link_state":"up","external_ids":["map",[]],"bfd_status":["map",[]],"link_resets":2,"name":"int-dvr1","type":"internal","cfm_remote_opstate":["set",[]],"_uuid":["uuid","a9896684-4fb9-4aef-ab2a-c3bd9d26b756"],"status":["map",[["driver_name","openvswitch"]]],"ifindex":71,"_version":["uuid","4d705705-001d-4eed-be34-0cd83ae3cbec"],"other_config":["map",[]],"admin_state":"up","cfm_remote_mpids":["set",[]],"cfm_mpid":["set",[]],"bfd":["map",[]],"ofport_request":["set",[]],"ingress_policing_burst":0,"cfm_flap_count":["set",[]],"cfm_health":["set",[]]}]}],"error":null}
[DEBUG] module:ovsdb,function:_send,router:openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"Interface","where":[["name","==","int-br1"]],"op":"select"}],"method":"transact","id":72026}
... JSON-RPC response ...
{"id":72026,"result":[{"rows":[{"options":["map",[]],"mtu":1500,"link_speed":["set",[]],"statistics":["map",[["collisions",0],["rx_bytes",0],["rx_crc_err",0],["rx_dropped",0],["rx_errors",0],["rx_frame_err",0],["rx_over_err",0],["rx_packets",0],["tx_bytes",0],["tx_dropped",0],["tx_errors",0],["tx_packets",0]]],"mac_in_use":"fa:db:82:1a:52:8b","ingress_policing_rate":0,"ofport":6,"mac":["set",[]],"cfm_fault_status":["set",[]],"duplex":["set",[]],"lacp_current":["set",[]],"cfm_fault":["set",[]],"link_state":"up","external_ids":["map",[]],"bfd_status":["map",[]],"link_resets":2,"name":"int-br1","type":"internal","cfm_remote_opstate":["set",[]],"_uuid":["uuid","7feae963-0e54-4091-8a14-4ab3300f5283"],"status":["map",[["driver_name","openvswitch"]]],"ifindex":70,"_version":["uuid","159e46b9-2c76-4251-a44c-064daa8a3c61"],"other_config":["map",[]],"admin_state":"up","cfm_remote_mpids":["set",[]],"cfm_mpid":["set",[]],"bfd":["map",[]],"ofport_request":["set",[]],"ingress_policing_burst":0,"cfm_flap_count":["set",[]],"cfm_health":["set",[]]}]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-ofctl add-flow br-int table=0,priority=2,in_port=6,dl_type=0x0800,nw_dst=10.0.1.0/24,actions=normal
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-ofctl add-flow br-int table=0,priority=1,in_port=6,dl_type=0x0800,nw_dst=10.0.0.0/8,actions=resubmit(,1)
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-ofctl add-flow br-int table=0,priority=1,in_port=6,dl_type=0x0800,nw_dst=172.16.0.0/12,actions=resubmit(,1)
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-ofctl add-flow br-int table=0,priority=1,in_port=6,dl_type=0x0800,nw_dst=192.168.0.0/16,actions=resubmit(,1)
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-ofctl add-flow br-int table=0,priority=1,in_port=7,dl_type=0x0806,nw_src=10.0.1.1,nw_proto=2,actions=drop
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-ofctl add-flow br-int table=1,priority=0,actions=set_field:a6:d5:eb:ba:b9:38->dl_dst,output:7
[DEBUG] module:ovsdb,function:_send,router:openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"Interface","where":[["type","==","vxlan"]],"columns":["ofport","options"],"op":"select"}],"method":"transact","id":481607}
... JSON-RPC response ...
{"id":481607,"result":[{"rows":[{"options":["map",[["in_key","flow"],["local_ip","192.168.1.103"],["out_key","flow"],["remote_ip","192.168.1.101"]]],"ofport":3},{"options":["map",[["in_key","flow"],["local_ip","192.168.1.103"],["out_key","flow"],["remote_ip","192.168.1.102"]]],"ofport":2},{"options":["map",[["in_key","flow"],["local_ip","192.168.1.103"],["out_key","flow"],["remote_ip","192.168.1.104"]]],"ofport":4}]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-ofctl add-flow br-tun table=21,priority=1,dl_vlan=1,actions=strip_vlan,set_tunnel:101,output:2,output:4
[DEBUG] module:ovsdb,function:_send,router:openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN","row":{},"op":"insert"}],"method":"transact","id":97065}
... JSON-RPC response ...
{"id":97065,"result":[{"uuid":["uuid","0cacf16e-f501-4e61-a7f8-7e3860e2684a"]},{"error":"constraint violation","details":"transaction causes \"NLAN\" table to contain 2 rows, greater than the schema-defined limit of 1 row(s)"}],"error":null}
[DEBUG] module:ovsdb,function:_send,router:openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","where":[["vni","==",101]],"op":"select"}],"method":"transact","id":919000}
... JSON-RPC response ...
{"id":919000,"result":[{"rows":[]}],"error":null}
[DEBUG] module:ovsdb,function:crud,router:openwrt3
CRUD operation (add): {'peers': ['192.168.1.102', '192.168.1.104'], 'vid': 1, 'ip_vhost': '10.0.1.103/24', 'vni': 101, 'ip_dvr': '10.0.1.1/24', 'mode': 'spoke_dvr'}
[DEBUG] module:ovsdb,function:_send,router:openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","uuid-name":"temp_755239","row":{"peers":["set",["192.168.1.102","192.168.1.104"]],"vid":1,"ip_vhost":"10.0.1.103/24","vni":101,"ip_dvr":"10.0.1.1/24","mode":"spoke_dvr"},"op":"insert"},{"table":"NLAN","where":[],"mutations":[["subnets","insert",["set",[["named-uuid","temp_755239"]]]]],"op":"mutate"}],"method":"transact","id":713261}
... JSON-RPC response ...
{"id":713261,"result":[{"uuid":["uuid","d69f0fd8-7aa4-417d-b79b-15e6ca7e3f31"]},{"count":1}],"error":null}
[DEBUG] module:ovsdb,function:_send,router:openwrt3
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","where":[["vni","==",101]],"op":"select"}],"method":"transact","id":427442}
... JSON-RPC response ...
{"id":427442,"result":[{"rows":[{"peers":["set",["192.168.1.102","192.168.1.104"]],"_version":["uuid","4a5c2682-7116-4a42-b67a-19083c8fbca3"],"vni":101,"ports":["set",[]],"mode":"spoke_dvr","vid":1,"_uuid":["uuid","d69f0fd8-7aa4-417d-b79b-15e6ca7e3f31"],"default_gw":["set",[]],"ip_vhost":"10.0.1.103/24","ip_dvr":"10.0.1.1/24"}]}],"error":null}
__ NLAN response __
message:Execution completed
exit:0
=+=+= NLAN Response from router:openwrt2,platform:openwrt =+=+=+=+=+=+=+=+=+=+
[INFO] module:nlan_agent,function:<module>,router:openwrt2
NLAN Agent initialization completed
{'mod_dir': ['command', 'config'], 'etc_dir': '/opt/nlan/etc', 'state_order': ['bridges', 'services', 'gateway', 'vxlan', 'subnets'], 'types': {'services': {'name': {'max': 1, 'key': {'type': 'string'}, 'min': 1}, 'chain': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}}, 'bridges': {'controller': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'ovs_bridges': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}, 'gateway': {'network': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'rip': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}, 'vxlan': {'remote_ips': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}, 'local_ip': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}, 'subnets': {'ip_dvr': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'peers': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}, 'vni': {'max': 1, 'key': {'minInteger': 0, 'maxInteger': 16777215, 'type': 'integer'}, 'min': 1}, 'vid': {'max': 1, 'key': {'minInteger': 0, 'maxInteger': 4095, 'type': 'integer'}, 'min': 0}, 'ip_vhost': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'ports': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}, 'default_gw': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'mode': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}}, 'tables': {'services': {'max': 'unlimited', 'key': {'type': 'uuid', 'refTable': 'NLAN_Service'}, 'min': 0}, 'bridges': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_Bridges'}, 'min': 0}, 'gateway': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_Gateway'}, 'min': 0}, 'vxlan': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_VXLAN'}, 'min': 0}, 'subnets': {'max': 'unlimited', 'key': {'type': 'uuid', 'refTable': 'NLAN_Subnet'}, 'min': 0}}, 'agent_dir': '/opt/nlan', 'indexes': {'services': 'name', 'subnets': 'vni'}, 'platform': 'openwrt', 'init': False, 'router': 'openwrt2', 'logger': <logging.Logger object at 0xb755f16c>, 'schema': 'ovsdb_nlan.schema'}
[INFO] module:nlan_agent,function:_route,router:openwrt2
function:bridges.add, model:{'ovs_bridges': 'enabled'}
[INFO] module:bridges,function:add,router:openwrt2
Adding bridges: br-int and br-tun
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-vsctl add-br br-int
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-vsctl add-br br-tun
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-ofctl del-flows br-tun
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-vsctl add-port br-int patch-int -- set interface patch-int type=patch options:peer=patch-tun
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-vsctl add-port br-tun patch-tun -- set interface patch-tun type=patch options:peer=patch-int
[DEBUG] module:ovsdb,function:_send,router:openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"Interface","where":[["name","==","patch-tun"]],"op":"select"}],"method":"transact","id":580623}
... JSON-RPC response ...
{"id":580623,"result":[{"rows":[{"options":["map",[["peer","patch-int"]]],"mtu":["set",[]],"link_speed":["set",[]],"statistics":["map",[["collisions",0],["rx_bytes",0],["rx_crc_err",0],["rx_dropped",0],["rx_errors",0],["rx_frame_err",0],["rx_over_err",0],["rx_packets",0],["tx_bytes",0],["tx_dropped",0],["tx_errors",0],["tx_packets",0]]],"mac_in_use":"1a:56:4b:bf:7d:87","ingress_policing_rate":0,"ofport":1,"mac":["set",[]],"cfm_fault_status":["set",[]],"duplex":["set",[]],"lacp_current":["set",[]],"cfm_fault":["set",[]],"link_state":["set",[]],"external_ids":["map",[]],"bfd_status":["map",[]],"link_resets":["set",[]],"name":"patch-tun","type":"patch","cfm_remote_opstate":["set",[]],"_uuid":["uuid","3025baf9-bc72-46c7-b65f-612c18d83559"],"status":["map",[]],"ifindex":0,"_version":["uuid","8f3712e9-479d-4f92-8269-dfbe0cfe5c94"],"other_config":["map",[]],"admin_state":["set",[]],"cfm_remote_mpids":["set",[]],"cfm_mpid":["set",[]],"bfd":["map",[]],"ofport_request":["set",[]],"ingress_policing_burst":0,"cfm_flap_count":["set",[]],"cfm_health":["set",[]]}]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-ofctl del-flows br-tun
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-ofctl add-flow br-tun table=0,priority=1,in_port=1,actions=resubmit(,1)
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-ofctl add-flow br-tun table=0,priority=0,actions=drop
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-ofctl add-flow br-tun table=1,priority=0,dl_dst=01:00:00:00:00:00/01:00:00:00:00:00,actions=resubmit(,19)
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-ofctl add-flow br-tun table=1,priority=0,dl_dst=00:00:00:00:00:00/01:00:00:00:00:00,actions=resubmit(,20)
[DEBUG] module:ovsdb,function:_send,router:openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"Interface","where":[["name","==","patch-tun"]],"op":"select"}],"method":"transact","id":721224}
... JSON-RPC response ...
{"id":721224,"result":[{"rows":[{"options":["map",[["peer","patch-int"]]],"mtu":["set",[]],"link_speed":["set",[]],"statistics":["map",[["collisions",0],["rx_bytes",0],["rx_crc_err",0],["rx_dropped",0],["rx_errors",0],["rx_frame_err",0],["rx_over_err",0],["rx_packets",0],["tx_bytes",0],["tx_dropped",0],["tx_errors",0],["tx_packets",0]]],"mac_in_use":"1a:56:4b:bf:7d:87","ingress_policing_rate":0,"ofport":1,"mac":["set",[]],"cfm_fault_status":["set",[]],"duplex":["set",[]],"lacp_current":["set",[]],"cfm_fault":["set",[]],"link_state":"up","external_ids":["map",[]],"bfd_status":["map",[]],"link_resets":0,"name":"patch-tun","type":"patch","cfm_remote_opstate":["set",[]],"_uuid":["uuid","3025baf9-bc72-46c7-b65f-612c18d83559"],"status":["map",[]],"ifindex":0,"_version":["uuid","15e3d496-37e1-4513-ace8-ed1c504dc99b"],"other_config":["map",[]],"admin_state":"up","cfm_remote_mpids":["set",[]],"cfm_mpid":["set",[]],"bfd":["map",[]],"ofport_request":["set",[]],"ingress_policing_burst":0,"cfm_flap_count":["set",[]],"cfm_health":["set",[]]}]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-ofctl add-flow br-tun table=2,priority=0,actions=drop
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-ofctl add-flow br-tun table=3,priority=0,actions=drop
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-ofctl add-flow br-tun table=10,priority=1,actions=learn(table=20,hard_timeout=300,priority=1,NXM_OF_VLAN_TCI[0..11],NXM_OF_ETH_DST[]=NXM_OF_ETH_SRC[],load:0->NXM_OF_VLAN_TCI[],load:NXM_NX_TUN_ID[]->NXM_NX_TUN_ID[],output:NXM_OF_IN_PORT[]),output:1
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-ofctl add-flow br-tun table=19,priority=0,actions=resubmit(,21)
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-ofctl add-flow br-tun table=20,priority=0,actions=resubmit(,21)
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-ofctl add-flow br-tun table=21,priority=0,actions=drop
[DEBUG] module:ovsdb,function:_send,router:openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN","row":{},"op":"insert"}],"method":"transact","id":859991}
... JSON-RPC response ...
{"id":859991,"result":[{"uuid":["uuid","7da9ac37-2871-4502-b54d-8ca2adb648ee"]}],"error":null}
[DEBUG] module:ovsdb,function:_send,router:openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Bridges","where":[],"op":"select"}],"method":"transact","id":8060}
... JSON-RPC response ...
{"id":8060,"result":[{"rows":[]}],"error":null}
[DEBUG] module:ovsdb,function:_send,router:openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Bridges","uuid-name":"temp_9966","row":{"ovs_bridges":"enabled"},"op":"insert"},{"table":"NLAN","where":[],"mutations":[["bridges","insert",["set",[["named-uuid","temp_9966"]]]]],"op":"mutate"}],"method":"transact","id":947542}
... JSON-RPC response ...
{"id":947542,"result":[{"uuid":["uuid","c090c5b4-324a-46cd-bd35-08505e96f820"]},{"count":1}],"error":null}
[DEBUG] module:ovsdb,function:_send,router:openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Bridges","where":[],"op":"select"}],"method":"transact","id":607240}
... JSON-RPC response ...
{"id":607240,"result":[{"rows":[{"_uuid":["uuid","c090c5b4-324a-46cd-bd35-08505e96f820"],"_version":["uuid","9c3988b6-bd1c-4c9a-b09f-a5dc2dde9f07"],"ovs_bridges":"enabled","controller":["set",[]]}]}],"error":null}
[INFO] module:nlan_agent,function:_route,router:openwrt2
function:vxlan.add, model:{'remote_ips': ['192.168.1.103', '192.168.1.101', '192.168.1.104'], 'local_ip': '192.168.1.102'}
[INFO] module:vxlan,function:add,router:openwrt2
Adding a VXLAN tunnel: vxlan_103
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-vsctl add-port br-tun vxlan_103 -- set interface vxlan_103 type=vxlan options:in_key=flow options:local_ip=192.168.1.102 options:out_key=flow options:remote_ip=192.168.1.103
[INFO] module:vxlan,function:add,router:openwrt2
Adding a VXLAN tunnel: vxlan_101
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-vsctl add-port br-tun vxlan_101 -- set interface vxlan_101 type=vxlan options:in_key=flow options:local_ip=192.168.1.102 options:out_key=flow options:remote_ip=192.168.1.101
[INFO] module:vxlan,function:add,router:openwrt2
Adding a VXLAN tunnel: vxlan_104
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-vsctl add-port br-tun vxlan_104 -- set interface vxlan_104 type=vxlan options:in_key=flow options:local_ip=192.168.1.102 options:out_key=flow options:remote_ip=192.168.1.104
[DEBUG] module:ovsdb,function:_send,router:openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"Interface","where":[["type","==","vxlan"]],"columns":["ofport","options"],"op":"select"}],"method":"transact","id":153480}
... JSON-RPC response ...
{"id":153480,"result":[{"rows":[{"options":["map",[["in_key","flow"],["local_ip","192.168.1.102"],["out_key","flow"],["remote_ip","192.168.1.101"]]],"ofport":3},{"options":["map",[["in_key","flow"],["local_ip","192.168.1.102"],["out_key","flow"],["remote_ip","192.168.1.103"]]],"ofport":2},{"options":["map",[["in_key","flow"],["local_ip","192.168.1.102"],["out_key","flow"],["remote_ip","192.168.1.104"]]],"ofport":4}]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-ofctl add-flow br-tun table=0,priority=1,in_port=3,actions=resubmit(,2)
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-ofctl add-flow br-tun table=0,priority=1,in_port=2,actions=resubmit(,2)
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-ofctl add-flow br-tun table=0,priority=1,in_port=4,actions=resubmit(,2)
[DEBUG] module:ovsdb,function:_send,router:openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN","row":{},"op":"insert"}],"method":"transact","id":819730}
... JSON-RPC response ...
{"id":819730,"result":[{"uuid":["uuid","40681a92-3fc2-4bbc-9575-27f86a601e25"]},{"error":"constraint violation","details":"transaction causes \"NLAN\" table to contain 2 rows, greater than the schema-defined limit of 1 row(s)"}],"error":null}
[DEBUG] module:ovsdb,function:_send,router:openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_VXLAN","where":[],"op":"select"}],"method":"transact","id":468339}
... JSON-RPC response ...
{"id":468339,"result":[{"rows":[]}],"error":null}
[DEBUG] module:ovsdb,function:_send,router:openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_VXLAN","uuid-name":"temp_413666","row":{"remote_ips":["set",["192.168.1.103","192.168.1.101","192.168.1.104"]],"local_ip":"192.168.1.102"},"op":"insert"},{"table":"NLAN","where":[],"mutations":[["vxlan","insert",["set",[["named-uuid","temp_413666"]]]]],"op":"mutate"}],"method":"transact","id":941979}
... JSON-RPC response ...
{"id":941979,"result":[{"uuid":["uuid","89f42e5b-f2ae-4dda-beab-c70356f12f75"]},{"count":1}],"error":null}
[DEBUG] module:ovsdb,function:_send,router:openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_VXLAN","where":[],"op":"select"}],"method":"transact","id":984271}
... JSON-RPC response ...
{"id":984271,"result":[{"rows":[{"_version":["uuid","22cd5490-a365-4f50-adb0-5c2c05698a76"],"_uuid":["uuid","89f42e5b-f2ae-4dda-beab-c70356f12f75"],"local_ip":"192.168.1.102","remote_ips":["set",["192.168.1.101","192.168.1.103","192.168.1.104"]]}]}],"error":null}
[INFO] module:nlan_agent,function:_route,router:openwrt2
function:subnets.add, index:('vni', 1), model:{'peers': ['192.168.1.101', '192.168.1.103'], 'vid': 2, 'ip_vhost': '192.168.100.102/24', 'default_gw': '192.168.100.1', 'ip_dvr': '192.168.100.2/24', 'vni': 1}
[INFO] module:subnets,function:_crud,router:openwrt2
Adding a subnet(vlan): 2
[DEBUG] module:ovsdb,function:_send,router:openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN","row":{},"op":"insert"}],"method":"transact","id":115505}
... JSON-RPC response ...
{"id":115505,"result":[{"uuid":["uuid","e27c2345-cf95-4a50-9de9-310a3d607b01"]},{"error":"constraint violation","details":"transaction causes \"NLAN\" table to contain 2 rows, greater than the schema-defined limit of 1 row(s)"}],"error":null}
[DEBUG] module:ovsdb,function:_send,router:openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","where":[["vni","==",1]],"op":"select"}],"method":"transact","id":282101}
... JSON-RPC response ...
{"id":282101,"result":[{"rows":[]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip netns add ns2
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: brctl addbr br2
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip link add veth-ns2 type veth peer name temp-ns2
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip link set dev temp-ns2 netns ns2
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip netns exec ns2 ip link set dev temp-ns2 name eth0
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-vsctl add-port br-int int-br2 tag=2 -- set interface int-br2 type=internal
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-vsctl add-port br-int int-dvr2 tag=2 -- set interface int-dvr2 type=internal
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: brctl addif br2 veth-ns2
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: brctl addif br2 int-br2
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip link set dev veth-ns2 promisc on
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip link set dev veth-ns2 up
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip netns exec ns2 ip link set dev eth0 up
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip link set dev int-br2 promisc on
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip link set dev int-br2 up
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip link set dev int-dvr2 up
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip link set dev br2 up
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip netns exec ns2 ip addr add dev eth0 192.168.100.102/24
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip addr add dev int-dvr2 192.168.100.2/24
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip netns exec ns2 ip route add default via 192.168.100.2 dev eth0
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: route
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip route add default via 192.168.100.1
[DEBUG] module:ovsdb,function:_send,router:openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"Controller","where":[],"columns":["target"],"op":"select"}],"method":"transact","id":462797}
... JSON-RPC response ...
{"id":462797,"result":[{"rows":[]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-ofctl add-flow br-tun table=2,priority=1,tun_id=1,actions=mod_vlan_vid:2,resubmit(,10)
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-ofctl add-flow br-tun table=19,priority=1,dl_type=0x0806,dl_vlan=2,nw_dst=192.168.100.2,actions=drop
[DEBUG] module:ovsdb,function:_send,router:openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"Interface","where":[["type","==","vxlan"]],"columns":["ofport","options"],"op":"select"}],"method":"transact","id":311484}
... JSON-RPC response ...
{"id":311484,"result":[{"rows":[{"options":["map",[["in_key","flow"],["local_ip","192.168.1.102"],["out_key","flow"],["remote_ip","192.168.1.101"]]],"ofport":3},{"options":["map",[["in_key","flow"],["local_ip","192.168.1.102"],["out_key","flow"],["remote_ip","192.168.1.103"]]],"ofport":2},{"options":["map",[["in_key","flow"],["local_ip","192.168.1.102"],["out_key","flow"],["remote_ip","192.168.1.104"]]],"ofport":4}]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-ofctl add-flow br-tun table=21,priority=1,dl_vlan=2,actions=strip_vlan,set_tunnel:1,output:3,output:2
[DEBUG] module:ovsdb,function:_send,router:openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN","row":{},"op":"insert"}],"method":"transact","id":827405}
... JSON-RPC response ...
{"id":827405,"result":[{"uuid":["uuid","79a29138-5958-4531-a566-084f06820763"]},{"error":"constraint violation","details":"transaction causes \"NLAN\" table to contain 2 rows, greater than the schema-defined limit of 1 row(s)"}],"error":null}
[DEBUG] module:ovsdb,function:_send,router:openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","where":[["vni","==",1]],"op":"select"}],"method":"transact","id":698743}
... JSON-RPC response ...
{"id":698743,"result":[{"rows":[]}],"error":null}
[DEBUG] module:ovsdb,function:crud,router:openwrt2
CRUD operation (add): {'peers': ['192.168.1.101', '192.168.1.103'], 'vid': 2, 'ip_vhost': '192.168.100.102/24', 'default_gw': '192.168.100.1', 'ip_dvr': '192.168.100.2/24', 'vni': 1}
[DEBUG] module:ovsdb,function:_send,router:openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","uuid-name":"temp_406802","row":{"peers":["set",["192.168.1.101","192.168.1.103"]],"vid":2,"ip_vhost":"192.168.100.102/24","default_gw":"192.168.100.1","ip_dvr":"192.168.100.2/24","vni":1},"op":"insert"},{"table":"NLAN","where":[],"mutations":[["subnets","insert",["set",[["named-uuid","temp_406802"]]]]],"op":"mutate"}],"method":"transact","id":57484}
... JSON-RPC response ...
{"id":57484,"result":[{"uuid":["uuid","15063946-4f24-438d-9813-43aab02ee48c"]},{"count":1}],"error":null}
[DEBUG] module:ovsdb,function:_send,router:openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","where":[["vni","==",1]],"op":"select"}],"method":"transact","id":210777}
... JSON-RPC response ...
{"id":210777,"result":[{"rows":[{"peers":["set",["192.168.1.101","192.168.1.103"]],"_version":["uuid","0ef6314b-7841-4e71-ac84-1f1b4e55c4df"],"vni":1,"ports":["set",[]],"mode":["set",[]],"vid":2,"_uuid":["uuid","15063946-4f24-438d-9813-43aab02ee48c"],"default_gw":"192.168.100.1","ip_vhost":"192.168.100.102/24","ip_dvr":"192.168.100.2/24"}]}],"error":null}
[INFO] module:nlan_agent,function:_route,router:openwrt2
function:subnets.add, index:('vni', 103), model:{'ip_dvr': '10.0.3.1/24', 'ip_vhost': '10.0.3.102/24', 'peers': ['192.168.1.101', '192.168.1.103'], 'vid': 3, 'vni': 103}
[INFO] module:subnets,function:_crud,router:openwrt2
Adding a subnet(vlan): 3
[DEBUG] module:ovsdb,function:_send,router:openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN","row":{},"op":"insert"}],"method":"transact","id":841622}
... JSON-RPC response ...
{"id":841622,"result":[{"uuid":["uuid","2d074b26-7f67-4293-afce-e652deb14677"]},{"error":"constraint violation","details":"transaction causes \"NLAN\" table to contain 2 rows, greater than the schema-defined limit of 1 row(s)"}],"error":null}
[DEBUG] module:ovsdb,function:_send,router:openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","where":[["vni","==",103]],"op":"select"}],"method":"transact","id":39717}
... JSON-RPC response ...
{"id":39717,"result":[{"rows":[]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip netns add ns3
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: brctl addbr br3
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip link add veth-ns3 type veth peer name temp-ns3
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip link set dev temp-ns3 netns ns3
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip netns exec ns3 ip link set dev temp-ns3 name eth0
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-vsctl add-port br-int int-br3 tag=3 -- set interface int-br3 type=internal
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-vsctl add-port br-int int-dvr3 tag=3 -- set interface int-dvr3 type=internal
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: brctl addif br3 veth-ns3
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: brctl addif br3 int-br3
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip link set dev veth-ns3 promisc on
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip link set dev veth-ns3 up
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip netns exec ns3 ip link set dev eth0 up
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip link set dev int-br3 promisc on
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip link set dev int-br3 up
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip link set dev int-dvr3 up
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip link set dev br3 up
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip netns exec ns3 ip addr add dev eth0 10.0.3.102/24
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip addr add dev int-dvr3 10.0.3.1/24
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip netns exec ns3 ip route add default via 10.0.3.1 dev eth0
[DEBUG] module:ovsdb,function:_send,router:openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"Controller","where":[],"columns":["target"],"op":"select"}],"method":"transact","id":616577}
... JSON-RPC response ...
{"id":616577,"result":[{"rows":[]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-ofctl add-flow br-tun table=2,priority=1,tun_id=103,actions=mod_vlan_vid:3,resubmit(,10)
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-ofctl add-flow br-tun table=19,priority=1,dl_type=0x0806,dl_vlan=3,nw_dst=10.0.3.1,actions=drop
[DEBUG] module:ovsdb,function:_send,router:openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"Interface","where":[["type","==","vxlan"]],"columns":["ofport","options"],"op":"select"}],"method":"transact","id":16836}
... JSON-RPC response ...
{"id":16836,"result":[{"rows":[{"options":["map",[["in_key","flow"],["local_ip","192.168.1.102"],["out_key","flow"],["remote_ip","192.168.1.101"]]],"ofport":3},{"options":["map",[["in_key","flow"],["local_ip","192.168.1.102"],["out_key","flow"],["remote_ip","192.168.1.103"]]],"ofport":2},{"options":["map",[["in_key","flow"],["local_ip","192.168.1.102"],["out_key","flow"],["remote_ip","192.168.1.104"]]],"ofport":4}]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-ofctl add-flow br-tun table=21,priority=1,dl_vlan=3,actions=strip_vlan,set_tunnel:103,output:3,output:2
[DEBUG] module:ovsdb,function:_send,router:openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN","row":{},"op":"insert"}],"method":"transact","id":529925}
... JSON-RPC response ...
{"id":529925,"result":[{"uuid":["uuid","c8ae7529-9865-47f6-8217-e10b84360230"]},{"error":"constraint violation","details":"transaction causes \"NLAN\" table to contain 2 rows, greater than the schema-defined limit of 1 row(s)"}],"error":null}
[DEBUG] module:ovsdb,function:_send,router:openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","where":[["vni","==",103]],"op":"select"}],"method":"transact","id":599305}
... JSON-RPC response ...
{"id":599305,"result":[{"rows":[]}],"error":null}
[DEBUG] module:ovsdb,function:crud,router:openwrt2
CRUD operation (add): {'ip_dvr': '10.0.3.1/24', 'ip_vhost': '10.0.3.102/24', 'peers': ['192.168.1.101', '192.168.1.103'], 'vid': 3, 'vni': 103}
[DEBUG] module:ovsdb,function:_send,router:openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","uuid-name":"temp_257916","row":{"ip_dvr":"10.0.3.1/24","ip_vhost":"10.0.3.102/24","peers":["set",["192.168.1.101","192.168.1.103"]],"vid":3,"vni":103},"op":"insert"},{"table":"NLAN","where":[],"mutations":[["subnets","insert",["set",[["named-uuid","temp_257916"]]]]],"op":"mutate"}],"method":"transact","id":17299}
... JSON-RPC response ...
{"id":17299,"result":[{"uuid":["uuid","7ed7094c-efde-4a6b-808f-9683fe61a014"]},{"count":1}],"error":null}
[DEBUG] module:ovsdb,function:_send,router:openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","where":[["vni","==",103]],"op":"select"}],"method":"transact","id":344667}
... JSON-RPC response ...
{"id":344667,"result":[{"rows":[{"peers":["set",["192.168.1.101","192.168.1.103"]],"_version":["uuid","5f3d26f6-3889-4e70-a68a-2482dea5f2f8"],"vni":103,"ports":["set",[]],"mode":["set",[]],"vid":3,"_uuid":["uuid","7ed7094c-efde-4a6b-808f-9683fe61a014"],"default_gw":["set",[]],"ip_vhost":"10.0.3.102/24","ip_dvr":"10.0.3.1/24"}]}],"error":null}
[INFO] module:nlan_agent,function:_route,router:openwrt2
function:subnets.add, index:('vni', 101), model:{'peers': ['192.168.1.103', '192.168.1.104'], 'vid': 1, 'ip_vhost': '10.0.1.102/24', 'vni': 101, 'ip_dvr': '10.0.1.1/24', 'mode': 'spoke_dvr'}
[INFO] module:subnets,function:_crud,router:openwrt2
Adding a subnet(vlan): 1
[DEBUG] module:ovsdb,function:_send,router:openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN","row":{},"op":"insert"}],"method":"transact","id":144416}
... JSON-RPC response ...
{"id":144416,"result":[{"uuid":["uuid","bd67a430-60dd-4d6d-b0f6-e310427b7d01"]},{"error":"constraint violation","details":"transaction causes \"NLAN\" table to contain 2 rows, greater than the schema-defined limit of 1 row(s)"}],"error":null}
[DEBUG] module:ovsdb,function:_send,router:openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","where":[["vni","==",101]],"op":"select"}],"method":"transact","id":530490}
... JSON-RPC response ...
{"id":530490,"result":[{"rows":[]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip netns add ns1
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: brctl addbr br1
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip link add veth-ns1 type veth peer name temp-ns1
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip link set dev temp-ns1 netns ns1
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip netns exec ns1 ip link set dev temp-ns1 name eth0
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-vsctl add-port br-int int-br1 tag=1 -- set interface int-br1 type=internal
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-vsctl add-port br-int int-dvr1 tag=1 -- set interface int-dvr1 type=internal
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: brctl addif br1 veth-ns1
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: brctl addif br1 int-br1
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip link set dev veth-ns1 promisc on
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip link set dev veth-ns1 up
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip netns exec ns1 ip link set dev eth0 up
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip link set dev int-br1 promisc on
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip link set dev int-br1 up
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip link set dev int-dvr1 up
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip link set dev br1 up
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip netns exec ns1 ip addr add dev eth0 10.0.1.102/24
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip addr add dev int-dvr1 10.0.1.1/24
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip netns exec ns1 ip route add default via 10.0.1.1 dev eth0
[DEBUG] module:ovsdb,function:_send,router:openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"Controller","where":[],"columns":["target"],"op":"select"}],"method":"transact","id":438187}
... JSON-RPC response ...
{"id":438187,"result":[{"rows":[]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-ofctl add-flow br-tun table=2,priority=1,tun_id=101,actions=mod_vlan_vid:1,resubmit(,10)
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip link show dev int-dvr1
[DEBUG] module:ovsdb,function:_send,router:openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"Interface","where":[["name","==","int-dvr1"]],"op":"select"}],"method":"transact","id":987742}
... JSON-RPC response ...
{"id":987742,"result":[{"rows":[{"options":["map",[]],"mtu":1500,"link_speed":["set",[]],"statistics":["map",[["collisions",0],["rx_bytes",0],["rx_crc_err",0],["rx_dropped",0],["rx_errors",0],["rx_frame_err",0],["rx_over_err",0],["rx_packets",0],["tx_bytes",0],["tx_dropped",0],["tx_errors",0],["tx_packets",0]]],"mac_in_use":"b2:54:6d:55:42:eb","ingress_policing_rate":0,"ofport":7,"mac":["set",[]],"cfm_fault_status":["set",[]],"duplex":["set",[]],"lacp_current":["set",[]],"cfm_fault":["set",[]],"link_state":"up","external_ids":["map",[]],"bfd_status":["map",[]],"link_resets":2,"name":"int-dvr1","type":"internal","cfm_remote_opstate":["set",[]],"_uuid":["uuid","a7ebb34d-a7f6-4da3-9370-821d1a8da4d7"],"status":["map",[["driver_name","openvswitch"]]],"ifindex":71,"_version":["uuid","63e3df8d-6e37-4f9c-aecb-a64bb9bb519b"],"other_config":["map",[]],"admin_state":"up","cfm_remote_mpids":["set",[]],"cfm_mpid":["set",[]],"bfd":["map",[]],"ofport_request":["set",[]],"ingress_policing_burst":0,"cfm_flap_count":["set",[]],"cfm_health":["set",[]]}]}],"error":null}
[DEBUG] module:ovsdb,function:_send,router:openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"Interface","where":[["name","==","int-br1"]],"op":"select"}],"method":"transact","id":682097}
... JSON-RPC response ...
{"id":682097,"result":[{"rows":[{"options":["map",[]],"mtu":1500,"link_speed":["set",[]],"statistics":["map",[["collisions",0],["rx_bytes",0],["rx_crc_err",0],["rx_dropped",0],["rx_errors",0],["rx_frame_err",0],["rx_over_err",0],["rx_packets",0],["tx_bytes",0],["tx_dropped",0],["tx_errors",0],["tx_packets",0]]],"mac_in_use":"5e:1b:38:43:b3:ca","ingress_policing_rate":0,"ofport":6,"mac":["set",[]],"cfm_fault_status":["set",[]],"duplex":["set",[]],"lacp_current":["set",[]],"cfm_fault":["set",[]],"link_state":"up","external_ids":["map",[]],"bfd_status":["map",[]],"link_resets":2,"name":"int-br1","type":"internal","cfm_remote_opstate":["set",[]],"_uuid":["uuid","f62f820f-7b59-4389-856f-18ece475beee"],"status":["map",[["driver_name","openvswitch"]]],"ifindex":70,"_version":["uuid","c218e7ec-487a-4625-9562-e9178242ce5c"],"other_config":["map",[]],"admin_state":"up","cfm_remote_mpids":["set",[]],"cfm_mpid":["set",[]],"bfd":["map",[]],"ofport_request":["set",[]],"ingress_policing_burst":0,"cfm_flap_count":["set",[]],"cfm_health":["set",[]]}]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-ofctl add-flow br-int table=0,priority=2,in_port=6,dl_type=0x0800,nw_dst=10.0.1.0/24,actions=normal
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-ofctl add-flow br-int table=0,priority=1,in_port=6,dl_type=0x0800,nw_dst=10.0.0.0/8,actions=resubmit(,1)
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-ofctl add-flow br-int table=0,priority=1,in_port=6,dl_type=0x0800,nw_dst=172.16.0.0/12,actions=resubmit(,1)
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-ofctl add-flow br-int table=0,priority=1,in_port=6,dl_type=0x0800,nw_dst=192.168.0.0/16,actions=resubmit(,1)
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-ofctl add-flow br-int table=0,priority=1,in_port=7,dl_type=0x0806,nw_src=10.0.1.1,nw_proto=2,actions=drop
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-ofctl add-flow br-int table=1,priority=0,actions=set_field:b2:54:6d:55:42:eb->dl_dst,output:7
[DEBUG] module:ovsdb,function:_send,router:openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"Interface","where":[["type","==","vxlan"]],"columns":["ofport","options"],"op":"select"}],"method":"transact","id":426745}
... JSON-RPC response ...
{"id":426745,"result":[{"rows":[{"options":["map",[["in_key","flow"],["local_ip","192.168.1.102"],["out_key","flow"],["remote_ip","192.168.1.101"]]],"ofport":3},{"options":["map",[["in_key","flow"],["local_ip","192.168.1.102"],["out_key","flow"],["remote_ip","192.168.1.103"]]],"ofport":2},{"options":["map",[["in_key","flow"],["local_ip","192.168.1.102"],["out_key","flow"],["remote_ip","192.168.1.104"]]],"ofport":4}]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-ofctl add-flow br-tun table=21,priority=1,dl_vlan=1,actions=strip_vlan,set_tunnel:101,output:2,output:4
[DEBUG] module:ovsdb,function:_send,router:openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN","row":{},"op":"insert"}],"method":"transact","id":598635}
... JSON-RPC response ...
{"id":598635,"result":[{"uuid":["uuid","8582395c-b20e-4c1a-a4b5-dbb2c81131ca"]},{"error":"constraint violation","details":"transaction causes \"NLAN\" table to contain 2 rows, greater than the schema-defined limit of 1 row(s)"}],"error":null}
[DEBUG] module:ovsdb,function:_send,router:openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","where":[["vni","==",101]],"op":"select"}],"method":"transact","id":985240}
... JSON-RPC response ...
{"id":985240,"result":[{"rows":[]}],"error":null}
[DEBUG] module:ovsdb,function:crud,router:openwrt2
CRUD operation (add): {'peers': ['192.168.1.103', '192.168.1.104'], 'vid': 1, 'ip_vhost': '10.0.1.102/24', 'vni': 101, 'ip_dvr': '10.0.1.1/24', 'mode': 'spoke_dvr'}
[DEBUG] module:ovsdb,function:_send,router:openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","uuid-name":"temp_235456","row":{"peers":["set",["192.168.1.103","192.168.1.104"]],"vid":1,"ip_vhost":"10.0.1.102/24","vni":101,"ip_dvr":"10.0.1.1/24","mode":"spoke_dvr"},"op":"insert"},{"table":"NLAN","where":[],"mutations":[["subnets","insert",["set",[["named-uuid","temp_235456"]]]]],"op":"mutate"}],"method":"transact","id":423554}
... JSON-RPC response ...
{"id":423554,"result":[{"uuid":["uuid","59edbaec-552e-44dc-bc9d-ff3212a72077"]},{"count":1}],"error":null}
[DEBUG] module:ovsdb,function:_send,router:openwrt2
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","where":[["vni","==",101]],"op":"select"}],"method":"transact","id":196685}
... JSON-RPC response ...
{"id":196685,"result":[{"rows":[{"peers":["set",["192.168.1.103","192.168.1.104"]],"_version":["uuid","1611ec34-cce0-4436-b437-61e4a2ed35a4"],"vni":101,"ports":["set",[]],"mode":"spoke_dvr","vid":1,"_uuid":["uuid","59edbaec-552e-44dc-bc9d-ff3212a72077"],"default_gw":["set",[]],"ip_vhost":"10.0.1.102/24","ip_dvr":"10.0.1.1/24"}]}],"error":null}
__ NLAN response __
message:Execution completed
exit:0
=+=+= NLAN Response from router:openwrt1,platform:openwrt =+=+=+=+=+=+=+=+=+=+
[INFO] module:nlan_agent,function:<module>,router:openwrt1
NLAN Agent initialization completed
{'mod_dir': ['command', 'config'], 'etc_dir': '/opt/nlan/etc', 'state_order': ['bridges', 'services', 'gateway', 'vxlan', 'subnets'], 'types': {'services': {'name': {'max': 1, 'key': {'type': 'string'}, 'min': 1}, 'chain': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}}, 'bridges': {'controller': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'ovs_bridges': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}, 'gateway': {'network': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'rip': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}, 'vxlan': {'remote_ips': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}, 'local_ip': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}, 'subnets': {'ip_dvr': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'peers': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}, 'vni': {'max': 1, 'key': {'minInteger': 0, 'maxInteger': 16777215, 'type': 'integer'}, 'min': 1}, 'vid': {'max': 1, 'key': {'minInteger': 0, 'maxInteger': 4095, 'type': 'integer'}, 'min': 0}, 'ip_vhost': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'ports': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}, 'default_gw': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'mode': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}}, 'tables': {'services': {'max': 'unlimited', 'key': {'type': 'uuid', 'refTable': 'NLAN_Service'}, 'min': 0}, 'bridges': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_Bridges'}, 'min': 0}, 'gateway': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_Gateway'}, 'min': 0}, 'vxlan': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_VXLAN'}, 'min': 0}, 'subnets': {'max': 'unlimited', 'key': {'type': 'uuid', 'refTable': 'NLAN_Subnet'}, 'min': 0}}, 'agent_dir': '/opt/nlan', 'indexes': {'services': 'name', 'subnets': 'vni'}, 'platform': 'openwrt', 'init': False, 'router': 'openwrt1', 'logger': <logging.Logger object at 0xb75a916c>, 'schema': 'ovsdb_nlan.schema'}
[INFO] module:nlan_agent,function:_route,router:openwrt1
function:bridges.add, model:{'ovs_bridges': 'enabled'}
[INFO] module:bridges,function:add,router:openwrt1
Adding bridges: br-int and br-tun
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-vsctl add-br br-int
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-vsctl add-br br-tun
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-ofctl del-flows br-tun
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-vsctl add-port br-int patch-int -- set interface patch-int type=patch options:peer=patch-tun
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-vsctl add-port br-tun patch-tun -- set interface patch-tun type=patch options:peer=patch-int
[DEBUG] module:ovsdb,function:_send,router:openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"Interface","where":[["name","==","patch-tun"]],"op":"select"}],"method":"transact","id":477879}
... JSON-RPC response ...
{"id":477879,"result":[{"rows":[{"options":["map",[["peer","patch-int"]]],"mtu":["set",[]],"link_speed":["set",[]],"statistics":["map",[["collisions",0],["rx_bytes",0],["rx_crc_err",0],["rx_dropped",0],["rx_errors",0],["rx_frame_err",0],["rx_over_err",0],["rx_packets",0],["tx_bytes",0],["tx_dropped",0],["tx_errors",0],["tx_packets",0]]],"mac_in_use":"f6:14:5e:4f:f7:f0","ingress_policing_rate":0,"ofport":1,"mac":["set",[]],"cfm_fault_status":["set",[]],"duplex":["set",[]],"lacp_current":["set",[]],"cfm_fault":["set",[]],"link_state":["set",[]],"external_ids":["map",[]],"bfd_status":["map",[]],"link_resets":["set",[]],"name":"patch-tun","type":"patch","cfm_remote_opstate":["set",[]],"_uuid":["uuid","030621f3-d1f2-44d8-a877-bcd7139a0562"],"status":["map",[]],"ifindex":0,"_version":["uuid","328eaffe-d7e7-47a6-8cac-356e963c880f"],"other_config":["map",[]],"admin_state":["set",[]],"cfm_remote_mpids":["set",[]],"cfm_mpid":["set",[]],"bfd":["map",[]],"ofport_request":["set",[]],"ingress_policing_burst":0,"cfm_flap_count":["set",[]],"cfm_health":["set",[]]}]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-ofctl del-flows br-tun
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-ofctl add-flow br-tun table=0,priority=1,in_port=1,actions=resubmit(,1)
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-ofctl add-flow br-tun table=0,priority=0,actions=drop
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-ofctl add-flow br-tun table=1,priority=0,dl_dst=01:00:00:00:00:00/01:00:00:00:00:00,actions=resubmit(,19)
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-ofctl add-flow br-tun table=1,priority=0,dl_dst=00:00:00:00:00:00/01:00:00:00:00:00,actions=resubmit(,20)
[DEBUG] module:ovsdb,function:_send,router:openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"Interface","where":[["name","==","patch-tun"]],"op":"select"}],"method":"transact","id":939756}
... JSON-RPC response ...
{"id":939756,"result":[{"rows":[{"options":["map",[["peer","patch-int"]]],"mtu":["set",[]],"link_speed":["set",[]],"statistics":["map",[["collisions",0],["rx_bytes",0],["rx_crc_err",0],["rx_dropped",0],["rx_errors",0],["rx_frame_err",0],["rx_over_err",0],["rx_packets",0],["tx_bytes",0],["tx_dropped",0],["tx_errors",0],["tx_packets",0]]],"mac_in_use":"f6:14:5e:4f:f7:f0","ingress_policing_rate":0,"ofport":1,"mac":["set",[]],"cfm_fault_status":["set",[]],"duplex":["set",[]],"lacp_current":["set",[]],"cfm_fault":["set",[]],"link_state":"up","external_ids":["map",[]],"bfd_status":["map",[]],"link_resets":0,"name":"patch-tun","type":"patch","cfm_remote_opstate":["set",[]],"_uuid":["uuid","030621f3-d1f2-44d8-a877-bcd7139a0562"],"status":["map",[]],"ifindex":0,"_version":["uuid","be3afde6-8b05-45c0-a6cb-31416602fd77"],"other_config":["map",[]],"admin_state":"up","cfm_remote_mpids":["set",[]],"cfm_mpid":["set",[]],"bfd":["map",[]],"ofport_request":["set",[]],"ingress_policing_burst":0,"cfm_flap_count":["set",[]],"cfm_health":["set",[]]}]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-ofctl add-flow br-tun table=2,priority=0,actions=drop
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-ofctl add-flow br-tun table=3,priority=0,actions=drop
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-ofctl add-flow br-tun table=10,priority=1,actions=learn(table=20,hard_timeout=300,priority=1,NXM_OF_VLAN_TCI[0..11],NXM_OF_ETH_DST[]=NXM_OF_ETH_SRC[],load:0->NXM_OF_VLAN_TCI[],load:NXM_NX_TUN_ID[]->NXM_NX_TUN_ID[],output:NXM_OF_IN_PORT[]),output:1
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-ofctl add-flow br-tun table=19,priority=0,actions=resubmit(,21)
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-ofctl add-flow br-tun table=20,priority=0,actions=resubmit(,21)
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-ofctl add-flow br-tun table=21,priority=0,actions=drop
[DEBUG] module:ovsdb,function:_send,router:openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN","row":{},"op":"insert"}],"method":"transact","id":817070}
... JSON-RPC response ...
{"id":817070,"result":[{"uuid":["uuid","274c994e-8266-4af1-b4ed-b393b6c8d070"]}],"error":null}
[DEBUG] module:ovsdb,function:_send,router:openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Bridges","where":[],"op":"select"}],"method":"transact","id":271213}
... JSON-RPC response ...
{"id":271213,"result":[{"rows":[]}],"error":null}
[DEBUG] module:ovsdb,function:_send,router:openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Bridges","uuid-name":"temp_871363","row":{"ovs_bridges":"enabled"},"op":"insert"},{"table":"NLAN","where":[],"mutations":[["bridges","insert",["set",[["named-uuid","temp_871363"]]]]],"op":"mutate"}],"method":"transact","id":647395}
... JSON-RPC response ...
{"id":647395,"result":[{"uuid":["uuid","70e06e76-c8b6-49b6-979f-7b90547adc2c"]},{"count":1}],"error":null}
[DEBUG] module:ovsdb,function:_send,router:openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Bridges","where":[],"op":"select"}],"method":"transact","id":15767}
... JSON-RPC response ...
{"id":15767,"result":[{"rows":[{"_uuid":["uuid","70e06e76-c8b6-49b6-979f-7b90547adc2c"],"_version":["uuid","86c379b0-a3ca-435a-9a39-847bf217178d"],"ovs_bridges":"enabled","controller":["set",[]]}]}],"error":null}
[INFO] module:nlan_agent,function:_route,router:openwrt1
function:gateway.add, model:{'network': 'eth2', 'rip': 'enabled'}
[INFO] module:gateway,function:add,router:openwrt1
Adding a gateway router: rip
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: vtysh -c configure terminal -c interface eth2 -c link-detect -c exit -c router rip -c version 2 -c redistribute connected -c network eth2 -c exit -c exit -c write -c exit
[DEBUG] module:ovsdb,function:_send,router:openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN","row":{},"op":"insert"}],"method":"transact","id":565598}
... JSON-RPC response ...
{"id":565598,"result":[{"uuid":["uuid","333959e3-8471-426b-9d93-396c727c5b87"]},{"error":"constraint violation","details":"transaction causes \"NLAN\" table to contain 2 rows, greater than the schema-defined limit of 1 row(s)"}],"error":null}
[DEBUG] module:ovsdb,function:_send,router:openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Gateway","where":[],"op":"select"}],"method":"transact","id":533081}
... JSON-RPC response ...
{"id":533081,"result":[{"rows":[]}],"error":null}
[DEBUG] module:ovsdb,function:_send,router:openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Gateway","uuid-name":"temp_286857","row":{"network":"eth2","rip":"enabled"},"op":"insert"},{"table":"NLAN","where":[],"mutations":[["gateway","insert",["set",[["named-uuid","temp_286857"]]]]],"op":"mutate"}],"method":"transact","id":640388}
... JSON-RPC response ...
{"id":640388,"result":[{"uuid":["uuid","383dadfd-9de2-488d-86de-5369f99eac69"]},{"count":1}],"error":null}
[DEBUG] module:ovsdb,function:_send,router:openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Gateway","where":[],"op":"select"}],"method":"transact","id":79041}
... JSON-RPC response ...
{"id":79041,"result":[{"rows":[{"_version":["uuid","b5e808ff-0eab-444e-a08c-c0c590374bc1"],"network":"eth2","_uuid":["uuid","383dadfd-9de2-488d-86de-5369f99eac69"],"rip":"enabled"}]}],"error":null}
[INFO] module:nlan_agent,function:_route,router:openwrt1
function:vxlan.add, model:{'remote_ips': ['192.168.1.103', '192.168.1.102', '192.168.1.104'], 'local_ip': '192.168.1.101'}
[INFO] module:vxlan,function:add,router:openwrt1
Adding a VXLAN tunnel: vxlan_103
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-vsctl add-port br-tun vxlan_103 -- set interface vxlan_103 type=vxlan options:in_key=flow options:local_ip=192.168.1.101 options:out_key=flow options:remote_ip=192.168.1.103
[INFO] module:vxlan,function:add,router:openwrt1
Adding a VXLAN tunnel: vxlan_102
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-vsctl add-port br-tun vxlan_102 -- set interface vxlan_102 type=vxlan options:in_key=flow options:local_ip=192.168.1.101 options:out_key=flow options:remote_ip=192.168.1.102
[INFO] module:vxlan,function:add,router:openwrt1
Adding a VXLAN tunnel: vxlan_104
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-vsctl add-port br-tun vxlan_104 -- set interface vxlan_104 type=vxlan options:in_key=flow options:local_ip=192.168.1.101 options:out_key=flow options:remote_ip=192.168.1.104
[DEBUG] module:ovsdb,function:_send,router:openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"Interface","where":[["type","==","vxlan"]],"columns":["ofport","options"],"op":"select"}],"method":"transact","id":986717}
... JSON-RPC response ...
{"id":986717,"result":[{"rows":[{"options":["map",[["in_key","flow"],["local_ip","192.168.1.101"],["out_key","flow"],["remote_ip","192.168.1.102"]]],"ofport":3},{"options":["map",[["in_key","flow"],["local_ip","192.168.1.101"],["out_key","flow"],["remote_ip","192.168.1.103"]]],"ofport":2},{"options":["map",[["in_key","flow"],["local_ip","192.168.1.101"],["out_key","flow"],["remote_ip","192.168.1.104"]]],"ofport":4}]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-ofctl add-flow br-tun table=0,priority=1,in_port=3,actions=resubmit(,2)
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-ofctl add-flow br-tun table=0,priority=1,in_port=2,actions=resubmit(,2)
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-ofctl add-flow br-tun table=0,priority=1,in_port=4,actions=resubmit(,2)
[DEBUG] module:ovsdb,function:_send,router:openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN","row":{},"op":"insert"}],"method":"transact","id":329041}
... JSON-RPC response ...
{"id":329041,"result":[{"uuid":["uuid","86e1408a-d574-4905-9a40-c7789c81616a"]},{"error":"constraint violation","details":"transaction causes \"NLAN\" table to contain 2 rows, greater than the schema-defined limit of 1 row(s)"}],"error":null}
[DEBUG] module:ovsdb,function:_send,router:openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_VXLAN","where":[],"op":"select"}],"method":"transact","id":198251}
... JSON-RPC response ...
{"id":198251,"result":[{"rows":[]}],"error":null}
[DEBUG] module:ovsdb,function:_send,router:openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_VXLAN","uuid-name":"temp_281572","row":{"remote_ips":["set",["192.168.1.103","192.168.1.102","192.168.1.104"]],"local_ip":"192.168.1.101"},"op":"insert"},{"table":"NLAN","where":[],"mutations":[["vxlan","insert",["set",[["named-uuid","temp_281572"]]]]],"op":"mutate"}],"method":"transact","id":46242}
... JSON-RPC response ...
{"id":46242,"result":[{"uuid":["uuid","3f16451b-6168-49aa-b248-ac428b1da30e"]},{"count":1}],"error":null}
[DEBUG] module:ovsdb,function:_send,router:openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_VXLAN","where":[],"op":"select"}],"method":"transact","id":165090}
... JSON-RPC response ...
{"id":165090,"result":[{"rows":[{"_version":["uuid","d945702a-3847-4247-b689-9d19b68224fe"],"_uuid":["uuid","3f16451b-6168-49aa-b248-ac428b1da30e"],"local_ip":"192.168.1.101","remote_ips":["set",["192.168.1.102","192.168.1.103","192.168.1.104"]]}]}],"error":null}
[INFO] module:nlan_agent,function:_route,router:openwrt1
function:subnets.add, index:('vni', 1), model:{'ip_dvr': '192.168.100.1/24', 'ip_vhost': '192.168.100.101/24', 'peers': ['192.168.1.102', '192.168.1.103'], 'vid': 2, 'vni': 1}
[INFO] module:subnets,function:_crud,router:openwrt1
Adding a subnet(vlan): 2
[DEBUG] module:ovsdb,function:_send,router:openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN","row":{},"op":"insert"}],"method":"transact","id":830073}
... JSON-RPC response ...
{"id":830073,"result":[{"uuid":["uuid","ee74986d-f6d5-4769-82e1-60490e97bf0a"]},{"error":"constraint violation","details":"transaction causes \"NLAN\" table to contain 2 rows, greater than the schema-defined limit of 1 row(s)"}],"error":null}
[DEBUG] module:ovsdb,function:_send,router:openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","where":[["vni","==",1]],"op":"select"}],"method":"transact","id":801328}
... JSON-RPC response ...
{"id":801328,"result":[{"rows":[]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip netns add ns2
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: brctl addbr br2
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip link add veth-ns2 type veth peer name temp-ns2
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip link set dev temp-ns2 netns ns2
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip netns exec ns2 ip link set dev temp-ns2 name eth0
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-vsctl add-port br-int int-br2 tag=2 -- set interface int-br2 type=internal
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-vsctl add-port br-int int-dvr2 tag=2 -- set interface int-dvr2 type=internal
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: brctl addif br2 veth-ns2
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: brctl addif br2 int-br2
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip link set dev veth-ns2 promisc on
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip link set dev veth-ns2 up
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip netns exec ns2 ip link set dev eth0 up
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip link set dev int-br2 promisc on
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip link set dev int-br2 up
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip link set dev int-dvr2 up
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip link set dev br2 up
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip netns exec ns2 ip addr add dev eth0 192.168.100.101/24
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip addr add dev int-dvr2 192.168.100.1/24
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip netns exec ns2 ip route add default via 192.168.100.1 dev eth0
[DEBUG] module:ovsdb,function:_send,router:openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"Controller","where":[],"columns":["target"],"op":"select"}],"method":"transact","id":471077}
... JSON-RPC response ...
{"id":471077,"result":[{"rows":[]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-ofctl add-flow br-tun table=2,priority=1,tun_id=1,actions=mod_vlan_vid:2,resubmit(,10)
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-ofctl add-flow br-tun table=19,priority=1,dl_type=0x0806,dl_vlan=2,nw_dst=192.168.100.1,actions=drop
[DEBUG] module:ovsdb,function:_send,router:openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"Interface","where":[["type","==","vxlan"]],"columns":["ofport","options"],"op":"select"}],"method":"transact","id":823033}
... JSON-RPC response ...
{"id":823033,"result":[{"rows":[{"options":["map",[["in_key","flow"],["local_ip","192.168.1.101"],["out_key","flow"],["remote_ip","192.168.1.102"]]],"ofport":3},{"options":["map",[["in_key","flow"],["local_ip","192.168.1.101"],["out_key","flow"],["remote_ip","192.168.1.103"]]],"ofport":2},{"options":["map",[["in_key","flow"],["local_ip","192.168.1.101"],["out_key","flow"],["remote_ip","192.168.1.104"]]],"ofport":4}]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-ofctl add-flow br-tun table=21,priority=1,dl_vlan=2,actions=strip_vlan,set_tunnel:1,output:3,output:2
[DEBUG] module:ovsdb,function:_send,router:openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN","row":{},"op":"insert"}],"method":"transact","id":79706}
... JSON-RPC response ...
{"id":79706,"result":[{"uuid":["uuid","7389c89f-88a3-45a8-83eb-6849f26b2abb"]},{"error":"constraint violation","details":"transaction causes \"NLAN\" table to contain 2 rows, greater than the schema-defined limit of 1 row(s)"}],"error":null}
[DEBUG] module:ovsdb,function:_send,router:openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","where":[["vni","==",1]],"op":"select"}],"method":"transact","id":795316}
... JSON-RPC response ...
{"id":795316,"result":[{"rows":[]}],"error":null}
[DEBUG] module:ovsdb,function:crud,router:openwrt1
CRUD operation (add): {'ip_dvr': '192.168.100.1/24', 'ip_vhost': '192.168.100.101/24', 'peers': ['192.168.1.102', '192.168.1.103'], 'vid': 2, 'vni': 1}
[DEBUG] module:ovsdb,function:_send,router:openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","uuid-name":"temp_409795","row":{"ip_dvr":"192.168.100.1/24","ip_vhost":"192.168.100.101/24","peers":["set",["192.168.1.102","192.168.1.103"]],"vid":2,"vni":1},"op":"insert"},{"table":"NLAN","where":[],"mutations":[["subnets","insert",["set",[["named-uuid","temp_409795"]]]]],"op":"mutate"}],"method":"transact","id":714837}
... JSON-RPC response ...
{"id":714837,"result":[{"uuid":["uuid","de83ae0e-2057-4c22-8e83-ecad7b0fe880"]},{"count":1}],"error":null}
[DEBUG] module:ovsdb,function:_send,router:openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","where":[["vni","==",1]],"op":"select"}],"method":"transact","id":373022}
... JSON-RPC response ...
{"id":373022,"result":[{"rows":[{"peers":["set",["192.168.1.102","192.168.1.103"]],"_version":["uuid","54c3ec48-9afb-4fb4-a7c2-d5907cf561ce"],"vni":1,"ports":["set",[]],"mode":["set",[]],"vid":2,"_uuid":["uuid","de83ae0e-2057-4c22-8e83-ecad7b0fe880"],"default_gw":["set",[]],"ip_vhost":"192.168.100.101/24","ip_dvr":"192.168.100.1/24"}]}],"error":null}
[INFO] module:nlan_agent,function:_route,router:openwrt1
function:subnets.add, index:('vni', 103), model:{'ip_dvr': '10.0.3.1/24', 'ip_vhost': '10.0.3.101/24', 'peers': ['192.168.1.102', '192.168.1.103'], 'vid': 3, 'vni': 103}
[INFO] module:subnets,function:_crud,router:openwrt1
Adding a subnet(vlan): 3
[DEBUG] module:ovsdb,function:_send,router:openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN","row":{},"op":"insert"}],"method":"transact","id":758679}
... JSON-RPC response ...
{"id":758679,"result":[{"uuid":["uuid","db73b915-2c52-457a-af23-68e12a2ec892"]},{"error":"constraint violation","details":"transaction causes \"NLAN\" table to contain 2 rows, greater than the schema-defined limit of 1 row(s)"}],"error":null}
[DEBUG] module:ovsdb,function:_send,router:openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","where":[["vni","==",103]],"op":"select"}],"method":"transact","id":322864}
... JSON-RPC response ...
{"id":322864,"result":[{"rows":[]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip netns add ns3
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: brctl addbr br3
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip link add veth-ns3 type veth peer name temp-ns3
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip link set dev temp-ns3 netns ns3
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip netns exec ns3 ip link set dev temp-ns3 name eth0
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-vsctl add-port br-int int-br3 tag=3 -- set interface int-br3 type=internal
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-vsctl add-port br-int int-dvr3 tag=3 -- set interface int-dvr3 type=internal
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: brctl addif br3 veth-ns3
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: brctl addif br3 int-br3
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip link set dev veth-ns3 promisc on
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip link set dev veth-ns3 up
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip netns exec ns3 ip link set dev eth0 up
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip link set dev int-br3 promisc on
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip link set dev int-br3 up
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip link set dev int-dvr3 up
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip link set dev br3 up
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip netns exec ns3 ip addr add dev eth0 10.0.3.101/24
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip addr add dev int-dvr3 10.0.3.1/24
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip netns exec ns3 ip route add default via 10.0.3.1 dev eth0
[DEBUG] module:ovsdb,function:_send,router:openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"Controller","where":[],"columns":["target"],"op":"select"}],"method":"transact","id":259286}
... JSON-RPC response ...
{"id":259286,"result":[{"rows":[]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-ofctl add-flow br-tun table=2,priority=1,tun_id=103,actions=mod_vlan_vid:3,resubmit(,10)
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-ofctl add-flow br-tun table=19,priority=1,dl_type=0x0806,dl_vlan=3,nw_dst=10.0.3.1,actions=drop
[DEBUG] module:ovsdb,function:_send,router:openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"Interface","where":[["type","==","vxlan"]],"columns":["ofport","options"],"op":"select"}],"method":"transact","id":900596}
... JSON-RPC response ...
{"id":900596,"result":[{"rows":[{"options":["map",[["in_key","flow"],["local_ip","192.168.1.101"],["out_key","flow"],["remote_ip","192.168.1.102"]]],"ofport":3},{"options":["map",[["in_key","flow"],["local_ip","192.168.1.101"],["out_key","flow"],["remote_ip","192.168.1.103"]]],"ofport":2},{"options":["map",[["in_key","flow"],["local_ip","192.168.1.101"],["out_key","flow"],["remote_ip","192.168.1.104"]]],"ofport":4}]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-ofctl add-flow br-tun table=21,priority=1,dl_vlan=3,actions=strip_vlan,set_tunnel:103,output:3,output:2
[DEBUG] module:ovsdb,function:_send,router:openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN","row":{},"op":"insert"}],"method":"transact","id":556297}
... JSON-RPC response ...
{"id":556297,"result":[{"uuid":["uuid","852bace5-e4d2-4cef-aab9-7968077d9080"]},{"error":"constraint violation","details":"transaction causes \"NLAN\" table to contain 2 rows, greater than the schema-defined limit of 1 row(s)"}],"error":null}
[DEBUG] module:ovsdb,function:_send,router:openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","where":[["vni","==",103]],"op":"select"}],"method":"transact","id":217919}
... JSON-RPC response ...
{"id":217919,"result":[{"rows":[]}],"error":null}
[DEBUG] module:ovsdb,function:crud,router:openwrt1
CRUD operation (add): {'ip_dvr': '10.0.3.1/24', 'ip_vhost': '10.0.3.101/24', 'peers': ['192.168.1.102', '192.168.1.103'], 'vid': 3, 'vni': 103}
[DEBUG] module:ovsdb,function:_send,router:openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","uuid-name":"temp_719087","row":{"ip_dvr":"10.0.3.1/24","ip_vhost":"10.0.3.101/24","peers":["set",["192.168.1.102","192.168.1.103"]],"vid":3,"vni":103},"op":"insert"},{"table":"NLAN","where":[],"mutations":[["subnets","insert",["set",[["named-uuid","temp_719087"]]]]],"op":"mutate"}],"method":"transact","id":499123}
... JSON-RPC response ...
{"id":499123,"result":[{"uuid":["uuid","d259196a-7bc8-4761-b249-9895df22a106"]},{"count":1}],"error":null}
[DEBUG] module:ovsdb,function:_send,router:openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","where":[["vni","==",103]],"op":"select"}],"method":"transact","id":331125}
... JSON-RPC response ...
{"id":331125,"result":[{"rows":[{"peers":["set",["192.168.1.102","192.168.1.103"]],"_version":["uuid","a667e755-1fd3-4487-a136-af99211f6c6d"],"vni":103,"ports":["set",[]],"mode":["set",[]],"vid":3,"_uuid":["uuid","d259196a-7bc8-4761-b249-9895df22a106"],"default_gw":["set",[]],"ip_vhost":"10.0.3.101/24","ip_dvr":"10.0.3.1/24"}]}],"error":null}
[INFO] module:nlan_agent,function:_route,router:openwrt1
function:subnets.add, index:('vni', 1001), model:{'peers': ['192.168.1.104'], 'vid': 1, 'ip_vhost': '10.0.1.101/24', 'vni': 1001, 'ip_dvr': '10.0.1.1/24', 'mode': 'hub'}
[INFO] module:subnets,function:_crud,router:openwrt1
Adding a subnet(vlan): 1
[DEBUG] module:ovsdb,function:_send,router:openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN","row":{},"op":"insert"}],"method":"transact","id":455858}
... JSON-RPC response ...
{"id":455858,"result":[{"uuid":["uuid","374e601b-73ec-482f-bcbd-e7e04b1cf636"]},{"error":"constraint violation","details":"transaction causes \"NLAN\" table to contain 2 rows, greater than the schema-defined limit of 1 row(s)"}],"error":null}
[DEBUG] module:ovsdb,function:_send,router:openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","where":[["vni","==",1001]],"op":"select"}],"method":"transact","id":634160}
... JSON-RPC response ...
{"id":634160,"result":[{"rows":[]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip netns add ns1
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: brctl addbr br1
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip link add veth-ns1 type veth peer name temp-ns1
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip link set dev temp-ns1 netns ns1
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip netns exec ns1 ip link set dev temp-ns1 name eth0
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-vsctl add-port br-int int-br1 tag=1 -- set interface int-br1 type=internal
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-vsctl add-port br-int int-dvr1 tag=1 -- set interface int-dvr1 type=internal
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: brctl addif br1 veth-ns1
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: brctl addif br1 int-br1
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip link set dev veth-ns1 promisc on
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip link set dev veth-ns1 up
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip netns exec ns1 ip link set dev eth0 up
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip link set dev int-br1 promisc on
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip link set dev int-br1 up
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip link set dev int-dvr1 up
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip link set dev br1 up
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip netns exec ns1 ip addr add dev eth0 10.0.1.101/24
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip addr add dev int-dvr1 10.0.1.1/24
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip netns exec ns1 ip route add default via 10.0.1.1 dev eth0
[DEBUG] module:ovsdb,function:_send,router:openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"Controller","where":[],"columns":["target"],"op":"select"}],"method":"transact","id":32480}
... JSON-RPC response ...
{"id":32480,"result":[{"rows":[]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-ofctl add-flow br-tun table=2,priority=1,tun_id=1001,actions=mod_vlan_vid:1,resubmit(,10)
[DEBUG] module:ovsdb,function:_send,router:openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"Interface","where":[["type","==","vxlan"]],"columns":["ofport","options"],"op":"select"}],"method":"transact","id":43367}
... JSON-RPC response ...
{"id":43367,"result":[{"rows":[{"options":["map",[["in_key","flow"],["local_ip","192.168.1.101"],["out_key","flow"],["remote_ip","192.168.1.102"]]],"ofport":3},{"options":["map",[["in_key","flow"],["local_ip","192.168.1.101"],["out_key","flow"],["remote_ip","192.168.1.103"]]],"ofport":2},{"options":["map",[["in_key","flow"],["local_ip","192.168.1.101"],["out_key","flow"],["remote_ip","192.168.1.104"]]],"ofport":4}]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-ofctl add-flow br-tun table=21,priority=1,dl_vlan=1,actions=strip_vlan,set_tunnel:1001,output:4
[DEBUG] module:ovsdb,function:_send,router:openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN","row":{},"op":"insert"}],"method":"transact","id":910258}
... JSON-RPC response ...
{"id":910258,"result":[{"uuid":["uuid","1d35251e-14de-4c30-a227-67065072190e"]},{"error":"constraint violation","details":"transaction causes \"NLAN\" table to contain 2 rows, greater than the schema-defined limit of 1 row(s)"}],"error":null}
[DEBUG] module:ovsdb,function:_send,router:openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","where":[["vni","==",1001]],"op":"select"}],"method":"transact","id":600823}
... JSON-RPC response ...
{"id":600823,"result":[{"rows":[]}],"error":null}
[DEBUG] module:ovsdb,function:crud,router:openwrt1
CRUD operation (add): {'peers': ['192.168.1.104'], 'vid': 1, 'ip_vhost': '10.0.1.101/24', 'vni': 1001, 'ip_dvr': '10.0.1.1/24', 'mode': 'hub'}
[DEBUG] module:ovsdb,function:_send,router:openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","uuid-name":"temp_368218","row":{"peers":["set",["192.168.1.104"]],"vid":1,"ip_vhost":"10.0.1.101/24","vni":1001,"ip_dvr":"10.0.1.1/24","mode":"hub"},"op":"insert"},{"table":"NLAN","where":[],"mutations":[["subnets","insert",["set",[["named-uuid","temp_368218"]]]]],"op":"mutate"}],"method":"transact","id":154713}
... JSON-RPC response ...
{"id":154713,"result":[{"uuid":["uuid","005f2374-7e6a-4d2a-995d-74d8d3a1f779"]},{"count":1}],"error":null}
[DEBUG] module:ovsdb,function:_send,router:openwrt1
... JSON-RPC request ...
{"params":["Open_vSwitch",{"table":"NLAN_Subnet","where":[["vni","==",1001]],"op":"select"}],"method":"transact","id":42983}
... JSON-RPC response ...
{"id":42983,"result":[{"rows":[{"peers":"192.168.1.104","_version":["uuid","08e7e6b5-575a-4044-aac3-782316cbe3d5"],"vni":1001,"ports":["set",[]],"mode":"hub","vid":1,"_uuid":["uuid","005f2374-7e6a-4d2a-995d-74d8d3a1f779"],"default_gw":["set",[]],"ip_vhost":"10.0.1.101/24","ip_dvr":"10.0.1.1/24"}]}],"error":null}
__ NLAN response __
message:Execution completed
exit:0
=+=+= NLAN Response from router:rpi1,platform:debian +=+=+=+=+=+=+=+=+=+=+=+=+
[INFO] module:nlan_agent,function:<module>,router:rpi1
NLAN Agent initialization completed
{'mod_dir': ['command', 'config'], 'etc_dir': '/opt/nlan/etc', 'state_order': ['bridges', 'services', 'gateway', 'vxlan', 'subnets'], 'types': {'services': {'name': {'max': 1, 'key': {'type': 'string'}, 'min': 1}, 'chain': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}}, 'bridges': {'controller': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'ovs_bridges': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}, 'gateway': {'network': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'rip': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}, 'vxlan': {'remote_ips': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}, 'local_ip': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}, 'subnets': {'ip_dvr': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'peers': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}, 'vni': {'max': 1, 'key': {'minInteger': 0, 'maxInteger': 16777215, 'type': 'integer'}, 'min': 1}, 'vid': {'max': 1, 'key': {'minInteger': 0, 'maxInteger': 4095, 'type': 'integer'}, 'min': 0}, 'ip_vhost': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'ports': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}, 'default_gw': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'mode': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}}, 'tables': {'services': {'max': 'unlimited', 'key': {'type': 'uuid', 'refTable': 'NLAN_Service'}, 'min': 0}, 'bridges': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_Bridges'}, 'min': 0}, 'gateway': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_Gateway'}, 'min': 0}, 'vxlan': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_VXLAN'}, 'min': 0}, 'subnets': {'max': 'unlimited', 'key': {'type': 'uuid', 'refTable': 'NLAN_Subnet'}, 'min': 0}}, 'agent_dir': '/opt/nlan', 'indexes': {'services': 'name', 'subnets': 'vni'}, 'platform': 'debian', 'init': False, 'router': 'rpi1', 'logger': <logging.Logger object at 0xb7273d4c>, 'schema': 'ovsdb_nlan.schema'}
[INFO] module:nlan_agent,function:_route,router:rpi1
function:bridges.add, model:{'ovs_bridges': 'enabled'}
[INFO] module:bridges,function:add,router:rpi1
Adding bridges: br-int and br-tun
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: ovs-vsctl add-br br-int
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: ovs-vsctl add-br br-tun
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: ovs-ofctl del-flows br-tun
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: ovs-vsctl add-port br-int patch-int -- set interface patch-int type=patch options:peer=patch-tun
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: ovs-vsctl add-port br-tun patch-tun -- set interface patch-tun type=patch options:peer=patch-int
[DEBUG] module:ovsdb,function:_send,router:rpi1
... JSON-RPC request ...
{"params": ["Open_vSwitch", {"table": "Interface", "where": [["name", "==", "patch-tun"]], "op": "select"}], "method": "transact", "id": 639906}
... JSON-RPC response ...
{"id":639906,"result":[{"rows":[{"options":["map",[["peer","patch-int"]]],"mtu":["set",[]],"link_speed":["set",[]],"statistics":["map",[["collisions",0],["rx_bytes",0],["rx_crc_err",0],["rx_dropped",0],["rx_errors",0],["rx_frame_err",0],["rx_over_err",0],["rx_packets",0],["tx_bytes",0],["tx_dropped",0],["tx_errors",0],["tx_packets",0]]],"mac_in_use":"b2:c9:d9:f6:a7:66","ingress_policing_rate":0,"ofport":1,"mac":["set",[]],"cfm_fault_status":["set",[]],"duplex":["set",[]],"lacp_current":["set",[]],"cfm_fault":["set",[]],"link_state":"up","external_ids":["map",[]],"bfd_status":["map",[]],"link_resets":0,"name":"patch-tun","type":"patch","cfm_remote_opstate":["set",[]],"_uuid":["uuid","3f1973db-332c-4c1d-9d68-ba0c560acd08"],"status":["map",[]],"ifindex":0,"_version":["uuid","e1f16605-b12f-410d-9959-a859b0f24e6d"],"other_config":["map",[]],"admin_state":"up","cfm_remote_mpids":["set",[]],"cfm_mpid":["set",[]],"bfd":["map",[]],"ofport_request":["set",[]],"ingress_policing_burst":0,"cfm_flap_count":["set",[]],"cfm_health":["set",[]]}]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: ovs-ofctl del-flows br-tun
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: ovs-ofctl add-flow br-tun table=0,priority=1,in_port=1,actions=resubmit(,1)
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: ovs-ofctl add-flow br-tun table=0,priority=0,actions=drop
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: ovs-ofctl add-flow br-tun table=1,priority=0,dl_dst=01:00:00:00:00:00/01:00:00:00:00:00,actions=resubmit(,19)
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: ovs-ofctl add-flow br-tun table=1,priority=0,dl_dst=00:00:00:00:00:00/01:00:00:00:00:00,actions=resubmit(,20)
[DEBUG] module:ovsdb,function:_send,router:rpi1
... JSON-RPC request ...
{"params": ["Open_vSwitch", {"table": "Interface", "where": [["name", "==", "patch-tun"]], "op": "select"}], "method": "transact", "id": 953750}
... JSON-RPC response ...
{"id":953750,"result":[{"rows":[{"options":["map",[["peer","patch-int"]]],"mtu":["set",[]],"link_speed":["set",[]],"statistics":["map",[["collisions",0],["rx_bytes",0],["rx_crc_err",0],["rx_dropped",0],["rx_errors",0],["rx_frame_err",0],["rx_over_err",0],["rx_packets",0],["tx_bytes",0],["tx_dropped",0],["tx_errors",0],["tx_packets",0]]],"mac_in_use":"b2:c9:d9:f6:a7:66","ingress_policing_rate":0,"ofport":1,"mac":["set",[]],"cfm_fault_status":["set",[]],"duplex":["set",[]],"lacp_current":["set",[]],"cfm_fault":["set",[]],"link_state":"up","external_ids":["map",[]],"bfd_status":["map",[]],"link_resets":0,"name":"patch-tun","type":"patch","cfm_remote_opstate":["set",[]],"_uuid":["uuid","3f1973db-332c-4c1d-9d68-ba0c560acd08"],"status":["map",[]],"ifindex":0,"_version":["uuid","e1f16605-b12f-410d-9959-a859b0f24e6d"],"other_config":["map",[]],"admin_state":"up","cfm_remote_mpids":["set",[]],"cfm_mpid":["set",[]],"bfd":["map",[]],"ofport_request":["set",[]],"ingress_policing_burst":0,"cfm_flap_count":["set",[]],"cfm_health":["set",[]]}]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: ovs-ofctl add-flow br-tun table=2,priority=0,actions=drop
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: ovs-ofctl add-flow br-tun table=3,priority=0,actions=drop
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: ovs-ofctl add-flow br-tun table=10,priority=1,actions=learn(table=20,hard_timeout=300,priority=1,NXM_OF_VLAN_TCI[0..11],NXM_OF_ETH_DST[]=NXM_OF_ETH_SRC[],load:0->NXM_OF_VLAN_TCI[],load:NXM_NX_TUN_ID[]->NXM_NX_TUN_ID[],output:NXM_OF_IN_PORT[]),output:1
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: ovs-ofctl add-flow br-tun table=19,priority=0,actions=resubmit(,21)
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: ovs-ofctl add-flow br-tun table=20,priority=0,actions=resubmit(,21)
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: ovs-ofctl add-flow br-tun table=21,priority=0,actions=drop
[DEBUG] module:ovsdb,function:_send,router:rpi1
... JSON-RPC request ...
{"params": ["Open_vSwitch", {"table": "NLAN", "row": {}, "op": "insert"}], "method": "transact", "id": 560076}
... JSON-RPC response ...
{"id":560076,"result":[{"uuid":["uuid","7de700b4-39c4-419f-b7b0-69b1f15ae543"]}],"error":null}
[DEBUG] module:ovsdb,function:_send,router:rpi1
... JSON-RPC request ...
{"params": ["Open_vSwitch", {"table": "NLAN_Bridges", "where": [], "op": "select"}], "method": "transact", "id": 299700}
... JSON-RPC response ...
{"id":299700,"result":[{"rows":[]}],"error":null}
[DEBUG] module:ovsdb,function:_send,router:rpi1
... JSON-RPC request ...
{"params": ["Open_vSwitch", {"table": "NLAN_Bridges", "uuid-name": "temp_607031", "row": {"ovs_bridges": "enabled"}, "op": "insert"}, {"table": "NLAN", "where": [], "mutations": [["bridges", "insert", ["set", [["named-uuid", "temp_607031"]]]]], "op": "mutate"}], "method": "transact", "id": 94944}
... JSON-RPC response ...
{"id":94944,"result":[{"uuid":["uuid","1ae35184-9c7e-492b-9d62-511515384f88"]},{"count":1}],"error":null}
[DEBUG] module:ovsdb,function:_send,router:rpi1
... JSON-RPC request ...
{"params": ["Open_vSwitch", {"table": "NLAN_Bridges", "where": [], "op": "select"}], "method": "transact", "id": 341405}
... JSON-RPC response ...
{"id":341405,"result":[{"rows":[{"_uuid":["uuid","1ae35184-9c7e-492b-9d62-511515384f88"],"_version":["uuid","54712578-c76c-4c0b-bdd7-ee625f4c1a82"],"ovs_bridges":"enabled","controller":["set",[]]}]}],"error":null}
[INFO] module:nlan_agent,function:_route,router:rpi1
function:services.add, index:('name', 'snort1'), model:{'name': 'snort1', 'chain': ['mz.101', 'dmz.1001']}
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: lxc-start -d -f /var/lib/lxc/snort1/config_nlan -n snort1
[DEBUG] module:ovsdb,function:_send,router:rpi1
... JSON-RPC request ...
{"params": ["Open_vSwitch", {"table": "NLAN", "row": {}, "op": "insert"}], "method": "transact", "id": 117470}
... JSON-RPC response ...
{"id":117470,"result":[{"uuid":["uuid","045bdf99-f22c-4a1c-bb88-352b15524fb8"]},{"error":"constraint violation","details":"transaction causes \"NLAN\" table to contain 2 rows, greater than the schema-defined limit of 1 row(s)"}],"error":null}
[DEBUG] module:ovsdb,function:_send,router:rpi1
... JSON-RPC request ...
{"params": ["Open_vSwitch", {"table": "NLAN_Service", "where": [["name", "==", "snort1"]], "op": "select"}], "method": "transact", "id": 441500}
... JSON-RPC response ...
{"id":441500,"result":[{"rows":[]}],"error":null}
[DEBUG] module:ovsdb,function:crud,router:rpi1
CRUD operation (add): {'name': 'snort1', 'chain': ['mz.101', 'dmz.1001']}
[DEBUG] module:ovsdb,function:_send,router:rpi1
... JSON-RPC request ...
{"params": ["Open_vSwitch", {"table": "NLAN_Service", "uuid-name": "temp_132071", "row": {"name": "snort1", "chain": ["set", ["mz.101", "dmz.1001"]]}, "op": "insert"}, {"table": "NLAN", "where": [], "mutations": [["services", "insert", ["set", [["named-uuid", "temp_132071"]]]]], "op": "mutate"}], "method": "transact", "id": 776640}
... JSON-RPC response ...
{"id":776640,"result":[{"uuid":["uuid","d6f9274e-3f60-4a01-90a1-b27c74476455"]},{"count":1}],"error":null}
[DEBUG] module:ovsdb,function:_send,router:rpi1
... JSON-RPC request ...
{"params": ["Open_vSwitch", {"table": "NLAN_Service", "where": [["name", "==", "snort1"]], "op": "select"}], "method": "transact", "id": 406167}
... JSON-RPC response ...
{"id":406167,"result":[{"rows":[{"_version":["uuid","ed0505c3-dc7f-4306-8ca0-d77c5a80afdd"],"_uuid":["uuid","d6f9274e-3f60-4a01-90a1-b27c74476455"],"chain":["set",["dmz.1001","mz.101"]],"name":"snort1"}]}],"error":null}
[INFO] module:nlan_agent,function:_route,router:rpi1
function:vxlan.add, model:{'remote_ips': ['192.168.1.103', '192.168.1.102', '192.168.1.101'], 'local_ip': '192.168.1.104'}
[INFO] module:vxlan,function:add,router:rpi1
Adding a VXLAN tunnel: vxlan_103
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: ovs-vsctl add-port br-tun vxlan_103 -- set interface vxlan_103 type=vxlan options:in_key=flow options:local_ip=192.168.1.104 options:out_key=flow options:remote_ip=192.168.1.103
[INFO] module:vxlan,function:add,router:rpi1
Adding a VXLAN tunnel: vxlan_102
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: ovs-vsctl add-port br-tun vxlan_102 -- set interface vxlan_102 type=vxlan options:in_key=flow options:local_ip=192.168.1.104 options:out_key=flow options:remote_ip=192.168.1.102
[INFO] module:vxlan,function:add,router:rpi1
Adding a VXLAN tunnel: vxlan_101
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: ovs-vsctl add-port br-tun vxlan_101 -- set interface vxlan_101 type=vxlan options:in_key=flow options:local_ip=192.168.1.104 options:out_key=flow options:remote_ip=192.168.1.101
[DEBUG] module:ovsdb,function:_send,router:rpi1
... JSON-RPC request ...
{"params": ["Open_vSwitch", {"table": "Interface", "where": [["type", "==", "vxlan"]], "columns": ["ofport", "options"], "op": "select"}], "method": "transact", "id": 169292}
... JSON-RPC response ...
{"id":169292,"result":[{"rows":[{"options":["map",[["in_key","flow"],["local_ip","192.168.1.104"],["out_key","flow"],["remote_ip","192.168.1.101"]]],"ofport":4},{"options":["map",[["in_key","flow"],["local_ip","192.168.1.104"],["out_key","flow"],["remote_ip","192.168.1.102"]]],"ofport":3},{"options":["map",[["in_key","flow"],["local_ip","192.168.1.104"],["out_key","flow"],["remote_ip","192.168.1.103"]]],"ofport":2}]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: ovs-ofctl add-flow br-tun table=0,priority=1,in_port=4,actions=resubmit(,2)
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: ovs-ofctl add-flow br-tun table=0,priority=1,in_port=3,actions=resubmit(,2)
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: ovs-ofctl add-flow br-tun table=0,priority=1,in_port=2,actions=resubmit(,2)
[DEBUG] module:ovsdb,function:_send,router:rpi1
... JSON-RPC request ...
{"params": ["Open_vSwitch", {"table": "NLAN", "row": {}, "op": "insert"}], "method": "transact", "id": 952687}
... JSON-RPC response ...
{"id":952687,"result":[{"uuid":["uuid","1ce3a1c4-5b25-43e1-8857-aee95dc93257"]},{"error":"constraint violation","details":"transaction causes \"NLAN\" table to contain 2 rows, greater than the schema-defined limit of 1 row(s)"}],"error":null}
[DEBUG] module:ovsdb,function:_send,router:rpi1
... JSON-RPC request ...
{"params": ["Open_vSwitch", {"table": "NLAN_VXLAN", "where": [], "op": "select"}], "method": "transact", "id": 414727}
... JSON-RPC response ...
{"id":414727,"result":[{"rows":[]}],"error":null}
[DEBUG] module:ovsdb,function:_send,router:rpi1
... JSON-RPC request ...
{"params": ["Open_vSwitch", {"table": "NLAN_VXLAN", "uuid-name": "temp_838225", "row": {"remote_ips": ["set", ["192.168.1.103", "192.168.1.102", "192.168.1.101"]], "local_ip": "192.168.1.104"}, "op": "insert"}, {"table": "NLAN", "where": [], "mutations": [["vxlan", "insert", ["set", [["named-uuid", "temp_838225"]]]]], "op": "mutate"}], "method": "transact", "id": 401040}
... JSON-RPC response ...
{"id":401040,"result":[{"uuid":["uuid","423cd2c4-4886-4cb0-9c50-6c6e8cc68a2a"]},{"count":1}],"error":null}
[DEBUG] module:ovsdb,function:_send,router:rpi1
... JSON-RPC request ...
{"params": ["Open_vSwitch", {"table": "NLAN_VXLAN", "where": [], "op": "select"}], "method": "transact", "id": 711674}
... JSON-RPC response ...
{"id":711674,"result":[{"rows":[{"_version":["uuid","d78bafbe-76fd-4db3-9b24-b94a0b7eda92"],"_uuid":["uuid","423cd2c4-4886-4cb0-9c50-6c6e8cc68a2a"],"local_ip":"192.168.1.104","remote_ips":["set",["192.168.1.101","192.168.1.102","192.168.1.103"]]}]}],"error":null}
[INFO] module:nlan_agent,function:_route,router:rpi1
function:subnets.add, index:('vni', 1001), model:{'peers': ['192.168.1.101'], 'vni': 1001, 'vid': 111, 'ports': ['dmz.1001']}
[INFO] module:subnets,function:_crud,router:rpi1
Adding a subnet(vlan): 111
[DEBUG] module:ovsdb,function:_send,router:rpi1
... JSON-RPC request ...
{"params": ["Open_vSwitch", {"table": "NLAN", "row": {}, "op": "insert"}], "method": "transact", "id": 464920}
... JSON-RPC response ...
{"id":464920,"result":[{"uuid":["uuid","7cd4eeb2-efb0-4ce2-9c69-81c70f5e8c85"]},{"error":"constraint violation","details":"transaction causes \"NLAN\" table to contain 2 rows, greater than the schema-defined limit of 1 row(s)"}],"error":null}
[DEBUG] module:ovsdb,function:_send,router:rpi1
... JSON-RPC request ...
{"params": ["Open_vSwitch", {"table": "NLAN_Subnet", "where": [["vni", "==", 1001]], "op": "select"}], "method": "transact", "id": 237571}
... JSON-RPC response ...
{"id":237571,"result":[{"rows":[]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: ip netns add ns111
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: brctl addbr br111
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: ip link add veth-ns111 type veth peer name temp-ns111
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: ip link set dev temp-ns111 netns ns111
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: ip netns exec ns111 ip link set dev temp-ns111 name eth0
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: ovs-vsctl add-port br-int int-br111 tag=111 -- set interface int-br111 type=internal
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: ovs-vsctl add-port br-int int-dvr111 tag=111 -- set interface int-dvr111 type=internal
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: brctl addif br111 veth-ns111
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: brctl addif br111 int-br111
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: ip link set dev veth-ns111 promisc on
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: ip link set dev veth-ns111 up
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: ip netns exec ns111 ip link set dev eth0 up
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: ip link set dev int-br111 promisc on
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: ip link set dev int-br111 up
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: ip link set dev int-dvr111 up
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: ip link set dev br111 up
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: brctl addif br111 dmz.1001
[DEBUG] module:ovsdb,function:_send,router:rpi1
... JSON-RPC request ...
{"params": ["Open_vSwitch", {"table": "Controller", "where": [], "columns": ["target"], "op": "select"}], "method": "transact", "id": 997865}
... JSON-RPC response ...
{"id":997865,"result":[{"rows":[]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: ovs-ofctl add-flow br-tun table=2,priority=1,tun_id=1001,actions=mod_vlan_vid:111,resubmit(,10)
[DEBUG] module:ovsdb,function:_send,router:rpi1
... JSON-RPC request ...
{"params": ["Open_vSwitch", {"table": "Interface", "where": [["type", "==", "vxlan"]], "columns": ["ofport", "options"], "op": "select"}], "method": "transact", "id": 395492}
... JSON-RPC response ...
{"id":395492,"result":[{"rows":[{"options":["map",[["in_key","flow"],["local_ip","192.168.1.104"],["out_key","flow"],["remote_ip","192.168.1.101"]]],"ofport":4},{"options":["map",[["in_key","flow"],["local_ip","192.168.1.104"],["out_key","flow"],["remote_ip","192.168.1.102"]]],"ofport":3},{"options":["map",[["in_key","flow"],["local_ip","192.168.1.104"],["out_key","flow"],["remote_ip","192.168.1.103"]]],"ofport":2}]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: ovs-ofctl add-flow br-tun table=21,priority=1,dl_vlan=111,actions=strip_vlan,set_tunnel:1001,output:4
[DEBUG] module:ovsdb,function:_send,router:rpi1
... JSON-RPC request ...
{"params": ["Open_vSwitch", {"table": "NLAN", "row": {}, "op": "insert"}], "method": "transact", "id": 951441}
... JSON-RPC response ...
{"id":951441,"result":[{"uuid":["uuid","f2bdbf4e-a754-43fb-8406-b56e0fa5d3c9"]},{"error":"constraint violation","details":"transaction causes \"NLAN\" table to contain 2 rows, greater than the schema-defined limit of 1 row(s)"}],"error":null}
[DEBUG] module:ovsdb,function:_send,router:rpi1
... JSON-RPC request ...
{"params": ["Open_vSwitch", {"table": "NLAN_Subnet", "where": [["vni", "==", 1001]], "op": "select"}], "method": "transact", "id": 781488}
... JSON-RPC response ...
{"id":781488,"result":[{"rows":[]}],"error":null}
[DEBUG] module:ovsdb,function:crud,router:rpi1
CRUD operation (add): {'peers': ['192.168.1.101'], 'vni': 1001, 'vid': 111, 'ports': ['dmz.1001']}
[DEBUG] module:ovsdb,function:_send,router:rpi1
... JSON-RPC request ...
{"params": ["Open_vSwitch", {"table": "NLAN_Subnet", "uuid-name": "temp_40713", "row": {"peers": ["set", ["192.168.1.101"]], "vid": 111, "vni": 1001, "ports": ["set", ["dmz.1001"]]}, "op": "insert"}, {"table": "NLAN", "where": [], "mutations": [["subnets", "insert", ["set", [["named-uuid", "temp_40713"]]]]], "op": "mutate"}], "method": "transact", "id": 824413}
... JSON-RPC response ...
{"id":824413,"result":[{"uuid":["uuid","02db4455-13a8-4585-bacd-4afbc8097ff8"]},{"count":1}],"error":null}
[DEBUG] module:ovsdb,function:_send,router:rpi1
... JSON-RPC request ...
{"params": ["Open_vSwitch", {"table": "NLAN_Subnet", "where": [["vni", "==", 1001]], "op": "select"}], "method": "transact", "id": 658241}
... JSON-RPC response ...
{"id":658241,"result":[{"rows":[{"peers":"192.168.1.101","_version":["uuid","ae2e3638-dc0f-4382-81b6-9150ae384b43"],"vni":1001,"ports":"dmz.1001","mode":["set",[]],"vid":111,"_uuid":["uuid","02db4455-13a8-4585-bacd-4afbc8097ff8"],"default_gw":["set",[]],"ip_vhost":["set",[]],"ip_dvr":["set",[]]}]}],"error":null}
[INFO] module:nlan_agent,function:_route,router:rpi1
function:subnets.add, index:('vni', 101), model:{'peers': ['192.168.1.102', '192.168.1.103'], 'vni': 101, 'vid': 1, 'ports': ['mz.101']}
[INFO] module:subnets,function:_crud,router:rpi1
Adding a subnet(vlan): 1
[DEBUG] module:ovsdb,function:_send,router:rpi1
... JSON-RPC request ...
{"params": ["Open_vSwitch", {"table": "NLAN", "row": {}, "op": "insert"}], "method": "transact", "id": 823012}
... JSON-RPC response ...
{"id":823012,"result":[{"uuid":["uuid","840c8388-954f-4f51-999d-22864bf906e9"]},{"error":"constraint violation","details":"transaction causes \"NLAN\" table to contain 2 rows, greater than the schema-defined limit of 1 row(s)"}],"error":null}
[DEBUG] module:ovsdb,function:_send,router:rpi1
... JSON-RPC request ...
{"params": ["Open_vSwitch", {"table": "NLAN_Subnet", "where": [["vni", "==", 101]], "op": "select"}], "method": "transact", "id": 331717}
... JSON-RPC response ...
{"id":331717,"result":[{"rows":[]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: ip netns add ns1
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: brctl addbr br1
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: ip link add veth-ns1 type veth peer name temp-ns1
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: ip link set dev temp-ns1 netns ns1
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: ip netns exec ns1 ip link set dev temp-ns1 name eth0
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: ovs-vsctl add-port br-int int-br1 tag=1 -- set interface int-br1 type=internal
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: ovs-vsctl add-port br-int int-dvr1 tag=1 -- set interface int-dvr1 type=internal
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: brctl addif br1 veth-ns1
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: brctl addif br1 int-br1
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: ip link set dev veth-ns1 promisc on
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: ip link set dev veth-ns1 up
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: ip netns exec ns1 ip link set dev eth0 up
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: ip link set dev int-br1 promisc on
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: ip link set dev int-br1 up
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: ip link set dev int-dvr1 up
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: ip link set dev br1 up
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: brctl addif br1 mz.101
[DEBUG] module:ovsdb,function:_send,router:rpi1
... JSON-RPC request ...
{"params": ["Open_vSwitch", {"table": "Controller", "where": [], "columns": ["target"], "op": "select"}], "method": "transact", "id": 369885}
... JSON-RPC response ...
{"id":369885,"result":[{"rows":[]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: ovs-ofctl add-flow br-tun table=2,priority=1,tun_id=101,actions=mod_vlan_vid:1,resubmit(,10)
[DEBUG] module:ovsdb,function:_send,router:rpi1
... JSON-RPC request ...
{"params": ["Open_vSwitch", {"table": "Interface", "where": [["type", "==", "vxlan"]], "columns": ["ofport", "options"], "op": "select"}], "method": "transact", "id": 992130}
... JSON-RPC response ...
{"id":992130,"result":[{"rows":[{"options":["map",[["in_key","flow"],["local_ip","192.168.1.104"],["out_key","flow"],["remote_ip","192.168.1.101"]]],"ofport":4},{"options":["map",[["in_key","flow"],["local_ip","192.168.1.104"],["out_key","flow"],["remote_ip","192.168.1.102"]]],"ofport":3},{"options":["map",[["in_key","flow"],["local_ip","192.168.1.104"],["out_key","flow"],["remote_ip","192.168.1.103"]]],"ofport":2}]}],"error":null}
[DEBUG] module:cmdutil,function:_cmd2,router:rpi1
cmd: ovs-ofctl add-flow br-tun table=21,priority=1,dl_vlan=1,actions=strip_vlan,set_tunnel:101,output:3,output:2
[DEBUG] module:ovsdb,function:_send,router:rpi1
... JSON-RPC request ...
{"params": ["Open_vSwitch", {"table": "NLAN", "row": {}, "op": "insert"}], "method": "transact", "id": 85320}
... JSON-RPC response ...
{"id":85320,"result":[{"uuid":["uuid","906cff25-af04-4ed7-864a-709eedb492c4"]},{"error":"constraint violation","details":"transaction causes \"NLAN\" table to contain 2 rows, greater than the schema-defined limit of 1 row(s)"}],"error":null}
[DEBUG] module:ovsdb,function:_send,router:rpi1
... JSON-RPC request ...
{"params": ["Open_vSwitch", {"table": "NLAN_Subnet", "where": [["vni", "==", 101]], "op": "select"}], "method": "transact", "id": 930015}
... JSON-RPC response ...
{"id":930015,"result":[{"rows":[]}],"error":null}
[DEBUG] module:ovsdb,function:crud,router:rpi1
CRUD operation (add): {'peers': ['192.168.1.102', '192.168.1.103'], 'vni': 101, 'vid': 1, 'ports': ['mz.101']}
[DEBUG] module:ovsdb,function:_send,router:rpi1
... JSON-RPC request ...
{"params": ["Open_vSwitch", {"table": "NLAN_Subnet", "uuid-name": "temp_767235", "row": {"peers": ["set", ["192.168.1.102", "192.168.1.103"]], "vid": 1, "vni": 101, "ports": ["set", ["mz.101"]]}, "op": "insert"}, {"table": "NLAN", "where": [], "mutations": [["subnets", "insert", ["set", [["named-uuid", "temp_767235"]]]]], "op": "mutate"}], "method": "transact", "id": 246257}
... JSON-RPC response ...
{"id":246257,"result":[{"uuid":["uuid","084d025c-c81b-4fca-9d54-3860e93b24e1"]},{"count":1}],"error":null}
[DEBUG] module:ovsdb,function:_send,router:rpi1
... JSON-RPC request ...
{"params": ["Open_vSwitch", {"table": "NLAN_Subnet", "where": [["vni", "==", 101]], "op": "select"}], "method": "transact", "id": 185990}
... JSON-RPC response ...
{"id":185990,"result":[{"rows":[{"peers":["set",["192.168.1.102","192.168.1.103"]],"_version":["uuid","1a489965-b1c8-441a-922a-beba2d72f2a0"],"vni":101,"ports":"mz.101","mode":["set",[]],"vid":1,"_uuid":["uuid","084d025c-c81b-4fca-9d54-3860e93b24e1"],"default_gw":["set",[]],"ip_vhost":["set",[]],"ip_dvr":["set",[]]}]}],"error":null}
__ NLAN response __
message:Execution completed
exit:0
=+=+= Transaction Summary =+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+

Start Time: 2014-04-23 00:52:38.086831

Router           Result    Elapsed Time
---------------------------------------
openwrt3          :-)         4.48(sec)
openwrt2          :-)         6.44(sec)
openwrt1          :-)         6.67(sec)
rpi1              :-)         9.57(sec)
=+=+= NLAN Request to router:openwrt1,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ip netns add ns-global
=+=+= NLAN Request to router:openwrt1,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ip link add veth-global type veth peer name temp
=+=+= NLAN Request to router:openwrt1,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ip link set dev temp netns ns-global
=+=+= NLAN Request to router:openwrt1,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ip netns exec ns-global ip link set dev temp name eth0
=+=+= NLAN Request to router:openwrt1,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ip netns exec ns-global ip addr add dev eth0 8.8.8.8/24
=+=+= NLAN Request to router:openwrt1,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ip link set dev veth-global up
=+=+= NLAN Request to router:openwrt1,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ip addr add dev veth-global 8.8.8.1/24
=+=+= NLAN Request to router:openwrt1,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ip netns exec ns-global ip link set dev eth0 up
=+=+= NLAN Request to router:openwrt1,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ip netns exec ns-global ip route add default via  8.8.8.1
=+=+= NLAN Request to router:openwrt1,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: echo a b c
=+=+= NLAN Response from router:openwrt1,platform:openwrt =+=+=+=+=+=+=+=+=+=+
a b c
=+=+= NLAN Request to router:openwrt1,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ip netns exec ns1 ping -c 2 10.0.1.102
=+=+= NLAN Response from router:openwrt1,platform:openwrt =+=+=+=+=+=+=+=+=+=+
PING 10.0.1.102 (10.0.1.102): 56 data bytes
64 bytes from 10.0.1.102: seq=0 ttl=64 time=21.343 ms
64 bytes from 10.0.1.102: seq=1 ttl=64 time=11.881 ms

--- 10.0.1.102 ping statistics ---
2 packets transmitted, 2 packets received, 0% packet loss
round-trip min/avg/max = 11.881/16.612/21.343 ms
=+=+= NLAN Request to router:openwrt1,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ip netns exec ns1 ping -c 2 10.0.1.102
=+=+= NLAN Response from router:openwrt1,platform:openwrt =+=+=+=+=+=+=+=+=+=+
PING 10.0.1.102 (10.0.1.102): 56 data bytes
64 bytes from 10.0.1.102: seq=0 ttl=64 time=1.687 ms
64 bytes from 10.0.1.102: seq=1 ttl=64 time=7.472 ms

--- 10.0.1.102 ping statistics ---
2 packets transmitted, 2 packets received, 0% packet loss
round-trip min/avg/max = 1.687/4.579/7.472 ms
=+=+= NLAN Request to router:openwrt1,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ip netns exec ns3 ping -c 2 10.0.3.103
=+=+= NLAN Response from router:openwrt1,platform:openwrt =+=+=+=+=+=+=+=+=+=+
PING 10.0.3.103 (10.0.3.103): 56 data bytes
64 bytes from 10.0.3.103: seq=0 ttl=64 time=23.651 ms
64 bytes from 10.0.3.103: seq=1 ttl=64 time=0.610 ms

--- 10.0.3.103 ping statistics ---
2 packets transmitted, 2 packets received, 0% packet loss
round-trip min/avg/max = 0.610/12.130/23.651 ms
=+=+= NLAN Request to router:openwrt3,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ip netns exec ns3 ping -c 2 10.0.1.101
=+=+= NLAN Response from router:openwrt3,platform:openwrt =+=+=+=+=+=+=+=+=+=+
PING 10.0.1.101 (10.0.1.101): 56 data bytes
64 bytes from 10.0.1.101: seq=0 ttl=63 time=19.488 ms
64 bytes from 10.0.1.101: seq=1 ttl=63 time=1.863 ms

--- 10.0.1.101 ping statistics ---
2 packets transmitted, 2 packets received, 0% packet loss
round-trip min/avg/max = 1.863/10.675/19.488 ms
=+=+= NLAN Request to router:openwrt2,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ip netns exec ns1 ping -c 2 192.168.100.1
=+=+= NLAN Response from router:openwrt2,platform:openwrt =+=+=+=+=+=+=+=+=+=+
PING 192.168.100.1 (192.168.100.1): 56 data bytes
64 bytes from 192.168.100.1: seq=0 ttl=64 time=29.690 ms
64 bytes from 192.168.100.1: seq=1 ttl=64 time=2.544 ms

--- 192.168.100.1 ping statistics ---
2 packets transmitted, 2 packets received, 0% packet loss
round-trip min/avg/max = 2.544/16.117/29.690 ms
=+=+= NLAN Request to router:openwrt3,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ip netns exec ns1 ping -c 2 192.168.100.1
=+=+= NLAN Response from router:openwrt3,platform:openwrt =+=+=+=+=+=+=+=+=+=+
PING 192.168.100.1 (192.168.100.1): 56 data bytes
64 bytes from 192.168.100.1: seq=0 ttl=64 time=13.129 ms
64 bytes from 192.168.100.1: seq=1 ttl=64 time=4.314 ms

--- 192.168.100.1 ping statistics ---
2 packets transmitted, 2 packets received, 0% packet loss
round-trip min/avg/max = 4.314/8.721/13.129 ms
=+=+= NLAN Request to router:openwrt2,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ip netns exec ns3 ping -c 2 192.168.100.1
=+=+= NLAN Response from router:openwrt2,platform:openwrt =+=+=+=+=+=+=+=+=+=+
PING 192.168.100.1 (192.168.100.1): 56 data bytes
64 bytes from 192.168.100.1: seq=0 ttl=64 time=5.975 ms
64 bytes from 192.168.100.1: seq=1 ttl=64 time=1.192 ms

--- 192.168.100.1 ping statistics ---
2 packets transmitted, 2 packets received, 0% packet loss
round-trip min/avg/max = 1.192/3.583/5.975 ms
=+=+= NLAN Request to router:openwrt2,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ping -c 2 192.168.100.1
=+=+= NLAN Response from router:openwrt2,platform:openwrt =+=+=+=+=+=+=+=+=+=+
PING 192.168.100.1 (192.168.100.1): 56 data bytes
64 bytes from 192.168.100.1: seq=0 ttl=64 time=2.364 ms
64 bytes from 192.168.100.1: seq=1 ttl=64 time=0.888 ms

--- 192.168.100.1 ping statistics ---
2 packets transmitted, 2 packets received, 0% packet loss
round-trip min/avg/max = 0.888/1.626/2.364 ms
=+=+= NLAN Request to router:openwrt3,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ip netns exec ns3 ping -c 2 10.0.1.102
=+=+= NLAN Response from router:openwrt3,platform:openwrt =+=+=+=+=+=+=+=+=+=+
PING 10.0.1.102 (10.0.1.102): 56 data bytes
64 bytes from 10.0.1.102: seq=0 ttl=63 time=8.514 ms
64 bytes from 10.0.1.102: seq=1 ttl=63 time=3.353 ms

--- 10.0.1.102 ping statistics ---
2 packets transmitted, 2 packets received, 0% packet loss
round-trip min/avg/max = 3.353/5.933/8.514 ms
=+=+= NLAN Request to router:openwrt3,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ip netns exec ns3 ping -c 2 10.0.1.1
=+=+= NLAN Response from router:openwrt3,platform:openwrt =+=+=+=+=+=+=+=+=+=+
PING 10.0.1.1 (10.0.1.1): 56 data bytes
64 bytes from 10.0.1.1: seq=0 ttl=64 time=2.428 ms
64 bytes from 10.0.1.1: seq=1 ttl=64 time=0.692 ms

--- 10.0.1.1 ping statistics ---
2 packets transmitted, 2 packets received, 0% packet loss
round-trip min/avg/max = 0.692/1.560/2.428 ms
=+=+= NLAN Request to router:openwrt2,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ip netns exec ns3 ping -c 2 10.0.1.1
=+=+= NLAN Response from router:openwrt2,platform:openwrt =+=+=+=+=+=+=+=+=+=+
PING 10.0.1.1 (10.0.1.1): 56 data bytes
64 bytes from 10.0.1.1: seq=0 ttl=64 time=1.630 ms
64 bytes from 10.0.1.1: seq=1 ttl=64 time=0.214 ms

--- 10.0.1.1 ping statistics ---
2 packets transmitted, 2 packets received, 0% packet loss
round-trip min/avg/max = 0.214/0.922/1.630 ms
=+=+= NLAN Request to router:openwrt2,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ip netns exec ns1 ping -c 2 8.8.8.8
=+=+= NLAN Response from router:openwrt2,platform:openwrt =+=+=+=+=+=+=+=+=+=+
PING 8.8.8.8 (8.8.8.8): 56 data bytes

--- 8.8.8.8 ping statistics ---
2 packets transmitted, 0 packets received, 100% packet loss
=+=+= NLAN Request to router:openwrt2,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ip netns exec ns3 ping -c 2 8.8.8.8
=+=+= NLAN Response from router:openwrt2,platform:openwrt =+=+=+=+=+=+=+=+=+=+
PING 8.8.8.8 (8.8.8.8): 56 data bytes

--- 8.8.8.8 ping statistics ---
2 packets transmitted, 0 packets received, 100% packet loss
=+=+= NLAN Request to router:openwrt3,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ip netns exec ns1 ping -c 2 8.8.8.8
=+=+= NLAN Response from router:openwrt3,platform:openwrt =+=+=+=+=+=+=+=+=+=+
PING 8.8.8.8 (8.8.8.8): 56 data bytes

--- 8.8.8.8 ping statistics ---
2 packets transmitted, 0 packets received, 100% packet loss
=+=+= NLAN Request to router:openwrt3,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ip netns exec ns3 ping -c 2 8.8.8.8
=+=+= NLAN Response from router:openwrt3,platform:openwrt =+=+=+=+=+=+=+=+=+=+
PING 8.8.8.8 (8.8.8.8): 56 data bytes

--- 8.8.8.8 ping statistics ---
2 packets transmitted, 0 packets received, 100% packet loss
=+=+= NLAN Request to router:openwrt3,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
command: system.reboot
=+=+= NLAN Request to router:openwrt2,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
command: system.reboot
=+=+= NLAN Request to router:openwrt1,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
command: system.reboot
=+=+= NLAN Request to router:rpi1,platform:debian =+=+=+=+=+=+=+=+=+=+=+=+=+=+
command: system.reboot
=+=+= NLAN Response from router:openwrt3,platform:openwrt =+=+=+=+=+=+=+=+=+=+
__ NLAN response __
message:Execution completed
exit:0
=+=+= NLAN Response from router:openwrt2,platform:openwrt =+=+=+=+=+=+=+=+=+=+
__ NLAN response __
message:Execution completed
exit:0
=+=+= NLAN Response from router:openwrt1,platform:openwrt =+=+=+=+=+=+=+=+=+=+
__ NLAN response __
message:Execution completed
exit:0
=+=+= NLAN Response from router:rpi1,platform:debian +=+=+=+=+=+=+=+=+=+=+=+=+
__ NLAN response __
message:Execution completed
exit:0
=+=+= Transaction Summary =+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+

Start Time: 2014-04-23 00:54:11.196240

Router           Result    Elapsed Time
---------------------------------------
openwrt3          :-)         0.72(sec)
openwrt2          :-)         0.93(sec)
openwrt1          :-)         1.04(sec)
rpi1              :-)         1.89(sec)
Make sure all the systems have rebooted!
Enter to proceed the test: 
=+=+= NLAN Request to router:openwrt1,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ip netns add ns-global


OK. I will terminate the subprocesses...
cmd: ps -p 5577 h
=+=+= NLAN Request to router:openwrt1,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --raw
command: ip link add veth-global type veth peer name temp

OK. I will terminate the subprocesses...
cmd: ps -p 5586 h
subrocess:  5586 pts/0    Z+     0:00 [python] <defunct>

