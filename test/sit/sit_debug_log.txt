=+=+= Ping test to all the target routers =+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+
Router           Host           Ping
------------------------------------
openwrt3         192.168.1.103  OK
rpi1             192.168.1.104  OK
openwrt1         192.168.1.101  OK
openwrt2         192.168.1.102  OK
=+=+= NLAN Request to router:openwrt3,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
command: init.run
=+=+= NLAN Request to router:openwrt2,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
command: init.run
=+=+= NLAN Request to router:openwrt1,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
command: init.run
=+=+= NLAN Request to router:rpi1,platform:debian =+=+=+=+=+=+=+=+=+=+=+=+=+=+
command: init.run
--- STDOUT from router:openwrt3,platform:openwrt
[INFO] 2014-05-21 08:36:33,534 module:nlan_agent,function:<module>,router:openwrt3
NLAN Agent initialization completed
[DEBUG] 2014-05-21 08:36:33,537 module:nlan_agent,function:<module>,router:openwrt3
__n__: {'tables': {'services': {'max': 'unlimited', 'key': {'type': 'uuid', 'refTable': 'NLAN_Service'}, 'min': 0}, 'bridges': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_Bridges'}, 'min': 0}, 'gateway': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_Gateway'}, 'min': 0}, 'vxlan': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_VXLAN'}, 'min': 0}, 'subnets': {'max': 'unlimited', 'key': {'type': 'uuid', 'refTable': 'NLAN_Subnet'}, 'min': 0}}, 'agent_dir': '/opt/nlan', 'platform': 'openwrt', 'share_dir': '/opt/nlan/share', 'state_order': ['bridges', 'services', 'gateway', 'vxlan', 'subnets'], 'logger': <logging.Logger object at 0xb762982c>, 'router': 'openwrt3', 'schema': 'ovsdb_nlan.schema', 'types': {'services': {'name': {'max': 1, 'key': {'type': 'string'}, 'min': 1}, 'chain': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}}, 'bridges': {'controller': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'ovs_bridges': {'max': 1, 'key': {'enum': ['set', ['enabled']], 'type': 'string'}, 'min': 0}}, 'gateway': {'network': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'rip': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}, 'vxlan': {'remote_ips': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}, 'local_ip': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}, 'subnets': {'peers': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}, 'vid': {'max': 1, 'key': {'minInteger': 0, 'maxInteger': 4095, 'type': 'integer'}, 'min': 0}, 'ip_vhost': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'vni': {'max': 1, 'key': {'minInteger': 0, 'maxInteger': 16777215, 'type': 'integer'}, 'min': 1}, 'ip_dvr': {'max': 3, 'value': {'type': 'string'}, 'key': {'enum': ['set', ['addr', 'mode', 'dhcp']], 'type': 'string'}, 'min': 0}, 'default_gw': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'ports': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}}}, 'indexes': {'services': 'name', 'subnets': 'vni'}}
[INFO] 2014-05-21 08:36:33,577 module:nlan_agent,function:_route,router:openwrt3
function:init.run, args:()
[DEBUG] 2014-05-21 08:36:33,578 module:cmdutil,function:_cmd2,router:openwrt3
cmd: lxc-ls
[DEBUG] 2014-05-21 08:36:33,593 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-vsctl --if-exists del-br br-tun
[DEBUG] 2014-05-21 08:36:33,627 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-vsctl --if-exists del-br br-int
[DEBUG] 2014-05-21 08:36:33,774 module:cmdutil,function:_cmd2,router:openwrt3
cmd: brctl show
[DEBUG] 2014-05-21 08:36:33,784 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip link set dev veth-ns101 down
[DEBUG] 2014-05-21 08:36:33,801 module:cmdutil,function:_cmd2,router:openwrt3
cmd: brctl delif br101 veth-ns101
[DEBUG] 2014-05-21 08:36:33,819 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip link set dev veth-ns101 up
[DEBUG] 2014-05-21 08:36:33,830 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip link set dev br101 down
[DEBUG] 2014-05-21 08:36:33,837 module:cmdutil,function:_cmd2,router:openwrt3
cmd: brctl delbr br101
[DEBUG] 2014-05-21 08:36:33,848 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip link set dev veth-ns103 down
[DEBUG] 2014-05-21 08:36:33,862 module:cmdutil,function:_cmd2,router:openwrt3
cmd: brctl delif br103 veth-ns103
[DEBUG] 2014-05-21 08:36:33,874 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip link set dev veth-ns103 up
[DEBUG] 2014-05-21 08:36:33,882 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip link set dev br103 down
[DEBUG] 2014-05-21 08:36:33,889 module:cmdutil,function:_cmd2,router:openwrt3
cmd: brctl delbr br103
[DEBUG] 2014-05-21 08:36:33,901 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip link set dev veth-ns1 down
[DEBUG] 2014-05-21 08:36:33,914 module:cmdutil,function:_cmd2,router:openwrt3
cmd: brctl delif br1 veth-ns1
[DEBUG] 2014-05-21 08:36:33,92--- STDOUT from router:rpi1,platform:debian
[INFO] 2014-05-21 01:36:35,358 module:nlan_agent,function:<module>,router:rpi1
NLAN Agent initialization completed
[DEBUG] 2014-05-21 01:36:35,360 module:nlan_agent,function:<module>,router:rpi1
__n__: {'tables': {'services': {'max': 'unlimited', 'key': {'type': 'uuid', 'refTable': 'NLAN_Service'}, 'min': 0}, 'bridges': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_Bridges'}, 'min': 0}, 'gateway': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_Gateway'}, 'min': 0}, 'vxlan': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_VXLAN'}, 'min': 0}, 'subnets': {'max': 'unlimited', 'key': {'type': 'uuid', 'refTable': 'NLAN_Subnet'}, 'min': 0}}, 'agent_dir': '/opt/nlan', 'platform': 'debian', 'share_dir': '/opt/nlan/share', 'state_order': ['bridges', 'services', 'gateway', 'vxlan', 'subnets'], 'logger': <logging.Logger object at 0xb72546cc>, 'router': 'rpi1', 'schema': 'ovsdb_nlan.schema', 'types': {'services': {'name': {'max': 1, 'key': {'type': 'string'}, 'min': 1}, 'chain': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}}, 'bridges': {'controller': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'ovs_bridges': {'max': 1, 'key': {'enum': ['set', ['enabled']], 'type': 'string'}, 'min': 0}}, 'gateway': {'network': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'rip': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}, 'vxlan': {'remote_ips': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}, 'local_ip': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}, 'subnets': {'peers': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}, 'vid': {'max': 1, 'key': {'minInteger': 0, 'maxInteger': 4095, 'type': 'integer'}, 'min': 0}, 'ip_vhost': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'vni': {'max': 1, 'key': {'minInteger': 0, 'maxInteger': 16777215, 'type': 'integer'}, 'min': 1}, 'ip_dvr': {'max': 3, 'value': {'type': 'string'}, 'key': {'enum': ['set', ['addr', 'mode', 'dhcp']], 'type': 'string'}, 'min': 0}, 'default_gw': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'ports': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}}}, 'indexes': {'services': 'name', 'subnets': 'vni'}}
[INFO] 2014-05-21 01:36:35,398 module:nlan_agent,function:_route,router:rpi1
function:init.run, args:()
[DEBUG] 2014-05-21 01:36:35,400 module:cmdutil,function:_cmd2,router:rpi1
cmd: lxc-ls
[DEBUG] 2014-05-21 01:36:35,483 module:cmdutil,function:_cmd2,router:rpi1
cmd: lxc-stop -n snort1
[DEBUG] 2014-05-21 01:36:35,495 module:cmdutil,function:_cmd2,router:rpi1
cmd: lxc-stop -n snort2
[DEBUG] 2014-05-21 01:36:35,502 module:cmdutil,function:_cmd2,router:rpi1
cmd: ovs-vsctl --if-exists del-br br-tun
[DEBUG] 2014-05-21 01:36:35,533 module:cmdutil,function:_cmd2,router:rpi1
cmd: ovs-vsctl --if-exists del-br br-int
[DEBUG] 2014-05-21 01:36:35,585 module:cmdutil,function:_cmd2,router:rpi1
cmd: brctl show
[DEBUG] 2014-05-21 01:36:35,667 module:cmdutil,function:_cmd2,router:rpi1
cmd: ip link set dev dmz.1001 down
[DEBUG] 2014-05-21 01:36:35,701 module:cmdutil,function:_cmd2,router:rpi1
cmd: brctl delif br1001 dmz.1001
[DEBUG] 2014-05-21 01:36:35,732 module:cmdutil,function:_cmd2,router:rpi1
cmd: ip link set dev dmz.1001 up
[DEBUG] 2014-05-21 01:36:35,763 module:cmdutil,function:_cmd2,router:rpi1
cmd: ip link set dev br1001 down
[DEBUG] 2014-05-21 01:36:35,772 module:cmdutil,function:_cmd2,router:rpi1
cmd: brctl delbr br1001
[DEBUG] 2014-05-21 01:36:35,779 module:cmdutil,function:_cmd2,router:rpi1
cmd: ip link set dev mz.101 down
[DEBUG] 2014-05-21 01:36:35,791 module:cmdutil,function:_cmd2,router:rpi1
cmd: brctl delif br101 mz.101
[DEBUG] 2014-05-21 01:36:35,805 module:cmdutil,function:_cmd2,router:rpi1
cmd: ip link set dev mz.101 up
[DEBUG] 2014-05-21 01:36:35,815 module:cmdutil,function:_cmd2,router:rpi1
cmd: ip link set dev br101 down
[DEBUG] 2014-05-21 01:36:35,833 module:cmdutil,function:_cmd2,router:rpi1
cmd: brctl delbr br101
[DEBUG] 2014-05-21 01:36:35,843 module:cmdutil,function:_cmd2,router:rpi1
cmd: ip netns list
[DEBUG] 2014-05-21 01:36:35,902 module:ovsdb,function:_6 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip link set dev veth-ns1 up
[DEBUG] 2014-05-21 08:36:33,932 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip link set dev br1 down
[DEBUG] 2014-05-21 08:36:33,938 module:cmdutil,function:_cmd2,router:openwrt3
cmd: brctl delbr br1
[DEBUG] 2014-05-21 08:36:33,953 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip netns list
[DEBUG] 2014-05-21 08:36:33,959 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip netns del ns103
[DEBUG] 2014-05-21 08:36:33,965 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip netns del ns1
[DEBUG] 2014-05-21 08:36:33,974 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip netns del ns101
[DEBUG] 2014-05-21 08:36:34,008 module:ovsdb,function:_send,router:openwrt3
request:
  id: 25960
  method: transact
  params:
  - Open_vSwitch
  - columns:
    - vni
    - ip_dvr
    op: select
    table: NLAN_Subnet
    where: []
response:
  error: null
  id: 25960
  result:
  - rows:
    - ip_dvr:
      - map
      - - - addr
          - 10.0.1.1/24
        - - mode
          - spoke_dvr
      vni: 101
    - ip_dvr:
      - map
      - - - addr
          - 192.168.100.3/24
        - - mode
          - dvr
      vni: 1
    - ip_dvr:
      - map
      - - - addr
          - 10.0.3.1/24
        - - mode
          - dvr
      vni: 103
[DEBUG] 2014-05-21 08:36:34,017 module:ovsdb,function:_send,router:openwrt3
request:
  id: 628353
  method: transact
  params:
  - Open_vSwitch
  - op: delete
    table: NLAN
    where: []
response:
  error: null
  id: 628353
  result:
  - count: 1
[INFO] 2014-05-21 08:36:34,021 module:nlan_agent,function:<module>,router:openwrt3
NLAN Agent execution completed
--- RESPONSE from router:openwrt3,platform:openwrt
message: Execution completed
exit: 0
--- STDOUT from router:openwrt2,platform:openwrt
[INFO] 2014-05-21 08:36:32,708 module:nlan_agent,function:<module>,router:openwrt2
NLAN Agent initialization completed
[DEBUG] 2014-05-21 08:36:32,710 module:nlan_agent,function:<module>,router:openwrt2
__n__: {'tables': {'services': {'max': 'unlimited', 'key': {'type': 'uuid', 'refTable': 'NLAN_Service'}, 'min': 0}, 'bridges': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_Bridges'}, 'min': 0}, 'gateway': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_Gateway'}, 'min': 0}, 'vxlan': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_VXLAN'}, 'min': 0}, 'subnets': {'max': 'unlimited', 'key': {'type': 'uuid', 'refTable': 'NLAN_Subnet'}, 'min': 0}}, 'agent_dir': '/opt/nlan', 'platform': 'openwrt', 'share_dir': '/opt/nlan/share', 'state_order': ['bridges', 'services', 'gateway', 'vxlan', 'subnets'], 'logger': <logging.Logger object at 0xb75c886c>, 'router': 'openwrt2', 'schema': 'ovsdb_nlan.schema', 'types': {'services': {'name': {'max': 1, 'key': {'type': 'string'}, 'min': 1}, 'chain': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}}, 'bridges': {'controller': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'ovs_bridges': {'max': 1, 'key': {'enum': ['set', ['enabled']], 'type': 'string'}, 'min': 0}}, 'gateway': {'network': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'rip': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}, 'vxlan': {'remote_ips': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}, 'local_ip': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}, 'subnets': {'peers': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}, 'vid': {'max': 1, 'key': {'minInteger': 0, 'maxInteger': 4095, 'type': 'integer'}, 'min': 0}, 'ip_vhost': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'vni': {'max': 1, 'key': {'minInteger': 0, 'maxInteger': 16777215, 'type': 'integer'}, 'min': 1}, 'ip_dvr': {'max': 3, 'value': {'type': 'string'}, 'key': {'enum': ['set', ['addr', 'mode', 'dhcp']], 'type': 'string'}, 'min': 0}, 'default_gw': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'ports': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}}}, 'indexes': {'services': 'name', 'subnets': 'vni'}}
[INFO] 2014-05-21 08:36:32,750 module:nlan_agent,function:_route,router:openwrt2
function:init.run, args:()
[DEBUG] 2014-05-21 08:36:32,752 module:cmdutil,function:_cmd2,router:openwrt2
cmd: lxc-ls
[DEBUG] 2014-05-21 08:36:32,766 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-vsctl --if-exists del-br br-tun
[DEBUG] 2014-05-21 08:36:32,800 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-vsctl --if-exists del-br br-int
[DEBUG] 2014-05-21 08:36:32,955 module:cmdutil,function:_cmd2,router:openwrt2
cmd: brctl show
[DEBUG] 2014-05-21 08:36:32,966 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip link set dev veth-ns101 down
[DEBUG] 2014-05-21 08:36:32,999 module:cmdutil,function:_cmd2,router:openwrt2
cmd: brctl delif br101 veth-ns101
[DEBUG] 2014-05-21 08:36:33,044 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip link set dev veth-ns101 up
[DEBUG] 2014-05-21 08:36:33,073 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip link set dev br101 down
[DEBUG] 2014-05-21 08:36:33,084 module:cmdutil,function:_cmd2,router:openwrt2
cmd: brctl delbr br101
[DEBUG] 2014-05-21 08:36:33,108 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip link set dev veth-ns103 down
[DEBUG] 2014-05-21 08:36:33,148 module:cmdutil,function:_cmd2,router:openwrt2
cmd: brctl delif br103 veth-ns103
[DEBUG] 2014-05-21 08:36:33,199 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip link set dev veth-ns103 up
[DEBUG] 2014-05-21 08:36:33,209 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip link set dev br103 down
[DEBUG] 2014-05-21 08:36:33,218 module:cmdutil,function:_cmd2,router:openwrt2
cmd: brctl delbr br103
[DEBUG] 2014-05-21 08:36:33,232 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip link set dev veth-ns1 down
[DEBUG] 2014-05-21 08:36:33,245 module:cmdutil,function:_cmd2,router:openwrt2
cmd: brctl delif br1 veth-ns1
[DEBUG] 2014-05-21 08:36:33,26send,router:rpi1
request:
  id: 581307
  method: transact
  params:
  - Open_vSwitch
  - op: delete
    table: NLAN
    where: []
response:
  error: null
  id: 581307
  result:
  - count: 1
[INFO] 2014-05-21 01:36:35,905 module:nlan_agent,function:<module>,router:rpi1
NLAN Agent execution completed
--- RESPONSE from router:rpi1,platform:debian
message: Execution completed
exit: 0
0 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip link set dev veth-ns1 up
[DEBUG] 2014-05-21 08:36:33,265 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip link set dev br1 down
[DEBUG] 2014-05-21 08:36:33,271 module:cmdutil,function:_cmd2,router:openwrt2
cmd: brctl delbr br1
[DEBUG] 2014-05-21 08:36:33,282 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip netns list
[DEBUG] 2014-05-21 08:36:33,289 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip netns del ns101
[DEBUG] 2014-05-21 08:36:33,295 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip netns del ns1
[DEBUG] 2014-05-21 08:36:33,301 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip netns del ns103
[DEBUG] 2014-05-21 08:36:33,318 module:ovsdb,function:_send,router:openwrt2
request:
  id: 671900
  method: transact
  params:
  - Open_vSwitch
  - columns:
    - vni
    - ip_dvr
    op: select
    table: NLAN_Subnet
    where: []
response:
  error: null
  id: 671900
  result:
  - rows:
    - ip_dvr:
      - map
      - - - addr
          - 10.0.3.1/24
        - - mode
          - dvr
      vni: 103
    - ip_dvr:
      - map
      - - - addr
          - 192.168.100.2/24
        - - mode
          - dvr
      vni: 1
    - ip_dvr:
      - map
      - - - addr
          - 10.0.1.1/24
        - - mode
          - spoke_dvr
      vni: 101
[DEBUG] 2014-05-21 08:36:33,327 module:ovsdb,function:_send,router:openwrt2
request:
  id: 130278
  method: transact
  params:
  - Open_vSwitch
  - op: delete
    table: NLAN
    where: []
response:
  error: null
  id: 130278
  result:
  - count: 1
[INFO] 2014-05-21 08:36:33,331 module:nlan_agent,function:<module>,router:openwrt2
NLAN Agent execution completed
--- RESPONSE from router:openwrt2,platform:openwrt
message: Execution completed
exit: 0
--- STDOUT from router:openwrt1,platform:openwrt
[INFO] 2014-05-21 08:36:33,805 module:nlan_agent,function:<module>,router:openwrt1
NLAN Agent initialization completed
[DEBUG] 2014-05-21 08:36:33,807 module:nlan_agent,function:<module>,router:openwrt1
__n__: {'tables': {'services': {'max': 'unlimited', 'key': {'type': 'uuid', 'refTable': 'NLAN_Service'}, 'min': 0}, 'bridges': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_Bridges'}, 'min': 0}, 'gateway': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_Gateway'}, 'min': 0}, 'vxlan': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_VXLAN'}, 'min': 0}, 'subnets': {'max': 'unlimited', 'key': {'type': 'uuid', 'refTable': 'NLAN_Subnet'}, 'min': 0}}, 'agent_dir': '/opt/nlan', 'platform': 'openwrt', 'share_dir': '/opt/nlan/share', 'state_order': ['bridges', 'services', 'gateway', 'vxlan', 'subnets'], 'logger': <logging.Logger object at 0xb75cd80c>, 'router': 'openwrt1', 'schema': 'ovsdb_nlan.schema', 'types': {'services': {'name': {'max': 1, 'key': {'type': 'string'}, 'min': 1}, 'chain': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}}, 'bridges': {'controller': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'ovs_bridges': {'max': 1, 'key': {'enum': ['set', ['enabled']], 'type': 'string'}, 'min': 0}}, 'gateway': {'network': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'rip': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}, 'vxlan': {'remote_ips': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}, 'local_ip': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}, 'subnets': {'peers': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}, 'vid': {'max': 1, 'key': {'minInteger': 0, 'maxInteger': 4095, 'type': 'integer'}, 'min': 0}, 'ip_vhost': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'vni': {'max': 1, 'key': {'minInteger': 0, 'maxInteger': 16777215, 'type': 'integer'}, 'min': 1}, 'ip_dvr': {'max': 3, 'value': {'type': 'string'}, 'key': {'enum': ['set', ['addr', 'mode', 'dhcp']], 'type': 'string'}, 'min': 0}, 'default_gw': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'ports': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}}}, 'indexes': {'services': 'name', 'subnets': 'vni'}}
[INFO] 2014-05-21 08:36:33,838 module:nlan_agent,function:_route,router:openwrt1
function:init.run, args:()
[DEBUG] 2014-05-21 08:36:33,839 module:cmdutil,function:_cmd2,router:openwrt1
cmd: lxc-ls
[DEBUG] 2014-05-21 08:36:33,854 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-vsctl --if-exists del-br br-tun
[DEBUG] 2014-05-21 08:36:33,888 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-vsctl --if-exists del-br br-int
[DEBUG] 2014-05-21 08:36:34,020 module:cmdutil,function:_cmd2,router:openwrt1
cmd: brctl show
[DEBUG] 2014-05-21 08:36:34,036 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip link set dev veth-ns1001 down
[DEBUG] 2014-05-21 08:36:34,056 module:cmdutil,function:_cmd2,router:openwrt1
cmd: brctl delif br1001 veth-ns1001
[DEBUG] 2014-05-21 08:36:34,086 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip link set dev veth-ns1001 up
[DEBUG] 2014-05-21 08:36:34,095 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip link set dev br1001 down
[DEBUG] 2014-05-21 08:36:34,105 module:cmdutil,function:_cmd2,router:openwrt1
cmd: brctl delbr br1001
[DEBUG] 2014-05-21 08:36:34,185 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip link set dev veth-ns103 down
[DEBUG] 2014-05-21 08:36:34,196 module:cmdutil,function:_cmd2,router:openwrt1
cmd: brctl delif br103 veth-ns103
[DEBUG] 2014-05-21 08:36:34,215 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip link set dev veth-ns103 up
[DEBUG] 2014-05-21 08:36:34,229 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip link set dev br103 down
[DEBUG] 2014-05-21 08:36:34,240 module:cmdutil,function:_cmd2,router:openwrt1
cmd: brctl delbr br103
[DEBUG] 2014-05-21 08:36:34,267 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip link set dev veth-ns1 down
[DEBUG] 2014-05-21 08:36:34,279 module:cmdutil,function:_cmd2,router:openwrt1
cmd: brctl delif br1 veth-ns1
[DEBUG] 2014-05-21 08:36:34,295 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip link set dev veth-ns1 up
[DEBUG] 2014-05-21 08:36:34,307 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip link set dev br1 down
[DEBUG] 2014-05-21 08:36:34,315 module:cmdutil,function:_cmd2,router:openwrt1
cmd: brctl delbr br1
[DEBUG] 2014-05-21 08:36:34,328 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip netns list
[DEBUG] 2014-05-21 08:36:34,337 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip netns del ns-global
[DEBUG] 2014-05-21 08:36:34,349 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip netns del ns1001
[DEBUG] 2014-05-21 08:36:34,354 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip netns del ns103
[DEBUG] 2014-05-21 08:36:34,358 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip netns del ns1
[DEBUG] 2014-05-21 08:36:34,371 module:ovsdb,function:_send,router:openwrt1
request:
  id: 403284
  method: transact
  params:
  - Open_vSwitch
  - columns:
    - vni
    - ip_dvr
    op: select
    table: NLAN_Subnet
    where: []
response:
  error: null
  id: 403284
  result:
  - rows:
    - ip_dvr:
      - map
      - - - addr
          - 192.168.100.1/24
        - - mode
          - dvr
      vni: 1
    - ip_dvr:
      - map
      - - - addr
          - 10.0.3.1/24
        - - dhcp
          - enabled
        - - mode
          - dvr
      vni: 103
    - ip_dvr:
      - map
      - - - addr
          - 10.0.1.1/24
        - - dhcp
          - enabled
        - - mode
          - hub
      vni: 1001
[DEBUG] 2014-05-21 08:36:34,380 module:cmdutil,function:_cmd2,router:openwrt1
cmd: uci delete network.int_dvr103
[DEBUG] 2014-05-21 08:36:34,390 module:cmdutil,function:_cmd2,router:openwrt1
cmd: uci delete dhcp.int_dvr103
[DEBUG] 2014-05-21 08:36:34,395 module:cmdutil,function:_cmd2,router:openwrt1
cmd: uci commit
[DEBUG] 2014-05-21 08:36:34,424 module:cmdutil,function:_cmd2,router:openwrt1
cmd: /etc/init.d/network restart
[DEBUG] 2014-05-21 08:36:35,508 module:cmdutil,function:_cmd2,router:openwrt1
cmd: /etc/init.d/dnsmasq restart
[DEBUG] 2014-05-21 08:36:35,718 module:cmdutil,function:_cmd2,router:openwrt1
cmd: uci delete network.int_dvr1001
[DEBUG] 2014-05-21 08:36:35,735 module:cmdutil,function:_cmd2,router:openwrt1
cmd: uci delete dhcp.int_dvr1001
[DEBUG] 2014-05-21 08:36:35,764 module:cmdutil,function:_cmd2,router:openwrt1
cmd: uci commit
[DEBUG] 2014-05-21 08:36:35,811 module:cmdutil,function:_cmd2,router:openwrt1
cmd: /etc/init.d/network restart
[DEBUG] 2014-05-21 08:36:36,969 module:cmdutil,function:_cmd2,router:openwrt1
cmd: /etc/init.d/dnsmasq restart
[DEBUG] 2014-05-21 08:36:37,186 module:ovsdb,function:_send,router:openwrt1
request:
  id: 191014
  method: transact
  params:
  - Open_vSwitch
  - op: delete
    table: NLAN
    where: []
response:
  error: null
  id: 191014
  result:
  - count: 1
[INFO] 2014-05-21 08:36:37,188 module:nlan_agent,function:<module>,router:openwrt1
NLAN Agent execution completed
--- STDERR from router:openwrt1,platform:openwrt
Command failed: Not found
Command failed: Not found
--- RESPONSE from router:openwrt1,platform:openwrt
message: Execution completed
exit: 0
=+=+= Transaction Summary =+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+

Start Time: 2014-05-21 01:34:57.633801

Router           Result    Elapsed Time
---------------------------------------
openwrt3          :-)         1.64(sec)
rpi1              :-)         1.68(sec)
openwrt2          :-)         1.77(sec)
openwrt1          :-)         4.64(sec)
=+=+= Ping test to all the target routers =+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+
Router           Host           Ping
------------------------------------
openwrt2         192.168.1.102  OK
openwrt3         192.168.1.103  OK
rpi1             192.168.1.104  OK
openwrt1         192.168.1.101  OK
=+=+= NLAN Request to router:rpi1,platform:debian =+=+=+=+=+=+=+=+=+=+=+=+=+=+
operation: --add
dict_args: "OrderedDict([('bridges', {'ovs_bridges': 'enabled'}), ('services', [{'name': 'snort1', 'chain': ['mz.101', 'dmz.1001'], '_index': ['name', 'snort1']}]), ('vxlan', {'remote_ips': ['192.168.1.103', '192.168.1.102', '192.168.1.101'], 'local_ip': '192.168.1.104'}), ('subnets', [{'ports': ['dmz.1001'], 'peers': ['192.168.1.101'], 'vni': 1001, 'vid': 111, '_index': ['vni', 1001]}, {'ports': ['mz.101'], 'peers': ['192.168.1.102', '192.168.1.103'], 'vni': 101, 'vid': 1, '_index': ['vni', 101]}])])"
=+=+= NLAN Request to router:openwrt3,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --add
dict_args: "OrderedDict([('bridges', {'ovs_bridges': 'enabled'}), ('vxlan', {'remote_ips': ['192.168.1.102', '192.168.1.101', '192.168.1.104'], 'local_ip': '192.168.1.103'}), ('subnets', [{'peers': ['192.168.1.101', '192.168.1.102'], 'vid': 2, '_index': ['vni', 1], 'ip_vhost': '192.168.100.103/24', 'default_gw': '192.168.100.1', 'ip_dvr': OrderedDict([('addr', '192.168.100.3/24'), ('mode', 'dvr')]), 'vni': 1}, {'peers': ['192.168.1.101', '192.168.1.102'], 'vid': 3, '_index': ['vni', 103], 'ip_vhost': '10.0.3.103/24', 'vni': 103, 'ip_dvr': OrderedDict([('addr', '10.0.3.1/24'), ('mode', 'dvr')])}, {'peers': ['192.168.1.102', '192.168.1.104'], 'vid': 1, '_index': ['vni', 101], 'ip_vhost': '10.0.1.103/24', 'vni': 101, 'ip_dvr': OrderedDict([('addr', '10.0.1.1/24'), ('mode', 'spoke_dvr')])}])])"
=+=+= NLAN Request to router:openwrt2,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --add
dict_args: "OrderedDict([('bridges', {'ovs_bridges': 'enabled'}), ('vxlan', {'remote_ips': ['192.168.1.103', '192.168.1.101', '192.168.1.104'], 'local_ip': '192.168.1.102'}), ('subnets', [{'peers': ['192.168.1.101', '192.168.1.103'], 'vid': 2, '_index': ['vni', 1], 'ip_vhost': '192.168.100.102/24', 'default_gw': '192.168.100.1', 'ip_dvr': OrderedDict([('addr', '192.168.100.2/24'), ('mode', 'dvr')]), 'vni': 1}, {'peers': ['192.168.1.101', '192.168.1.103'], 'vid': 3, '_index': ['vni', 103], 'ip_vhost': '10.0.3.102/24', 'vni': 103, 'ip_dvr': OrderedDict([('addr', '10.0.3.1/24'), ('mode', 'dvr')])}, {'peers': ['192.168.1.103', '192.168.1.104'], 'vid': 1, '_index': ['vni', 101], 'ip_vhost': '10.0.1.102/24', 'vni': 101, 'ip_dvr': OrderedDict([('addr', '10.0.1.1/24'), ('mode', 'spoke_dvr')])}])])"
=+=+= NLAN Request to router:openwrt1,platform:openwrt +=+=+=+=+=+=+=+=+=+=+=+
operation: --add
dict_args: "OrderedDict([('bridges', {'ovs_bridges': 'enabled'}), ('gateway', {'network': 'eth2', 'rip': 'enabled'}), ('vxlan', {'remote_ips': ['192.168.1.103', '192.168.1.102', '192.168.1.104'], 'local_ip': '192.168.1.101'}), ('subnets', [{'peers': ['192.168.1.102', '192.168.1.103'], 'vid': 2, '_index': ['vni', 1], 'ip_vhost': '192.168.100.101/24', 'vni': 1, 'ip_dvr': OrderedDict([('addr', '192.168.100.1/24'), ('mode', 'dvr')])}, {'peers': ['192.168.1.102', '192.168.1.103'], 'vid': 3, '_index': ['vni', 103], 'ip_vhost': '10.0.3.101/24', 'vni': 103, 'ip_dvr': OrderedDict([('addr', '10.0.3.1/24'), ('mode', 'dvr'), ('dhcp', 'enabled')])}, {'peers': ['192.168.1.104'], 'vid': 1, '_index': ['vni', 1001], 'ip_vhost': '10.0.1.101/24', 'vni': 1001, 'ip_dvr': OrderedDict([('addr', '10.0.1.1/24'), ('mode', 'hub'), ('dhcp', 'enabled')])}])])"
--- STDOUT from router:openwrt2,platform:openwrt
[INFO] 2014-05-21 08:36:38,659 module:nlan_agent,function:<module>,router:openwrt2
NLAN Agent initialization completed
[DEBUG] 2014-05-21 08:36:38,660 module:nlan_agent,function:<module>,router:openwrt2
__n__: {'tables': {'services': {'max': 'unlimited', 'key': {'type': 'uuid', 'refTable': 'NLAN_Service'}, 'min': 0}, 'bridges': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_Bridges'}, 'min': 0}, 'gateway': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_Gateway'}, 'min': 0}, 'vxlan': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_VXLAN'}, 'min': 0}, 'subnets': {'max': 'unlimited', 'key': {'type': 'uuid', 'refTable': 'NLAN_Subnet'}, 'min': 0}}, 'agent_dir': '/opt/nlan', 'platform': 'openwrt', 'share_dir': '/opt/nlan/share', 'state_order': ['bridges', 'services', 'gateway', 'vxlan', 'subnets'], 'logger': <logging.Logger object at 0xb763dc4c>, 'router': 'openwrt2', 'schema': 'ovsdb_nlan.schema', 'types': {'services': {'name': {'max': 1, 'key': {'type': 'string'}, 'min': 1}, 'chain': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}}, 'bridges': {'controller': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'ovs_bridges': {'max': 1, 'key': {'enum': ['set', ['enabled']], 'type': 'string'}, 'min': 0}}, 'gateway': {'network': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'rip': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}, 'vxlan': {'remote_ips': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}, 'local_ip': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}, 'subnets': {'peers': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}, 'vid': {'max': 1, 'key': {'minInteger': 0, 'maxInteger': 4095, 'type': 'integer'}, 'min': 0}, 'ip_vhost': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'vni': {'max': 1, 'key': {'minInteger': 0, 'maxInteger': 16777215, 'type': 'integer'}, 'min': 1}, 'ip_dvr': {'max': 3, 'value': {'type': 'string'}, 'key': {'enum': ['set', ['addr', 'mode', 'dhcp']], 'type': 'string'}, 'min': 0}, 'default_gw': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'ports': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}}}, 'indexes': {'services': 'name', 'subnets': 'vni'}}
[INFO] 2014-05-21 08:36:38,763 module:nlan_agent,function:_route,router:openwrt2
function:bridges.add, model:{'ovs_bridges': 'enabled'}
[DEBUG] 2014-05-21 08:36:38,777 module:ovsdb,function:_send,router:openwrt2
request:
  id: 693796
  method: transact
  params:
  - Open_vSwitch
  - op: select
    table: NLAN
    where: []
response:
  error: null
  id: 693796
  result:
  - rows: []
[DEBUG] 2014-05-21 08:36:38,781 module:ovsdb,function:_send,router:openwrt2
request:
  id: 432043
  method: transact
  params:
  - Open_vSwitch
  - op: insert
    row: {}
    table: NLAN
response:
  error: null
  id: 432043
  result:
  - uuid:
    - uuid
    - bfc3093f-e074-4c45-a638-3a65c8b5319d
[DEBUG] 2014-05-21 08:36:38,786 module:ovsdb,function:_send,router:openwrt2
request:
  id: 460334
  method: transact
  params:
  - Open_vSwitch
  - op: select
    table: NLAN_Bridges
    where: []
response:
  error: null
  id: 460334
  result:
  - rows: []
[INFO] 2014-05-21 08:36:38,788 module:bridges,function:add,router:openwrt2
Adding bridges: br-int and br-tun
[DEBUG] 2014-05-21 08:36:38,827 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-vsctl add-br br-int
[DEBUG] 2014-05-21 08:36:38,865 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-vsctl add-br br-tun
[DEBUG] 2014-05-21 08:36:38,916 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-ofctl del-flows br-tun
[DEBUG] 2014-05-21 08:36:38,930 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-vsctl add-port br-int patch-int -- set interface patch-int type=patch options:peer=patch-tun
[DEBUG] 2014-05-21 08:36:38,961 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-vsctl add-port br-tun patch-tun -- set interface patch-tun type=patch options:peer=patch-int
[DEBUG] 2014-05-21 08:36:38,988 module:ovsdb,function:_send,router:openwrt2
request:
  id: 385989
  method: transact
  params:
  - Open_vSwitch
  - op: select
    table: Interface
    where:
    - - name
      - ==
      - patch-tun
response:
  error: null
  id: 385989
  result:
  - rows:
    - _uuid:
      - uuid
      - b209db20-8ddf-4a02-b5de-2ae5992c8152
      _version:
      - uuid
      - 61bd2d3c-05a0-4820-abad-8cf7ca4452d4
      admin_state:
      - set
      - []
      bfd:
      - map
      - []
      bfd_status:
      - map
      - []
      cfm_fault:
      - set
      - []
      cfm_fault_status:
      - set
      - []
      cfm_flap_count:
      - set
      - []
      cfm_health:
      - set
      - []
      cfm_mpid:
      - set
      - []
      cfm_remote_mpids:
      - set
      - []
      cfm_remote_opstate:
      - set
      - []
      duplex:
      - set
      - []
      external_ids:
      - map
      - []
      ifindex: 0
      ingress_policing_burst: 0
      ingress_policing_rate: 0
      lacp_current:
      - set
      - []
      link_resets:
      - set
      - []
      link_speed:
      - set
      - []
      link_state:
      - set
      - []
      mac:
      - set
      - []
      mac_in_use: 62:36:8e:d3:c0:84
      mtu:
      - set
      - []
      name: patch-tun
      ofport: 1
      ofport_request:
      - set
      - []
      options:
      - map
      - - - peer
          - patch-int
      other_config:
      - map
      - []
      statistics:
      - map
      - - - collisions
          - 0
        - - rx_bytes
          - 0
        - - rx_crc_err
          - 0
        - - rx_dropped
          - 0
        - - rx_errors
          - 0
        - - rx_frame_err
          - 0
        - - rx_over_err
          - 0
        - - rx_packets
          - 0
        - - tx_bytes
          - 0
        - - tx_dropped
          - 0
        - - tx_errors
          - 0
        - - tx_packets
          - 0
      status:
      - map
      - []
      type: patch
[DEBUG] 2014-05-21 08:36:39,007 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-ofctl add-flow br-tun table=0,priority=1,in_port=1,actions=resubmit(,1)
[DEBUG] 2014-05-21 08:36:39,018 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-ofctl add-flow br-tun table=0,priority=0,actions=drop
[DEBUG] 2014-05-21 08:36:39,028 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-ofctl add-flow br-tun table=1,priority=0,dl_dst=01:00:00:00:00:00/01:00:00:00:00:00,actions=resubmit(,19)
[DEBUG] 2014-05-21 08:36:39,038 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-ofctl add-flow br-tun table=1,priority=0,dl_dst=00:00:00:00:00:00/01:00:00:00:00:00,actions=resubmit(,20)
[DEBUG] 2014-05-21 08:36:39,050 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-ofctl add-flow br-tun table=2,priority=0,actions=drop
[DEBUG] 2014-05-21 08:36:39,063 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-ofctl add-flow br-tun table=3,priority=0,actions=drop
[DEBUG] 2014-05-21 08:36:39,075 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-ofctl add-flow br-tun table=10,priority=1,actions=learn(table=20,hard_timeout=300,priority=1,NXM_OF_VLAN_TCI[0..11],NXM_OF_ETH_DST[]=NXM_OF_ETH_SRC[],load:0->NXM_OF_VLAN_TCI[],load:NXM_NX_TUN_ID[]->NXM_NX_TUN_ID[],output:NXM_OF_IN_PORT[]),output:1
[DEBUG] 2014-05-21 08:36:39,086 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-ofctl add-flow br-tun table=19,priority=0,actions=resubmit(,21)
[DEBUG] 2014-05-21 08:36:39,097 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-ofctl add-flow br-tun table=20,priority=0,actions=resubmit(,21)
[DEBUG] 2014-05-21 08:36:39,108 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-ofctl add-flow br-tun table=21,priority=0,actions=drop
[DEBUG] 2014-05-21 08:36:39,118 module:ovsdb,function:crud,router:openwrt2
CRUD operation (add): {'ovs_bridges': 'enabled'}
[DEBUG] 2014-05-21 08:36:39,121 module:ovsdb,function:_send,router:openwrt2
request:
  id: 697492
  method: transact
  params:
  - Open_vSwitch
  - op: insert
    row:
      ovs_bridges: enabled
    table: NLAN_Bridges
    uuid-name: temp_203918
  - mutations:
    - - bridges
      - insert
      - - set
        - - - named-uuid
            - temp_203918
    op: mutate
    table: NLAN
    where: []
response:
  error: null
  id: 697492
  result:
  - uuid:
    - uuid
    - 821e2b29-9d08-4fee-a074-2188308e90c3
  - count: 1
[DEBUG] 2014-05-21 08:36:39,127 module:ovsdb,function:_send,router:openwrt2
request:
  id: 994517
  method: transact
  params:
  - Open_vSwitch
  - op: select
    table: NLAN_Bridges
    where: []
response:
  error: null
  id: 994517
  result:
  - rows:
    - _uuid:
      - uuid
      - 821e2b29-9d08-4fee-a074-2188308e90c3
      _version:
      - uuid
      - f8240352-a96b-4381-85d1-1b445c1c04c6
      controller:
      - set
      - []
      ovs_bridges: enabled
[INFO] 2014-05-21 08:36:39,134 module:nlan_agent,function:_route,router:openwrt2
function:vxlan.add, model:{'remote_ips': ['192.168.1.103', '192.168.1.101', '192.168.1.104'], 'local_ip': '192.168.1.102'}
[DEBUG] 2014-05-21 08:36:39,137 module:ovsdb,function:_send,router:openwrt2
request:
  id: 301459
  method: transact
  params:
  - Open_vSwitch
  - op: select
    table: NLAN
    where: []
response:
  error: null
  id: 301459
  result:
  - rows:
    - _uuid:
      - uuid
      - bfc3093f-e074-4c45-a638-3a65c8b5319d
      _version:
      - uuid
      - 8b8b4b08-a5d1-480f-8dcd-261ca08e63ed
      bridges:
      - uuid
      - 821e2b29-9d08-4fee-a074-2188308e90c3
      gateway:
      - set
      - []
      services:
      - set
      - []
      subnets:
      - set
      - []
      vxlan:
      - set
      - []
[DEBUG] 2014-05-21 08:36:39,144 module:ovsdb,function:_send,router:openwrt2
request:
  id: 221441
  method: transact
  params:
  - Open_vSwitch
  - op: select
    table: NLAN_VXLAN
    where: []
response:
  error: null
  id: 221441
  result:
  - rows: []
[INFO] 2014-05-21 08:36:39,150 module:vxlan,function:add,router:openwrt2
Adding a VXLAN tunnel: vxlan_192.168.1.103
[DEBUG] 2014-05-21 08:36:39,151 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-vsctl add-port br-tun vxlan_192.168.1.103 -- set interface vxlan_192.168.1.103 type=vxlan options:in_key=flow options:local_ip=192.168.1.102 options:out_key=flow options:remote_ip=192.168.1.103
[INFO] 2014-05-21 08:36:39,174 module:vxlan,function:add,router:openwrt2
Adding a VXLAN tunnel: vxlan_192.168.1.101
[DEBUG] 2014-05-21 08:36:39,175 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-vsctl add-port br-tun vxlan_192.168.1.101 -- set interface vxlan_192.168.1.101 type=vxlan options:in_key=flow options:local_ip=192.168.1.102 options:out_key=flow options:remote_ip=192.168.1.101
[INFO] 2014-05-21 08:36:39,202 module:vxlan,function:add,router:openwrt2
Adding a VXLAN tunnel: vxlan_192.168.1.104
[DEBUG] 2014-05-21 08:36:39,203 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-vsctl add-port br-tun vxlan_192.168.1.104 -- set interface vxlan_192.168.1.104 type=vxlan options:in_key=flow options:local_ip=192.168.1.102 options:out_key=flow options:remote_ip=192.168.1.104
[DEBUG] 2014-05-21 08:36:39,233 module:ovsdb,function:_send,router:openwrt2
request:
  id: 643069
  method: transact
  params:
  - Open_vSwitch
  - columns:
    - ofport
    - options
    op: select
    table: Interface
    where:
    - - type
      - ==
      - vxlan
response:
  error: null
  id: 643069
  result:
  - rows:
    - ofport: 3
      options:
      - map
      - - - in_key
          - flow
        - - local_ip
          - 192.168.1.102
        - - out_key
          - flow
        - - remote_ip
          - 192.168.1.101
    - ofport: 2
      options:
      - map
      - - - in_key
          - flow
        - - local_ip
          - 192.168.1.102
        - - out_key
          - flow
        - - remote_ip
          - 192.168.1.103
    - ofport: 4
      options:
      - map
      - - - in_key
          - flow
        - - local_ip
          - 192.168.1.102
        - - out_key
          - flow
        - - remote_ip
          - 192.168.1.104
[DEBUG] 2014-05-21 08:36:39,241 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-ofctl add-flow br-tun table=0,priority=1,in_port=3,actions=resubmit(,2)
[DEBUG] 2014-05-21 08:36:39,252 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-ofctl add-flow br-tun table=0,priority=1,in_port=2,actions=resubmit(,2)
[DEBUG] 2014-05-21 08:36:39,267 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-ofctl add-flow br-tun table=0,priority=1,in_port=4,actions=resubmit(,2)
[DEBUG] 2014-05-21 08:36:39,279 module:ovsdb,function:crud,router:openwrt2
CRUD operation (add): {'remote_ips': ['192.168.1.103', '192.168.1.101', '192.168.1.104'], 'local_ip': '192.168.1.102'}
[DEBUG] 2014-05-21 08:36:39,284 module:ovsdb,function:_send,router:openwrt2
request:
  id: 149360
  method: transact
  params:
  - Open_vSwitch
  - op: insert
    row:
      local_ip: 192.168.1.102
      remote_ips:
      - set
      - - 192.168.1.103
        - 192.168.1.101
        - 192.168.1.104
    table: NLAN_VXLAN
    uuid-name: temp_844279
  - mutations:
    - - vxlan
      - insert
      - - set
        - - - named-uuid
            - temp_844279
    op: mutate
    table: NLAN
    where: []
response:
  error: null
  id: 149360
  result:
  - uuid:
    - uuid
    - a150a0b3-afdf-4ac3-acc9-9ecfc018a360
  - count: 1
[DEBUG] 2014-05-21 08:36:39,289 module:ovsdb,function:_send,router:openwrt2
request:
  id: 753816
  method: transact
  params:
  - Open_vSwitch
  - op: select
    table: NLAN_VXLAN
    where: []
response:
  error: null
  id: 753816
  result:
  - rows:
    - _uuid:
      - uuid
      - a150a0b3-afdf-4ac3-acc9-9ecfc018a360
      _version:
      - uuid
      - cce7e7cc-fd40-4d80-a901-a9f29fb104d5
      local_ip: 192.168.1.102
      remote_ips:
      - set
      - - 192.168.1.101
        - 192.168.1.103
        - 192.168.1.104
[INFO] 2014-05-21 08:36:39,309 module:nlan_agent,function:_route,router:openwrt2
function:subnets.add, index:['vni', 1], model:{'peers': ['192.168.1.101', '192.168.1.103'], 'vid': 2, 'ip_vhost': '192.168.100.102/24', 'default_gw': '192.168.100.1', 'ip_dvr': OrderedDict([('addr', '192.168.100.2/24'), ('mode', 'dvr')]), 'vni': 1}
[DEBUG] 2014-05-21 08:36:39,312 module:ovsdb,function:_send,router:openwrt2
request:
  id: 265882
  method: transact
  params:
  - Open_vSwitch
  - op: select
    table: NLAN
    where: []
response:
  error: null
  id: 265882
  result:
  - rows:
    - _uuid:
      - uuid
      - bfc3093f-e074-4c45-a638-3a65c8b5319d
      _version:
      - uuid
      - 703c2144-e2b0-4aea-9d75-282704e09b02
      bridges:
      - uuid
      - 821e2b29-9d08-4fee-a074-2188308e90c3
      gateway:
      - set
      - []
      services:
      - set
      - []
      subnets:
      - set
      - []
      vxlan:
      - uuid
      - a150a0b3-afdf-4ac3-acc9-9ecfc018a360
[DEBUG] 2014-05-21 08:36:39,320 module:ovsdb,function:_send,router:openwrt2
request:
  id: 120457
  method: transact
  params:
  - Open_vSwitch
  - op: select
    table: NLAN_Subnet
    where:
    - - vni
      - ==
      - 1
response:
  error: null
  id: 120457
  result:
  - rows: []
[INFO] 2014-05-21 08:36:39,325 module:subnets,function:add,router:openwrt2
Adding a subnet(vlan): 2
[DEBUG] 2014-05-21 08:36:39,326 module:cmdutil,function:_cmd2,router:openwrt2
cmd: brctl addbr br1
[DEBUG] 2014-05-21 08:36:39,339 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-vsctl add-port br-int int_br1 tag=2 -- set interface int_br1 type=internal
[DEBUG] 2014-05-21 08:36:39,385 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-vsctl add-port br-int int_dvr1 tag=2 -- set interface int_dvr1 type=internal
[DEBUG] 2014-05-21 08:36:39,435 module:cmdutil,function:_cmd2,router:openwrt2
cmd: brctl addif br1 int_br1
[DEBUG] 2014-05-21 08:36:39,450 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip link set dev int_br1 promisc on
[DEBUG] 2014-05-21 08:36:39,457 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip link set dev int_br1 up
[DEBUG] 2014-05-21 08:36:39,468 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip link set dev int_dvr1 up
[DEBUG] 2014-05-21 08:36:39,474 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip link set dev br1 up
[DEBUG] 2014-05-21 08:36:39,488 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip netns add ns1
[DEBUG] 2014-05-21 08:36:39,498 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip link add veth-ns1 type veth peer name temp-ns1
[DEBUG] 2014-05-21 08:36:39,515 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip link set dev temp-ns1 netns ns1
[DEBUG] 2014-05-21 08:36:39,521 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip netns exec ns1 ip link set dev temp-ns1 name eth0
[DEBUG] 2014-05-21 08:36:39,532 module:cmdutil,function:_cmd2,router:openwrt2
cmd: brctl addif br1 veth-ns1
[DEBUG] 2014-05-21 08:36:39,550 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip link set dev veth-ns1 promisc on
[DEBUG] 2014-05-21 08:36:39,556 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip link set dev veth-ns1 up
[DEBUG] 2014-05-21 08:36:39,575 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip netns exec ns1 ip link set dev eth0 up
[DEBUG] 2014-05-21 08:36:39,591 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip netns exec ns1 ip addr add dev eth0 192.168.100.102/24
[DEBUG] 2014-05-21 08:36:39,601 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip netns exec ns1 ip route add default via 192.168.100.2 dev eth0
[DEBUG] 2014-05-21 08:36:39,611 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip addr add dev int_dvr1 192.168.100.2/24
[DEBUG] 2014-05-21 08:36:39,617 module:cmdutil,function:_cmd2,router:openwrt2
cmd: route
[DEBUG] 2014-05-21 08:36:39,624 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip route add default via 192.168.100.1
[DEBUG] 2014-05-21 08:36:39,630 module:ovsdb,function:_send,router:openwrt2
request:
  id: 122812
  method: transact
  params:
  - Open_vSwitch
  - columns:
    - target
    op: select
    table: Controller
    where: []
response:
  error: null
  id: 122812
  result:
  - rows: []
[DEBUG] 2014-05-21 08:36:39,632 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-ofctl add-flow br-tun table=2,priority=1,tun_id=1,actions=mod_vlan_vid:2,resubmit(,10)
[DEBUG] 2014-05-21 08:36:39,642 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-ofctl add-flow br-tun table=19,priority=1,dl_type=0x0806,dl_vlan=2,nw_dst=192.168.100.2,actions=drop
[DEBUG] 2014-05-21 08:36:39,654 module:ovsdb,function:_send,router:openwrt2
request:
  id: 538900
  method: transact
  params:
  - Open_vSwitch
  - columns:
    - ofport
    - options
    op: select
    table: Interface
    where:
    - - type
      - ==
      - vxlan
response:
  error: null
  id: 538900
  result:
  - rows:
    - ofport: 3
      options:
      - map
      - - - in_key
          - flow
        - - local_ip
          - 192.168.1.102
        - - out_key
          - flow
        - - remote_ip
          - 192.168.1.101
    - ofport: 2
      options:
      - map
      - - - in_key
          - flow
        - - local_ip
          - 192.168.1.102
        - - out_key
          - flow
        - - remote_ip
          - 192.168.1.103
    - ofport: 4
      options:
      - map
      - - - in_key
          - flow
        - - local_ip
          - 192.168.1.102
        - - out_key
          - flow
        - - remote_ip
          - 192.168.1.104
[DEBUG] 2014-05-21 08:36:39,663 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-ofctl add-flow br-tun table=21,priority=1,dl_vlan=2,actions=strip_vlan,set_tunnel:1,output:3,output:2
[DEBUG] 2014-05-21 08:36:39,673 module:ovsdb,function:crud,router:openwrt2
CRUD operation (add): {'peers': ['192.168.1.101', '192.168.1.103'], 'vid': 2, 'ip_vhost': '192.168.100.102/24', 'default_gw': '192.168.100.1', 'ip_dvr': OrderedDict([('addr', '192.168.100.2/24'), ('mode', 'dvr')]), 'vni': 1}
[DEBUG] 2014-05-21 08:36:39,676 module:ovsdb,function:_send,router:openwrt2
request:
  id: 618979
  method: transact
  params:
  - Open_vSwitch
  - op: insert
    row:
      default_gw: 192.168.100.1
      ip_dvr:
      - map
      - - - addr
          - 192.168.100.2/24
        - - mode
          - dvr
      ip_vhost: 192.168.100.102/24
      peers:
      - set
      - - 192.168.1.101
        - 192.168.1.103
      vid: 2
      vni: 1
    table: NLAN_Subnet
    uuid-name: temp_333552
  - mutations:
    - - subnets
      - insert
      - - set
        - - - named-uuid
            - temp_333552
    op: mutate
    table: NLAN
    where: []
response:
  error: null
  id: 618979
  result:
  - uuid:
    - uuid
    - 89b36f76-0a3e-4747-88b3-e8c04d1a865d
  - count: 1
[DEBUG] 2014-05-21 08:36:39,680 module:ovsdb,function:_send,router:openwrt2
request:
  id: 255779
  method: transact
  params:
  - Open_vSwitch
  - op: select
    table: NLAN_Subnet
    where:
    - - vni
      - ==
      - 1
response:
  error: null
  id: 255779
  result:
  - rows:
    - _uuid:
      - uuid
      - 89b36f76-0a3e-4747-88b3-e8c04d1a865d
      _version:
      - uuid
      - 119e67a6-df09-4457-b47b-8bd7bb50e7c4
      default_gw: 192.168.100.1
      ip_dvr:
      - map
      - - - addr
          - 192.168.100.2/24
        - - mode
          - dvr
      ip_vhost: 192.168.100.102/24
      peers:
      - set
      - - 192.168.1.101
        - 192.168.1.103
      ports:
      - set
      - []
      vid: 2
      vni: 1
[INFO] 2014-05-21 08:36:39,687 module:nlan_agent,function:_route,router:openwrt2
function:subnets.add, index:['vni', 103], model:{'peers': ['192.168.1.101', '192.168.1.103'], 'vid': 3, 'ip_vhost': '10.0.3.102/24', 'vni': 103, 'ip_dvr': OrderedDict([('addr', '10.0.3.1/24'), ('mode', 'dvr')])}
[DEBUG] 2014-05-21 08:36:39,689 module:ovsdb,function:_send,router:openwrt2
request:
  id: 189891
  method: transact
  params:
  - Open_vSwitch
  - op: select
    table: NLAN
    where: []
response:
  error: null
  id: 189891
  result:
  - rows:
    - _uuid:
      - uuid
      - bfc3093f-e074-4c45-a638-3a65c8b5319d
      _version:
      - uuid
      - d0cef3d6-ffd2-4ddc-b0bc-a81662300405
      bridges:
      - uuid
      - 821e2b29-9d08-4fee-a074-2188308e90c3
      gateway:
      - set
      - []
      services:
      - set
      - []
      subnets:
      - uuid
      - 89b36f76-0a3e-4747-88b3-e8c04d1a865d
      vxlan:
      - uuid
      - a150a0b3-afdf-4ac3-acc9-9ecfc018a360
[DEBUG] 2014-05-21 08:36:39,697 module:ovsdb,function:_send,router:openwrt2
request:
  id: 779566
  method: transact
  params:
  - Open_vSwitch
  - op: select
    table: NLAN_Subnet
    where:
    - - vni
      - ==
      - 103
response:
  error: null
  id: 779566
  result:
  - rows: []
[INFO] 2014-05-21 08:36:39,703 module:subnets,function:add,router:openwrt2
Adding a subnet(vlan): 3
[DEBUG] 2014-05-21 08:36:39,705 module:cmdutil,function:_cmd2,router:openwrt2
cmd: brctl addbr br103
[DEBUG] 2014-05-21 08:36:39,715 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-vsctl add-port br-int int_br103 tag=3 -- set interface int_br103 type=internal
[DEBUG] 2014-05-21 08:36:39,759 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-vsctl add-port br-int int_dvr103 tag=3 -- set interface int_dvr103 type=internal
[DEBUG] 2014-05-21 08:36:39,807 module:cmdutil,function:_cmd2,router:openwrt2
cmd: brctl addif br103 int_br103
[DEBUG] 2014-05-21 08:36:39,820 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip link set dev int_br103 promisc on
[DEBUG] 2014-05-21 08:36:39,829 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip link set dev int_br103 up
[DEBUG] 2014-05-21 08:36:39,835 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip link set dev int_dvr103 up
[DEBUG] 2014-05-21 08:36:39,839 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip link set dev br103 up
[DEBUG] 2014-05-21 08:36:39,850 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip netns add ns103
[DEBUG] 2014-05-21 08:36:39,861 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip link add veth-ns103 type veth peer name temp-ns103
[DEBUG] 2014-05-21 08:36:39,874 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip link set dev temp-ns103 netns ns103
[DEBUG] 2014-05-21 08:36:39,881 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip netns exec ns103 ip link set dev temp-ns103 name eth0
[DEBUG] 2014-05-21 08:36:39,892 module:cmdutil,function:_cmd2,router:openwrt2
cmd: brctl addif br103 veth-ns103
[DEBUG] 2014-05-21 08:36:39,910 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip link set dev veth-ns103 promisc on
[DEBUG] 2014-05-21 08:36:39,917 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip link set dev veth-ns103 up
[DEBUG] 2014-05-21 08:36:39,937 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip netns exec ns103 ip link set dev eth0 up
[DEBUG] 2014-05-21 08:36:39,956 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip netns exec ns103 ip addr add dev eth0 10.0.3.102/24
[DEBUG] 2014-05-21 08:36:39,967 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip netns exec ns103 ip route add default via 10.0.3.1 dev eth0
[DEBUG] 2014-05-21 08:36:39,973 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip addr add dev int_dvr103 10.0.3.1/24
[DEBUG] 2014-05-21 08:36:39,980 module:ovsdb,function:_send,router:openwrt2
request:
  id: 839385
  method: transact
  params:
  - Open_vSwitch
  - columns:
    - target
    op: select
    table: Controller
    where: []
response:
  error: null
  id: 839385
  result:
  - rows: []
[DEBUG] 2014-05-21 08:36:39,983 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-ofctl add-flow br-tun table=2,priority=1,tun_id=103,actions=mod_vlan_vid:3,resubmit(,10)
[DEBUG] 2014-05-21 08:36:39,993 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-ofctl add-flow br-tun table=19,priority=1,dl_type=0x0806,dl_vlan=3,nw_dst=10.0.3.1,actions=drop
[DEBUG] 2014-05-21 08:36:40,006 module:ovsdb,function:_send,router:openwrt2
request:
  id: 842151
  method: transact
  params:
  - Open_vSwitch
  - columns:
    - ofport
    - options
    op: select
    table: Interface
    where:
    - - type
      - ==
      - vxlan
response:
  error: null
  id: 842151
  result:
  - rows:
    - ofport: 3
      options:
      - map
      - - - in_key
          - flow
        - - local_ip
          - 192.168.1.102
        - - out_key
          - flow
        - - remote_ip
          - 192.168.1.101
    - ofport: 2
      options:
      - map
      - - - in_key
          - flow
        - - local_ip
          - 192.168.1.102
        - - out_key
          - flow
        - - remote_ip
          - 192.168.1.103
    - ofport: 4
      options:
      - map
      - - - in_key
          - flow
        - - local_ip
          - 192.168.1.102
        - - out_key
          - flow
        - - remote_ip
          - 192.168.1.104
[DEBUG] 2014-05-21 08:36:40,013 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-ofctl add-flow br-tun table=21,priority=1,dl_vlan=3,actions=strip_vlan,set_tunnel:103,output:3,output:2
[DEBUG] 2014-05-21 08:36:40,023 module:ovsdb,function:crud,router:openwrt2
CRUD operation (add): {'peers': ['192.168.1.101', '192.168.1.103'], 'vid': 3, 'ip_vhost': '10.0.3.102/24', 'vni': 103, 'ip_dvr': OrderedDict([('addr', '10.0.3.1/24'), ('mode', 'dvr')])}
[DEBUG] 2014-05-21 08:36:40,027 module:ovsdb,function:_send,router:openwrt2
request:
  id: 72250
  method: transact
  params:
  - Open_vSwitch
  - op: insert
    row:
      ip_dvr:
      - map
      - - - addr
          - 10.0.3.1/24
        - - mode
          - dvr
      ip_vhost: 10.0.3.102/24
      peers:
      - set
      - - 192.168.1.101
        - 192.168.1.103
      vid: 3
      vni: 103
    table: NLAN_Subnet
    uuid-name: temp_655942
  - mutations:
    - - subnets
      - insert
      - - set
        - - - named-uuid
            - temp_655942
    op: mutate
    table: NLAN
    where: []
response:
  error: null
  id: 72250
  result:
  - uuid:
    - uuid
    - 53beddb8-c0d0-4b4f-8f8b-e499d069ec39
  - count: 1
[DEBUG] 2014-05-21 08:36:40,031 module:ovsdb,function:_send,router:openwrt2
request:
  id: 224650
  method: transact
  params:
  - Open_vSwitch
  - op: select
    table: NLAN_Subnet
    where:
    - - vni
      - ==
      - 103
response:
  error: null
  id: 224650
  result:
  - rows:
    - _uuid:
      - uuid
      - 53beddb8-c0d0-4b4f-8f8b-e499d069ec39
      _version:
      - uuid
      - 7aebe8d1-c238-418a-87fb-5bb56200391b
      default_gw:
      - set
      - []
      ip_dvr:
      - map
      - - - addr
          - 10.0.3.1/24
        - - mode
          - dvr
      ip_vhost: 10.0.3.102/24
      peers:
      - set
      - - 192.168.1.101
        - 192.168.1.103
      ports:
      - set
      - []
      vid: 3
      vni: 103
[INFO] 2014-05-21 08:36:40,036 module:nlan_agent,function:_route,router:openwrt2
function:subnets.add, index:['vni', 101], model:{'peers': ['192.168.1.103', '192.168.1.104'], 'vid': 1, 'ip_vhost': '10.0.1.102/24', 'vni': 101, 'ip_dvr': OrderedDict([('addr', '10.0.1.1/24'), ('mode', 'spoke_dvr')])}
[DEBUG] 2014-05-21 08:36:40,039 module:ovsdb,function:_send,router:openwrt2
request:
  id: 181874
  method: transact
  params:
  - Open_vSwitch
  - op: select
    table: NLAN
    where: []
response:
  error: null
  id: 181874
  result:
  - rows:
    - _uuid:
      - uuid
      - bfc3093f-e074-4c45-a638-3a65c8b5319d
      _version:
      - uuid
      - 371c1b7f-da2a-4cac-8a0c-047684f4e992
      bridges:
      - uuid
      - 821e2b29-9d08-4fee-a074-2188308e90c3
      gateway:
      - set
      - []
      services:
      - set
      - []
      subnets:
      - set
      - - - uuid
          - 53beddb8-c0d0-4b4f-8f8b-e499d069ec39
        - - uuid
          - 89b36f76-0a3e-4747-88b3-e8c04d1a865d
      vxlan:
      - uuid
      - a150a0b3-afdf-4ac3-acc9-9ecfc018a360
[DEBUG] 2014-05-21 08:36:40,048 module:ovsdb,function:_send,router:openwrt2
request:
  id: 634115
  method: transact
  params:
  - Open_vSwitch
  - op: select
    table: NLAN_Subnet
    where:
    - - vni
      - ==
      - 101
response:
  error: null
  id: 634115
  result:
  - rows: []
[INFO] 2014-05-21 08:36:40,051 module:subnets,function:add,router:openwrt2
Adding a subnet(vlan): 1
[DEBUG] 2014-05-21 08:36:40,052 module:cmdutil,function:_cmd2,router:openwrt2
cmd: brctl addbr br101
[DEBUG] 2014-05-21 08:36:40,063 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-vsctl add-port br-int int_br101 tag=1 -- set interface int_br101 type=internal
[DEBUG] 2014-05-21 08:36:40,104 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-vsctl add-port br-int int_dvr101 tag=1 -- set interface int_dvr101 type=internal
[DEBUG] 2014-05-21 08:36:40,151 module:cmdutil,function:_cmd2,router:openwrt2
cmd: brctl addif br101 int_br101
[DEBUG] 2014-05-21 08:36:40,159 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip link set dev int_br101 promisc on
[DEBUG] 2014-05-21 08:36:40,164 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip link set dev int_br101 up
[DEBUG] 2014-05-21 08:36:40,174 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip link set dev int_dvr101 up
[DEBUG] 2014-05-21 08:36:40,179 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip link set dev br101 up
[DEBUG] 2014-05-21 08:36:40,193 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip netns add ns101
[DEBUG] 2014-05-21 08:36:40,206 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip link add veth-ns101 type veth peer name temp-ns101
[DEBUG] 2014-05-21 08:36:40,222 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip link set dev temp-ns101 netns ns101
[DEBUG] 2014-05-21 08:36:40,230 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip netns exec ns101 ip link set dev temp-ns101 name eth0
[DEBUG] 2014-05-21 08:36:40,237 module:cmdutil,function:_cmd2,router:openwrt2
cmd: brctl addif br101 veth-ns101
[DEBUG] 2014-05-21 08:36:40,254 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip link set dev veth-ns101 promisc on
[DEBUG] 2014-05-21 08:36:40,259 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip link set dev veth-ns101 up
[DEBUG] 2014-05-21 08:36:40,278 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip netns exec ns101 ip link set dev eth0 up
[DEBUG] 2014-05-21 08:36:40,290 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip netns exec ns101 ip addr add dev eth0 10.0.1.102/24
[DEBUG] 2014-05-21 08:36:40,299 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip netns exec ns101 ip route add default via 10.0.1.1 dev eth0
[DEBUG] 2014-05-21 08:36:40,305 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip addr add dev int_dvr101 10.0.1.1/24
[DEBUG] 2014-05-21 08:36:40,311 module:ovsdb,function:_send,router:openwrt2
request:
  id: 335645
  method: transact
  params:
  - Open_vSwitch
  - columns:
    - target
    op: select
    table: Controller
    where: []
response:
  error: null
  id: 335645
  result:
  - rows: []
[DEBUG] 2014-05-21 08:36:40,313 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-ofctl add-flow br-tun table=2,priority=1,tun_id=101,actions=mod_vlan_vid:1,resubmit(,10)
[DEBUG] 2014-05-21 08:36:40,321 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ip link show dev int_dvr101
[DEBUG] 2014-05-21 08:36:40,327 module:ovsdb,function:_send,router:openwrt2
request:
  id: 81836
  method: transact
  params:
  - Open_vSwitch
  - op: select
    table: Interface
    where:
    - - name
      - ==
      - int_dvr101
response:
  error: null
  id: 81836
  result:
  - rows:
    - _uuid:
      - uuid
      - 5482fee7-ff22-4548-a02d-cd65f383ad06
      _version:
      - uuid
      - 808d567a-4fdd-49ef-b50f-a8f616c2743c
      admin_state: up
      bfd:
      - map
      - []
      bfd_status:
      - map
      - []
      cfm_fault:
      - set
      - []
      cfm_fault_status:
      - set
      - []
      cfm_flap_count:
      - set
      - []
      cfm_health:
      - set
      - []
      cfm_mpid:
      - set
      - []
      cfm_remote_mpids:
      - set
      - []
      cfm_remote_opstate:
      - set
      - []
      duplex:
      - set
      - []
      external_ids:
      - map
      - []
      ifindex: 44
      ingress_policing_burst: 0
      ingress_policing_rate: 0
      lacp_current:
      - set
      - []
      link_resets: 2
      link_speed:
      - set
      - []
      link_state: up
      mac:
      - set
      - []
      mac_in_use: 66:ce:82:d5:83:2a
      mtu: 1500
      name: int_dvr101
      ofport: 7
      ofport_request:
      - set
      - []
      options:
      - map
      - []
      other_config:
      - map
      - []
      statistics:
      - map
      - - - collisions
          - 0
        - - rx_bytes
          - 0
        - - rx_crc_err
          - 0
        - - rx_dropped
          - 0
        - - rx_errors
          - 0
        - - rx_frame_err
          - 0
        - - rx_over_err
          - 0
        - - rx_packets
          - 0
        - - tx_bytes
          - 0
        - - tx_dropped
          - 0
        - - tx_errors
          - 0
        - - tx_packets
          - 0
      status:
      - map
      - - - driver_name
          - openvswitch
      type: internal
[DEBUG] 2014-05-21 08:36:40,339 module:ovsdb,function:_send,router:openwrt2
request:
  id: 33571
  method: transact
  params:
  - Open_vSwitch
  - op: select
    table: Interface
    where:
    - - name
      - ==
      - int_br101
response:
  error: null
  id: 33571
  result:
  - rows:
    - _uuid:
      - uuid
      - 86e3c4d0-0ce5-4428-b9e9-a76c77ff02d0
      _version:
      - uuid
      - b5161cec-861e-4dc1-b87f-032067c946af
      admin_state: up
      bfd:
      - map
      - []
      bfd_status:
      - map
      - []
      cfm_fault:
      - set
      - []
      cfm_fault_status:
      - set
      - []
      cfm_flap_count:
      - set
      - []
      cfm_health:
      - set
      - []
      cfm_mpid:
      - set
      - []
      cfm_remote_mpids:
      - set
      - []
      cfm_remote_opstate:
      - set
      - []
      duplex:
      - set
      - []
      external_ids:
      - map
      - []
      ifindex: 43
      ingress_policing_burst: 0
      ingress_policing_rate: 0
      lacp_current:
      - set
      - []
      link_resets: 2
      link_speed:
      - set
      - []
      link_state: up
      mac:
      - set
      - []
      mac_in_use: 06:6a:c2:a8:f2:46
      mtu: 1500
      name: int_br101
      ofport: 6
      ofport_request:
      - set
      - []
      options:
      - map
      - []
      other_config:
      - map
      - []
      statistics:
      - map
      - - - collisions
          - 0
        - - rx_bytes
          - 0
        - - rx_crc_err
          - 0
        - - rx_dropped
          - 0
        - - rx_errors
          - 0
        - - rx_frame_err
          - 0
        - - rx_over_err
          - 0
        - - rx_packets
          - 0
        - - tx_bytes
          - 0
        - - tx_dropped
          - 0
        - - tx_errors
          - 0
        - - tx_packets
          - 0
      status:
      - map
      - - - driver_name
          - openvswitch
      type: internal
[DEBUG] 2014-05-21 08:36:40,353 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-ofctl add-flow br-int table=0,priority=2,in_port=6,dl_type=0x0800,nw_dst=10.0.1.0/24,actions=normal
[DEBUG] 2014-05-21 08:36:40,361 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-ofctl add-flow br-int table=0,priority=1,in_port=6,dl_type=0x0800,nw_dst=10.0.0.0/8,actions=resubmit(,1)
[DEBUG] 2014-05-21 08:36:40,371 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-ofctl add-flow br-int table=0,priority=1,in_port=6,dl_type=0x0800,nw_dst=172.16.0.0/12,actions=resubmit(,1)
[DEBUG] 2014-05-21 08:36:40,379 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-ofctl add-flow br-int table=0,priority=1,in_port=6,dl_type=0x0800,nw_dst=192.168.0.0/16,actions=resubmit(,1)
[DEBUG] 2014-05-21 08:36:40,388 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-ofctl add-flow br-int table=0,priority=1,in_port=7,dl_type=0x0806,nw_src=10.0.1.1,nw_proto=2,actions=drop
[DEBUG] 2014-05-21 08:36:40,396 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-ofctl add-flow br-int table=1,priority=0,in_port=6,actions=set_field:66:ce:82:d5:83:2a->dl_dst,output:7
[DEBUG] 2014-05-21 08:36:40,407 module:ovsdb,function:_send,router:openwrt2
request:
  id: 119175
  method: transact
  params:
  - Open_vSwitch
  - columns:
    - ofport
    - options
    op: select
    table: Interface
    where:
    - - type
      - ==
      - vxlan
response:
  error: null
  id: 119175
  result:
  - rows:
    - ofport: 3
      options:
      - map
      - - - in_key
          - flow
        - - local_ip
          - 192.168.1.102
        - - out_key
          - flow
        - - remote_ip
          - 192.168.1.101
    - ofport: 2
      options:
      - map
      - - - in_key
          - flow
        - - local_ip
          - 192.168.1.102
        - - out_key
          - flow
        - - remote_ip
          - 192.168.1.103
    - ofport: 4
      options:
      - map
      - - - in_key
          - flow
        - - local_ip
          - 192.168.1.102
        - - out_key
          - flow
        - - remote_ip
          - 192.168.1.104
[DEBUG] 2014-05-21 08:36:40,415 module:cmdutil,function:_cmd2,router:openwrt2
cmd: ovs-ofctl add-flow br-tun table=21,priority=1,dl_vlan=1,actions=strip_vlan,set_tunnel:101,output:2,output:4
[DEBUG] 2014-05-21 08:36:40,425 module:ovsdb,function:crud,router:openwrt2
CRUD operation (add): {'peers': ['192.168.1.103', '192.168.1.104'], 'vid': 1, 'ip_vhost': '10.0.1.102/24', 'vni': 101, 'ip_dvr': OrderedDict([('addr', '10.0.1.1/24'), ('mode', 'spoke_dvr')])}
[DEBUG] 2014-05-21 08:36:40,428 module:ovsdb,function:_send,router:openwrt2
request:
  id: 998602
  method: transact
  params:
  - Open_vSwitch
  - op: insert
    row:
      ip_dvr:
      - map
      - - - addr
          - 10.0.1.1/24
        - - mode
          - spoke_dvr
      ip_vhost: 10.0.1.102/24
      peers:
      - set
      - - 192.168.1.103
        - 192.168.1.104
      vid: 1
      vni: 101
    table: NLAN_Subnet
    uuid-name: temp_590186
  - mutations:
    - - subnets
      - insert
      - - set
        - - - named-uuid
            - temp_590186
    op: mutate
    table: NLAN
    where: []
response:
  error: null
  id: 998602
  result:
  - uuid:
    - uuid
    - e4b5cd97-6e02-4f49-8afe-5a308fbf5d82
  - count: 1
[DEBUG] 2014-05-21 08:36:40,431 module:ovsdb,function:_send,router:openwrt2
request:
  id: 987675
  method: transact
  params:
  - Open_vSwitch
  - op: select
    table: NLAN_Subnet
    where:
    - - vni
      - ==
      - 101
response:
  error: null
  id: 987675
  result:
  - rows:
    - _uuid:
      - uuid
      - e4b5cd97-6e02-4f49-8afe-5a308fbf5d82
      _version:
      - uuid
      - 1a7fd04f-0489-4660-8566-ed4c0890098c
      default_gw:
      - set
      - []
      ip_dvr:
      - map
      - - - addr
          - 10.0.1.1/24
        - - mode
          - spoke_dvr
      ip_vhost: 10.0.1.102/24
      peers:
      - set
      - - 192.168.1.103
        - 192.168.1.104
      ports:
      - set
      - []
    --- STDOUT from router:rpi1,platform:debian
[INFO] 2014-05-21 01:36:41,560 module:nlan_agent,function:<module>,router:rpi1
NLAN Agent initialization completed
[DEBUG] 2014-05-21 01:36:41,563 module:nlan_agent,function:<module>,router:rpi1
__n__: {'tables': {'services': {'max': 'unlimited', 'key': {'type': 'uuid', 'refTable': 'NLAN_Service'}, 'min': 0}, 'bridges': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_Bridges'}, 'min': 0}, 'gateway': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_Gateway'}, 'min': 0}, 'vxlan': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_VXLAN'}, 'min': 0}, 'subnets': {'max': 'unlimited', 'key': {'type': 'uuid', 'refTable': 'NLAN_Subnet'}, 'min': 0}}, 'agent_dir': '/opt/nlan', 'platform': 'debian', 'share_dir': '/opt/nlan/share', 'state_order': ['bridges', 'services', 'gateway', 'vxlan', 'subnets'], 'logger': <logging.Logger object at 0xb731022c>, 'router': 'rpi1', 'schema': 'ovsdb_nlan.schema', 'types': {'services': {'name': {'max': 1, 'key': {'type': 'string'}, 'min': 1}, 'chain': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}}, 'bridges': {'controller': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'ovs_bridges': {'max': 1, 'key': {'enum': ['set', ['enabled']], 'type': 'string'}, 'min': 0}}, 'gateway': {'network': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'rip': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}, 'vxlan': {'remote_ips': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}, 'local_ip': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}, 'subnets': {'peers': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}, 'vid': {'max': 1, 'key': {'minInteger': 0, 'maxInteger': 4095, 'type': 'integer'}, 'min': 0}, 'ip_vhost': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'vni': {'max': 1, 'key': {'minInteger': 0, 'maxInteger': 16777215, 'type': 'integer'}, 'min': 1}, 'ip_dvr': {'max': 3, 'value': {'type': 'string'}, 'key': {'enum': ['set', ['addr', 'mode', 'dhcp']], 'type': 'string'}, 'min': 0}, 'default_gw': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'ports': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}}}, 'indexes': {'services': 'name', 'subnets': 'vni'}}
[INFO] 2014-05-21 01:36:41,652 module:nlan_agent,function:_route,router:rpi1
function:bridges.add, model:{'ovs_bridges': 'enabled'}
[DEBUG] 2014-05-21 01:36:41,676 module:ovsdb,function:_send,router:rpi1
request:
  id: 599176
  method: transact
  params:
  - Open_vSwitch
  - op: select
    table: NLAN
    where: []
response:
  error: null
  id: 599176
  result:
  - rows: []
[DEBUG] 2014-05-21 01:36:41,679 module:ovsdb,function:_send,router:rpi1
request:
  id: 235102
  method: transact
  params:
  - Open_vSwitch
  - op: insert
    row: {}
    table: NLAN
response:
  error: null
  id: 235102
  result:
  - uuid:
    - uuid
    - f85e64c7-2a19-4025-ae78-47cea98f84a5
[DEBUG] 2014-05-21 01:36:41,681 module:ovsdb,function:_send,router:rpi1
request:
  id: 266511
  method: transact
  params:
  - Open_vSwitch
  - op: select
    table: NLAN_Bridges
    where: []
response:
  error: null
  id: 266511
  result:
  - rows: []
[INFO] 2014-05-21 01:36:41,682 module:bridges,function:add,router:rpi1
Adding bridges: br-int and br-tun
[DEBUG] 2014-05-21 01:36:41,708 module:cmdutil,function:_cmd2,router:rpi1
cmd: ovs-vsctl add-br br-int
[DEBUG] 2014-05-21 01:36:41,735 module:cmdutil,function:_cmd2,router:rpi1
cmd: ovs-vsctl add-br br-tun
[DEBUG] 2014-05-21 01:36:41,854 module:cmdutil,function:_cmd2,router:rpi1
cmd: ovs-ofctl del-flows br-tun
[DEBUG] 2014-05-21 01:36:41,885 module:cmdutil,function:_cmd2,router:rpi1
cmd: ovs-vsctl add-port br-int patch-int -- set interface patch-int type=patch options:peer=patch-tun
[DEBUG] 2014-05-21 01:36:41,933 module:cmdutil,function:_cmd2,router:rpi1
cmd: ovs-vsctl add-port br-tun patch-tun -- set interface patch-tun type=patch options:peer=patch-int
[DEBUG] 2014-05-21 01:36:41,961 module:ovsdb,function:_send,router:rpi1
request:
  id: 16884
  method: transact
  params:
  - Open_vSwitch
  - op: select
    table: Interface
    where:
    - - name
      - ==
      - patch-tun
response:
  error: null
  id: 16884
  result:
  - rows:
    - _uuid:
      - uuid
      - 60b5af87-051d-43aa-bbe4-f1a91ed679fe
      _version:
      - uuid
      - e6e5bd26-ba92-405f-80b3-3246d816c93e
      admin_state:
      - set
      - []
      bfd:
      - map
      - []
      bfd_status:
      - map
      - []
      cfm_fault:
      - set
      - []
      cfm_fault_status:
      - set
      - []
      cfm_flap_count:
      - set
      - []
      cfm_health:
      - set
      - []
      cfm_mpid:
      - set
      - []
      cfm_remote_mpids:
      - set
      - []
      cfm_remote_opstate:
      - set
      - []
      duplex:
      - set
      - []
      external_ids:
      - map
      - []
      ifindex: 0
      ingress_policing_burst: 0
      ingress_policing_rate: 0
      lacp_current:
      - set
      - []
      link_resets:
      - set
      - []
      link_speed:
      - set
      - []
      link_state:
      - set
      - []
      mac:
      - set
      - []
      mac_in_use: 0a:e2:43:ae:29:ea
      mtu:
      - set
      - []
      name: patch-tun
      ofport: 1
      ofport_request:
      - set
      - []
      options:
      - map
      - - - peer
          - patch-int
      other_config:
      - map
      - []
      statistics:
      - map
      - - - collisions
          - 0
        - - rx_bytes
          - 0
        - - rx_crc_err
          - 0
        - - rx_dropped
          - 0
        - - rx_errors
          - 0
        - - rx_frame_err
          - 0
        - - rx_over_err
          - 0
        - - rx_packets
          - 0
        - - tx_bytes
          - 0
        - - tx_dropped
          - 0
        - - tx_errors
          - 0
        - - tx_packets
          - 0
      status:
      - map
      - []
      type: patch
[DEBUG] 2014-05-21 01:36:41,964 module:cmdutil,function:_cmd2,router:rpi1
cmd: ovs-ofctl add-flow br-tun table=0,priority=1,in_port=1,actions=resubmit(,1)
[DEBUG] 2014-05-21 01:36:41,980 module:cmdutil,function:_cmd2,router:rpi1
cmd: ovs-ofctl add-flow br-tun table=0,priority=0,actions=drop
[DEBUG] 2014-05-21 01:36:41,993 module:cmdutil,function:_cmd2,router:rpi1
cmd: ovs-ofctl add-flow br-tun table=1,priority=0,dl_dst=01:00:00:00:00:00/01:00:00:00:00:00,actions=resubmit(,19)
[DEBUG] 2014-05-21 01:36:42,009 module:cmdutil,function:_cmd2,router:rpi1
cmd: ovs-ofctl add-flow br-tun table=1,priority=0,dl_dst=00:00:00:00:00:00/01:00:00:00:00:00,actions=resubmit(,20)
[DEBUG] 2014-05-21 01:36:42,022 module:cmdutil,function:_cmd2,router:rpi1
cmd: ovs-ofctl add-flow br-tun table=2,priority=0,actions=drop
[DEBUG] 2014-05-21 01:36:42,034 module:cmdutil,function:_cmd2,router:rpi1
cmd: ovs-ofctl add-flow br-tun table=3,priority=0,actions=drop
[DEBUG] 2014-05-21 01:36:42,047 module:cmdutil,function:_cmd2,router:rpi1
cmd: ovs-ofctl add-flow br-tun table=10,priority=1,actions=learn(table=20,hard_timeout=300,priority=1,NXM_OF_VLAN_TCI[0..11],NXM_OF_ETH_DST[]=NXM_OF_ETH_SRC[],load:0->NXM_OF_VLAN_TCI[],load:NXM_NX_TUN_ID[]->NXM_NX_TUN_ID[],output:NXM_OF_IN_PORT[]),output:1
[DEBUG] 2014-05-21 01:36:42,058 module:cmdutil,function:_cmd2,router:rpi1
cmd: ovs-ofctl add-flow br-tun table=19,priority=0,actions=resubmit(,21)
[DEBUG] 2014-05-21 01:36:42,071 module:cmdutil,function:_cmd2,router:rpi1
cmd: ovs-ofctl add-flow br-tun table=20,priority=0,actions=resubmit(,21)
[DEBUG] 2014-05-21 01:36:42,083 module:cmdutil,function:_cmd2,router:rpi1
cmd: ovs-ofctl add-flow br-tun table=21,priority=0,actions=drop
[DEBUG] 2014-05-21 01:36:42,095 module:ovsdb,function:crud,router:rpi1
CRUD operation (add): {'ovs_bridges': 'enabled'}
[DEBUG] 2014-05-21 01:36:42,098 module:ovsdb,function:_send,router:rpi1
request:
  id: 452479
  method: transact
  params:
  - Open_vSwitch
  - op: insert
    row:
      ovs_bridges: enabled
    table: NLAN_Bridges
    uuid-name: temp_533695
  - mutations:
    - - bridges
      - insert
      - - set
        - - - named-uuid
            - temp_533695
    op: mutate
    table: NLAN
    where: []
response:
  error: null
  id: 452479
  result:
  - uuid:
    - uuid
    - 96  vid: 1
      vni: 101
[INFO] 2014-05-21 08:36:40,438 module:nlan_agent,function:<module>,router:openwrt2
NLAN Agent execution completed
--- RESPONSE from router:openwrt2,platform:openwrt
message: Execution completed
exit: 0
601563-5551-414c-91e6-7f39d6234514
  - count: 1
[DEBUG] 2014-05-21 01:36:42,100 module:ovsdb,function:_send,router:rpi1
request:
  id: 294969
  method: transact
  params:
  - Open_vSwitch
  - op: select
    table: NLAN_Bridges
    where: []
response:
  error: null
  id: 294969
  result:
  - rows:
    - _uuid:
      - uuid
      - 96601563-5551-414c-91e6-7f39d6234514
      _version:
      - uuid
      - 7c5d4810-8845-4589-9215-4bee998db379
      controller:
      - set
      - []
      ovs_bridges: enabled
[INFO] 2014-05-21 01:36:42,106 module:nlan_agent,function:_route,router:rpi1
function:services.add, index:['name', 'snort1'], model:{'name': 'snort1', 'chain': ['mz.101', 'dmz.1001']}
[DEBUG] 2014-05-21 01:36:42,109 module:ovsdb,function:_send,router:rpi1
request:
  id: 645514
  method: transact
  params:
  - Open_vSwitch
  - op: select
    table: NLAN
    where: []
response:
  error: null
  id: 645514
  result:
  - rows:
    - _uuid:
      - uuid
      - f85e64c7-2a19-4025-ae78-47cea98f84a5
      _version:
      - uuid
      - 480248bf-dc34-4a78-bcbd-a1d00e4d5f40
      bridges:
      - uuid
      - 96601563-5551-414c-91e6-7f39d6234514
      gateway:
      - set
      - []
      services:
      - set
      - []
      subnets:
      - set
      - []
      vxlan:
      - set
      - []
[DEBUG] 2014-05-21 01:36:42,111 module:ovsdb,function:_send,router:rpi1
request:
  id: 575985
  method: transact
  params:
  - Open_vSwitch
  - op: select
    table: NLAN_Service
    where:
    - - name
      - ==
      - snort1
response:
  error: null
  id: 575985
  result:
  - rows: []
[DEBUG] 2014-05-21 01:36:42,116 module:cmdutil,function:_cmd2,router:rpi1
cmd: lxc-stop -n snort1
[DEBUG] 2014-05-21 01:36:42,122 module:cmdutil,function:_cmd2,router:rpi1
cmd: lxc-start -d -f /var/lib/lxc/snort1/config_nlan -n snort1
[DEBUG] 2014-05-21 01:36:42,129 module:ovsdb,function:crud,router:rpi1
CRUD operation (add): {'name': 'snort1', 'chain': ['mz.101', 'dmz.1001']}
[DEBUG] 2014-05-21 01:36:42,132 module:ovsdb,function:_send,router:rpi1
request:
  id: 217023
  method: transact
  params:
  - Open_vSwitch
  - op: insert
    row:
      chain:
      - set
      - - mz.101
        - dmz.1001
      name: snort1
    table: NLAN_Service
    uuid-name: temp_368016
  - mutations:
    - - services
      - insert
      - - set
        - - - named-uuid
            - temp_368016
    op: mutate
    table: NLAN
    where: []
response:
  error: null
  id: 217023
  result:
  - uuid:
    - uuid
    - 17c73cd1-a4d5-4a70-a273-f0420452e888
  - count: 1
[DEBUG] 2014-05-21 01:36:42,134 module:ovsdb,function:_send,router:rpi1
request:
  id: 864432
  method: transact
  params:
  - Open_vSwitch
  - op: select
    table: NLAN_Service
    where:
    - - name
      - ==
      - snort1
response:
  error: null
  id: 864432
  result:
  - rows:
    - _uuid:
      - uuid
      - 17c73cd1-a4d5-4a70-a273-f0420452e888
      _version:
      - uuid
      - 9e83ad7d-80bc-4137-a0d9-6e9ffabcd2ea
      chain:
      - set
      - - dmz.1001
        - mz.101
      name: snort1
[INFO] 2014-05-21 01:36:42,139 module:nlan_agent,function:_route,router:rpi1
function:vxlan.add, model:{'remote_ips': ['192.168.1.103', '192.168.1.102', '192.168.1.101'], 'local_ip': '192.168.1.104'}
[DEBUG] 2014-05-21 01:36:42,142 module:ovsdb,function:_send,router:rpi1
request:
  id: 968796
  method: transact
  params:
  - Open_vSwitch
  - op: select
    table: NLAN
    where: []
response:
  error: null
  id: 968796
  result:
  - rows:
    - _uuid:
      - uuid
      - f85e64c7-2a19-4025-ae78-47cea98f84a5
      _version:
      - uuid
      - f0b1505e-f232-4738-a070-f949603c7b1e
      bridges:
      - uuid
      - 96601563-5551-414c-91e6-7f39d6234514
      gateway:
      - set
      - []
      services:
      - uuid
      - 17c73cd1-a4d5-4a70-a273-f0420452e888
      subnets:
      - set
      - []
      vxlan:
      - set
      - []
[DEBUG] 2014-05-21 01:36:42,144 module:ovsdb,function:_send,router:rpi1
request:
  id: 974573
  method: transact
  params:
  - Open_vSwitch
  - op: select
    table: NLAN_VXLAN
    where: []
response:
  error: null
  id: 974573
  result:
  - rows: []
[INFO] 2014-05-21 01:36:42,151 module:vxlan,function:add,router:rpi1
Adding a VXLAN tunnel: vxlan_192.168.1.103
[DEBUG] 2014-05-21 01:36:42,159 module:cmdutil,function:_cmd2,router:rpi1
cmd: ovs-vsctl add-port br-tun vxlan_192.168.1.103 -- set interface vxlan_192.168.1.103 type=vxlan options:in_key=flow options:local_ip=192.168.1.104 options:out_key=flow options:remote_ip=192.168.1.103
[INFO] 2014-05-21 01:36:42,252 module:vxlan,function:add,router:rpi1
Adding a VXLAN tunnel: vxlan_192.168.1.102
[DEBUG] 2014-05-21 01:36:42,253 module:cmdutil,function:_cmd2,router:rpi1
cmd: ovs-vsctl add-port br-tun vxlan_192.168.1.102 -- set interface vxlan_192.168.1.102 type=vxlan options:in_key=flow options:local_ip=192.168.1.104 options:out_key=flow options:remote_ip=192.168.1.102
[INFO] 2014-05-21 01:36:42,333 module:vxlan,function:add,router:rpi1
Adding a VXLAN tunnel: vxlan_192.168.1.101
[DEBUG] 2014-05-21 01:36:42,334 module:cmdutil,function:_cmd2,router:rpi1
cmd: ovs-vsctl add-port br-tun vxlan_192.168.1.101 -- set interface vxlan_192.168.1.101 type=vxlan options:in_key=flow options:local_ip=192.168.1.104 options:out_key=flow options:remote_ip=192.168.1.101
[DEBUG] 2014-05-21 01:36:42,399 module:ovsdb,function:_send,router:rpi1
request:
  id: 447030
  method: transact
  params:
  - Open_vSwitch
  - columns:
    - ofport
    - options
    op: select
    table: Interface
    where:
    - - type
      - ==
      - vxlan
response:
  error: null
  id: 447030
  result:
  - rows:
    - ofport: 4
      options:
      - map
      - - - in_key
          - flow
        - - local_ip
          - 192.168.1.104
        - - out_key
          - flow
        - - remote_ip
          - 192.168.1.101
    - ofport: 3
      options:
      - map
      - - - in_key
          - flow
        - - local_ip
          - 192.168.1.104
        - - out_key
          - flow
        - - remote_ip
          - 192.168.1.102
    - ofport: 2
      options:
      - map
      - - - in_key
          - flow
        - - local_ip
          - 192.168.1.104
        - - out_key
          - flow
        - - remote_ip
          - 192.168.1.103
[DEBUG] 2014-05-21 01:36:42,401 module:cmdutil,function:_cmd2,router:rpi1
cmd: ovs-ofctl add-flow br-tun table=0,priority=1,in_port=4,actions=resubmit(,2)
[DEBUG] 2014-05-21 01:36:42,426 module:cmdutil,function:_cmd2,router:rpi1
cmd: ovs-ofctl add-flow br-tun table=0,priority=1,in_port=3,actions=resubmit(,2)
[DEBUG] 2014-05-21 01:36:42,438 module:cmdutil,function:_cmd2,router:rpi1
cmd: ovs-ofctl add-flow br-tun table=0,priority=1,in_port=2,actions=resubmit(,2)
[DEBUG] 2014-05-21 01:36:42,449 module:ovsdb,function:crud,router:rpi1
CRUD operation (add): {'remote_ips': ['192.168.1.103', '192.168.1.102', '192.168.1.101'], 'local_ip': '192.168.1.104'}
[DEBUG] 2014-05-21 01:36:42,452 module:ovsdb,function:_send,router:rpi1
request:
  id: 236610
  method: transact
  params:
  - Open_vSwitch
  - op: insert
    row:
      local_ip: 192.168.1.104
      remote_ips:
      - set
      - - 192.168.1.103
        - 192.168.1.102
        - 192.168.1.101
    table: NLAN_VXLAN
    uuid-name: temp_969775
  - mutations:
    - - vxlan
      - insert
      - - set
        - - - named-uuid
            - temp_969775
    op: mutate
    table: NLAN
    where: []
response:
  error: null
  id: 236610
  result:
  - uuid:
    - uuid
    - ca093c25-8a74-4121-9f06-83e6641f5f2f
  - count: 1
[DEBUG] 2014-05-21 01:36:42,454 module:ovsdb,function:_send,router:rpi1
request:
  id: 602441
  method: transact
  params:
  - Open_vSwitch
  - op: select
    table: NLAN_VXLAN
    where: []
response:
  error: null
  id: 602441
  result:
  - rows:
    - _uuid:
      - uuid
      - ca093c25-8a74-4121-9f06-83e6641f5f2f
      _version:
      - uuid
      - c360d543-c936-4b06-baaf-e35ffc5c2fda
      local_ip: 192.168.1.104
      remote_ips:
      - set
      - - 192.168.1.101
        - 192.168.1.102
        - 192.168.1.103
[INFO] 2014-05-21 01:36:42,478 module:nlan_agent,function:_route,router:rpi1
function:subnets.add, index:['vni', 1001], model:{'peers': ['192.168.1.101'], 'ports': ['dmz.1001'], 'vni': 1001, 'vid': 111}
[DEBUG] 2014-05-21 01:36:42,480 module:ovsdb,function:_send,router:rpi1
request:
  id: 733451
  method: transact
  params:
  - Open_vSwitch
  - op: select
    table: NLAN
    where: []
response:
  error: null
  id: 733451
  result:
  - rows:
    - _uuid:
      - uuid
      - f85e64c7-2a19-4025-ae78-47cea98f84a5
      _version:
      - uuid
      - 4cc93c89-52fa-4f76-946c-9366a44aa21c
      bridges:
      - uuid
      - 96601563-5551-414c-91e6-7f39d6234514
      gateway:
      - set
      - []
      services:
      - uuid
      - 17c73cd1-a4d5-4a70-a273-f0420452e888
      subnets:
      - set
      - []
      vxlan:
      - uuid
      - ca093c25-8a74-4121-9f06-83e6641f5f2f
[DEBUG] 2014-05-21 01:36:42,482 module:ovsdb,function:_send,router:rpi1
request:
  id: 951004
  method: transact
  params:
  - Open_vSwitch
  - op: select
    table: NLAN_Subnet
    where:
    - - vni
      - ==
      - 1001
response:
  error: null
  id: 951004
  result:
  - rows: []
[INFO] 2014-05-21 01:36:42,490 module:subnets,function:add,router:rpi1
Adding a subnet(vlan): 111
[DEBUG] 2014-05-21 01:36:42,494 module:cmdutil,function:_cmd2,router:rpi1
cmd: brctl addbr br1001
[DEBUG] 2014-05-21 01:36:42,510 module:cmdutil,function:_cmd2,router:rpi1
cmd: ovs-vsctl add-port br-int int_br1001 tag=111 -- set interface int_br1001 type=internal
[DEBUG] 2014-05-21 01:36:42,584 module:cmdutil,function:_cmd2,router:rpi1
cmd: ovs-vsctl add-port br-int int_dvr1001 tag=111 -- set interface int_dvr1001 type=internal
[DEBUG] 2014-05-21 01:36:42,661 module:cmdutil,function:_cmd2,router:rpi1
cmd: brctl addif br1001 int_br1001
[DEBUG] 2014-05-21 01:36:42,685 module:cmdutil,function:_cmd2,router:rpi1
cmd: ip link set dev int_br1001 promisc on
[DEBUG] 2014-05-21 01:36:42,755 module:cmdutil,function:_cmd2,router:rpi1
cmd: ip link set dev int_br1001 up
[DEBUG] 2014-05-21 01:36:42,769 module:cmdutil,function:_cmd2,router:rpi1
cmd: ip link set dev int_dvr1001 up
[DEBUG] 2014-05-21 01:36:42,785 module:cmdutil,function:_cmd2,router:rpi1
cmd: ip link set dev br1001 up
[DEBUG] 2014-05-21 01:36:42,809 module:cmdutil,function:_cmd2,router:rpi1
cmd: brctl addif br1001 dmz.1001
[DEBUG] 2014-05-21 01:36:42,829 module:ovsdb,function:_send,router:rpi1
request:
  id: 670086
  method: transact
  params:
  - Open_vSwitch
  - columns:
    - target
    op: select
    table: Controller
    where: []
response:
  error: null
  id: 670086
  result:
  - rows: []
[DEBUG] 2014-05-21 01:36:42,830 module:cmdutil,function:_cmd2,router:rpi1
cmd: ovs-ofctl add-flow br-tun table=2,priority=1,tun_id=1001,actions=mod_vlan_vid:111,resubmit(,10)
[DEBUG] 2014-05-21 01:36:42,860 module:ovsdb,function:_send,router:rpi1
request:
  id: 172518
  method: transact
  params:
  - Open_vSwitch
  - columns:
    - ofport
    - options
    op: select
    table: Interface
    where:
    - - type
      - ==
      - vxlan
response:
  error: null
  id: 172518
  result:
  - rows:
    - ofport: 4
      options:
      - map
      - - - in_key
          - flow
        - - local_ip
          - 192.168.1.104
        - - out_key
          - flow
        - - remote_ip
          - 192.168.1.101
    - ofport: 3
      options:
      - map
      - - - in_key
          - flow
        - - local_ip
          - 192.168.1.104
        - - out_key
          - flow
        - - remote_ip
          - 192.168.1.102
    - ofport: 2
      options:
      - map
      - - - in_key
          - flow
        - - local_ip
          - 192.168.1.104
        - - out_key
          - flow
        - - remote_ip
          - 192.168.1.103
[DEBUG] 2014-05-21 01:36:42,861 module:cmdutil,function:_cmd2,router:rpi1
cmd: ovs-ofctl add-flow br-tun table=21,priority=1,dl_vlan=111,actions=strip_vlan,set_tunnel:1001,output:4
[DEBUG] 2014-05-21 01:36:42,881 module:ovsdb,function:crud,router:rpi1
CRUD operation (add): {'peers': ['192.168.1.101'], 'ports': ['dmz.1001'], 'vni': 1001, 'vid': 111}
[DEBUG] 2014-05-21 01:36:42,883 module:ovsdb,function:_send,router:rpi1
request:
  id: 661820
  method: transact
  params:
  - Open_vSwitch
  - op: insert
    row:
      peers:
      - set
      - - 192.168.1.101
      ports:
      - set
      - - dmz.1001
      vid: 111
      vni: 1001
    table: NLAN_Subnet
    uuid-name: temp_95555
  - mutations:
    - - subnets
      - insert
      - - set
        - - - named-uuid
            - temp_95555
    op: mutate
    table: NLAN
    where: []
response:
  error: null
  id: 661820
  result:
  - uuid:
    - uuid
    - d77310a6-3251-43dc-92ea-4500728c12bf
  - count: 1
[DEBUG] 2014-05-21 01:36:42,885 module:ovsdb,function:_send,router:rpi1
request:
  id: 652716
  method: transact
  params:
  - Open_vSwitch
  - op: select
    table: NLAN_Subnet
    where:
    - - vni
      - ==
      - 1001
response:
  error: null
  id: 652716
  result:
  - rows:
    - _uuid:
      - uuid
      - d77310a6-3251-43dc-92ea-4500728c12bf
      _version:
      - uuid
      - 7386a21c-a099-4b98-9e9d-67a978db22a4
      default_gw:
      - set
      - []
      ip_dvr:
      - map
      - []
      ip_vhost:
      - set
      - []
      peers: 192.168.1.101
      ports: dmz.1001
      vid: 111
      vni: 1001
[INFO] 2014-05-21 01:36:42,886 module:nlan_agent,function:_route,router:rpi1
function:subnets.add, index:['vni', 101], model:{'peers': ['192.168.1.102', '192.168.1.103'], 'ports': ['mz.101'], 'vni': 101, 'vid': 1}
[DEBUG] 2014-05-21 01:36:42,888 module:ovsdb,function:_send,router:rpi1
request:
  id: 798774
  method: transact
  params:
  - Open_vSwitch
  - op: select
    table: NLAN
    where: []
response:
  error: null
  id: 798774
  result:
  - rows:
    - _uuid:
      - uuid
      - f85e64c7-2a19-4025-ae78-47cea98f84a5
      _version:
      - uuid
      - d69d2f4c-cf9f-425e-99e4-ccae568a1576
      bridges:
      - uuid
      - 96601563-5551-414c-91e6-7f39d6234514
      gateway:
      - set
      - []
      services:
      - uuid
      - 17c73cd1-a4d5-4a70-a273-f0420452e888
      subnets:
      - uuid
      - d77310a6-3251-43dc-92ea-4500728c12bf
      vxlan:
      - uuid
      - ca093c25-8a74-4121-9f06-83e6641f5f2f
[DEBUG] 2014-05-21 01:36:42,890 module:ovsdb,function:_send,router:rpi1
request:
  id: 337999
  method: transact
  params:
  - Open_vSwitch
  - op: select
    table: NLAN_Subnet
    where:
    - - vni
      - ==
      - 101
response:
  error: null
  id: 337999
  result:
  - rows: []
[INFO] 2014-05-21 01:36:42,892 module:subnets,function:add,router:rpi1
Adding a subnet(vlan): 1
[DEBUG] 2014-05-21 01:36:42,895 module:cmdutil,function:_cmd2,router:rpi1
cmd: brctl addbr br101
[DEBUG] 2014-05-21 01:36:42,910 module:cmdutil,function:_cmd2,router:rpi1
cmd: ovs-vsctl add-port br-int int_br101 tag=1 -- set interface int_br101 type=internal
[DEBUG] 2014-05-21 01:36:42,965 module:cmdutil,function:_cmd2,router:rpi1
cmd: ovs-vsctl add-port br-int int_dvr101 tag=1 -- set interface int_dvr101 type=internal
[DEBUG] 2014-05-21 01:36:43,031 module:cmdutil,function:_cmd2,router:rpi1
cmd: brctl addif br101 int_br101
[DEBUG] 2014-05-21 01:36:43,048 module:cmdutil,function:_cmd2,router:rpi1
cmd: ip link set dev int_br101 promisc on
[DEBUG] 2014-05-21 01:36:43,060 module:cmdutil,function:_cmd2,router:rpi1
cmd: ip link set dev int_br101 up
[DEBUG] 2014-05-21 01:36:43,076 module:cmdutil,function:_cmd2,router:rpi1
cmd: ip link set dev int_dvr101 up
[DEBUG] 2014-05-21 01:36:43,090 module:cmdutil,function:_cmd2,router:rpi1
cmd: ip link set dev br101 up
[DEBUG] 2014-05-21 01:36:43,116 module:cmdutil,function:_cmd2,router:rpi1
cmd: brctl addif br101 mz.101
[DEBUG] 2014-05-21 01:36:43,128 module:ovsdb,function:_send,router:rpi1
request:
  id: 11082
  method: transact
  params:
  - Open_vSwitch
  - columns:
    - target
    op: select
    table: Controller
    where: []
response:
  error: null
  id: 11082
  result:
  - rows: []
[DEBUG] 2014-05-21 01:36:43,129 module:cmdutil,function:_cmd2,router:rpi1
cmd: ovs-ofctl add-flow br-tun table=2,priority=1,tun_id=101,actions=mod_vlan_vid:1,resubmit(,10)
[DEBUG] 2014-05-21 01:36:43,148 module:ovsdb,function:_send,router:rpi1
request:
  id: 154421
  method: transact
  par--- STDOUT from router:openwrt3,platform:openwrt
[INFO] 2014-05-21 08:36:39,619 module:nlan_agent,function:<module>,router:openwrt3
NLAN Agent initialization completed
[DEBUG] 2014-05-21 08:36:39,620 module:nlan_agent,function:<module>,router:openwrt3
__n__: {'tables': {'services': {'max': 'unlimited', 'key': {'type': 'uuid', 'refTable': 'NLAN_Service'}, 'min': 0}, 'bridges': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_Bridges'}, 'min': 0}, 'gateway': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_Gateway'}, 'min': 0}, 'vxlan': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_VXLAN'}, 'min': 0}, 'subnets': {'max': 'unlimited', 'key': {'type': 'uuid', 'refTable': 'NLAN_Subnet'}, 'min': 0}}, 'agent_dir': '/opt/nlan', 'platform': 'openwrt', 'share_dir': '/opt/nlan/share', 'state_order': ['bridges', 'services', 'gateway', 'vxlan', 'subnets'], 'logger': <logging.Logger object at 0xb759f9ac>, 'router': 'openwrt3', 'schema': 'ovsdb_nlan.schema', 'types': {'services': {'name': {'max': 1, 'key': {'type': 'string'}, 'min': 1}, 'chain': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}}, 'bridges': {'controller': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'ovs_bridges': {'max': 1, 'key': {'enum': ['set', ['enabled']], 'type': 'string'}, 'min': 0}}, 'gateway': {'network': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'rip': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}, 'vxlan': {'remote_ips': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}, 'local_ip': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}, 'subnets': {'peers': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}, 'vid': {'max': 1, 'key': {'minInteger': 0, 'maxInteger': 4095, 'type': 'integer'}, 'min': 0}, 'ip_vhost': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'vni': {'max': 1, 'key': {'minInteger': 0, 'maxInteger': 16777215, 'type': 'integer'}, 'min': 1}, 'ip_dvr': {'max': 3, 'value': {'type': 'string'}, 'key': {'enum': ['set', ['addr', 'mode', 'dhcp']], 'type': 'string'}, 'min': 0}, 'default_gw': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'ports': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}}}, 'indexes': {'services': 'name', 'subnets': 'vni'}}
[INFO] 2014-05-21 08:36:39,741 module:nlan_agent,function:_route,router:openwrt3
function:bridges.add, model:{'ovs_bridges': 'enabled'}
[DEBUG] 2014-05-21 08:36:39,759 module:ovsdb,function:_send,router:openwrt3
request:
  id: 324257
  method: transact
  params:
  - Open_vSwitch
  - op: select
    table: NLAN
    where: []
response:
  error: null
  id: 324257
  result:
  - rows: []
[DEBUG] 2014-05-21 08:36:39,763 module:ovsdb,function:_send,router:openwrt3
request:
  id: 258139
  method: transact
  params:
  - Open_vSwitch
  - op: insert
    row: {}
    table: NLAN
response:
  error: null
  id: 258139
  result:
  - uuid:
    - uuid
    - 45337354-3cbe-44cc-b217-4da5145a1103
[DEBUG] 2014-05-21 08:36:39,766 module:ovsdb,function:_send,router:openwrt3
request:
  id: 598044
  method: transact
  params:
  - Open_vSwitch
  - op: select
    table: NLAN_Bridges
    where: []
response:
  error: null
  id: 598044
  result:
  - rows: []
[INFO] 2014-05-21 08:36:39,769 module:bridges,function:add,router:openwrt3
Adding bridges: br-int and br-tun
[DEBUG] 2014-05-21 08:36:39,804 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-vsctl add-br br-int
[DEBUG] 2014-05-21 08:36:39,837 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-vsctl add-br br-tun
[DEBUG] 2014-05-21 08:36:39,883 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-ofctl del-flows br-tun
[DEBUG] 2014-05-21 08:36:39,901 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-vsctl add-port br-int patch-int -- set interface patch-int type=patch options:peer=patch-tun
[DEBUG] 2014-05-21 08:36:39,930 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-vsctl add-port br-tun patch-tun -- set interface patch-tun type=patch options:peer=patch-int
[DEBUG] 2014-05-21 08:36:39,959 module:ovsdb,function:_send,router:openwrt3
request:
  id: 129983
  method: transact
  params:
  - Open_vSwitch
  - op: select
    table: Interface
    where:
    - - name
      - ==
      - patch-tun
response:
  error: null
  id: 129983
  result:
  - rows:
    - _uuid:
      - uuid
      - 14bdd105-0d52-4519-a192-54f2c957e7aa
      _version:
      - uuid
      - 631f2365-1ebc-48ee-b6e2-f586d1181b17
      admin_state:
      - set
      - []
      bfd:
      - map
      - []
      bfd_status:
      - map
      - []
      cfm_fault:
      - set
      - []
      cfm_fault_status:
      - set
      - []
      cfm_flap_count:
      - set
      - []
      cfm_health:
      - set
      - []
      cfm_mpid:
      - set
      - []
      cfm_remote_mpids:
      - set
      - []
      cfm_remote_opstate:
      - set
      - []
      duplex:
      - set
      - []
      external_ids:
      - map
      - []
      ifindex: 0
      ingress_policing_burst: 0
      ingress_policing_rate: 0
      lacp_current:
      - set
      - []
      link_resets:
      - set
      - []
      link_speed:
      - set
      - []
      link_state:
      - set
      - []
      mac:
      - set
      - []
      mac_in_use: 1e:28:53:9c:15:62
      mtu:
      - set
      - []
      name: patch-tun
      ofport: 1
      ofport_request:
      - set
      - []
      options:
      - map
      - - - peer
          - patch-int
      other_config:
      - map
      - []
      statistics:
      - map
      - - - collisions
          - 0
        - - rx_bytes
          - 0
        - - rx_crc_err
          - 0
        - - rx_dropped
          - 0
        - - rx_errors
          - 0
        - - rx_frame_err
          - 0
        - - rx_over_err
          - 0
        - - rx_packets
          - 0
        - - tx_bytes
          - 0
        - - tx_dropped
          - 0
        - - tx_errors
          - 0
        - - tx_packets
          - 0
      status:
      - map
      - []
      type: patch
[DEBUG] 2014-05-21 08:36:39,978 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-ofctl add-flow br-tun table=0,priority=1,in_port=1,actions=resubmit(,1)
[DEBUG] 2014-05-21 08:36:39,989 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-ofctl add-flow br-tun table=0,priority=0,actions=drop
[DEBUG] 2014-05-21 08:36:40,000 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-ofctl add-flow br-tun table=1,priority=0,dl_dst=01:00:00:00:00:00/01:00:00:00:00:00,actions=resubmit(,19)
[DEBUG] 2014-05-21 08:36:40,012 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-ofctl add-flow br-tun table=1,priority=0,dl_dst=00:00:00:00:00:00/01:00:00:00:00:00,actions=resubmit(,20)
[DEBUG] 2014-05-21 08:36:40,023 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-ofctl add-flow br-tun table=2,priority=0,actions=drop
[DEBUG] 2014-05-21 08:36:40,036 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-ofctl add-flow br-tun table=3,priority=0,actions=drop
[DEBUG] 2014-05-21 08:36:40,047 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-ofctl add-flow br-tun table=10,priority=1,actions=learn(table=20,hard_timeout=300,priority=1,NXM_OF_VLAN_TCI[0..11],NXM_OF_ETH_DST[]=NXM_OF_ETH_SRC[],load:0->NXM_OF_VLAN_TCI[],load:NXM_NX_TUN_ID[]->NXM_NX_TUN_ID[],output:NXM_OF_IN_PORT[]),output:1
[DEBUG] 2014-05-21 08:36:40,059 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-ofctl add-flow br-tun table=19,priority=0,actions=resubmit(,21)
[DEBUG] 2014-05-21 08:36:40,070 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-ofctl add-flow br-tun table=20,priority=0,actions=resubmit(,21)
[DEBUG] 2014-05-21 08:36:40,081 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-ofctl add-flow br-tun table=21,priority=0,actions=drop
[DEBUG] 2014-05-21 08:36:40,092 module:ovsdb,function:crud,router:openwrt3
CRUD operation (add): {'ovs_bridges': 'enabled'}
[DEBUG] 2014-05-21 08:36:40,096 module:ovsdb,function:_send,router:openwrt3
request:
  id: 339801
  method: transact
  params:
  - Open_vSwitch
  - op: insert
    row:
      ovs_bridges: enabled
    table: NLAN_Bridges
    uuid-name: temp_723874
  - mutations:
    - - bridges
      - insert
      - - set
        - - - named-uuid
            - temp_723874
    op: mutate
    table: NLAN
    where: []
response:
  error: null
  id: 339801
  result:
  - uuid:
    - uuid
    - 8acabb90-a2c4-4970-a847-521eb34a2505
  - count: 1
[DEBUG] 2014-05-21 08:36:40,100 module:ovsdb,function:_send,router:openwrt3
request:
  id: 937934
  method: transact
  params:
  - Open_vSwitch
  - op: select
    table: NLAN_Bridges
    where: []
response:
  error: null
  id: 937934
  result:
  - rows:
    - _uuid:
      - uuid
      - 8acabb90-a2c4-4970-a847-521eb34a2505
      _version:
      - uuid
      - d3bb722d-8b63-4de8-a87c-fa0c44ab4603
      controller:
      - set
      - []
      ovs_bridges: enabled
[INFO] 2014-05-21 08:36:40,107 module:nlan_agent,function:_route,router:openwrt3
function:vxlan.add, model:{'remote_ips': ['192.168.1.102', '192.168.1.101', '192.168.1.104'], 'local_ip': '192.168.1.103'}
[DEBUG] 2014-05-21 08:36:40,111 module:ovsdb,function:_send,router:openwrt3
request:
  id: 566187
  method: transact
  params:
  - Open_vSwitch
  - op: select
    table: NLAN
    where: []
response:
  error: null
  id: 566187
  result:
  - rows:
    - _uuid:
      - uuid
      - 45337354-3cbe-44cc-b217-4da5145a1103
      _version:
      - uuid
      - d5f61a67-6e93-471f-b6f9-cf80ae344bbb
      bridges:
      - uuid
      - 8acabb90-a2c4-4970-a847-521eb34a2505
      gateway:
      - set
      - []
      services:
      - set
      - []
      subnets:
      - set
      - []
      vxlan:
      - set
      - []
[DEBUG] 2014-05-21 08:36:40,118 module:ovsdb,function:_send,router:openwrt3
request:
  id: 656787
  method: transact
  params:
  - Open_vSwitch
  - op: select
    table: NLAN_VXLAN
    where: []
response:
  error: null
  id: 656787
  result:
  - rows: []
[INFO] 2014-05-21 08:36:40,123 module:vxlan,function:add,router:openwrt3
Adding a VXLAN tunnel: vxlan_192.168.1.102
[DEBUG] 2014-05-21 08:36:40,124 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-vsctl add-port br-tun vxlan_192.168.1.102 -- set interface vxlan_192.168.1.102 type=vxlan options:in_key=flow options:local_ip=192.168.1.103 options:out_key=flow options:remote_ip=192.168.1.102
[INFO] 2014-05-21 08:36:40,150 module:vxlan,function:add,router:openwrt3
Adding a VXLAN tunnel: vxlan_192.168.1.101
[DEBUG] 2014-05-21 08:36:40,151 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-vsctl add-port br-tun vxlan_192.168.1.101 -- set interface vxlan_192.168.1.101 type=vxlan options:in_key=flow options:local_ip=192.168.1.103 options:out_key=flow options:remote_ip=192.168.1.101
[INFO] 2014-05-21 08:36:40,177 module:vxlan,function:add,router:openwrt3
Adding a VXLAN tunnel: vxlan_192.168.1.104
[DEBUG] 2014-05-21 08:36:40,178 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-vsctl add-port br-tun vxlan_192.168.1.104 -- set interface vxlan_192.168.1.104 type=vxlan options:in_key=flow options:local_ip=192.168.1.103 options:out_key=flow options:remote_ip=192.168.1.104
[DEBUG] 2014-05-21 08:36:40,208 module:ovsdb,function:_send,router:openwrt3
request:
  id: 297150
  method: transact
  params:
  - Open_vSwitch
  - columns:
    - ofport
    - options
    op: select
    table: Interface
    where:
    - - type
      - ==
      - vxlan
response:
  error: null
  id: 297150
  result:
  - rows:
    - ofport: 3
      options:
      - map
      - - - in_key
          - flow
        - - local_ip
          - 192.168.1.103
        - - out_key
          - flow
        - - remote_ip
          - 192.168.1.101
    - ofport: 2
      options:
      - map
      - - - in_key
          - flow
        - - local_ip
          - 192.168.1.103
        - - out_key
          - flow
        - - remote_ip
          - 192.168.1.102
    - ofport: 4
      options:
      - map
      - - - in_key
          - flow
        - - local_ip
          - 192.168.1.103
        - - out_key
          - flow
        - - remote_ip
          - 192.168.1.104
[DEBUG] 2014-05-21 08:36:40,216 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-ofctl add-flow br-tun table=0,priority=1,in_port=3,actions=resubmit(,2)
[DEBUG] 2014-05-21 08:36:40,230 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovsams:
  - Open_vSwitch
  - columns:
    - ofport
    - options
    op: select
    table: Interface
    where:
    - - type
      - ==
      - vxlan
response:
  error: null
  id: 154421
  result:
  - rows:
    - ofport: 4
      options:
      - map
      - - - in_key
          - flow
        - - local_ip
          - 192.168.1.104
        - - out_key
          - flow
        - - remote_ip
          - 192.168.1.101
    - ofport: 3
      options:
      - map
      - - - in_key
          - flow
        - - local_ip
          - 192.168.1.104
        - - out_key
          - flow
        - - remote_ip
          - 192.168.1.102
    - ofport: 2
      options:
      - map
      - - - in_key
          - flow
        - - local_ip
          - 192.168.1.104
        - - out_key
          - flow
        - - remote_ip
          - 192.168.1.103
[DEBUG] 2014-05-21 01:36:43,151 module:cmdutil,function:_cmd2,router:rpi1
cmd: ovs-ofctl add-flow br-tun table=21,priority=1,dl_vlan=1,actions=strip_vlan,set_tunnel:101,output:3,output:2
[DEBUG] 2014-05-21 01:36:43,171 module:ovsdb,function:crud,router:rpi1
CRUD operation (add): {'peers': ['192.168.1.102', '192.168.1.103'], 'ports': ['mz.101'], 'vni': 101, 'vid': 1}
[DEBUG] 2014-05-21 01:36:43,173 module:ovsdb,function:_send,router:rpi1
request:
  id: 300542
  method: transact
  params:
  - Open_vSwitch
  - op: insert
    row:
      peers:
      - set
      - - 192.168.1.102
        - 192.168.1.103
      ports:
      - set
      - - mz.101
      vid: 1
      vni: 101
    table: NLAN_Subnet
    uuid-name: temp_151367
  - mutations:
    - - subnets
      - insert
      - - set
        - - - named-uuid
            - temp_151367
    op: mutate
    table: NLAN
    where: []
response:
  error: null
  id: 300542
  result:
  - uuid:
    - uuid
    - 87c8e122-809c-4403-946d-4e7c809aa6fb
  - count: 1
[DEBUG] 2014-05-21 01:36:43,176 module:ovsdb,function:_send,router:rpi1
request:
  id: 873354
  method: transact
  params:
  - Open_vSwitch
  - op: select
    table: NLAN_Subnet
    where:
    - - vni
      - ==
      - 101
response:
  error: null
  id: 873354
  result:
  - rows:
    - _uuid:
      - uuid
      - 87c8e122-809c-4403-946d-4e7c809aa6fb
      _version:
      - uuid
      - e3c40b99-6045-4aed-bc96-adb4b2d8f31b
      default_gw:
      - set
      - []
      ip_dvr:
      - map
      - []
      ip_vhost:
      - set
      - []
      peers:
      - set
      - - 192.168.1.102
        - 192.168.1.103
      ports: mz.101
      vid: 1
      vni: 101
[INFO] 2014-05-21 01:36:43,180 module:nlan_agent,function:<module>,router:rpi1
NLAN Agent execution completed
--- RESPONSE from router:rpi1,platform:debian
message: Execution completed
exit: 0
-ofctl add-flow br-tun table=0,priority=1,in_port=2,actions=resubmit(,2)
[DEBUG] 2014-05-21 08:36:40,247 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-ofctl add-flow br-tun table=0,priority=1,in_port=4,actions=resubmit(,2)
[DEBUG] 2014-05-21 08:36:40,258 module:ovsdb,function:crud,router:openwrt3
CRUD operation (add): {'remote_ips': ['192.168.1.102', '192.168.1.101', '192.168.1.104'], 'local_ip': '192.168.1.103'}
[DEBUG] 2014-05-21 08:36:40,263 module:ovsdb,function:_send,router:openwrt3
request:
  id: 265193
  method: transact
  params:
  - Open_vSwitch
  - op: insert
    row:
      local_ip: 192.168.1.103
      remote_ips:
      - set
      - - 192.168.1.102
        - 192.168.1.101
        - 192.168.1.104
    table: NLAN_VXLAN
    uuid-name: temp_241043
  - mutations:
    - - vxlan
      - insert
      - - set
        - - - named-uuid
            - temp_241043
    op: mutate
    table: NLAN
    where: []
response:
  error: null
  id: 265193
  result:
  - uuid:
    - uuid
    - 37be9172-7cca-4c31-986b-4ee1207ae6a5
  - count: 1
[DEBUG] 2014-05-21 08:36:40,268 module:ovsdb,function:_send,router:openwrt3
request:
  id: 868251
  method: transact
  params:
  - Open_vSwitch
  - op: select
    table: NLAN_VXLAN
    where: []
response:
  error: null
  id: 868251
  result:
  - rows:
    - _uuid:
      - uuid
      - 37be9172-7cca-4c31-986b-4ee1207ae6a5
      _version:
      - uuid
      - 992e79c9-f68a-4255-ac9b-93e34e49cf08
      local_ip: 192.168.1.103
      remote_ips:
      - set
      - - 192.168.1.101
        - 192.168.1.102
        - 192.168.1.104
[INFO] 2014-05-21 08:36:40,289 module:nlan_agent,function:_route,router:openwrt3
function:subnets.add, index:['vni', 1], model:{'peers': ['192.168.1.101', '192.168.1.102'], 'vid': 2, 'ip_vhost': '192.168.100.103/24', 'default_gw': '192.168.100.1', 'ip_dvr': OrderedDict([('addr', '192.168.100.3/24'), ('mode', 'dvr')]), 'vni': 1}
[DEBUG] 2014-05-21 08:36:40,292 module:ovsdb,function:_send,router:openwrt3
request:
  id: 102072
  method: transact
  params:
  - Open_vSwitch
  - op: select
    table: NLAN
    where: []
response:
  error: null
  id: 102072
  result:
  - rows:
    - _uuid:
      - uuid
      - 45337354-3cbe-44cc-b217-4da5145a1103
      _version:
      - uuid
      - 542fb4d0-5f22-4d3f-8a42-4e518859991d
      bridges:
      - uuid
      - 8acabb90-a2c4-4970-a847-521eb34a2505
      gateway:
      - set
      - []
      services:
      - set
      - []
      subnets:
      - set
      - []
      vxlan:
      - uuid
      - 37be9172-7cca-4c31-986b-4ee1207ae6a5
[DEBUG] 2014-05-21 08:36:40,300 module:ovsdb,function:_send,router:openwrt3
request:
  id: 158247
  method: transact
  params:
  - Open_vSwitch
  - op: select
    table: NLAN_Subnet
    where:
    - - vni
      - ==
      - 1
response:
  error: null
  id: 158247
  result:
  - rows: []
[INFO] 2014-05-21 08:36:40,306 module:subnets,function:add,router:openwrt3
Adding a subnet(vlan): 2
[DEBUG] 2014-05-21 08:36:40,307 module:cmdutil,function:_cmd2,router:openwrt3
cmd: brctl addbr br1
[DEBUG] 2014-05-21 08:36:40,318 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-vsctl add-port br-int int_br1 tag=2 -- set interface int_br1 type=internal
[DEBUG] 2014-05-21 08:36:40,364 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-vsctl add-port br-int int_dvr1 tag=2 -- set interface int_dvr1 type=internal
[DEBUG] 2014-05-21 08:36:40,413 module:cmdutil,function:_cmd2,router:openwrt3
cmd: brctl addif br1 int_br1
[DEBUG] 2014-05-21 08:36:40,422 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip link set dev int_br1 promisc on
[DEBUG] 2014-05-21 08:36:40,436 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip link set dev int_br1 up
[DEBUG] 2014-05-21 08:36:40,442 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip link set dev int_dvr1 up
[DEBUG] 2014-05-21 08:36:40,447 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip link set dev br1 up
[DEBUG] 2014-05-21 08:36:40,459 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip netns add ns1
[DEBUG] 2014-05-21 08:36:40,471 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip link add veth-ns1 type veth peer name temp-ns1
[DEBUG] 2014-05-21 08:36:40,486 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip link set dev temp-ns1 netns ns1
[DEBUG] 2014-05-21 08:36:40,493 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip netns exec ns1 ip link set dev temp-ns1 name eth0
[DEBUG] 2014-05-21 08:36:40,504 module:cmdutil,function:_cmd2,router:openwrt3
cmd: brctl addif br1 veth-ns1
[DEBUG] 2014-05-21 08:36:40,520 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip link set dev veth-ns1 promisc on
[DEBUG] 2014-05-21 08:36:40,528 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip link set dev veth-ns1 up
[DEBUG] 2014-05-21 08:36:40,548 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip netns exec ns1 ip link set dev eth0 up
[DEBUG] 2014-05-21 08:36:40,566 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip netns exec ns1 ip addr add dev eth0 192.168.100.103/24
[DEBUG] 2014-05-21 08:36:40,577 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip netns exec ns1 ip route add default via 192.168.100.3 dev eth0
[DEBUG] 2014-05-21 08:36:40,584 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip addr add dev int_dvr1 192.168.100.3/24
[DEBUG] 2014-05-21 08:36:40,591 module:cmdutil,function:_cmd2,router:openwrt3
cmd: route
[DEBUG] 2014-05-21 08:36:40,596 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip route add default via 192.168.100.1
[DEBUG] 2014-05-21 08:36:40,603 module:ovsdb,function:_send,router:openwrt3
request:
  id: 754669
  method: transact
  params:
  - Open_vSwitch
  - columns:
    - target
    op: select
    table: Controller
    where: []
response:
  error: null
  id: 754669
  result:
  - rows: []
[DEBUG] 2014-05-21 08:36:40,606 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-ofctl add-flow br-tun table=2,priority=1,tun_id=1,actions=mod_vlan_vid:2,resubmit(,10)
[DEBUG] 2014-05-21 08:36:40,616 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-ofctl add-flow br-tun table=19,priority=1,dl_type=0x0806,dl_vlan=2,nw_dst=192.168.100.3,actions=drop
[DEBUG] 2014-05-21 08:36:40,628 module:ovsdb,function:_send,router:openwrt3
request:
  id: 913986
  method: transact
  params:
  - Open_vSwitch
  - columns:
    - ofport
    - options
    op: select
    table: Interface
    where:
    - - type
      - ==
      - vxlan
response:
  error: null
  id: 913986
  result:
  - rows:
    - ofport: 3
      options:
      - map
      - - - in_key
          - flow
        - - local_ip
          - 192.168.1.103
        - - out_key
          - flow
        - - remote_ip
          - 192.168.1.101
    - ofport: 2
      options:
      - map
      - - - in_key
          - flow
        - - local_ip
          - 192.168.1.103
        - - out_key
          - flow
        - - remote_ip
          - 192.168.1.102
    - ofport: 4
      options:
      - map
      - - - in_key
          - flow
        - - local_ip
          - 192.168.1.103
        - - out_key
          - flow
        - - remote_ip
          - 192.168.1.104
[DEBUG] 2014-05-21 08:36:40,637 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-ofctl add-flow br-tun table=21,priority=1,dl_vlan=2,actions=strip_vlan,set_tunnel:1,output:3,output:2
[DEBUG] 2014-05-21 08:36:40,647 module:ovsdb,function:crud,router:openwrt3
CRUD operation (add): {'peers': ['192.168.1.101', '192.168.1.102'], 'vid': 2, 'ip_vhost': '192.168.100.103/24', 'default_gw': '192.168.100.1', 'ip_dvr': OrderedDict([('addr', '192.168.100.3/24'), ('mode', 'dvr')]), 'vni': 1}
[DEBUG] 2014-05-21 08:36:40,664 module:ovsdb,function:_send,router:openwrt3
request:
  id: 727548
  method: transact
  params:
  - Open_vSwitch
  - op: insert
    row:
      default_gw: 192.168.100.1
      ip_dvr:
      - map
      - - - addr
          - 192.168.100.3/24
        - - mode
          - dvr
      ip_vhost: 192.168.100.103/24
      peers:
      - set
      - - 192.168.1.101
        - 192.168.1.102
      vid: 2
      vni: 1
    table: NLAN_Subnet
    uuid-name: temp_623588
  - mutations:
    - - subnets
      - insert
      - - set
        - - - named-uuid
            - temp_623588
    op: mutate
    table: NLAN
    where: []
response:
  error: null
  id: 727548
  result:
  - uuid:
    - uuid
    - 5f49340b-e2cd-432d-9cd3-78e0a7d064e9
  - count: 1
[DEBUG] 2014-05-21 08:36:40,677 module:ovsdb,function:_send,router:openwrt3
request:
  id: 202032
  method: transact
  params:
  - Open_vSwitch
  - op: select
    table: NLAN_Subnet
    where:
    - - vni
      - ==
      - 1
response:
  error: null
  id: 202032
  result:
  - rows:
    - _uuid:
      - uuid
      - 5f49340b-e2cd-432d-9cd3-78e0a7d064e9
      _version:
      - uuid
      - eee1500e-92ea-4921-bd89-9b7fa6772e68
      default_gw: 192.168.100.1
      ip_dvr:
      - map
      - - - addr
          - 192.168.100.3/24
        - - mode
          - dvr
      ip_vhost: 192.168.100.103/24
      peers:
      - set
      - - 192.168.1.101
        - 192.168.1.102
      ports:
      - set
      - []
      vid: 2
      vni: 1
[INFO] 2014-05-21 08:36:40,690 module:nlan_agent,function:_route,router:openwrt3
function:subnets.add, index:['vni', 103], model:{'peers': ['192.168.1.101', '192.168.1.102'], 'vid': 3, 'ip_vhost': '10.0.3.103/24', 'vni': 103, 'ip_dvr': OrderedDict([('addr', '10.0.3.1/24'), ('mode', 'dvr')])}
[DEBUG] 2014-05-21 08:36:40,696 module:ovsdb,function:_send,router:openwrt3
request:
  id: 869241
  method: transact
  params:
  - Open_vSwitch
  - op: select
    table: NLAN
    where: []
response:
  error: null
  id: 869241
  result:
  - rows:
    - _uuid:
      - uuid
      - 45337354-3cbe-44cc-b217-4da5145a1103
      _version:
      - uuid
      - 5d0a31be-972c-47fd-be0c-d7300f59e70e
      bridges:
      - uuid
      - 8acabb90-a2c4-4970-a847-521eb34a2505
      gateway:
      - set
      - []
      services:
      - set
      - []
      subnets:
      - uuid
      - 5f49340b-e2cd-432d-9cd3-78e0a7d064e9
      vxlan:
      - uuid
      - 37be9172-7cca-4c31-986b-4ee1207ae6a5
[DEBUG] 2014-05-21 08:36:40,705 module:ovsdb,function:_send,router:openwrt3
request:
  id: 978141
  method: transact
  params:
  - Open_vSwitch
  - op: select
    table: NLAN_Subnet
    where:
    - - vni
      - ==
      - 103
response:
  error: null
  id: 978141
  result:
  - rows: []
[INFO] 2014-05-21 08:36:40,708 module:subnets,function:add,router:openwrt3
Adding a subnet(vlan): 3
[DEBUG] 2014-05-21 08:36:40,709 module:cmdutil,function:_cmd2,router:openwrt3
cmd: brctl addbr br103
[DEBUG] 2014-05-21 08:36:40,719 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-vsctl add-port br-int int_br103 tag=3 -- set interface int_br103 type=internal
[DEBUG] 2014-05-21 08:36:40,788 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-vsctl add-port br-int int_dvr103 tag=3 -- set interface int_dvr103 type=internal
[DEBUG] 2014-05-21 08:36:40,861 module:cmdutil,function:_cmd2,router:openwrt3
cmd: brctl addif br103 int_br103
[DEBUG] 2014-05-21 08:36:40,894 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip link set dev int_br103 promisc on
[DEBUG] 2014-05-21 08:36:40,902 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip link set dev int_br103 up
[DEBUG] 2014-05-21 08:36:40,912 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip link set dev int_dvr103 up
[DEBUG] 2014-05-21 08:36:40,919 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip link set dev br103 up
[DEBUG] 2014-05-21 08:36:40,931 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip netns add ns103
[DEBUG] 2014-05-21 08:36:40,939 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip link add veth-ns103 type veth peer name temp-ns103
[DEBUG] 2014-05-21 08:36:40,955 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip link set dev temp-ns103 netns ns103
[DEBUG] 2014-05-21 08:36:40,962 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip netns exec ns103 ip link set dev temp-ns103 name eth0
[DEBUG] 2014-05-21 08:36:40,972 module:cmdutil,function:_cmd2,router:openwrt3
cmd: brctl addif br103 veth-ns103
[DEBUG] 2014-05-21 08:36:40,987 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip link set dev veth-ns103 promisc on
[DEBUG] 2014-05-21 08:36:40,993 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip link set dev veth-ns103 up
[DEBUG] 2014-05-21 08:36:41,010 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip netns exec ns103 ip link set dev eth0 up
[DEBUG] 2014-05-21 08:36:41,031 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip netns exec ns103 ip addr add dev eth0 10.0.3.103/24
[DEBUG] 2014-05-21 08:36:41,040 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip netns exec ns103 ip route add default via 10.0.3.1 dev eth0
[DEBUG] 2014-05-21 08:36:41,045 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip addr add dev int_dvr103 10.0.3.1/24
[DEBUG] 2014-05-21 08:36:41,055 module:ovsdb,function:_send,router:openwrt3
request:
  id: 444106
  method: transact
  params:
  - Open_vSwitch
  - columns:
    - target
    op: select
    table: Controller
    where: []
response:
  error: null
  id: 444106
  result:
  - rows: []
[DEBUG] 2014-05-21 08:36:41,057 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-ofctl add-flow br-tun table=2,priority=1,tun_id=103,actions=mod_vlan_vid:3,resubmit(,10)
[DEBUG] 2014-05-21 08:36:41,067 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-ofctl add-flow br-tun table=19,priority=1,dl_type=0x0806,dl_vlan=3,nw_dst=10.0.3.1,actions=drop
[DEBUG] 2014-05-21 08:36:41,079 module:ovsdb,function:_send,router:openwrt3
request:
  id: 308950
  method: transact
  params:
  - Open_vSwitch
  - columns:
    - ofport
    - options
    op: select
    table: Interface
    where:
    - - type
      - ==
      - vxlan
response:
  error: null
  id: 308950
  result:
  - rows:
    - ofport: 3
      options:
      - map
      - - - in_key
          - flow
        - - local_ip
          - 192.168.1.103
        - - out_key
          - flow
        - - remote_ip
          - 192.168.1.101
    - ofport: 2
      options:
      - map
      - - - in_key
          - flow
        - - local_ip
          - 192.168.1.103
        - - out_key
          - flow
        - - remote_ip
          - 192.168.1.102
    - ofport: 4
      options:
      - map
      - - - in_key
          - flow
        - - local_ip
          - 192.168.1.103
        - - out_key
          - flow
        - - remote_ip
          - 192.168.1.104
[DEBUG] 2014-05-21 08:36:41,089 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-ofctl add-flow br-tun table=21,priority=1,dl_vlan=3,actions=strip_vlan,set_tunnel:103,output:3,output:2
[DEBUG] 2014-05-21 08:36:41,098 module:ovsdb,function:crud,router:openwrt3
CRUD operation (add): {'peers': ['192.168.1.101', '192.168.1.102'], 'vid': 3, 'ip_vhost': '10.0.3.103/24', 'vni': 103, 'ip_dvr': OrderedDict([('addr', '10.0.3.1/24'), ('mode', 'dvr')])}
[DEBUG] 2014-05-21 08:36:41,102 module:ovsdb,function:_send,router:openwrt3
request:
  id: 289799
  method: transact
  params:
  - Open_vSwitch
  - op: insert
    row:
      ip_dvr:
      - map
      - - - addr
          - 10.0.3.1/24
        - - mode
          - dvr
      ip_vhost: 10.0.3.103/24
      peers:
      - set
      - - 192.168.1.101
        - 192.168.1.102
      vid: 3
      vni: 103
    table: NLAN_Subnet
    uuid-name: temp_323201
  - mutations:
    - - subnets
      - insert
      - - set
        - - - named-uuid
            - temp_323201
    op: mutate
    table: NLAN
    where: []
response:
  error: null
  id: 289799
  result:
  - uuid:
    - uuid
    - 71bc7395-7714-4826-9f2f-f3d441b98179
  - count: 1
[DEBUG] 2014-05-21 08:36:41,106 module:ovsdb,function:_send,router:openwrt3
request:
  id: 576774
  method: transact
  params:
  - Open_vSwitch
  - op: select
    table: NLAN_Subnet
    where:
    - - vni
      - ==
      - 103
response:
  error: null
  id: 576774
  result:
  - rows:
    - _uuid:
      - uuid
      - 71bc7395-7714-4826-9f2f-f3d441b98179
      _version:
      - uuid
      - 3f271123-181b-4137-bf31-f7612cc56b8b
      default_gw:
      - set
      - []
      ip_dvr:
      - map
      - - - addr
          - 10.0.3.1/24
        - - mode
          - dvr
      ip_vhost: 10.0.3.103/24
      peers:
      - set
      - - 192.168.1.101
        - 192.168.1.102
      ports:
      - set
      - []
      vid: 3
      vni: 103
[INFO] 2014-05-21 08:36:41,113 module:nlan_agent,function:_route,router:openwrt3
function:subnets.add, index:['vni', 101], model:{'peers': ['192.168.1.102', '192.168.1.104'], 'vid': 1, 'ip_vhost': '10.0.1.103/24', 'vni': 101, 'ip_dvr': OrderedDict([('addr', '10.0.1.1/24'), ('mode', 'spoke_dvr')])}
[DEBUG] 2014-05-21 08:36:41,116 module:ovsdb,function:_send,router:openwrt3
request:
  id: 94902
  method: transact
  params:
  - Open_vSwitch
  - op: select
    table: NLAN
    where: []
response:
  error: null
  id: 94902
  result:
  - rows:
    - _uuid:
      - uuid
      - 45337354-3cbe-44cc-b217-4da5145a1103
      _version:
      - uuid
      - 6231c680-41fb-4caa-97f0-108ecc301b02
      bridges:
      - uuid
      - 8acabb90-a2c4-4970-a847-521eb34a2505
      gateway:
      - set
      - []
      services:
      - set
      - []
      subnets:
      - set
      - - - uuid
          - 5f49340b-e2cd-432d-9cd3-78e0a7d064e9
        - - uuid
          - 71bc7395-7714-4826-9f2f-f3d441b98179
      vxlan:
      - uuid
      - 37be9172-7cca-4c31-986b-4ee1207ae6a5
[DEBUG] 2014-05-21 08:36:41,123 module:ovsdb,function:_send,router:openwrt3
request:
  id: 427273
  method: transact
  params:
  - Open_vSwitch
  - op: select
    table: NLAN_Subnet
    where:
    - - vni
      - ==
      - 101
response:
  error: null
  id: 427273
  result:
  - rows: []
[INFO] 2014-05-21 08:36:41,126 module:subnets,function:add,router:openwrt3
Adding a subnet(vlan): 1
[DEBUG] 2014-05-21 08:36:41,126 module:cmdutil,function:_cmd2,router:openwrt3
cmd: brctl addbr br101
[DEBUG] 2014-05-21 08:36:41,136 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-vsctl add-port br-int int_br101 tag=1 -- set interface int_br101 type=internal
[DEBUG] 2014-05-21 08:36:41,176 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-vsctl add-port br-int int_dvr101 tag=1 -- set interface int_dvr101 type=internal
[DEBUG] 2014-05-21 08:36:41,214 module:cmdutil,function:_cmd2,router:openwrt3
cmd: brctl addif br101 int_br101
[DEBUG] 2014-05-21 08:36:41,224 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip link set dev int_br101 promisc on
[DEBUG] 2014-05-21 08:36:41,231 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip link set dev int_br101 up
[DEBUG] 2014-05-21 08:36:41,239 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip link set dev int_dvr101 up
[DEBUG] 2014-05-21 08:36:41,246 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip link set dev br101 up
[DEBUG] 2014-05-21 08:36:41,259 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip netns add ns101
[DEBUG] 2014-05-21 08:36:41,269 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip link add veth-ns101 type veth peer name temp-ns101
[DEBUG] 2014-05-21 08:36:41,282 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip link set dev temp-ns101 netns ns101
[DEBUG] 2014-05-21 08:36:41,289 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip netns exec ns101 ip link set dev temp-ns101 name eth0
[DEBUG] 2014-05-21 08:36:41,299 module:cmdutil,function:_cmd2,router:openwrt3
cmd: brctl addif br101 veth-ns101
[DEBUG] 2014-05-21 08:36:41,310 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip link set dev veth-ns101 promisc on
[DEBUG] 2014-05-21 08:36:41,314 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip link set dev veth-ns101 up
[DEBUG] 2014-05-21 08:36:41,331 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip netns exec ns101 ip link set dev eth0 up
[DEBUG] 2014-05-21 08:36:41,346 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip netns exec ns101 ip addr add dev eth0 10.0.1.103/24
[DEBUG] 2014-05-21 08:36:41,354 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip netns exec ns101 ip route add default via 10.0.1.1 dev eth0
[DEBUG] 2014-05-21 08:36:41,362 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip addr add dev int_dvr101 10.0.1.1/24
[DEBUG] 2014-05-21 08:36:41,367 module:ovsdb,function:_send,router:openwrt3
request:
  id: 972605
  method: transact
  params:
  - Open_vSwitch
  - columns:
    - target
    op: select
    table: Controller
    where: []
response:
  error: null
  id: 972605
  result:
  - rows: []
[DEBUG] 2014-05-21 08:36:41,368 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-ofctl add-flow br-tun table=2,priority=1,tun_id=101,actions=mod_vlan_vid:1,resubmit(,10)
[DEBUG] 2014-05-21 08:36:41,377 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ip link show dev int_dvr101
[DEBUG] 2014-05-21 08:36:41,385 module:ovsdb,function:_send,router:openwrt3
request:
  id: 467874
  method: transact
  params:
  - Open_vSwitch
  - op: select
    table: Interface
    where:
    - - name
      - ==
      - int_dvr101
response:
  error: null
  id: 467874
  result:
  - rows:
    - _uuid:
      - uuid
      - 3834d340-b8cc-493e-a669-b1f1f81ce841
      _version:
      - uuid
      - 75153ff6-9a49-483e-ab16-2451b9fb90c3
      admin_state: up
      bfd:
      - map
      - []
      bfd_status:
      - map
      - []
      cfm_fault:
      - set
      - []
      cfm_fault_status:
      - set
      - []
      cfm_flap_count:
      - set
      - []
      cfm_health:
      - set
      - []
      cfm_mpid:
      - set
      - []
      cfm_remote_mpids:
      - set
      - []
      cfm_remote_opstate:
      - set
      - []
      duplex:
      - set
      - []
      external_ids:
      - map
      - []
      ifindex: 44
      ingress_policing_burst: 0
      ingress_policing_rate: 0
      lacp_current:
      - set
      - []
      link_resets: 2
      link_speed:
      - set
      - []
      link_state: up
      mac:
      - set
      - []
      mac_in_use: d6:a1:2a:1b:5b:ad
      mtu: 1500
      name: int_dvr101
      ofport: 7
      ofport_request:
      - set
      - []
      options:
      - map
      - []
      other_config:
      - map
      - []
      statistics:
      - map
      - - - collisions
          - 0
        - - rx_bytes
          - 0
        - - rx_crc_err
          - 0
        - - rx_dropped
          - 0
        - - rx_errors
          - 0
        - - rx_frame_err
          - 0
        - - rx_over_err
          - 0
        - - rx_packets
          - 0
        - - tx_bytes
          - 0
        - - tx_dropped
          - 0
        - - tx_errors
          - 0
        - - tx_packets
          - 0
      status:
      - map
      - - - driver_name
          - openvswitch
      type: internal
[DEBUG] 2014-05-21 08:36:41,396 module:ovsdb,function:_send,router:openwrt3
request:
  id: 151401
  method: transact
  params:
  - Open_vSwitch
  - op: select
    table: Interface
    where:
    - - name
      - ==
      - int_br101
response:
  error: null
  id: 151401
  result:
  - rows:
    - _uuid:
      - uuid
      - df3e73f3-847d-4428-ba66-1ab8ffbf7f00
      _version:
      - uuid
      - f598f433-c04d-47b8-84f5-2862ee36c758
      admin_state: up
      bfd:
      - map
      - []
      bfd_status:
      - map
      - []
      cfm_fault:
      - set
      - []
      cfm_fault_status:
      - set
      - []
      cfm_flap_count:
      - set
      - []
      cfm_health:
      - set
      - []
      cfm_mpid:
      - set
      - []
      cfm_remote_mpids:
      - set
      - []
      cfm_remote_opstate:
      - set
      - []
      duplex:
      - set
      - []
      external_ids:
      - map
      - []
      ifindex: 43
      ingress_policing_burst: 0
      ingress_policing_rate: 0
      lacp_current:
      - set
      - []
      link_resets: 2
      link_speed:
      - set
      - []
      link_state: up
      mac:
      - set
      - []
      mac_in_use: 5a:8c:1f:1a:3e:cd
      mtu: 1500
      name: int_br101
      ofport: 6
      ofport_request:
      - set
      - []
      options:
      - map
      - []
      other_config:
      - map
      - []
      statistics:
      - map
      - - - collisions
          - 0
        - - rx_bytes
          - 0
        - - rx_crc_err
          - 0
        - - rx_dropped
          - 0
        - - rx_errors
          - 0
        - - rx_frame_err
          - 0
        - - rx_over_err
          - 0
        - - rx_packets
          - 0
        - - tx_bytes
          - 0
        - - tx_dropped
          - 0
        - - tx_errors
          - 0
        - - tx_packets
          - 0
      status:
      - map
      - - - driver_name
          - openvswitch
      type: internal
[DEBUG] 2014-05-21 08:36:41,411 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-ofctl add-flow br-int table=0,priority=2,in_port=6,dl_type=0x0800,nw_dst=10.0.1.0/24,actions=normal
[DEBUG] 2014-05-21 08:36:41,421 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-ofctl add-flow br-int table=0,priority=1,in_port=6,dl_type=0x0800,nw_dst=10.0.0.0/8,actions=resubmit(,1)
[DEBUG] 2014-05-21 08:36:41,430 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-ofctl add-flow br-int table=0,priority=1,in_port=6,dl_type=0x0800,nw_dst=172.16.0.0/12,actions=resubmit(,1)
[DEBUG] 2014-05-21 08:36:41,440 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-ofctl add-flow br-int table=0,priority=1,in_port=6,dl_type=0x0800,nw_dst=192.168.0.0/16,actions=resubmit(,1)
[DEBUG] 2014-05-21 08:36:41,451 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-ofctl add-flow br-int table=0,priority=1,in_port=7,dl_type=0x0806,nw_src=10.0.1.1,nw_proto=2,actions=drop
[DEBUG] 2014-05-21 08:36:41,461 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-ofctl add-flow br-int table=1,priority=0,in_port=6,actions=set_field:d6:a1:2a:1b:5b:ad->dl_dst,output:7
[DEBUG] 2014-05-21 08:36:41,470 module:ovsdb,function:_send,router:openwrt3
request:
  id: 868043
  method: transact
  params:
  - Open_vSwitch
  - columns:
    - ofport
    - options
    op: select
    table: Interface
    where:
    - - type
      - ==
      - vxlan
response:
  error: null
  id: 868043
  result:
  - rows:
    - ofport: 3
      options:
      - map
      - - - in_key
          - flow
        - - local_ip
          - 192.168.1.103
        - - out_key
          - flow
        - - remote_ip
          - 192.168.1.101
    - ofport: 2
      options:
      - map
      - - - in_key
          - flow
        - - local_ip
          - 192.168.1.103
        - - out_key
          - flow
        - - remote_ip
          - 192.168.1.102
    - ofport: 4
      options:
      - map
      - - - in_key
          - flow
        - - local_ip
          - 192.168.1.103
        - - out_key
          - flow
        - - remote_ip
          - 192.168.1.104
[DEBUG] 2014-05-21 08:36:41,476 module:cmdutil,function:_cmd2,router:openwrt3
cmd: ovs-ofctl add-flow br-tun table=21,priority=1,dl_vlan=1,actions=strip_vlan,set_tunnel:101,output:2,output:4
[DEBUG] 2014-05-21 08:36:41,486 module:ovsdb,function:crud,router:openwrt3
CRUD operation (add): {'peers': ['192.168.1.102', '192.168.1.104'], 'vid': 1, 'ip_vhost': '10.0.1.103/24', 'vni': 101, 'ip_dvr': OrderedDict([('addr', '10.0.1.1/24'), ('mode', 'spoke_dvr')])}
[DEBUG] 2014-05-21 08:36:41,489 module:ovsdb,function:_send,router:openwrt3
request:
  id: 474630
  method: transact
  params:
  - Open_vSwitch
  - op: insert
    row:
      ip_dvr:
      - map
      - - - addr
          - 10.0.1.1/24
        - - mode
          - spoke_dvr
      ip_vhost: 10.0.1.103/24
      peers:
      - set
      - - 192.168.1.102
        - 192.168.1.104
      vid: 1
      vni: 101
    table: NLAN_Subnet
    uuid-name: temp_899613
  - mutations:
    - - subnets
      - insert
      - - set
        - - - named-uuid
            - temp_899613
    op: mutate
    table: NLAN
    where: []
response:
  error: null
  id: 474630
  result:
  - uuid:
    - uuid
    - ffa098af-2c16-416f-bde2-e0e7b3d063d0
  - count: 1
[DEBUG] 2014-05-21 08:36:41,493 module:ovsdb,function:_send,router:openwrt3
request:
  id: 771431
  method: transact
  params:
  - Open_vSwitch
  - op: select
    table: NLAN_Subnet
    where:
    - - vni
      - ==
      - 101
response:
  error: null
  id: 771431
  result:
  - rows:
    - _uuid:
      - uuid
      - ffa098af-2c16-416f-bde2-e0e7b3d063d0
      _version:
      - uuid
      - de2e923a-2f12-4d31-abd5-36c7f4596ead
      default_gw:
      - set
      - []
      ip_dvr:
      - map
      - - - addr
          - 10.0.1.1/24
        - - mode
          - spoke_dvr
      ip_vhost: 10.0.1.103/24
      peers:
      - set
      - - 192.168.1.102
        - 192.168.1.104
      ports:
      - set
      - []
      vid: 1
      vni: 101
[INFO] 2014-05-21 08:36:41,500 module:nlan_agent,function:<module>,router:openwrt3
NLAN Agent execution completed
--- RESPONSE from router:openwrt3,platform:openwrt
message: Execution completed
exit: 0
--- STDOUT from router:openwrt1,platform:openwrt
[INFO] 2014-05-21 08:36:39,901 module:nlan_agent,function:<module>,router:openwrt1
NLAN Agent initialization completed
[DEBUG] 2014-05-21 08:36:39,905 module:nlan_agent,function:<module>,router:openwrt1
__n__: {'tables': {'services': {'max': 'unlimited', 'key': {'type': 'uuid', 'refTable': 'NLAN_Service'}, 'min': 0}, 'bridges': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_Bridges'}, 'min': 0}, 'gateway': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_Gateway'}, 'min': 0}, 'vxlan': {'max': 1, 'key': {'type': 'uuid', 'refTable': 'NLAN_VXLAN'}, 'min': 0}, 'subnets': {'max': 'unlimited', 'key': {'type': 'uuid', 'refTable': 'NLAN_Subnet'}, 'min': 0}}, 'agent_dir': '/opt/nlan', 'platform': 'openwrt', 'share_dir': '/opt/nlan/share', 'state_order': ['bridges', 'services', 'gateway', 'vxlan', 'subnets'], 'logger': <logging.Logger object at 0xb7641bec>, 'router': 'openwrt1', 'schema': 'ovsdb_nlan.schema', 'types': {'services': {'name': {'max': 1, 'key': {'type': 'string'}, 'min': 1}, 'chain': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}}, 'bridges': {'controller': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'ovs_bridges': {'max': 1, 'key': {'enum': ['set', ['enabled']], 'type': 'string'}, 'min': 0}}, 'gateway': {'network': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'rip': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}, 'vxlan': {'remote_ips': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}, 'local_ip': {'max': 1, 'key': {'type': 'string'}, 'min': 0}}, 'subnets': {'peers': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}, 'vid': {'max': 1, 'key': {'minInteger': 0, 'maxInteger': 4095, 'type': 'integer'}, 'min': 0}, 'ip_vhost': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'vni': {'max': 1, 'key': {'minInteger': 0, 'maxInteger': 16777215, 'type': 'integer'}, 'min': 1}, 'ip_dvr': {'max': 3, 'value': {'type': 'string'}, 'key': {'enum': ['set', ['addr', 'mode', 'dhcp']], 'type': 'string'}, 'min': 0}, 'default_gw': {'max': 1, 'key': {'type': 'string'}, 'min': 0}, 'ports': {'max': 'unlimited', 'key': {'type': 'string'}, 'min': 0}}}, 'indexes': {'services': 'name', 'subnets': 'vni'}}
[INFO] 2014-05-21 08:36:40,067 module:nlan_agent,function:_route,router:openwrt1
function:bridges.add, model:{'ovs_bridges': 'enabled'}
[DEBUG] 2014-05-21 08:36:40,089 module:ovsdb,function:_send,router:openwrt1
request:
  id: 811389
  method: transact
  params:
  - Open_vSwitch
  - op: select
    table: NLAN
    where: []
response:
  error: null
  id: 811389
  result:
  - rows: []
[DEBUG] 2014-05-21 08:36:40,099 module:ovsdb,function:_send,router:openwrt1
request:
  id: 793466
  method: transact
  params:
  - Open_vSwitch
  - op: insert
    row: {}
    table: NLAN
response:
  error: null
  id: 793466
  result:
  - uuid:
    - uuid
    - f3b41d1d-1a84-4c43-835b-8717bae74843
[DEBUG] 2014-05-21 08:36:40,108 module:ovsdb,function:_send,router:openwrt1
request:
  id: 434503
  method: transact
  params:
  - Open_vSwitch
  - op: select
    table: NLAN_Bridges
    where: []
response:
  error: null
  id: 434503
  result:
  - rows: []
[INFO] 2014-05-21 08:36:40,111 module:bridges,function:add,router:openwrt1
Adding bridges: br-int and br-tun
[DEBUG] 2014-05-21 08:36:40,221 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-vsctl add-br br-int
[DEBUG] 2014-05-21 08:36:40,286 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-vsctl add-br br-tun
[DEBUG] 2014-05-21 08:36:40,381 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-ofctl del-flows br-tun
[DEBUG] 2014-05-21 08:36:40,414 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-vsctl add-port br-int patch-int -- set interface patch-int type=patch options:peer=patch-tun
[DEBUG] 2014-05-21 08:36:40,453 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-vsctl add-port br-tun patch-tun -- set interface patch-tun type=patch options:peer=patch-int
[DEBUG] 2014-05-21 08:36:40,527 module:ovsdb,function:_send,router:openwrt1
request:
  id: 598338
  method: transact
  params:
  - Open_vSwitch
  - op: select
    table: Interface
    where:
    - - name
      - ==
      - patch-tun
response:
  error: null
  id: 598338
  result:
  - rows:
    - _uuid:
      - uuid
      - 5a9be87d-71a1-4efe-83ac-79409ab4c45a
      _version:
      - uuid
      - 70fffabb-2b00-409f-978e-c689e3e8a71b
      admin_state:
      - set
      - []
      bfd:
      - map
      - []
      bfd_status:
      - map
      - []
      cfm_fault:
      - set
      - []
      cfm_fault_status:
      - set
      - []
      cfm_flap_count:
      - set
      - []
      cfm_health:
      - set
      - []
      cfm_mpid:
      - set
      - []
      cfm_remote_mpids:
      - set
      - []
      cfm_remote_opstate:
      - set
      - []
      duplex:
      - set
      - []
      external_ids:
      - map
      - []
      ifindex: 0
      ingress_policing_burst: 0
      ingress_policing_rate: 0
      lacp_current:
      - set
      - []
      link_resets:
      - set
      - []
      link_speed:
      - set
      - []
      link_state:
      - set
      - []
      mac:
      - set
      - []
      mac_in_use: 36:d6:cf:00:30:4d
      mtu:
      - set
      - []
      name: patch-tun
      ofport: 1
      ofport_request:
      - set
      - []
      options:
      - map
      - - - peer
          - patch-int
      other_config:
      - map
      - []
      statistics:
      - map
      - - - collisions
          - 0
        - - rx_bytes
          - 0
        - - rx_crc_err
          - 0
        - - rx_dropped
          - 0
        - - rx_errors
          - 0
        - - rx_frame_err
          - 0
        - - rx_over_err
          - 0
        - - rx_packets
          - 0
        - - tx_bytes
          - 0
        - - tx_dropped
          - 0
        - - tx_errors
          - 0
        - - tx_packets
          - 0
      status:
      - map
      - []
      type: patch
[DEBUG] 2014-05-21 08:36:40,570 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-ofctl add-flow br-tun table=0,priority=1,in_port=1,actions=resubmit(,1)
[DEBUG] 2014-05-21 08:36:40,590 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-ofctl add-flow br-tun table=0,priority=0,actions=drop
[DEBUG] 2014-05-21 08:36:40,612 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-ofctl add-flow br-tun table=1,priority=0,dl_dst=01:00:00:00:00:00/01:00:00:00:00:00,actions=resubmit(,19)
[DEBUG] 2014-05-21 08:36:40,628 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-ofctl add-flow br-tun table=1,priority=0,dl_dst=00:00:00:00:00:00/01:00:00:00:00:00,actions=resubmit(,20)
[DEBUG] 2014-05-21 08:36:40,652 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-ofctl add-flow br-tun table=2,priority=0,actions=drop
[DEBUG] 2014-05-21 08:36:40,675 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-ofctl add-flow br-tun table=3,priority=0,actions=drop
[DEBUG] 2014-05-21 08:36:40,694 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-ofctl add-flow br-tun table=10,priority=1,actions=learn(table=20,hard_timeout=300,priority=1,NXM_OF_VLAN_TCI[0..11],NXM_OF_ETH_DST[]=NXM_OF_ETH_SRC[],load:0->NXM_OF_VLAN_TCI[],load:NXM_NX_TUN_ID[]->NXM_NX_TUN_ID[],output:NXM_OF_IN_PORT[]),output:1
[DEBUG] 2014-05-21 08:36:40,723 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-ofctl add-flow br-tun table=19,priority=0,actions=resubmit(,21)
[DEBUG] 2014-05-21 08:36:40,737 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-ofctl add-flow br-tun table=20,priority=0,actions=resubmit(,21)
[DEBUG] 2014-05-21 08:36:40,753 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-ofctl add-flow br-tun table=21,priority=0,actions=drop
[DEBUG] 2014-05-21 08:36:40,767 module:ovsdb,function:crud,router:openwrt1
CRUD operation (add): {'ovs_bridges': 'enabled'}
[DEBUG] 2014-05-21 08:36:40,774 module:ovsdb,function:_send,router:openwrt1
request:
  id: 321786
  method: transact
  params:
  - Open_vSwitch
  - op: insert
    row:
      ovs_bridges: enabled
    table: NLAN_Bridges
    uuid-name: temp_998890
  - mutations:
    - - bridges
      - insert
      - - set
        - - - named-uuid
            - temp_998890
    op: mutate
    table: NLAN
    where: []
response:
  error: null
  id: 321786
  result:
  - uuid:
    - uuid
    - ee95d85f-28a5-47e6-933b-380a277a009d
  - count: 1
[DEBUG] 2014-05-21 08:36:40,781 module:ovsdb,function:_send,router:openwrt1
request:
  id: 770417
  method: transact
  params:
  - Open_vSwitch
  - op: select
    table: NLAN_Bridges
    where: []
response:
  error: null
  id: 770417
  result:
  - rows:
    - _uuid:
      - uuid
      - ee95d85f-28a5-47e6-933b-380a277a009d
      _version:
      - uuid
      - 2cc2f37c-59cf-4e07-bcfa-03613715dfab
      controller:
      - set
      - []
      ovs_bridges: enabled
[INFO] 2014-05-21 08:36:40,802 module:nlan_agent,function:_route,router:openwrt1
function:gateway.add, model:{'network': 'eth2', 'rip': 'enabled'}
[DEBUG] 2014-05-21 08:36:40,807 module:ovsdb,function:_send,router:openwrt1
request:
  id: 547878
  method: transact
  params:
  - Open_vSwitch
  - op: select
    table: NLAN
    where: []
response:
  error: null
  id: 547878
  result:
  - rows:
    - _uuid:
      - uuid
      - f3b41d1d-1a84-4c43-835b-8717bae74843
      _version:
      - uuid
      - dd2b0802-4baf-40d9-9d50-e54ce01e4db9
      bridges:
      - uuid
      - ee95d85f-28a5-47e6-933b-380a277a009d
      gateway:
      - set
      - []
      services:
      - set
      - []
      subnets:
      - set
      - []
      vxlan:
      - set
      - []
[DEBUG] 2014-05-21 08:36:40,820 module:ovsdb,function:_send,router:openwrt1
request:
  id: 765001
  method: transact
  params:
  - Open_vSwitch
  - op: select
    table: NLAN_Gateway
    where: []
response:
  error: null
  id: 765001
  result:
  - rows: []
[INFO] 2014-05-21 08:36:40,828 module:gateway,function:add,router:openwrt1
Adding a gateway router: rip
[DEBUG] 2014-05-21 08:36:40,832 module:cmdutil,function:_cmd2,router:openwrt1
cmd: vtysh -c configure terminal -c interface eth2 -c link-detect -c exit -c router rip -c version 2 -c redistribute connected -c network eth2 -c exit -c exit -c write -c exit
[DEBUG] 2014-05-21 08:36:40,919 module:cmdutil,function:_cmd2,router:openwrt1
cmd: /etc/init.d/quagga start
[DEBUG] 2014-05-21 08:36:40,996 module:cmdutil,function:_cmd2,router:openwrt1
cmd: vtysh -c configure terminal -c interface eth2 -c link-detect -c exit -c router rip -c version 2 -c redistribute connected -c network eth2 -c exit -c exit -c write -c exit
[DEBUG] 2014-05-21 08:36:41,096 module:cmdutil,function:_cmd2,router:openwrt1
cmd: /etc/init.d/quagga restart
[DEBUG] 2014-05-21 08:36:43,253 module:ovsdb,function:crud,router:openwrt1
CRUD operation (add): {'network': 'eth2', 'rip': 'enabled'}
[DEBUG] 2014-05-21 08:36:43,257 module:ovsdb,function:_send,router:openwrt1
request:
  id: 143602
  method: transact
  params:
  - Open_vSwitch
  - op: insert
    row:
      network: eth2
      rip: enabled
    table: NLAN_Gateway
    uuid-name: temp_550053
  - mutations:
    - - gateway
      - insert
      - - set
        - - - named-uuid
            - temp_550053
    op: mutate
    table: NLAN
    where: []
response:
  error: null
  id: 143602
  result:
  - uuid:
    - uuid
    - df9bb1f6-d886-4929-a289-9b229e03d669
  - count: 1
[DEBUG] 2014-05-21 08:36:43,263 module:ovsdb,function:_send,router:openwrt1
request:
  id: 437128
  method: transact
  params:
  - Open_vSwitch
  - op: select
    table: NLAN_Gateway
    where: []
response:
  error: null
  id: 437128
  result:
  - rows:
    - _uuid:
      - uuid
      - df9bb1f6-d886-4929-a289-9b229e03d669
      _version:
      - uuid
      - 2fd9b890-dce8-44e1-9523-96d80f974a16
      network: eth2
      rip: enabled
[INFO] 2014-05-21 08:36:43,270 module:nlan_agent,function:_route,router:openwrt1
function:vxlan.add, model:{'remote_ips': ['192.168.1.103', '192.168.1.102', '192.168.1.104'], 'local_ip': '192.168.1.101'}
[DEBUG] 2014-05-21 08:36:43,273 module:ovsdb,function:_send,router:openwrt1
request:
  id: 92100
  method: transact
  params:
  - Open_vSwitch
  - op: select
    table: NLAN
    where: []
response:
  error: null
  id: 92100
  result:
  - rows:
    - _uuid:
      - uuid
      - f3b41d1d-1a84-4c43-835b-8717bae74843
      _version:
      - uuid
      - c2af98b8-d317-4b45-8ff9-03989f2c7f33
      bridges:
      - uuid
      - ee95d85f-28a5-47e6-933b-380a277a009d
      gateway:
      - uuid
      - df9bb1f6-d886-4929-a289-9b229e03d669
      services:
      - set
      - []
      subnets:
      - set
      - []
      vxlan:
      - set
      - []
[DEBUG] 2014-05-21 08:36:43,281 module:ovsdb,function:_send,router:openwrt1
request:
  id: 781948
  method: transact
  params:
  - Open_vSwitch
  - op: select
    table: NLAN_VXLAN
    where: []
response:
  error: null
  id: 781948
  result:
  - rows: []
[INFO] 2014-05-21 08:36:43,287 module:vxlan,function:add,router:openwrt1
Adding a VXLAN tunnel: vxlan_192.168.1.103
[DEBUG] 2014-05-21 08:36:43,290 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-vsctl add-port br-tun vxlan_192.168.1.103 -- set interface vxlan_192.168.1.103 type=vxlan options:in_key=flow options:local_ip=192.168.1.101 options:out_key=flow options:remote_ip=192.168.1.103
[INFO] 2014-05-21 08:36:43,317 module:vxlan,function:add,router:openwrt1
Adding a VXLAN tunnel: vxlan_192.168.1.102
[DEBUG] 2014-05-21 08:36:43,322 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-vsctl add-port br-tun vxlan_192.168.1.102 -- set interface vxlan_192.168.1.102 type=vxlan options:in_key=flow options:local_ip=192.168.1.101 options:out_key=flow options:remote_ip=192.168.1.102
[INFO] 2014-05-21 08:36:43,353 module:vxlan,function:add,router:openwrt1
Adding a VXLAN tunnel: vxlan_192.168.1.104
[DEBUG] 2014-05-21 08:36:43,353 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-vsctl add-port br-tun vxlan_192.168.1.104 -- set interface vxlan_192.168.1.104 type=vxlan options:in_key=flow options:local_ip=192.168.1.101 options:out_key=flow options:remote_ip=192.168.1.104
[DEBUG] 2014-05-21 08:36:43,391 module:ovsdb,function:_send,router:openwrt1
request:
  id: 800544
  method: transact
  params:
  - Open_vSwitch
  - columns:
    - ofport
    - options
    op: select
    table: Interface
    where:
    - - type
      - ==
      - vxlan
response:
  error: null
  id: 800544
  result:
  - rows:
    - ofport: 3
      options:
      - map
      - - - in_key
          - flow
        - - local_ip
          - 192.168.1.101
        - - out_key
          - flow
        - - remote_ip
          - 192.168.1.102
    - ofport: 2
      options:
      - map
      - - - in_key
          - flow
        - - local_ip
          - 192.168.1.101
        - - out_key
          - flow
        - - remote_ip
          - 192.168.1.103
    - ofport: 4
      options:
      - map
      - - - in_key
          - flow
        - - local_ip
          - 192.168.1.101
        - - out_key
          - flow
        - - remote_ip
          - 192.168.1.104
[DEBUG] 2014-05-21 08:36:43,401 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-ofctl add-flow br-tun table=0,priority=1,in_port=3,actions=resubmit(,2)
[DEBUG] 2014-05-21 08:36:43,413 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-ofctl add-flow br-tun table=0,priority=1,in_port=2,actions=resubmit(,2)
[DEBUG] 2014-05-21 08:36:43,423 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-ofctl add-flow br-tun table=0,priority=1,in_port=4,actions=resubmit(,2)
[DEBUG] 2014-05-21 08:36:43,442 module:ovsdb,function:crud,router:openwrt1
CRUD operation (add): {'remote_ips': ['192.168.1.103', '192.168.1.102', '192.168.1.104'], 'local_ip': '192.168.1.101'}
[DEBUG] 2014-05-21 08:36:43,451 module:ovsdb,function:_send,router:openwrt1
request:
  id: 564760
  method: transact
  params:
  - Open_vSwitch
  - op: insert
    row:
      local_ip: 192.168.1.101
      remote_ips:
      - set
      - - 192.168.1.103
        - 192.168.1.102
        - 192.168.1.104
    table: NLAN_VXLAN
    uuid-name: temp_549473
  - mutations:
    - - vxlan
      - insert
      - - set
        - - - named-uuid
            - temp_549473
    op: mutate
    table: NLAN
    where: []
response:
  error: null
  id: 564760
  result:
  - uuid:
    - uuid
    - 3a487b8c-01cd-4ad0-b322-97593d41a4ea
  - count: 1
[DEBUG] 2014-05-21 08:36:43,455 module:ovsdb,function:_send,router:openwrt1
request:
  id: 256743
  method: transact
  params:
  - Open_vSwitch
  - op: select
    table: NLAN_VXLAN
    where: []
response:
  error: null
  id: 256743
  result:
  - rows:
    - _uuid:
      - uuid
      - 3a487b8c-01cd-4ad0-b322-97593d41a4ea
      _version:
      - uuid
      - 3e8eb388-d11d-42a5-a0d9-fb843c4536a0
      local_ip: 192.168.1.101
      remote_ips:
      - set
      - - 192.168.1.102
        - 192.168.1.103
        - 192.168.1.104
[INFO] 2014-05-21 08:36:43,480 module:nlan_agent,function:_route,router:openwrt1
function:subnets.add, index:['vni', 1], model:{'peers': ['192.168.1.102', '192.168.1.103'], 'vid': 2, 'ip_vhost': '192.168.100.101/24', 'vni': 1, 'ip_dvr': OrderedDict([('addr', '192.168.100.1/24'), ('mode', 'dvr')])}
[DEBUG] 2014-05-21 08:36:43,484 module:ovsdb,function:_send,router:openwrt1
request:
  id: 791996
  method: transact
  params:
  - Open_vSwitch
  - op: select
    table: NLAN
    where: []
response:
  error: null
  id: 791996
  result:
  - rows:
    - _uuid:
      - uuid
      - f3b41d1d-1a84-4c43-835b-8717bae74843
      _version:
      - uuid
      - 2d959013-c043-498d-a9d3-f2de5f81a6ef
      bridges:
      - uuid
      - ee95d85f-28a5-47e6-933b-380a277a009d
      gateway:
      - uuid
      - df9bb1f6-d886-4929-a289-9b229e03d669
      services:
      - set
      - []
      subnets:
      - set
      - []
      vxlan:
      - uuid
      - 3a487b8c-01cd-4ad0-b322-97593d41a4ea
[DEBUG] 2014-05-21 08:36:43,493 module:ovsdb,function:_send,router:openwrt1
request:
  id: 541853
  method: transact
  params:
  - Open_vSwitch
  - op: select
    table: NLAN_Subnet
    where:
    - - vni
      - ==
      - 1
response:
  error: null
  id: 541853
  result:
  - rows: []
[INFO] 2014-05-21 08:36:43,499 module:subnets,function:add,router:openwrt1
Adding a subnet(vlan): 2
[DEBUG] 2014-05-21 08:36:43,502 module:cmdutil,function:_cmd2,router:openwrt1
cmd: brctl addbr br1
[DEBUG] 2014-05-21 08:36:43,516 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-vsctl add-port br-int int_br1 tag=2 -- set interface int_br1 type=internal
[DEBUG] 2014-05-21 08:36:43,561 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-vsctl add-port br-int int_dvr1 tag=2 -- set interface int_dvr1 type=internal
[DEBUG] 2014-05-21 08:36:43,606 module:cmdutil,function:_cmd2,router:openwrt1
cmd: brctl addif br1 int_br1
[DEBUG] 2014-05-21 08:36:43,616 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip link set dev int_br1 promisc on
[DEBUG] 2014-05-21 08:36:43,621 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip link set dev int_br1 up
[DEBUG] 2014-05-21 08:36:43,629 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip link set dev int_dvr1 up
[DEBUG] 2014-05-21 08:36:43,633 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip link set dev br1 up
[DEBUG] 2014-05-21 08:36:43,645 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip netns add ns1
[DEBUG] 2014-05-21 08:36:43,653 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip link add veth-ns1 type veth peer name temp-ns1
[DEBUG] 2014-05-21 08:36:43,669 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip link set dev temp-ns1 netns ns1
[DEBUG] 2014-05-21 08:36:43,677 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip netns exec ns1 ip link set dev temp-ns1 name eth0
[DEBUG] 2014-05-21 08:36:43,687 module:cmdutil,function:_cmd2,router:openwrt1
cmd: brctl addif br1 veth-ns1
[DEBUG] 2014-05-21 08:36:43,700 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip link set dev veth-ns1 promisc on
[DEBUG] 2014-05-21 08:36:43,706 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip link set dev veth-ns1 up
[DEBUG] 2014-05-21 08:36:43,727 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip netns exec ns1 ip link set dev eth0 up
[DEBUG] 2014-05-21 08:36:43,741 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip netns exec ns1 ip addr add dev eth0 192.168.100.101/24
[DEBUG] 2014-05-21 08:36:43,750 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip netns exec ns1 ip route add default via 192.168.100.1 dev eth0
[DEBUG] 2014-05-21 08:36:43,760 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip addr add dev int_dvr1 192.168.100.1/24
[DEBUG] 2014-05-21 08:36:43,767 module:ovsdb,function:_send,router:openwrt1
request:
  id: 620666
  method: transact
  params:
  - Open_vSwitch
  - columns:
    - target
    op: select
    table: Controller
    where: []
response:
  error: null
  id: 620666
  result:
  - rows: []
[DEBUG] 2014-05-21 08:36:43,769 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-ofctl add-flow br-tun table=2,priority=1,tun_id=1,actions=mod_vlan_vid:2,resubmit(,10)
[DEBUG] 2014-05-21 08:36:43,779 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-ofctl add-flow br-tun table=19,priority=1,dl_type=0x0806,dl_vlan=2,nw_dst=192.168.100.1,actions=drop
[DEBUG] 2014-05-21 08:36:43,790 module:ovsdb,function:_send,router:openwrt1
request:
  id: 852166
  method: transact
  params:
  - Open_vSwitch
  - columns:
    - ofport
    - options
    op: select
    table: Interface
    where:
    - - type
      - ==
      - vxlan
response:
  error: null
  id: 852166
  result:
  - rows:
    - ofport: 3
      options:
      - map
      - - - in_key
          - flow
        - - local_ip
          - 192.168.1.101
        - - out_key
          - flow
        - - remote_ip
          - 192.168.1.102
    - ofport: 2
      options:
      - map
      - - - in_key
          - flow
        - - local_ip
          - 192.168.1.101
        - - out_key
          - flow
        - - remote_ip
          - 192.168.1.103
    - ofport: 4
      options:
      - map
      - - - in_key
          - flow
        - - local_ip
          - 192.168.1.101
        - - out_key
          - flow
        - - remote_ip
          - 192.168.1.104
[DEBUG] 2014-05-21 08:36:43,796 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-ofctl add-flow br-tun table=21,priority=1,dl_vlan=2,actions=strip_vlan,set_tunnel:1,output:3,output:2
[DEBUG] 2014-05-21 08:36:43,804 module:ovsdb,function:crud,router:openwrt1
CRUD operation (add): {'peers': ['192.168.1.102', '192.168.1.103'], 'vid': 2, 'ip_vhost': '192.168.100.101/24', 'vni': 1, 'ip_dvr': OrderedDict([('addr', '192.168.100.1/24'), ('mode', 'dvr')])}
[DEBUG] 2014-05-21 08:36:43,808 module:ovsdb,function:_send,router:openwrt1
request:
  id: 918139
  method: transact
  params:
  - Open_vSwitch
  - op: insert
    row:
      ip_dvr:
      - map
      - - - addr
          - 192.168.100.1/24
        - - mode
          - dvr
      ip_vhost: 192.168.100.101/24
      peers:
      - set
      - - 192.168.1.102
        - 192.168.1.103
      vid: 2
      vni: 1
    table: NLAN_Subnet
    uuid-name: temp_187179
  - mutations:
    - - subnets
      - insert
      - - set
        - - - named-uuid
            - temp_187179
    op: mutate
    table: NLAN
    where: []
response:
  error: null
  id: 918139
  result:
  - uuid:
    - uuid
    - df4bde70-ac6f-4e09-8513-bc49b2b30992
  - count: 1
[DEBUG] 2014-05-21 08:36:43,811 module:ovsdb,function:_send,router:openwrt1
request:
  id: 517220
  method: transact
  params:
  - Open_vSwitch
  - op: select
    table: NLAN_Subnet
    where:
    - - vni
      - ==
      - 1
response:
  error: null
  id: 517220
  result:
  - rows:
    - _uuid:
      - uuid
      - df4bde70-ac6f-4e09-8513-bc49b2b30992
      _version:
      - uuid
      - 447e046e-4fe5-47e5-93bd-c29709509ea5
      default_gw:
      - set
      - []
      ip_dvr:
      - map
      - - - addr
          - 192.168.100.1/24
        - - mode
          - dvr
      ip_vhost: 192.168.100.101/24
      peers:
      - set
      - - 192.168.1.102
        - 192.168.1.103
      ports:
      - set
      - []
      vid: 2
      vni: 1
[INFO] 2014-05-21 08:36:43,816 module:nlan_agent,function:_route,router:openwrt1
function:subnets.add, index:['vni', 103], model:{'peers': ['192.168.1.102', '192.168.1.103'], 'vid': 3, 'ip_vhost': '10.0.3.101/24', 'vni': 103, 'ip_dvr': OrderedDict([('addr', '10.0.3.1/24'), ('mode', 'dvr'), ('dhcp', 'enabled')])}
[DEBUG] 2014-05-21 08:36:43,818 module:ovsdb,function:_send,router:openwrt1
request:
  id: 388871
  method: transact
  params:
  - Open_vSwitch
  - op: select
    table: NLAN
    where: []
response:
  error: null
  id: 388871
  result:
  - rows:
    - _uuid:
      - uuid
      - f3b41d1d-1a84-4c43-835b-8717bae74843
      _version:
      - uuid
      - cbe15139-010e-4697-9df4-b91baa589408
      bridges:
      - uuid
      - ee95d85f-28a5-47e6-933b-380a277a009d
      gateway:
      - uuid
      - df9bb1f6-d886-4929-a289-9b229e03d669
      services:
      - set
      - []
      subnets:
      - uuid
      - df4bde70-ac6f-4e09-8513-bc49b2b30992
      vxlan:
      - uuid
      - 3a487b8c-01cd-4ad0-b322-97593d41a4ea
[DEBUG] 2014-05-21 08:36:43,824 module:ovsdb,function:_send,router:openwrt1
request:
  id: 959443
  method: transact
  params:
  - Open_vSwitch
  - op: select
    table: NLAN_Subnet
    where:
    - - vni
      - ==
      - 103
response:
  error: null
  id: 959443
  result:
  - rows: []
[INFO] 2014-05-21 08:36:43,827 module:subnets,function:add,router:openwrt1
Adding a subnet(vlan): 3
[DEBUG] 2014-05-21 08:36:43,828 module:cmdutil,function:_cmd2,router:openwrt1
cmd: brctl addbr br103
[DEBUG] 2014-05-21 08:36:43,840 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-vsctl add-port br-int int_br103 tag=3 -- set interface int_br103 type=internal
[DEBUG] 2014-05-21 08:36:43,878 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-vsctl add-port br-int int_dvr103 tag=3 -- set interface int_dvr103 type=internal
[DEBUG] 2014-05-21 08:36:43,921 module:cmdutil,function:_cmd2,router:openwrt1
cmd: brctl addif br103 int_br103
[DEBUG] 2014-05-21 08:36:43,929 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip link set dev int_br103 promisc on
[DEBUG] 2014-05-21 08:36:43,935 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip link set dev int_br103 up
[DEBUG] 2014-05-21 08:36:43,943 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip link set dev int_dvr103 up
[DEBUG] 2014-05-21 08:36:43,950 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip link set dev br103 up
[DEBUG] 2014-05-21 08:36:43,962 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip netns add ns103
[DEBUG] 2014-05-21 08:36:43,972 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip link add veth-ns103 type veth peer name temp-ns103
[DEBUG] 2014-05-21 08:36:44,001 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip link set dev temp-ns103 netns ns103
[DEBUG] 2014-05-21 08:36:44,008 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip netns exec ns103 ip link set dev temp-ns103 name eth0
[DEBUG] 2014-05-21 08:36:44,017 module:cmdutil,function:_cmd2,router:openwrt1
cmd: brctl addif br103 veth-ns103
[DEBUG] 2014-05-21 08:36:44,032 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip link set dev veth-ns103 promisc on
[DEBUG] 2014-05-21 08:36:44,038 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip link set dev veth-ns103 up
[DEBUG] 2014-05-21 08:36:44,056 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip netns exec ns103 ip link set dev eth0 up
[DEBUG] 2014-05-21 08:36:44,072 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip netns exec ns103 ip addr add dev eth0 10.0.3.101/24
[DEBUG] 2014-05-21 08:36:44,082 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip netns exec ns103 ip route add default via 10.0.3.1 dev eth0
[DEBUG] 2014-05-21 08:36:44,091 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip addr add dev int_dvr103 10.0.3.1/24
[DEBUG] 2014-05-21 08:36:44,096 module:cmdutil,function:_cmd2,router:openwrt1
cmd: uci set network.int_dvr103=interface
[DEBUG] 2014-05-21 08:36:44,103 module:cmdutil,function:_cmd2,router:openwrt1
cmd: uci set network.int_dvr103.ifname=int_dvr103
[DEBUG] 2014-05-21 08:36:44,108 module:cmdutil,function:_cmd2,router:openwrt1
cmd: uci set network.int_dvr103.proto=static
[DEBUG] 2014-05-21 08:36:44,113 module:cmdutil,function:_cmd2,router:openwrt1
cmd: uci set network.int_dvr103.ipaddr=10.0.3.1
[DEBUG] 2014-05-21 08:36:44,117 module:cmdutil,function:_cmd2,router:openwrt1
cmd: uci set network.int_dvr103.netmask=255.255.255.0
[DEBUG] 2014-05-21 08:36:44,124 module:cmdutil,function:_cmd2,router:openwrt1
cmd: uci set dhcp.int_dvr103=dhcp
[DEBUG] 2014-05-21 08:36:44,130 module:cmdutil,function:_cmd2,router:openwrt1
cmd: uci set dhcp.int_dvr103.interface=int_dvr103
[DEBUG] 2014-05-21 08:36:44,136 module:cmdutil,function:_cmd2,router:openwrt1
cmd: uci set dhcp.int_dvr103.start=100
[DEBUG] 2014-05-21 08:36:44,142 module:cmdutil,function:_cmd2,router:openwrt1
cmd: uci set dhcp.int_dvr103.limit=150
[DEBUG] 2014-05-21 08:36:44,147 module:cmdutil,function:_cmd2,router:openwrt1
cmd: uci set dhcp.int_dvr103.leasetime=12h
[DEBUG] 2014-05-21 08:36:44,154 module:cmdutil,function:_cmd2,router:openwrt1
cmd: uci commit
[DEBUG] 2014-05-21 08:36:44,182 module:cmdutil,function:_cmd2,router:openwrt1
cmd: /etc/init.d/network restart
[DEBUG] 2014-05-21 08:36:45,280 module:cmdutil,function:_cmd2,router:openwrt1
cmd: /etc/init.d/dnsmasq restart
[DEBUG] 2014-05-21 08:36:45,505 module:ovsdb,function:_send,router:openwrt1
request:
  id: 91627
  method: transact
  params:
  - Open_vSwitch
  - columns:
    - target
    op: select
    table: Controller
    where: []
response:
  error: null
  id: 91627
  result:
  - rows: []
[DEBUG] 2014-05-21 08:36:45,507 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-ofctl add-flow br-tun table=2,priority=1,tun_id=103,actions=mod_vlan_vid:3,resubmit(,10)
[DEBUG] 2014-05-21 08:36:45,563 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-ofctl add-flow br-tun table=19,priority=1,dl_type=0x0806,dl_vlan=3,nw_dst=10.0.3.1,actions=drop
[DEBUG] 2014-05-21 08:36:45,603 module:ovsdb,function:_send,router:openwrt1
request:
  id: 466779
  method: transact
  params:
  - Open_vSwitch
  - columns:
    - ofport
    - options
    op: select
    table: Interface
    where:
    - - type
      - ==
      - vxlan
response:
  error: null
  id: 466779
  result:
  - rows:
    - ofport: 3
      options:
      - map
      - - - in_key
          - flow
        - - local_ip
          - 192.168.1.101
        - - out_key
          - flow
        - - remote_ip
          - 192.168.1.102
    - ofport: 2
      options:
      - map
      - - - in_key
          - flow
        - - local_ip
          - 192.168.1.101
        - - out_key
          - flow
        - - remote_ip
          - 192.168.1.103
    - ofport: 4
      options:
      - map
      - - - in_key
          - flow
        - - local_ip
          - 192.168.1.101
        - - out_key
          - flow
        - - remote_ip
          - 192.168.1.104
[DEBUG] 2014-05-21 08:36:45,622 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-ofctl add-flow br-tun table=21,priority=1,dl_vlan=3,actions=strip_vlan,set_tunnel:103,output:3,output:2
[DEBUG] 2014-05-21 08:36:45,650 module:ovsdb,function:crud,router:openwrt1
CRUD operation (add): {'peers': ['192.168.1.102', '192.168.1.103'], 'vid': 3, 'ip_vhost': '10.0.3.101/24', 'vni': 103, 'ip_dvr': OrderedDict([('addr', '10.0.3.1/24'), ('mode', 'dvr'), ('dhcp', 'enabled')])}
[DEBUG] 2014-05-21 08:36:45,654 module:ovsdb,function:_send,router:openwrt1
request:
  id: 138677
  method: transact
  params:
  - Open_vSwitch
  - op: insert
    row:
      ip_dvr:
      - map
      - - - addr
          - 10.0.3.1/24
        - - mode
          - dvr
        - - dhcp
          - enabled
      ip_vhost: 10.0.3.101/24
      peers:
      - set
      - - 192.168.1.102
        - 192.168.1.103
      vid: 3
      vni: 103
    table: NLAN_Subnet
    uuid-name: temp_272532
  - mutations:
    - - subnets
      - insert
      - - set
        - - - named-uuid
            - temp_272532
    op: mutate
    table: NLAN
    where: []
response:
  error: null
  id: 138677
  result:
  - uuid:
    - uuid
    - 4d574856-58b1-4263-8c6f-ac9f0f94b5f8
  - count: 1
[DEBUG] 2014-05-21 08:36:45,662 module:ovsdb,function:_send,router:openwrt1
request:
  id: 737040
  method: transact
  params:
  - Open_vSwitch
  - op: select
    table: NLAN_Subnet
    where:
    - - vni
      - ==
      - 103
response:
  error: null
  id: 737040
  result:
  - rows:
    - _uuid:
      - uuid
      - 4d574856-58b1-4263-8c6f-ac9f0f94b5f8
      _version:
      - uuid
      - d15d58f1-9a37-4ae5-a295-d84608cf146c
      default_gw:
      - set
      - []
      ip_dvr:
      - map
      - - - addr
          - 10.0.3.1/24
        - - dhcp
          - enabled
        - - mode
          - dvr
      ip_vhost: 10.0.3.101/24
      peers:
      - set
      - - 192.168.1.102
        - 192.168.1.103
      ports:
      - set
      - []
      vid: 3
      vni: 103
[INFO] 2014-05-21 08:36:45,679 module:nlan_agent,function:_route,router:openwrt1
function:subnets.add, index:['vni', 1001], model:{'peers': ['192.168.1.104'], 'vid': 1, 'ip_vhost': '10.0.1.101/24', 'vni': 1001, 'ip_dvr': OrderedDict([('addr', '10.0.1.1/24'), ('mode', 'hub'), ('dhcp', 'enabled')])}
[DEBUG] 2014-05-21 08:36:45,683 module:ovsdb,function:_send,router:openwrt1
request:
  id: 697182
  method: transact
  params:
  - Open_vSwitch
  - op: select
    table: NLAN
    where: []
response:
  error: null
  id: 697182
  result:
  - rows:
    - _uuid:
      - uuid
      - f3b41d1d-1a84-4c43-835b-8717bae74843
      _version:
      - uuid
      - f7c953f6-9278-4091-9ca3-99660870504d
      bridges:
      - uuid
      - ee95d85f-28a5-47e6-933b-380a277a009d
      gateway:
      - uuid
      - df9bb1f6-d886-4929-a289-9b229e03d669
      services:
      - set
      - []
      subnets:
      - set
      - - - uuid
          - 4d574856-58b1-4263-8c6f-ac9f0f94b5f8
        - - uuid
          - df4bde70-ac6f-4e09-8513-bc49b2b30992
      vxlan:
      - uuid
      - 3a487b8c-01cd-4ad0-b322-97593d41a4ea
[DEBUG] 2014-05-21 08:36:45,706 module:ovsdb,function:_send,router:openwrt1
request:
  id: 204457
  method: transact
  params:
  - Open_vSwitch
  - op: select
    table: NLAN_Subnet
    where:
    - - vni
      - ==
      - 1001
response:
  error: null
  id: 204457
  result:
  - rows: []
[INFO] 2014-05-21 08:36:45,709 module:subnets,function:add,router:openwrt1
Adding a subnet(vlan): 1
[DEBUG] 2014-05-21 08:36:45,714 module:cmdutil,function:_cmd2,router:openwrt1
cmd: brctl addbr br1001
[DEBUG] 2014-05-21 08:36:45,743 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-vsctl add-port br-int int_br1001 tag=1 -- set interface int_br1001 type=internal
[DEBUG] 2014-05-21 08:36:45,813 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-vsctl add-port br-int int_dvr1001 tag=1 -- set interface int_dvr1001 type=internal
[DEBUG] 2014-05-21 08:36:45,911 module:cmdutil,function:_cmd2,router:openwrt1
cmd: brctl addif br1001 int_br1001
[DEBUG] 2014-05-21 08:36:45,927 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip link set dev int_br1001 promisc on
[DEBUG] 2014-05-21 08:36:45,945 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip link set dev int_br1001 up
[DEBUG] 2014-05-21 08:36:45,955 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip link set dev int_dvr1001 up
[DEBUG] 2014-05-21 08:36:45,964 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip link set dev br1001 up
[DEBUG] 2014-05-21 08:36:45,989 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip netns add ns1001
[DEBUG] 2014-05-21 08:36:46,025 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip link add veth-ns1001 type veth peer name temp-ns1001
[DEBUG] 2014-05-21 08:36:46,055 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip link set dev temp-ns1001 netns ns1001
[DEBUG] 2014-05-21 08:36:46,071 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip netns exec ns1001 ip link set dev temp-ns1001 name eth0
[DEBUG] 2014-05-21 08:36:46,082 module:cmdutil,function:_cmd2,router:openwrt1
cmd: brctl addif br1001 veth-ns1001
[DEBUG] 2014-05-21 08:36:46,102 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip link set dev veth-ns1001 promisc on
[DEBUG] 2014-05-21 08:36:46,111 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip link set dev veth-ns1001 up
[DEBUG] 2014-05-21 08:36:46,144 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip netns exec ns1001 ip link set dev eth0 up
[DEBUG] 2014-05-21 08:36:46,169 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip netns exec ns1001 ip addr add dev eth0 10.0.1.101/24
[DEBUG] 2014-05-21 08:36:46,190 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip netns exec ns1001 ip route add default via 10.0.1.1 dev eth0
[DEBUG] 2014-05-21 08:36:46,197 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ip addr add dev int_dvr1001 10.0.1.1/24
[DEBUG] 2014-05-21 08:36:46,215 module:cmdutil,function:_cmd2,router:openwrt1
cmd: uci set network.int_dvr1001=interface
[DEBUG] 2014-05-21 08:36:46,221 module:cmdutil,function:_cmd2,router:openwrt1
cmd: uci set network.int_dvr1001.ifname=int_dvr1001
[DEBUG] 2014-05-21 08:36:46,227 module:cmdutil,function:_cmd2,router:openwrt1
cmd: uci set network.int_dvr1001.proto=static
[DEBUG] 2014-05-21 08:36:46,231 module:cmdutil,function:_cmd2,router:openwrt1
cmd: uci set network.int_dvr1001.ipaddr=10.0.1.1
[DEBUG] 2014-05-21 08:36:46,236 module:cmdutil,function:_cmd2,router:openwrt1
cmd: uci set network.int_dvr1001.netmask=255.255.255.0
[DEBUG] 2014-05-21 08:36:46,241 module:cmdutil,function:_cmd2,router:openwrt1
cmd: uci set dhcp.int_dvr1001=dhcp
[DEBUG] 2014-05-21 08:36:46,246 module:cmdutil,function:_cmd2,router:openwrt1
cmd: uci set dhcp.int_dvr1001.interface=int_dvr1001
[DEBUG] 2014-05-21 08:36:46,252 module:cmdutil,function:_cmd2,router:openwrt1
cmd: uci set dhcp.int_dvr1001.start=100
[DEBUG] 2014-05-21 08:36:46,257 module:cmdutil,function:_cmd2,router:openwrt1
cmd: uci set dhcp.int_dvr1001.limit=150
[DEBUG] 2014-05-21 08:36:46,262 module:cmdutil,function:_cmd2,router:openwrt1
cmd: uci set dhcp.int_dvr1001.leasetime=12h
[DEBUG] 2014-05-21 08:36:46,267 module:cmdutil,function:_cmd2,router:openwrt1
cmd: uci commit
[DEBUG] 2014-05-21 08:36:46,290 module:cmdutil,function:_cmd2,router:openwrt1
cmd: /etc/init.d/network restart
[DEBUG] 2014-05-21 08:36:47,400 module:cmdutil,function:_cmd2,router:openwrt1
cmd: /etc/init.d/dnsmasq restart
[DEBUG] 2014-05-21 08:36:47,616 module:ovsdb,function:_send,router:openwrt1
request:
  id: 644105
  method: transact
  params:
  - Open_vSwitch
  - columns:
    - target
    op: select
    table: Controller
    where: []
response:
  error: null
  id: 644105
  result:
  - rows: []
[DEBUG] 2014-05-21 08:36:47,618 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-ofctl add-flow br-tun table=2,priority=1,tun_id=1001,actions=mod_vlan_vid:1,resubmit(,10)
[DEBUG] 2014-05-21 08:36:47,663 module:ovsdb,function:_send,router:openwrt1
request:
  id: 469452
  method: transact
  params:
  - Open_vSwitch
  - columns:
    - ofport
    - options
    op: select
    table: Interface
    where:
    - - type
      - ==
      - vxlan
response:
  error: null
  id: 469452
  result:
  - rows:
    - ofport: 3
      options:
      - map
      - - - in_key
          - flow
        - - local_ip
          - 192.168.1.101
        - - out_key
          - flow
        - - remote_ip
          - 192.168.1.102
    - ofport: 2
      options:
      - map
      - - - in_key
          - flow
        - - local_ip
          - 192.168.1.101
        - - out_key
          - flow
        - - remote_ip
          - 192.168.1.103
    - ofport: 4
      options:
      - map
      - - - in_key
          - flow
        - - local_ip
          - 192.168.1.101
        - - out_key
          - flow
        - - remote_ip
          - 192.168.1.104
[DEBUG] 2014-05-21 08:36:47,691 module:cmdutil,function:_cmd2,router:openwrt1
cmd: ovs-ofctl add-flow br-tun table=21,priority=1,dl_vlan=1,actions=strip_vlan,set_tunnel:1001,output:4
[DEBUG] 2014-05-21 08:36:47,720 module:ovsdb,function:crud,router:openwrt1
CRUD operation (add): {'peers': ['192.168.1.104'], 'vid': 1, 'ip_vhost': '10.0.1.101/24', 'vni': 1001, 'ip_dvr': OrderedDict([('addr', '10.0.1.1/24'), ('mode', 'hub'), ('dhcp', 'enabled')])}
[DEBUG] 2014-05-21 08:36:47,731 module:ovsdb,function:_send,router:openwrt1
request:
  id: 47114
  method: transact
  params:
  - Open_vSwitch
  - op: insert
    row:
      ip_dvr:
      - map
      - - - addr
          - 10.0.1.1/24
        - - mode
          - hub
        - - dhcp
          - enabled
      ip_vhost: 10.0.1.101/24
      peers:
      - set
      - - 192.168.1.104
      vid: 1
      vni: 1001
    table: NLAN_Subnet
    uuid-name: temp_183720
  - mutations:
    - - subnets
      - insert
      - - set
        - - - named-uuid
            - temp_183720
    op: mutate
    table: NLAN
    where: []
response:
  error: null
  id: 47114
  result:
  - uuid:
    - uuid
    - 6512b970-a9ba-4997-add3-49004a4a1868
  - count: 1
[DEBUG] 2014-05-21 08:36:47,736 module:ovsdb,function:_send,router:openwrt1
request:
  id: 838022
  method: transact
  params:
  - Open_vSwitch
  - op: select
    table: NLAN_Subnet
    where:
    - - vni
      - ==
      - 1001
response:
  error: null
  id: 838022
  result:
  - rows:
    - _uuid:
      - uuid
      - 6512b970-a9ba-4997-add3-49004a4a1868
      _version:
      - uuid
      - db27bbe6-ca87-4030-b1a2-adf1fc0411b9
      default_gw:
      - set
      - []
      ip_dvr:
      - map
      - - - addr
          - 10.0.1.1/24
        - - dhcp
          - enabled
        - - mode
          - hub
      ip_vhost: 10.0.1.101/24
      peers: 192.168.1.104
      ports:
      - set
      - []
      vid: 1
      vni: 1001
[INFO] 2014-05-21 08:36:47,746 module:nlan_agent,function:<module>,router:openwrt1
NLAN Agent execution completed
--- STDERR from router:openwrt1,platform:openwrt
Command failed: Not found
Command failed: Not found
--- RESPONSE from router:openwrt1,platform:openwrt
message: Execution completed
exit: 0
=+=+= Transaction Summary =+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+

Start Time: 2014-05-21 01:35:03.717221

Router           Result    Elapsed Time
---------------------------------------
openwrt2          :-)         3.11(sec)
rpi1              :-)         3.38(sec)
openwrt3          :-)         3.74(sec)
openwrt1          :-)         9.38(sec)
--- STDOUT from router:openwrt1,platform:openwrt
Hello World!
--- STDOUT from router:openwrt2,platform:openwrt
Hello World!
--- STDOUT from router:rpi1,platform:debian
Hello World!
--- STDOUT from router:openwrt3,platform:openwrt
Hello World!
--- STDOUT from router:openwrt1,platform:openwrt
PING 10.0.1.102 (10.0.1.102): 56 data bytes
64 bytes from 10.0.1.102: seq=0 ttl=64 time=14.159 ms

--- 10.0.1.102 ping statistics ---
1 packets transmitted, 1 packets received, 0% packet loss
round-trip min/avg/max = 14.159/14.159/14.159 ms
--- STDOUT from router:openwrt1,platform:openwrt
PING 10.0.1.102 (10.0.1.102): 56 data bytes
64 bytes from 10.0.1.102: seq=0 ttl=64 time=2.241 ms

--- 10.0.1.102 ping statistics ---
1 packets transmitted, 1 packets received, 0% packet loss
round-trip min/avg/max = 2.241/2.241/2.241 ms
--- STDOUT from router:openwrt1,platform:openwrt
PING 10.0.3.103 (10.0.3.103): 56 data bytes
64 bytes from 10.0.3.103: seq=0 ttl=64 time=6.245 ms

--- 10.0.3.103 ping statistics ---
1 packets transmitted, 1 packets received, 0% packet loss
round-trip min/avg/max = 6.245/6.245/6.245 ms
--- STDOUT from router:openwrt3,platform:openwrt
PING 10.0.1.101 (10.0.1.101): 56 data bytes
64 bytes from 10.0.1.101: seq=0 ttl=63 time=13.820 ms

--- 10.0.1.101 ping statistics ---
1 packets transmitted, 1 packets received, 0% packet loss
round-trip min/avg/max = 13.820/13.820/13.820 ms
--- STDOUT from router:openwrt2,platform:openwrt
PING 192.168.100.1 (192.168.100.1): 56 data bytes
64 bytes from 192.168.100.1: seq=0 ttl=64 time=12.647 ms

--- 192.168.100.1 ping statistics ---
1 packets transmitted, 1 packets received, 0% packet loss
round-trip min/avg/max = 12.647/12.647/12.647 ms
--- STDOUT from router:openwrt3,platform:openwrt
PING 192.168.100.1 (192.168.100.1): 56 data bytes
64 bytes from 192.168.100.1: seq=0 ttl=64 time=11.523 ms

--- 192.168.100.1 ping statistics ---
1 packets transmitted, 1 packets received, 0% packet loss
round-trip min/avg/max = 11.523/11.523/11.523 ms
--- STDOUT from router:openwrt2,platform:openwrt
PING 192.168.100.1 (192.168.100.1): 56 data bytes
64 bytes from 192.168.100.1: seq=0 ttl=64 time=6.907 ms

--- 192.168.100.1 ping statistics ---
1 packets transmitted, 1 packets received, 0% packet loss
round-trip min/avg/max = 6.907/6.907/6.907 ms
--- STDOUT from router:openwrt2,platform:openwrt
PING 192.168.100.1 (192.168.100.1): 56 data bytes
64 bytes from 192.168.100.1: seq=0 ttl=64 time=2.094 ms

--- 192.168.100.1 ping statistics ---
1 packets transmitted, 1 packets received, 0% packet loss
round-trip min/avg/max = 2.094/2.094/2.094 ms
--- STDOUT from router:openwrt3,platform:openwrt
PING 10.0.1.102 (10.0.1.102): 56 data bytes
64 bytes from 10.0.1.102: seq=0 ttl=63 time=10.151 ms

--- 10.0.1.102 ping statistics ---
1 packets transmitted, 1 packets received, 0% packet loss
round-trip min/avg/max = 10.151/10.151/10.151 ms
--- STDOUT from router:openwrt3,platform:openwrt
PING 10.0.1.1 (10.0.1.1): 56 data bytes
64 bytes from 10.0.1.1: seq=0 ttl=64 time=4.154 ms

--- 10.0.1.1 ping statistics ---
1 packets transmitted, 1 packets received, 0% packet loss
round-trip min/avg/max = 4.154/4.154/4.154 ms
--- STDOUT from router:openwrt2,platform:openwrt
PING 10.0.1.1 (10.0.1.1): 56 data bytes
64 bytes from 10.0.1.1: seq=0 ttl=64 time=1.201 ms

--- 10.0.1.1 ping statistics ---
1 packets transmitted, 1 packets received, 0% packet loss
round-trip min/avg/max = 1.201/1.201/1.201 ms
--- STDOUT from router:openwrt2,platform:openwrt
PING 8.8.8.8 (8.8.8.8): 56 data bytes
64 bytes from 8.8.8.8: seq=0 ttl=63 time=4.047 ms

--- 8.8.8.8 ping statistics ---
1 packets transmitted, 1 packets received, 0% packet loss
round-trip min/avg/max = 4.047/4.047/4.047 ms
--- STDOUT from router:openwrt2,platform:openwrt
PING 8.8.8.8 (8.8.8.8): 56 data bytes
64 bytes from 8.8.8.8: seq=0 ttl=63 time=2.961 ms

--- 8.8.8.8 ping statistics ---
1 packets transmitted, 1 packets received, 0% packet loss
round-trip min/avg/max = 2.961/2.961/2.961 ms
--- STDOUT from router:openwrt3,platform:openwrt
PING 8.8.8.8 (8.8.8.8): 56 data bytes
64 bytes from 8.8.8.8: seq=0 ttl=63 time=6.419 ms

--- 8.8.8.8 ping statistics ---
1 packets transmitted, 1 packets received, 0% packet loss
round-trip min/avg/max = 6.419/6.419/6.419 ms
--- STDOUT from router:openwrt3,platform:openwrt
PING 8.8.8.8 (8.8.8.8): 56 data bytes
64 bytes from 8.8.8.8: seq=0 ttl=63 time=7.231 ms

--- 8.8.8.8 ping statistics ---
1 packets transmitted, 1 packets received, 0% packet loss
round-trip min/avg/max = 7.231/7.231/7.231 ms
--- STDOUT from router:openwrt2,platform:openwrt
Hello World!
--- STDOUT from router:openwrt3,platform:openwrt
Hello World!
--- STDOUT from router:openwrt1,platform:openwrt
Hello World!
--- STDOUT from router:rpi1,platform:debian
Hello World!
--- STDOUT from router:openwrt1,platform:openwrt
PING 10.0.1.102 (10.0.1.102): 56 data bytes
64 bytes from 10.0.1.102: seq=0 ttl=64 time=15.232 ms

--- 10.0.1.102 ping statistics ---
1 packets transmitted, 1 packets received, 0% packet loss
round-trip min/avg/max = 15.232/15.232/15.232 ms
--- STDOUT from router:openwrt1,platform:openwrt
PING 10.0.1.102 (10.0.1.102): 56 data bytes
64 bytes from 10.0.1.102: seq=0 ttl=64 time=2.476 ms

--- 10.0.1.102 ping statistics ---
1 packets transmitted, 1 packets received, 0% packet loss
round-trip min/avg/max = 2.476/2.476/2.476 ms
--- STDOUT from router:openwrt1,platform:openwrt
PING 10.0.3.103 (10.0.3.103): 56 data bytes
64 bytes from 10.0.3.103: seq=0 ttl=64 time=5.709 ms

--- 10.0.3.103 ping statistics ---
1 packets transmitted, 1 packets received, 0% packet loss
round-trip min/avg/max = 5.709/5.709/5.709 ms
--- STDOUT from router:openwrt3,platform:openwrt
PING 10.0.1.101 (10.0.1.101): 56 data bytes
64 bytes from 10.0.1.101: seq=0 ttl=63 time=16.348 ms

--- 10.0.1.101 ping statistics ---
1 packets transmitted, 1 packets received, 0% packet loss
round-trip min/avg/max = 16.348/16.348/16.348 ms
--- STDOUT from router:openwrt2,platform:openwrt
PING 192.168.100.1 (192.168.100.1): 56 data bytes
64 bytes from 192.168.100.1: seq=0 ttl=64 time=12.616 ms

--- 192.168.100.1 ping statistics ---
1 packets transmitted, 1 packets received, 0% packet loss
round-trip min/avg/max = 12.616/12.616/12.616 ms
--- STDOUT from router:openwrt3,platform:openwrt
PING 192.168.100.1 (192.168.100.1): 56 data bytes
64 bytes from 192.168.100.1: seq=0 ttl=64 time=14.845 ms

--- 192.168.100.1 ping statistics ---
1 packets transmitted, 1 packets received, 0% packet loss
round-trip min/avg/max = 14.845/14.845/14.845 ms
--- STDOUT from router:openwrt2,platform:openwrt
PING 192.168.100.1 (192.168.100.1): 56 data bytes
64 bytes from 192.168.100.1: seq=0 ttl=64 time=5.883 ms

--- 192.168.100.1 ping statistics ---
1 packets transmitted, 1 packets received, 0% packet loss
round-trip min/avg/max = 5.883/5.883/5.883 ms
--- STDOUT from router:openwrt2,platform:openwrt
PING 192.168.100.1 (192.168.100.1): 56 data bytes
64 bytes from 192.168.100.1: seq=0 ttl=64 time=2.275 ms

--- 192.168.100.1 ping statistics ---
1 packets transmitted, 1 packets received, 0% packet loss
round-trip min/avg/max = 2.275/2.275/2.275 ms
--- STDOUT from router:openwrt3,platform:openwrt
PING 10.0.1.102 (10.0.1.102): 56 data bytes
64 bytes from 10.0.1.102: seq=0 ttl=63 time=9.241 ms

--- 10.0.1.102 ping statistics ---
1 packets transmitted, 1 packets received, 0% packet loss
round-trip min/avg/max = 9.241/9.241/9.241 ms
--- STDOUT from router:openwrt3,platform:openwrt
PING 10.0.1.1 (10.0.1.1): 56 data bytes
64 bytes from 10.0.1.1: seq=0 ttl=64 time=2.501 ms

--- 10.0.1.1 ping statistics ---
1 packets transmitted, 1 packets received, 0% packet loss
round-trip min/avg/max = 2.501/2.501/2.501 ms
--- STDOUT from router:openwrt2,platform:openwrt
PING 10.0.1.1 (10.0.1.1): 56 data bytes
64 bytes from 10.0.1.1: seq=0 ttl=64 time=1.404 ms

--- 10.0.1.1 ping statistics ---
1 packets transmitted, 1 packets received, 0% packet loss
round-trip min/avg/max = 1.404/1.404/1.404 ms
--- STDOUT from router:openwrt2,platform:openwrt
PING 8.8.8.8 (8.8.8.8): 56 data bytes
64 bytes from 8.8.8.8: seq=0 ttl=63 time=8.101 ms

--- 8.8.8.8 ping statistics ---
1 packets transmitted, 1 packets received, 0% packet loss
round-trip min/avg/max = 8.101/8.101/8.101 ms
--- STDOUT from router:openwrt2,platform:openwrt
PING 8.8.8.8 (8.8.8.8): 56 data bytes
64 bytes from 8.8.8.8: seq=0 ttl=63 time=2.935 ms

--- 8.8.8.8 ping statistics ---
1 packets transmitted, 1 packets received, 0% packet loss
round-trip min/avg/max = 2.935/2.935/2.935 ms
--- STDOUT from router:openwrt3,platform:openwrt
PING 8.8.8.8 (8.8.8.8): 56 data bytes
64 bytes from 8.8.8.8: seq=0 ttl=63 time=5.711 ms

--- 8.8.8.8 ping statistics ---
1 packets transmitted, 1 packets received, 0% packet loss
round-trip min/avg/max = 5.711/5.711/5.711 ms
--- STDOUT from router:openwrt3,platform:openwrt
PING 8.8.8.8 (8.8.8.8): 56 data bytes
64 bytes from 8.8.8.8: seq=0 ttl=63 time=6.419 ms

--- 8.8.8.8 ping statistics ---
1 packets transmitted, 1 packets received, 0% packet loss
round-trip min/avg/max = 6.419/6.419/6.419 ms
